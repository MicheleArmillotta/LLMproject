[
  {
    "function_name": "WriteVersion",
    "container": "CTxDB",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/txdb-leveldb.h",
    "lines": "181-184",
    "snippet": "bool WriteVersion(int nVersion)\n    {\n        return Write(std::string(\"version\"), nVersion);\n    }",
    "includes": [
      "#include <leveldb/write_batch.h>",
      "#include <leveldb/db.h>",
      "#include <vector>",
      "#include <string>",
      "#include <map>",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "Write",
          "args": [
            "std::string(\"version\")",
            "nVersion"
          ],
          "line": 183
        },
        "resolved": true,
        "details": {
          "function_name": "Write",
          "container": "CTxDB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/txdb-leveldb.h",
          "lines": "101-123",
          "snippet": "bool Write(const K& key, const T& value)\n    {\n        if (fReadOnly)\n            assert(!\"Write called on database in read-only mode\");\n\n        CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n        ssKey.reserve(1000);\n        ssKey << key;\n        CDataStream ssValue(SER_DISK, CLIENT_VERSION);\n        ssValue.reserve(10000);\n        ssValue << value;\n\n        if (activeBatch) {\n            activeBatch->Put(ssKey.str(), ssValue.str());\n            return true;\n        }\n        leveldb::Status status = pdb->Put(leveldb::WriteOptions(), ssKey.str(), ssValue.str());\n        if (!status.ok()) {\n            printf(\"LevelDB write failure: %s\\n\", status.ToString().c_str());\n            return false;\n        }\n        return true;\n    }",
          "includes": [
            "#include <leveldb/write_batch.h>",
            "#include <leveldb/db.h>",
            "#include <vector>",
            "#include <string>",
            "#include <map>",
            "#include \"main.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <leveldb/write_batch.h>\n#include <leveldb/db.h>\n#include <vector>\n#include <string>\n#include <map>\n#include \"main.h\"\n\nCTxDB {\n  bool Write(const K& key, const T& value)\n      {\n          if (fReadOnly)\n              assert(!\"Write called on database in read-only mode\");\n  \n          CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n          ssKey.reserve(1000);\n          ssKey << key;\n          CDataStream ssValue(SER_DISK, CLIENT_VERSION);\n          ssValue.reserve(10000);\n          ssValue << value;\n  \n          if (activeBatch) {\n              activeBatch->Put(ssKey.str(), ssValue.str());\n              return true;\n          }\n          leveldb::Status status = pdb->Put(leveldb::WriteOptions(), ssKey.str(), ssValue.str());\n          if (!status.ok()) {\n              printf(\"LevelDB write failure: %s\\n\", status.ToString().c_str());\n              return false;\n          }\n          return true;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "std::string",
          "args": [
            "\"version\""
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <leveldb/write_batch.h>\n#include <leveldb/db.h>\n#include <vector>\n#include <string>\n#include <map>\n#include \"main.h\"\n\nCTxDB {\n  bool WriteVersion(int nVersion)\n      {\n          return Write(std::string(\"version\"), nVersion);\n      }\n}"
  },
  {
    "function_name": "ReadVersion",
    "container": "CTxDB",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/txdb-leveldb.h",
    "lines": "175-179",
    "snippet": "bool ReadVersion(int& nVersion)\n    {\n        nVersion = 0;\n        return Read(std::string(\"version\"), nVersion);\n    }",
    "includes": [
      "#include <leveldb/write_batch.h>",
      "#include <leveldb/db.h>",
      "#include <vector>",
      "#include <string>",
      "#include <map>",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "Read",
          "args": [
            "std::string(\"version\")",
            "nVersion"
          ],
          "line": 178
        },
        "resolved": true,
        "details": {
          "function_name": "Read",
          "container": "CTxDB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/txdb-leveldb.h",
          "lines": "60-98",
          "snippet": "bool Read(const K& key, T& value)\n    {\n        CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n        ssKey.reserve(1000);\n        ssKey << key;\n        std::string strValue;\n\n        bool readFromDb = true;\n        if (activeBatch) {\n            // First we must search for it in the currently pending set of\n            // changes to the db. If not found in the batch, go on to read disk.\n            bool deleted = false;\n            readFromDb = ScanBatch(ssKey, &strValue, &deleted) == false;\n            if (deleted) {\n                return false;\n            }\n        }\n        if (readFromDb) {\n            leveldb::Status status = pdb->Get(leveldb::ReadOptions(),\n                                              ssKey.str(), &strValue);\n            if (!status.ok()) {\n                if (status.IsNotFound())\n                    return false;\n                // Some unexpected error.\n                printf(\"LevelDB read failure: %s\\n\", status.ToString().c_str());\n                return false;\n            }\n        }\n        // Unserialize value\n        try {\n            CDataStream ssValue(strValue.data(), strValue.data() + strValue.size(),\n                                SER_DISK, CLIENT_VERSION);\n            ssValue >> value;\n        }\n        catch (std::exception &e) {\n            return false;\n        }\n        return true;\n    }",
          "includes": [
            "#include <leveldb/write_batch.h>",
            "#include <leveldb/db.h>",
            "#include <vector>",
            "#include <string>",
            "#include <map>",
            "#include \"main.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <leveldb/write_batch.h>\n#include <leveldb/db.h>\n#include <vector>\n#include <string>\n#include <map>\n#include \"main.h\"\n\nCTxDB {\n  bool Read(const K& key, T& value)\n      {\n          CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n          ssKey.reserve(1000);\n          ssKey << key;\n          std::string strValue;\n  \n          bool readFromDb = true;\n          if (activeBatch) {\n              // First we must search for it in the currently pending set of\n              // changes to the db. If not found in the batch, go on to read disk.\n              bool deleted = false;\n              readFromDb = ScanBatch(ssKey, &strValue, &deleted) == false;\n              if (deleted) {\n                  return false;\n              }\n          }\n          if (readFromDb) {\n              leveldb::Status status = pdb->Get(leveldb::ReadOptions(),\n                                                ssKey.str(), &strValue);\n              if (!status.ok()) {\n                  if (status.IsNotFound())\n                      return false;\n                  // Some unexpected error.\n                  printf(\"LevelDB read failure: %s\\n\", status.ToString().c_str());\n                  return false;\n              }\n          }\n          // Unserialize value\n          try {\n              CDataStream ssValue(strValue.data(), strValue.data() + strValue.size(),\n                                  SER_DISK, CLIENT_VERSION);\n              ssValue >> value;\n          }\n          catch (std::exception &e) {\n              return false;\n          }\n          return true;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "std::string",
          "args": [
            "\"version\""
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <leveldb/write_batch.h>\n#include <leveldb/db.h>\n#include <vector>\n#include <string>\n#include <map>\n#include \"main.h\"\n\nCTxDB {\n  bool ReadVersion(int& nVersion)\n      {\n          nVersion = 0;\n          return Read(std::string(\"version\"), nVersion);\n      }\n}"
  },
  {
    "function_name": "TxnAbort",
    "container": "CTxDB",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/txdb-leveldb.h",
    "lines": "168-173",
    "snippet": "bool TxnAbort()\n    {\n        delete activeBatch;\n        activeBatch = NULL;\n        return true;\n    }",
    "includes": [
      "#include <leveldb/write_batch.h>",
      "#include <leveldb/db.h>",
      "#include <vector>",
      "#include <string>",
      "#include <map>",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <leveldb/write_batch.h>\n#include <leveldb/db.h>\n#include <vector>\n#include <string>\n#include <map>\n#include \"main.h\"\n\nCTxDB {\n  bool TxnAbort()\n      {\n          delete activeBatch;\n          activeBatch = NULL;\n          return true;\n      }\n}"
  },
  {
    "function_name": "Exists",
    "container": "CTxDB",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/txdb-leveldb.h",
    "lines": "145-162",
    "snippet": "bool Exists(const K& key)\n    {\n        CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n        ssKey.reserve(1000);\n        ssKey << key;\n        std::string unused;\n\n        if (activeBatch) {\n            bool deleted;\n            if (ScanBatch(ssKey, &unused, &deleted) && !deleted) {\n                return true;\n            }\n        }\n\n\n        leveldb::Status status = pdb->Get(leveldb::ReadOptions(), ssKey.str(), &unused);\n        return status.IsNotFound() == false;\n    }",
    "includes": [
      "#include <leveldb/write_batch.h>",
      "#include <leveldb/db.h>",
      "#include <vector>",
      "#include <string>",
      "#include <map>",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "status.IsNotFound",
          "args": [],
          "line": 161
        },
        "resolved": true,
        "details": {
          "function_name": "IsNotFound",
          "container": "Status",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/include/leveldb/status.h",
          "lines": "55-55",
          "snippet": "bool IsNotFound() const { return code() == kNotFound; }",
          "includes": [
            "#include \"leveldb/slice.h\"",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/slice.h\"\n#include <string>\n\nStatus {\n  bool IsNotFound() const { return code() == kNotFound; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pdb->Get",
          "args": [
            "leveldb::ReadOptions()",
            "ssKey.str()",
            "&unused"
          ],
          "line": 160
        },
        "resolved": true,
        "details": {
          "function_name": "Get",
          "container": "CSignatureCache",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/script.cpp",
          "lines": "1211-1221",
          "snippet": "bool\n    Get(uint256 hash, const std::vector<unsigned char>& vchSig, const std::vector<unsigned char>& pubKey)\n    {\n        LOCK(cs_sigcache);\n\n        sigdata_type k(hash, vchSig, pubKey);\n        std::set<sigdata_type>::iterator mi = setValid.find(k);\n        if (mi != setValid.end())\n            return true;\n        return false;\n    }",
          "includes": [
            "#include \"util.h\"",
            "#include \"sync.h\"",
            "#include \"main.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include \"keystore.h\"",
            "#include \"script.h\"",
            "#include <boost/tuple/tuple_comparison.hpp>",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/foreach.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"sync.h\"\n#include \"main.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include \"keystore.h\"\n#include \"script.h\"\n#include <boost/tuple/tuple_comparison.hpp>\n#include <boost/tuple/tuple.hpp>\n#include <boost/foreach.hpp>\n\nCSignatureCache {\n  bool\n      Get(uint256 hash, const std::vector<unsigned char>& vchSig, const std::vector<unsigned char>& pubKey)\n      {\n          LOCK(cs_sigcache);\n  \n          sigdata_type k(hash, vchSig, pubKey);\n          std::set<sigdata_type>::iterator mi = setValid.find(k);\n          if (mi != setValid.end())\n              return true;\n          return false;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssKey.str",
          "args": [],
          "line": 160
        },
        "resolved": true,
        "details": {
          "function_name": "str",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "789-792",
          "snippet": "std::string str() const\n    {\n        return (std::string(begin(), end()));\n    }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  std::string str() const\n      {\n          return (std::string(begin(), end()));\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "leveldb::ReadOptions",
          "args": [],
          "line": 160
        },
        "resolved": true,
        "details": {
          "function_name": "ReadOptions",
          "container": "ReadOptions",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/include/leveldb/options.h",
          "lines": "161-165",
          "snippet": "ReadOptions()\n      : verify_checksums(false),\n        fill_cache(true),\n        snapshot(NULL) {\n  }",
          "includes": [
            "#include <stddef.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stddef.h>\n\nReadOptions {\n  ReadOptions()\n        : verify_checksums(false),\n          fill_cache(true),\n          snapshot(NULL) {\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ScanBatch",
          "args": [
            "ssKey",
            "&unused",
            "&deleted"
          ],
          "line": 154
        },
        "resolved": true,
        "details": {
          "function_name": "ScanBatch",
          "container": "CTxDB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/txdb-leveldb.cpp",
          "lines": "185-197",
          "snippet": "bool CTxDB::ScanBatch(const CDataStream &key, string *value, bool *deleted) const {\n    assert(activeBatch);\n    *deleted = false;\n    CBatchScanner scanner;\n    scanner.needle = key.str();\n    scanner.deleted = deleted;\n    scanner.foundValue = value;\n    leveldb::Status status = activeBatch->Iterate(&scanner);\n    if (!status.ok()) {\n        throw runtime_error(status.ToString());\n    }\n    return scanner.foundEntry;\n}",
          "includes": [
            "#include \"main.h\"",
            "#include \"util.h\"",
            "#include \"txdb.h\"",
            "#include \"checkpoints.h\"",
            "#include \"kernel.h\"",
            "#include <memenv/memenv.h>",
            "#include <leveldb/filter_policy.h>",
            "#include <leveldb/cache.h>",
            "#include <leveldb/env.h>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/version.hpp>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"main.h\"\n#include \"util.h\"\n#include \"txdb.h\"\n#include \"checkpoints.h\"\n#include \"kernel.h\"\n#include <memenv/memenv.h>\n#include <leveldb/filter_policy.h>\n#include <leveldb/cache.h>\n#include <leveldb/env.h>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/version.hpp>\n#include <map>\n\nCTxDB {\n  bool CTxDB::ScanBatch(const CDataStream &key, string *value, bool *deleted) const {\n      assert(activeBatch);\n      *deleted = false;\n      CBatchScanner scanner;\n      scanner.needle = key.str();\n      scanner.deleted = deleted;\n      scanner.foundValue = value;\n      leveldb::Status status = activeBatch->Iterate(&scanner);\n      if (!status.ok()) {\n          throw runtime_error(status.ToString());\n      }\n      return scanner.foundEntry;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssKey.reserve",
          "args": [
            "1000"
          ],
          "line": 148
        },
        "resolved": true,
        "details": {
          "function_name": "reserve",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "805-805",
          "snippet": "void reserve(size_type n)                        { vch.reserve(n + nReadPos); }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  void reserve(size_type n)                        { vch.reserve(n + nReadPos); }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <leveldb/write_batch.h>\n#include <leveldb/db.h>\n#include <vector>\n#include <string>\n#include <map>\n#include \"main.h\"\n\nCTxDB {\n  bool Exists(const K& key)\n      {\n          CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n          ssKey.reserve(1000);\n          ssKey << key;\n          std::string unused;\n  \n          if (activeBatch) {\n              bool deleted;\n              if (ScanBatch(ssKey, &unused, &deleted) && !deleted) {\n                  return true;\n              }\n          }\n  \n  \n          leveldb::Status status = pdb->Get(leveldb::ReadOptions(), ssKey.str(), &unused);\n          return status.IsNotFound() == false;\n      }\n}"
  },
  {
    "function_name": "Erase",
    "container": "CTxDB",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/txdb-leveldb.h",
    "lines": "126-142",
    "snippet": "bool Erase(const K& key)\n    {\n        if (!pdb)\n            return false;\n        if (fReadOnly)\n            assert(!\"Erase called on database in read-only mode\");\n\n        CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n        ssKey.reserve(1000);\n        ssKey << key;\n        if (activeBatch) {\n            activeBatch->Delete(ssKey.str());\n            return true;\n        }\n        leveldb::Status status = pdb->Delete(leveldb::WriteOptions(), ssKey.str());\n        return (status.ok() || status.IsNotFound());\n    }",
    "includes": [
      "#include <leveldb/write_batch.h>",
      "#include <leveldb/db.h>",
      "#include <vector>",
      "#include <string>",
      "#include <map>",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "status.IsNotFound",
          "args": [],
          "line": 141
        },
        "resolved": true,
        "details": {
          "function_name": "IsNotFound",
          "container": "Status",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/include/leveldb/status.h",
          "lines": "55-55",
          "snippet": "bool IsNotFound() const { return code() == kNotFound; }",
          "includes": [
            "#include \"leveldb/slice.h\"",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/slice.h\"\n#include <string>\n\nStatus {\n  bool IsNotFound() const { return code() == kNotFound; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "status.ok",
          "args": [],
          "line": 141
        },
        "resolved": true,
        "details": {
          "function_name": "ok",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/include/leveldb/table_builder.h",
          "lines": "78-78",
          "snippet": "bool ok() const { return status().ok(); }",
          "includes": [
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/options.h\"",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/status.h\"\n#include \"leveldb/options.h\"\n#include <stdint.h>\n\nTableBuilder {\n  bool ok() const { return status().ok(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pdb->Delete",
          "args": [
            "leveldb::WriteOptions()",
            "ssKey.str()"
          ],
          "line": 140
        },
        "resolved": true,
        "details": {
          "function_name": "Delete",
          "container": "DB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/db/db_impl.cc",
          "lines": "1437-1441",
          "snippet": "Status DB::Delete(const WriteOptions& opt, const Slice& key) {\n  WriteBatch batch;\n  batch.Delete(key);\n  return Write(opt, &batch);\n}",
          "includes": [
            "#include \"util/mutexlock.h\"",
            "#include \"util/logging.h\"",
            "#include \"util/coding.h\"",
            "#include \"table/two_level_iterator.h\"",
            "#include \"table/merger.h\"",
            "#include \"table/block.h\"",
            "#include \"port/port.h\"",
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/table.h\"",
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"leveldb/db.h\"",
            "#include \"db/write_batch_internal.h\"",
            "#include \"db/version_set.h\"",
            "#include \"db/table_cache.h\"",
            "#include \"db/memtable.h\"",
            "#include \"db/log_writer.h\"",
            "#include \"db/log_reader.h\"",
            "#include \"db/filename.h\"",
            "#include \"db/dbformat.h\"",
            "#include \"db/db_iter.h\"",
            "#include \"db/builder.h\"",
            "#include <vector>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <string>",
            "#include <set>",
            "#include <algorithm>",
            "#include \"db/db_impl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/mutexlock.h\"\n#include \"util/logging.h\"\n#include \"util/coding.h\"\n#include \"table/two_level_iterator.h\"\n#include \"table/merger.h\"\n#include \"table/block.h\"\n#include \"port/port.h\"\n#include \"leveldb/table_builder.h\"\n#include \"leveldb/table.h\"\n#include \"leveldb/status.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/db.h\"\n#include \"db/write_batch_internal.h\"\n#include \"db/version_set.h\"\n#include \"db/table_cache.h\"\n#include \"db/memtable.h\"\n#include \"db/log_writer.h\"\n#include \"db/log_reader.h\"\n#include \"db/filename.h\"\n#include \"db/dbformat.h\"\n#include \"db/db_iter.h\"\n#include \"db/builder.h\"\n#include <vector>\n#include <stdio.h>\n#include <stdint.h>\n#include <string>\n#include <set>\n#include <algorithm>\n#include \"db/db_impl.h\"\n\nDB {\n  Status DB::Delete(const WriteOptions& opt, const Slice& key) {\n    WriteBatch batch;\n    batch.Delete(key);\n    return Write(opt, &batch);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssKey.str",
          "args": [],
          "line": 140
        },
        "resolved": true,
        "details": {
          "function_name": "str",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "789-792",
          "snippet": "std::string str() const\n    {\n        return (std::string(begin(), end()));\n    }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  std::string str() const\n      {\n          return (std::string(begin(), end()));\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "leveldb::WriteOptions",
          "args": [],
          "line": 140
        },
        "resolved": true,
        "details": {
          "function_name": "WriteOptions",
          "container": "WriteOptions",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/include/leveldb/options.h",
          "lines": "188-190",
          "snippet": "WriteOptions()\n      : sync(false) {\n  }",
          "includes": [
            "#include <stddef.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stddef.h>\n\nWriteOptions {\n  WriteOptions()\n        : sync(false) {\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "activeBatch->Delete",
          "args": [
            "ssKey.str()"
          ],
          "line": 137
        },
        "resolved": true,
        "details": {
          "function_name": "Delete",
          "container": "CBatchScanner",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/txdb-leveldb.cpp",
          "lines": "172-177",
          "snippet": "virtual void Delete(const leveldb::Slice& key) {\n        if (key.ToString() == needle) {\n            foundEntry = true;\n            *deleted = true;\n        }\n    }",
          "includes": [
            "#include \"main.h\"",
            "#include \"util.h\"",
            "#include \"txdb.h\"",
            "#include \"checkpoints.h\"",
            "#include \"kernel.h\"",
            "#include <memenv/memenv.h>",
            "#include <leveldb/filter_policy.h>",
            "#include <leveldb/cache.h>",
            "#include <leveldb/env.h>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/version.hpp>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"main.h\"\n#include \"util.h\"\n#include \"txdb.h\"\n#include \"checkpoints.h\"\n#include \"kernel.h\"\n#include <memenv/memenv.h>\n#include <leveldb/filter_policy.h>\n#include <leveldb/cache.h>\n#include <leveldb/env.h>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/version.hpp>\n#include <map>\n\nCBatchScanner {\n  virtual void Delete(const leveldb::Slice& key) {\n          if (key.ToString() == needle) {\n              foundEntry = true;\n              *deleted = true;\n          }\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssKey.reserve",
          "args": [
            "1000"
          ],
          "line": 134
        },
        "resolved": true,
        "details": {
          "function_name": "reserve",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "805-805",
          "snippet": "void reserve(size_type n)                        { vch.reserve(n + nReadPos); }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  void reserve(size_type n)                        { vch.reserve(n + nReadPos); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "!\"Erase called on database in read-only mode\""
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <leveldb/write_batch.h>\n#include <leveldb/db.h>\n#include <vector>\n#include <string>\n#include <map>\n#include \"main.h\"\n\nCTxDB {\n  bool Erase(const K& key)\n      {\n          if (!pdb)\n              return false;\n          if (fReadOnly)\n              assert(!\"Erase called on database in read-only mode\");\n  \n          CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n          ssKey.reserve(1000);\n          ssKey << key;\n          if (activeBatch) {\n              activeBatch->Delete(ssKey.str());\n              return true;\n          }\n          leveldb::Status status = pdb->Delete(leveldb::WriteOptions(), ssKey.str());\n          return (status.ok() || status.IsNotFound());\n      }\n}"
  },
  {
    "function_name": "Write",
    "container": "CTxDB",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/txdb-leveldb.h",
    "lines": "101-123",
    "snippet": "bool Write(const K& key, const T& value)\n    {\n        if (fReadOnly)\n            assert(!\"Write called on database in read-only mode\");\n\n        CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n        ssKey.reserve(1000);\n        ssKey << key;\n        CDataStream ssValue(SER_DISK, CLIENT_VERSION);\n        ssValue.reserve(10000);\n        ssValue << value;\n\n        if (activeBatch) {\n            activeBatch->Put(ssKey.str(), ssValue.str());\n            return true;\n        }\n        leveldb::Status status = pdb->Put(leveldb::WriteOptions(), ssKey.str(), ssValue.str());\n        if (!status.ok()) {\n            printf(\"LevelDB write failure: %s\\n\", status.ToString().c_str());\n            return false;\n        }\n        return true;\n    }",
    "includes": [
      "#include <leveldb/write_batch.h>",
      "#include <leveldb/db.h>",
      "#include <vector>",
      "#include <string>",
      "#include <map>",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"LevelDB write failure: %s\\n\"",
            "status.ToString().c_str()"
          ],
          "line": 119
        },
        "resolved": true,
        "details": {
          "function_name": "real_strprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "331-338",
          "snippet": "string real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nstring real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "status.ToString",
          "args": [],
          "line": 119
        },
        "resolved": true,
        "details": {
          "function_name": "ToString",
          "container": "CService",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "1172-1175",
          "snippet": "std::string CService::ToString() const\n{\n    return ToStringIPPort();\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCService {\n  std::string CService::ToString() const\n  {\n      return ToStringIPPort();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "status.ok",
          "args": [],
          "line": 118
        },
        "resolved": true,
        "details": {
          "function_name": "ok",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/include/leveldb/table_builder.h",
          "lines": "78-78",
          "snippet": "bool ok() const { return status().ok(); }",
          "includes": [
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/options.h\"",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/status.h\"\n#include \"leveldb/options.h\"\n#include <stdint.h>\n\nTableBuilder {\n  bool ok() const { return status().ok(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pdb->Put",
          "args": [
            "leveldb::WriteOptions()",
            "ssKey.str()",
            "ssValue.str()"
          ],
          "line": 117
        },
        "resolved": true,
        "details": {
          "function_name": "Put",
          "container": "DB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/db/db_impl.cc",
          "lines": "1431-1435",
          "snippet": "Status DB::Put(const WriteOptions& opt, const Slice& key, const Slice& value) {\n  WriteBatch batch;\n  batch.Put(key, value);\n  return Write(opt, &batch);\n}",
          "includes": [
            "#include \"util/mutexlock.h\"",
            "#include \"util/logging.h\"",
            "#include \"util/coding.h\"",
            "#include \"table/two_level_iterator.h\"",
            "#include \"table/merger.h\"",
            "#include \"table/block.h\"",
            "#include \"port/port.h\"",
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/table.h\"",
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"leveldb/db.h\"",
            "#include \"db/write_batch_internal.h\"",
            "#include \"db/version_set.h\"",
            "#include \"db/table_cache.h\"",
            "#include \"db/memtable.h\"",
            "#include \"db/log_writer.h\"",
            "#include \"db/log_reader.h\"",
            "#include \"db/filename.h\"",
            "#include \"db/dbformat.h\"",
            "#include \"db/db_iter.h\"",
            "#include \"db/builder.h\"",
            "#include <vector>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <string>",
            "#include <set>",
            "#include <algorithm>",
            "#include \"db/db_impl.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/mutexlock.h\"\n#include \"util/logging.h\"\n#include \"util/coding.h\"\n#include \"table/two_level_iterator.h\"\n#include \"table/merger.h\"\n#include \"table/block.h\"\n#include \"port/port.h\"\n#include \"leveldb/table_builder.h\"\n#include \"leveldb/table.h\"\n#include \"leveldb/status.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/db.h\"\n#include \"db/write_batch_internal.h\"\n#include \"db/version_set.h\"\n#include \"db/table_cache.h\"\n#include \"db/memtable.h\"\n#include \"db/log_writer.h\"\n#include \"db/log_reader.h\"\n#include \"db/filename.h\"\n#include \"db/dbformat.h\"\n#include \"db/db_iter.h\"\n#include \"db/builder.h\"\n#include <vector>\n#include <stdio.h>\n#include <stdint.h>\n#include <string>\n#include <set>\n#include <algorithm>\n#include \"db/db_impl.h\"\n\nDB {\n  Status DB::Put(const WriteOptions& opt, const Slice& key, const Slice& value) {\n    WriteBatch batch;\n    batch.Put(key, value);\n    return Write(opt, &batch);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssValue.str",
          "args": [],
          "line": 117
        },
        "resolved": true,
        "details": {
          "function_name": "str",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "789-792",
          "snippet": "std::string str() const\n    {\n        return (std::string(begin(), end()));\n    }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  std::string str() const\n      {\n          return (std::string(begin(), end()));\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "leveldb::WriteOptions",
          "args": [],
          "line": 117
        },
        "resolved": true,
        "details": {
          "function_name": "WriteOptions",
          "container": "WriteOptions",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/include/leveldb/options.h",
          "lines": "188-190",
          "snippet": "WriteOptions()\n      : sync(false) {\n  }",
          "includes": [
            "#include <stddef.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stddef.h>\n\nWriteOptions {\n  WriteOptions()\n        : sync(false) {\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "activeBatch->Put",
          "args": [
            "ssKey.str()",
            "ssValue.str()"
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "Put",
          "container": "CBatchScanner",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/txdb-leveldb.cpp",
          "lines": "164-170",
          "snippet": "virtual void Put(const leveldb::Slice& key, const leveldb::Slice& value) {\n        if (key.ToString() == needle) {\n            foundEntry = true;\n            *deleted = false;\n            *foundValue = value.ToString();\n        }\n    }",
          "includes": [
            "#include \"main.h\"",
            "#include \"util.h\"",
            "#include \"txdb.h\"",
            "#include \"checkpoints.h\"",
            "#include \"kernel.h\"",
            "#include <memenv/memenv.h>",
            "#include <leveldb/filter_policy.h>",
            "#include <leveldb/cache.h>",
            "#include <leveldb/env.h>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/version.hpp>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"main.h\"\n#include \"util.h\"\n#include \"txdb.h\"\n#include \"checkpoints.h\"\n#include \"kernel.h\"\n#include <memenv/memenv.h>\n#include <leveldb/filter_policy.h>\n#include <leveldb/cache.h>\n#include <leveldb/env.h>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/version.hpp>\n#include <map>\n\nCBatchScanner {\n  virtual void Put(const leveldb::Slice& key, const leveldb::Slice& value) {\n          if (key.ToString() == needle) {\n              foundEntry = true;\n              *deleted = false;\n              *foundValue = value.ToString();\n          }\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssValue.reserve",
          "args": [
            "10000"
          ],
          "line": 110
        },
        "resolved": true,
        "details": {
          "function_name": "reserve",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "805-805",
          "snippet": "void reserve(size_type n)                        { vch.reserve(n + nReadPos); }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  void reserve(size_type n)                        { vch.reserve(n + nReadPos); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "!\"Write called on database in read-only mode\""
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <leveldb/write_batch.h>\n#include <leveldb/db.h>\n#include <vector>\n#include <string>\n#include <map>\n#include \"main.h\"\n\nCTxDB {\n  bool Write(const K& key, const T& value)\n      {\n          if (fReadOnly)\n              assert(!\"Write called on database in read-only mode\");\n  \n          CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n          ssKey.reserve(1000);\n          ssKey << key;\n          CDataStream ssValue(SER_DISK, CLIENT_VERSION);\n          ssValue.reserve(10000);\n          ssValue << value;\n  \n          if (activeBatch) {\n              activeBatch->Put(ssKey.str(), ssValue.str());\n              return true;\n          }\n          leveldb::Status status = pdb->Put(leveldb::WriteOptions(), ssKey.str(), ssValue.str());\n          if (!status.ok()) {\n              printf(\"LevelDB write failure: %s\\n\", status.ToString().c_str());\n              return false;\n          }\n          return true;\n      }\n}"
  },
  {
    "function_name": "Read",
    "container": "CTxDB",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/txdb-leveldb.h",
    "lines": "60-98",
    "snippet": "bool Read(const K& key, T& value)\n    {\n        CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n        ssKey.reserve(1000);\n        ssKey << key;\n        std::string strValue;\n\n        bool readFromDb = true;\n        if (activeBatch) {\n            // First we must search for it in the currently pending set of\n            // changes to the db. If not found in the batch, go on to read disk.\n            bool deleted = false;\n            readFromDb = ScanBatch(ssKey, &strValue, &deleted) == false;\n            if (deleted) {\n                return false;\n            }\n        }\n        if (readFromDb) {\n            leveldb::Status status = pdb->Get(leveldb::ReadOptions(),\n                                              ssKey.str(), &strValue);\n            if (!status.ok()) {\n                if (status.IsNotFound())\n                    return false;\n                // Some unexpected error.\n                printf(\"LevelDB read failure: %s\\n\", status.ToString().c_str());\n                return false;\n            }\n        }\n        // Unserialize value\n        try {\n            CDataStream ssValue(strValue.data(), strValue.data() + strValue.size(),\n                                SER_DISK, CLIENT_VERSION);\n            ssValue >> value;\n        }\n        catch (std::exception &e) {\n            return false;\n        }\n        return true;\n    }",
    "includes": [
      "#include <leveldb/write_batch.h>",
      "#include <leveldb/db.h>",
      "#include <vector>",
      "#include <string>",
      "#include <map>",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "strValue.size",
          "args": [],
          "line": 90
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "strValue.data",
          "args": [],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strValue.data",
          "args": [],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"LevelDB read failure: %s\\n\"",
            "status.ToString().c_str()"
          ],
          "line": 84
        },
        "resolved": true,
        "details": {
          "function_name": "real_strprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "331-338",
          "snippet": "string real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nstring real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "status.ToString",
          "args": [],
          "line": 84
        },
        "resolved": true,
        "details": {
          "function_name": "ToString",
          "container": "CService",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "1172-1175",
          "snippet": "std::string CService::ToString() const\n{\n    return ToStringIPPort();\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCService {\n  std::string CService::ToString() const\n  {\n      return ToStringIPPort();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "status.IsNotFound",
          "args": [],
          "line": 81
        },
        "resolved": true,
        "details": {
          "function_name": "IsNotFound",
          "container": "Status",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/include/leveldb/status.h",
          "lines": "55-55",
          "snippet": "bool IsNotFound() const { return code() == kNotFound; }",
          "includes": [
            "#include \"leveldb/slice.h\"",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/slice.h\"\n#include <string>\n\nStatus {\n  bool IsNotFound() const { return code() == kNotFound; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "status.ok",
          "args": [],
          "line": 80
        },
        "resolved": true,
        "details": {
          "function_name": "ok",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/include/leveldb/table_builder.h",
          "lines": "78-78",
          "snippet": "bool ok() const { return status().ok(); }",
          "includes": [
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/options.h\"",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/status.h\"\n#include \"leveldb/options.h\"\n#include <stdint.h>\n\nTableBuilder {\n  bool ok() const { return status().ok(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pdb->Get",
          "args": [
            "leveldb::ReadOptions()",
            "ssKey.str()",
            "&strValue"
          ],
          "line": 78
        },
        "resolved": true,
        "details": {
          "function_name": "Get",
          "container": "CSignatureCache",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/script.cpp",
          "lines": "1211-1221",
          "snippet": "bool\n    Get(uint256 hash, const std::vector<unsigned char>& vchSig, const std::vector<unsigned char>& pubKey)\n    {\n        LOCK(cs_sigcache);\n\n        sigdata_type k(hash, vchSig, pubKey);\n        std::set<sigdata_type>::iterator mi = setValid.find(k);\n        if (mi != setValid.end())\n            return true;\n        return false;\n    }",
          "includes": [
            "#include \"util.h\"",
            "#include \"sync.h\"",
            "#include \"main.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include \"keystore.h\"",
            "#include \"script.h\"",
            "#include <boost/tuple/tuple_comparison.hpp>",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/foreach.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"sync.h\"\n#include \"main.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include \"keystore.h\"\n#include \"script.h\"\n#include <boost/tuple/tuple_comparison.hpp>\n#include <boost/tuple/tuple.hpp>\n#include <boost/foreach.hpp>\n\nCSignatureCache {\n  bool\n      Get(uint256 hash, const std::vector<unsigned char>& vchSig, const std::vector<unsigned char>& pubKey)\n      {\n          LOCK(cs_sigcache);\n  \n          sigdata_type k(hash, vchSig, pubKey);\n          std::set<sigdata_type>::iterator mi = setValid.find(k);\n          if (mi != setValid.end())\n              return true;\n          return false;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssKey.str",
          "args": [],
          "line": 79
        },
        "resolved": true,
        "details": {
          "function_name": "str",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "789-792",
          "snippet": "std::string str() const\n    {\n        return (std::string(begin(), end()));\n    }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  std::string str() const\n      {\n          return (std::string(begin(), end()));\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "leveldb::ReadOptions",
          "args": [],
          "line": 78
        },
        "resolved": true,
        "details": {
          "function_name": "ReadOptions",
          "container": "ReadOptions",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/include/leveldb/options.h",
          "lines": "161-165",
          "snippet": "ReadOptions()\n      : verify_checksums(false),\n        fill_cache(true),\n        snapshot(NULL) {\n  }",
          "includes": [
            "#include <stddef.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stddef.h>\n\nReadOptions {\n  ReadOptions()\n        : verify_checksums(false),\n          fill_cache(true),\n          snapshot(NULL) {\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ScanBatch",
          "args": [
            "ssKey",
            "&strValue",
            "&deleted"
          ],
          "line": 72
        },
        "resolved": true,
        "details": {
          "function_name": "ScanBatch",
          "container": "CTxDB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/txdb-leveldb.cpp",
          "lines": "185-197",
          "snippet": "bool CTxDB::ScanBatch(const CDataStream &key, string *value, bool *deleted) const {\n    assert(activeBatch);\n    *deleted = false;\n    CBatchScanner scanner;\n    scanner.needle = key.str();\n    scanner.deleted = deleted;\n    scanner.foundValue = value;\n    leveldb::Status status = activeBatch->Iterate(&scanner);\n    if (!status.ok()) {\n        throw runtime_error(status.ToString());\n    }\n    return scanner.foundEntry;\n}",
          "includes": [
            "#include \"main.h\"",
            "#include \"util.h\"",
            "#include \"txdb.h\"",
            "#include \"checkpoints.h\"",
            "#include \"kernel.h\"",
            "#include <memenv/memenv.h>",
            "#include <leveldb/filter_policy.h>",
            "#include <leveldb/cache.h>",
            "#include <leveldb/env.h>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/version.hpp>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"main.h\"\n#include \"util.h\"\n#include \"txdb.h\"\n#include \"checkpoints.h\"\n#include \"kernel.h\"\n#include <memenv/memenv.h>\n#include <leveldb/filter_policy.h>\n#include <leveldb/cache.h>\n#include <leveldb/env.h>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/version.hpp>\n#include <map>\n\nCTxDB {\n  bool CTxDB::ScanBatch(const CDataStream &key, string *value, bool *deleted) const {\n      assert(activeBatch);\n      *deleted = false;\n      CBatchScanner scanner;\n      scanner.needle = key.str();\n      scanner.deleted = deleted;\n      scanner.foundValue = value;\n      leveldb::Status status = activeBatch->Iterate(&scanner);\n      if (!status.ok()) {\n          throw runtime_error(status.ToString());\n      }\n      return scanner.foundEntry;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssKey.reserve",
          "args": [
            "1000"
          ],
          "line": 63
        },
        "resolved": true,
        "details": {
          "function_name": "reserve",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "805-805",
          "snippet": "void reserve(size_type n)                        { vch.reserve(n + nReadPos); }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  void reserve(size_type n)                        { vch.reserve(n + nReadPos); }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <leveldb/write_batch.h>\n#include <leveldb/db.h>\n#include <vector>\n#include <string>\n#include <map>\n#include \"main.h\"\n\nCTxDB {\n  bool Read(const K& key, T& value)\n      {\n          CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n          ssKey.reserve(1000);\n          ssKey << key;\n          std::string strValue;\n  \n          bool readFromDb = true;\n          if (activeBatch) {\n              // First we must search for it in the currently pending set of\n              // changes to the db. If not found in the batch, go on to read disk.\n              bool deleted = false;\n              readFromDb = ScanBatch(ssKey, &strValue, &deleted) == false;\n              if (deleted) {\n                  return false;\n              }\n          }\n          if (readFromDb) {\n              leveldb::Status status = pdb->Get(leveldb::ReadOptions(),\n                                                ssKey.str(), &strValue);\n              if (!status.ok()) {\n                  if (status.IsNotFound())\n                      return false;\n                  // Some unexpected error.\n                  printf(\"LevelDB read failure: %s\\n\", status.ToString().c_str());\n                  return false;\n              }\n          }\n          // Unserialize value\n          try {\n              CDataStream ssValue(strValue.data(), strValue.data() + strValue.size(),\n                                  SER_DISK, CLIENT_VERSION);\n              ssValue >> value;\n          }\n          catch (std::exception &e) {\n              return false;\n          }\n          return true;\n      }\n}"
  }
]