[
  {
    "function_name": "listLockedCoins",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "473-476",
    "snippet": "void WalletModel::listLockedCoins(std::vector<COutPoint>& vOutpts)\n{\n    return;\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  void WalletModel::listLockedCoins(std::vector<COutPoint>& vOutpts)\n  {\n      return;\n  }\n}"
  },
  {
    "function_name": "unlockCoin",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "468-471",
    "snippet": "void WalletModel::unlockCoin(COutPoint& output)\n{\n    return;\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  void WalletModel::unlockCoin(COutPoint& output)\n  {\n      return;\n  }\n}"
  },
  {
    "function_name": "lockCoin",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "463-466",
    "snippet": "void WalletModel::lockCoin(COutPoint& output)\n{\n    return;\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  void WalletModel::lockCoin(COutPoint& output)\n  {\n      return;\n  }\n}"
  },
  {
    "function_name": "isLockedCoin",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "458-461",
    "snippet": "bool WalletModel::isLockedCoin(uint256 hash, unsigned int n) const\n{\n    return false;\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  bool WalletModel::isLockedCoin(uint256 hash, unsigned int n) const\n  {\n      return false;\n  }\n}"
  },
  {
    "function_name": "listCoins",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "426-456",
    "snippet": "void WalletModel::listCoins(std::map<QString, std::vector<COutput> >& mapCoins) const\n{\n    std::vector<COutput> vCoins;\n    wallet->AvailableCoins(vCoins);\n    std::vector<COutPoint> vLockedCoins;\n\n    // add locked coins\n    BOOST_FOREACH(const COutPoint& outpoint, vLockedCoins)\n    {\n        if (!wallet->mapWallet.count(outpoint.hash)) continue;\n        int nDepth = wallet->mapWallet[outpoint.hash].GetDepthInMainChain();\n        if (nDepth < 0) continue;\n        COutput out(&wallet->mapWallet[outpoint.hash], outpoint.n, nDepth);\n        vCoins.push_back(out);\n    }\n\n    BOOST_FOREACH(const COutput& out, vCoins)\n    {\n        COutput cout = out;\n\n        while (wallet->IsChange(cout.tx->vout[cout.i]) && cout.tx->vin.size() > 0 && wallet->IsMine(cout.tx->vin[0]))\n        {\n            if (!wallet->mapWallet.count(cout.tx->vin[0].prevout.hash)) break;\n            cout = COutput(&wallet->mapWallet[cout.tx->vin[0].prevout.hash], cout.tx->vin[0].prevout.n, 0);\n        }\n\n        CTxDestination address;\n        if(!ExtractDestination(cout.tx->vout[cout.i].scriptPubKey, address)) continue;\n        mapCoins[CBitcoinAddress(address).ToString().c_str()].push_back(out);\n    }\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mapCoins[CBitcoinAddress",
          "args": [
            "out"
          ],
          "line": 454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CBitcoinAddress",
          "args": [],
          "line": 454
        },
        "resolved": true,
        "details": {
          "function_name": "IsScript",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "384-394",
          "snippet": "bool IsScript() const {\n        if (!IsValid())\n            return false;\n        switch (nVersion) {\n        case SCRIPT_ADDRESS:\n        case SCRIPT_ADDRESS_TEST: {\n            return true;\n        }\n        default: return false;\n        }\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  bool IsScript() const {\n          if (!IsValid())\n              return false;\n          switch (nVersion) {\n          case SCRIPT_ADDRESS:\n          case SCRIPT_ADDRESS_TEST: {\n              return true;\n          }\n          default: return false;\n          }\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "CBitcoinAddress",
          "args": [
            "address"
          ],
          "line": 454
        },
        "resolved": true,
        "details": {
          "function_name": "operator()",
          "container": "CBitcoinAddressVisitor",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "399-399",
          "snippet": "bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddressVisitor {\n  bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ExtractDestination",
          "args": [
            "cout.tx->vout[cout.i].scriptPubKey",
            "address"
          ],
          "line": 453
        },
        "resolved": true,
        "details": {
          "function_name": "ExtractDestination",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/script.cpp",
          "lines": "1590-1614",
          "snippet": "bool ExtractDestination(const CScript& scriptPubKey, CTxDestination& addressRet)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    if (whichType == TX_PUBKEY)\n    {\n        addressRet = CPubKey(vSolutions[0]).GetID();\n        return true;\n    }\n    else if (whichType == TX_PUBKEYHASH)\n    {\n        addressRet = CKeyID(uint160(vSolutions[0]));\n        return true;\n    }\n    else if (whichType == TX_SCRIPTHASH)\n    {\n        addressRet = CScriptID(uint160(vSolutions[0]));\n        return true;\n    }\n    // Multisig txns have more than one address...\n    return false;\n}",
          "includes": [
            "#include \"util.h\"",
            "#include \"sync.h\"",
            "#include \"main.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include \"keystore.h\"",
            "#include \"script.h\"",
            "#include <boost/tuple/tuple_comparison.hpp>",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/foreach.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"sync.h\"\n#include \"main.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include \"keystore.h\"\n#include \"script.h\"\n#include <boost/tuple/tuple_comparison.hpp>\n#include <boost/tuple/tuple.hpp>\n#include <boost/foreach.hpp>\n\nbool ExtractDestination(const CScript& scriptPubKey, CTxDestination& addressRet)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    if (whichType == TX_PUBKEY)\n    {\n        addressRet = CPubKey(vSolutions[0]).GetID();\n        return true;\n    }\n    else if (whichType == TX_PUBKEYHASH)\n    {\n        addressRet = CKeyID(uint160(vSolutions[0]));\n        return true;\n    }\n    else if (whichType == TX_SCRIPTHASH)\n    {\n        addressRet = CScriptID(uint160(vSolutions[0]));\n        return true;\n    }\n    // Multisig txns have more than one address...\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "COutput",
          "args": [
            "&wallet->mapWallet[cout.tx->vin[0].prevout.hash]",
            "cout.tx->vin[0].prevout.n",
            "0"
          ],
          "line": 449
        },
        "resolved": true,
        "details": {
          "function_name": "COutput",
          "container": "COutput",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.h",
          "lines": "720-723",
          "snippet": "COutput(const CWalletTx *txIn, int iIn, int nDepthIn)\n    {\n        tx = txIn; i = iIn; nDepth = nDepthIn;\n    }",
          "includes": [
            "#include \"walletdb.h\"",
            "#include \"util.h\"",
            "#include \"ui_interface.h\"",
            "#include \"script.h\"",
            "#include \"keystore.h\"",
            "#include \"key.h\"",
            "#include \"main.h\"",
            "#include <stdlib.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"walletdb.h\"\n#include \"util.h\"\n#include \"ui_interface.h\"\n#include \"script.h\"\n#include \"keystore.h\"\n#include \"key.h\"\n#include \"main.h\"\n#include <stdlib.h>\n#include <vector>\n#include <string>\n\nCOutput {\n  COutput(const CWalletTx *txIn, int iIn, int nDepthIn)\n      {\n          tx = txIn; i = iIn; nDepth = nDepthIn;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wallet->mapWallet.count",
          "args": [
            "cout.tx->vin[0].prevout.hash"
          ],
          "line": 448
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wallet->IsMine",
          "args": [
            "cout.tx->vin[0]"
          ],
          "line": 446
        },
        "resolved": true,
        "details": {
          "function_name": "IsMine",
          "container": "CWallet",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.h",
          "lines": "230-236",
          "snippet": "bool IsMine(const CTransaction& tx) const\n    {\n        BOOST_FOREACH(const CTxOut& txout, tx.vout)\n            if (IsMine(txout) && txout.nValue >= nMinimumInputValue)\n                return true;\n        return false;\n    }",
          "includes": [
            "#include \"walletdb.h\"",
            "#include \"util.h\"",
            "#include \"ui_interface.h\"",
            "#include \"script.h\"",
            "#include \"keystore.h\"",
            "#include \"key.h\"",
            "#include \"main.h\"",
            "#include <stdlib.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"walletdb.h\"\n#include \"util.h\"\n#include \"ui_interface.h\"\n#include \"script.h\"\n#include \"keystore.h\"\n#include \"key.h\"\n#include \"main.h\"\n#include <stdlib.h>\n#include <vector>\n#include <string>\n\nCWallet {\n  bool IsMine(const CTransaction& tx) const\n      {\n          BOOST_FOREACH(const CTxOut& txout, tx.vout)\n              if (IsMine(txout) && txout.nValue >= nMinimumInputValue)\n                  return true;\n          return false;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "cout.tx->vin.size",
          "args": [],
          "line": 446
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "TransactionTablePriv",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/transactiontablemodel.cpp",
          "lines": "170-173",
          "snippet": "int size()\n    {\n        return cachedWallet.size();\n    }",
          "includes": [
            "#include <QtAlgorithms>",
            "#include <QDateTime>",
            "#include <QIcon>",
            "#include <QTimer>",
            "#include <QColor>",
            "#include <QList>",
            "#include <QLocale>",
            "#include \"ui_interface.h\"",
            "#include \"wallet.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"walletmodel.h\"",
            "#include \"transactiondesc.h\"",
            "#include \"guiconstants.h\"",
            "#include \"transactionrecord.h\"",
            "#include \"guiutil.h\"",
            "#include \"transactiontablemodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QtAlgorithms>\n#include <QDateTime>\n#include <QIcon>\n#include <QTimer>\n#include <QColor>\n#include <QList>\n#include <QLocale>\n#include \"ui_interface.h\"\n#include \"wallet.h\"\n#include \"bitcoinunits.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"transactiondesc.h\"\n#include \"guiconstants.h\"\n#include \"transactionrecord.h\"\n#include \"guiutil.h\"\n#include \"transactiontablemodel.h\"\n\nTransactionTablePriv {\n  int size()\n      {\n          return cachedWallet.size();\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wallet->IsChange",
          "args": [
            "cout.tx->vout[cout.i]"
          ],
          "line": 446
        },
        "resolved": true,
        "details": {
          "function_name": "IsChange",
          "container": "CWallet",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.cpp",
          "lines": "613-631",
          "snippet": "bool CWallet::IsChange(const CTxOut& txout) const\n{\n    CTxDestination address;\n\n    // TODO: fix handling of 'change' outputs. The assumption is that any\n    // payment to a TX_PUBKEYHASH that is mine but isn't in the address book\n    // is change. That assumption is likely to break when we implement multisignature\n    // wallets that return change back into a multi-signature-protected address;\n    // a better way of identifying which outputs are 'the send' and which are\n    // 'the change' will need to be implemented (maybe extend CWalletTx to remember\n    // which output, if any, was change).\n    if (ExtractDestination(txout.scriptPubKey, address) && ::IsMine(*this, address))\n    {\n        LOCK(cs_wallet);\n        if (!mapAddressBook.count(address))\n            return true;\n    }\n    return false;\n}",
          "includes": [
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"coincontrol.h\"",
            "#include \"kernel.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"crypter.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\"",
            "#include \"txdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/replace.hpp>\n#include \"coincontrol.h\"\n#include \"kernel.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"crypter.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n#include \"txdb.h\"\n\nCWallet {\n  bool CWallet::IsChange(const CTxOut& txout) const\n  {\n      CTxDestination address;\n  \n      // TODO: fix handling of 'change' outputs. The assumption is that any\n      // payment to a TX_PUBKEYHASH that is mine but isn't in the address book\n      // is change. That assumption is likely to break when we implement multisignature\n      // wallets that return change back into a multi-signature-protected address;\n      // a better way of identifying which outputs are 'the send' and which are\n      // 'the change' will need to be implemented (maybe extend CWalletTx to remember\n      // which output, if any, was change).\n      if (ExtractDestination(txout.scriptPubKey, address) && ::IsMine(*this, address))\n      {\n          LOCK(cs_wallet);\n          if (!mapAddressBook.count(address))\n              return true;\n      }\n      return false;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "vCoins.push_back",
          "args": [
            "out"
          ],
          "line": 439
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wallet->mapWallet[outpoint.hash].GetDepthInMainChain",
          "args": [],
          "line": 436
        },
        "resolved": true,
        "details": {
          "function_name": "GetDepthInMainChain",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "765-765",
          "snippet": "int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCMerkleTx {\n  int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wallet->AvailableCoins",
          "args": [
            "vCoins"
          ],
          "line": 429
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  void WalletModel::listCoins(std::map<QString, std::vector<COutput> >& mapCoins) const\n  {\n      std::vector<COutput> vCoins;\n      wallet->AvailableCoins(vCoins);\n      std::vector<COutPoint> vLockedCoins;\n  \n      // add locked coins\n      BOOST_FOREACH(const COutPoint& outpoint, vLockedCoins)\n      {\n          if (!wallet->mapWallet.count(outpoint.hash)) continue;\n          int nDepth = wallet->mapWallet[outpoint.hash].GetDepthInMainChain();\n          if (nDepth < 0) continue;\n          COutput out(&wallet->mapWallet[outpoint.hash], outpoint.n, nDepth);\n          vCoins.push_back(out);\n      }\n  \n      BOOST_FOREACH(const COutput& out, vCoins)\n      {\n          COutput cout = out;\n  \n          while (wallet->IsChange(cout.tx->vout[cout.i]) && cout.tx->vin.size() > 0 && wallet->IsMine(cout.tx->vin[0]))\n          {\n              if (!wallet->mapWallet.count(cout.tx->vin[0].prevout.hash)) break;\n              cout = COutput(&wallet->mapWallet[cout.tx->vin[0].prevout.hash], cout.tx->vin[0].prevout.n, 0);\n          }\n  \n          CTxDestination address;\n          if(!ExtractDestination(cout.tx->vout[cout.i].scriptPubKey, address)) continue;\n          mapCoins[CBitcoinAddress(address).ToString().c_str()].push_back(out);\n      }\n  }\n}"
  },
  {
    "function_name": "getOutputs",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "413-423",
    "snippet": "void WalletModel::getOutputs(const std::vector<COutPoint>& vOutpoints, std::vector<COutput>& vOutputs)\n{\n    BOOST_FOREACH(const COutPoint& outpoint, vOutpoints)\n    {\n        if (!wallet->mapWallet.count(outpoint.hash)) continue;\n        int nDepth = wallet->mapWallet[outpoint.hash].GetDepthInMainChain();\n        if (nDepth < 0) continue;\n        COutput out(&wallet->mapWallet[outpoint.hash], outpoint.n, nDepth);\n        vOutputs.push_back(out);\n    }\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "vOutputs.push_back",
          "args": [
            "out"
          ],
          "line": 421
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wallet->mapWallet[outpoint.hash].GetDepthInMainChain",
          "args": [],
          "line": 418
        },
        "resolved": true,
        "details": {
          "function_name": "GetDepthInMainChain",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "765-765",
          "snippet": "int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCMerkleTx {\n  int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wallet->mapWallet.count",
          "args": [
            "outpoint.hash"
          ],
          "line": 417
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  void WalletModel::getOutputs(const std::vector<COutPoint>& vOutpoints, std::vector<COutput>& vOutputs)\n  {\n      BOOST_FOREACH(const COutPoint& outpoint, vOutpoints)\n      {\n          if (!wallet->mapWallet.count(outpoint.hash)) continue;\n          int nDepth = wallet->mapWallet[outpoint.hash].GetDepthInMainChain();\n          if (nDepth < 0) continue;\n          COutput out(&wallet->mapWallet[outpoint.hash], outpoint.n, nDepth);\n          vOutputs.push_back(out);\n      }\n  }\n}"
  },
  {
    "function_name": "getPubKey",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "407-410",
    "snippet": "bool WalletModel::getPubKey(const CKeyID &address, CPubKey& vchPubKeyOut) const\n{\n    return wallet->GetPubKey(address, vchPubKeyOut);   \n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wallet->GetPubKey",
          "args": [
            "address",
            "vchPubKeyOut"
          ],
          "line": 409
        },
        "resolved": true,
        "details": {
          "function_name": "GetPubKey",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.cpp",
          "lines": "180-195",
          "snippet": "bool CCryptoKeyStore::GetPubKey(const CKeyID &address, CPubKey& vchPubKeyOut) const\n{\n    {\n        LOCK(cs_KeyStore);\n        if (!IsCrypted())\n            return CKeyStore::GetPubKey(address, vchPubKeyOut);\n\n        CryptedKeyMap::const_iterator mi = mapCryptedKeys.find(address);\n        if (mi != mapCryptedKeys.end())\n        {\n            vchPubKeyOut = (*mi).second.first;\n            return true;\n        }\n    }\n    return false;\n}",
          "includes": [
            "#include \"script.h\"",
            "#include \"keystore.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"keystore.h\"\n\nCCryptoKeyStore {\n  bool CCryptoKeyStore::GetPubKey(const CKeyID &address, CPubKey& vchPubKeyOut) const\n  {\n      {\n          LOCK(cs_KeyStore);\n          if (!IsCrypted())\n              return CKeyStore::GetPubKey(address, vchPubKeyOut);\n  \n          CryptedKeyMap::const_iterator mi = mapCryptedKeys.find(address);\n          if (mi != mapCryptedKeys.end())\n          {\n              vchPubKeyOut = (*mi).second.first;\n              return true;\n          }\n      }\n      return false;\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  bool WalletModel::getPubKey(const CKeyID &address, CPubKey& vchPubKeyOut) const\n  {\n      return wallet->GetPubKey(address, vchPubKeyOut);   \n  }\n}"
  },
  {
    "function_name": "CopyFrom",
    "container": "WalletModel::UnlockContext",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "400-405",
    "snippet": "void WalletModel::UnlockContext::CopyFrom(const UnlockContext& rhs)\n{\n    // Transfer context; old object no longer relocks wallet\n    *this = rhs;\n    rhs.relock = false;\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  UnlockContext {\n    void WalletModel::UnlockContext::CopyFrom(const UnlockContext& rhs)\n    {\n        // Transfer context; old object no longer relocks wallet\n        *this = rhs;\n        rhs.relock = false;\n    }\n  }\n}"
  },
  {
    "function_name": "~UnlockContext",
    "container": "WalletModel::UnlockContext",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "392-398",
    "snippet": "WalletModel::UnlockContext::~UnlockContext()\n{\n    if(valid && relock)\n    {\n        wallet->setWalletLocked(true);\n    }\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wallet->setWalletLocked",
          "args": [
            "true"
          ],
          "line": 396
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  UnlockContext {\n    WalletModel::UnlockContext::~UnlockContext()\n    {\n        if(valid && relock)\n        {\n            wallet->setWalletLocked(true);\n        }\n    }\n  }\n}"
  },
  {
    "function_name": "UnlockContext",
    "container": "WalletModel::UnlockContext",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "385-390",
    "snippet": "WalletModel::UnlockContext::UnlockContext(WalletModel *wallet, bool valid, bool relock):\n        wallet(wallet),\n        valid(valid),\n        relock(relock)\n{\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  UnlockContext {\n    WalletModel::UnlockContext::UnlockContext(WalletModel *wallet, bool valid, bool relock):\n            wallet(wallet),\n            valid(valid),\n            relock(relock)\n    {\n    }\n  }\n}"
  },
  {
    "function_name": "requestUnlock",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "364-383",
    "snippet": "WalletModel::UnlockContext WalletModel::requestUnlock()\n{\n    bool was_locked = getEncryptionStatus() == Locked;\n    \n    if ((!was_locked) && fWalletUnlockStakingOnly)\n    {\n       setWalletLocked(true);\n       was_locked = getEncryptionStatus() == Locked;\n\n    }\n    if(was_locked)\n    {\n        // Request UI to unlock wallet\n        emit requireUnlock();\n    }\n    // If wallet is still locked, unlock was failed or cancelled, mark context as invalid\n    bool valid = getEncryptionStatus() != Locked;\n\n    return UnlockContext(this, valid, was_locked && !fWalletUnlockStakingOnly);\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "UnlockContext",
          "args": [
            "this",
            "valid",
            "was_locked && !fWalletUnlockStakingOnly"
          ],
          "line": 382
        },
        "resolved": true,
        "details": {
          "function_name": "UnlockContext",
          "container": "WalletModel::UnlockContext",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
          "lines": "385-390",
          "snippet": "WalletModel::UnlockContext::UnlockContext(WalletModel *wallet, bool valid, bool relock):\n        wallet(wallet),\n        valid(valid),\n        relock(relock)\n{\n}",
          "includes": [
            "#include <QTimer>",
            "#include <QSet>",
            "#include \"base58.h\"",
            "#include \"walletdb.h\" // for BackupWallet",
            "#include \"wallet.h\"",
            "#include \"ui_interface.h\"",
            "#include \"transactiontablemodel.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"guiconstants.h\"",
            "#include \"walletmodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  UnlockContext {\n    WalletModel::UnlockContext::UnlockContext(WalletModel *wallet, bool valid, bool relock):\n            wallet(wallet),\n            valid(valid),\n            relock(relock)\n    {\n    }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "getEncryptionStatus",
          "args": [],
          "line": 380
        },
        "resolved": true,
        "details": {
          "function_name": "getEncryptionStatus",
          "container": "WalletModel",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
          "lines": "254-268",
          "snippet": "WalletModel::EncryptionStatus WalletModel::getEncryptionStatus() const\n{\n    if(!wallet->IsCrypted())\n    {\n        return Unencrypted;\n    }\n    else if(wallet->IsLocked())\n    {\n        return Locked;\n    }\n    else\n    {\n        return Unlocked;\n    }\n}",
          "includes": [
            "#include <QTimer>",
            "#include <QSet>",
            "#include \"base58.h\"",
            "#include \"walletdb.h\" // for BackupWallet",
            "#include \"wallet.h\"",
            "#include \"ui_interface.h\"",
            "#include \"transactiontablemodel.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"guiconstants.h\"",
            "#include \"walletmodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  WalletModel::EncryptionStatus WalletModel::getEncryptionStatus() const\n  {\n      if(!wallet->IsCrypted())\n      {\n          return Unencrypted;\n      }\n      else if(wallet->IsLocked())\n      {\n          return Locked;\n      }\n      else\n      {\n          return Unlocked;\n      }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "setWalletLocked",
          "args": [
            "true"
          ],
          "line": 370
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  WalletModel::UnlockContext WalletModel::requestUnlock()\n  {\n      bool was_locked = getEncryptionStatus() == Locked;\n      \n      if ((!was_locked) && fWalletUnlockStakingOnly)\n      {\n         setWalletLocked(true);\n         was_locked = getEncryptionStatus() == Locked;\n  \n      }\n      if(was_locked)\n      {\n          // Request UI to unlock wallet\n          emit requireUnlock();\n      }\n      // If wallet is still locked, unlock was failed or cancelled, mark context as invalid\n      bool valid = getEncryptionStatus() != Locked;\n  \n      return UnlockContext(this, valid, was_locked && !fWalletUnlockStakingOnly);\n  }\n}"
  },
  {
    "function_name": "unsubscribeFromCoreSignals",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "351-361",
    "snippet": "void WalletModel::unsubscribeFromCoreSignals()\n{\n    // Disconnect signals from wallet\n    wallet->NotifyStatusChanged.disconnect(boost::bind(&NotifyKeyStoreStatusChanged, this,\n      boost::placeholders::_1));\n    wallet->NotifyAddressBookChanged.disconnect(boost::bind(NotifyAddressBookChanged, this,\n      boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3,\n      boost::placeholders::_4, boost::placeholders::_5));\n    wallet->NotifyTransactionChanged.disconnect(boost::bind(NotifyTransactionChanged, this,\n      boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3));\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wallet->NotifyTransactionChanged.disconnect",
          "args": [
            "boost::bind(NotifyTransactionChanged, this,\n      boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3)"
          ],
          "line": 359
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "boost::bind",
          "args": [
            "NotifyTransactionChanged",
            "this",
            "boost::placeholders::_1",
            "boost::placeholders::_2",
            "boost::placeholders::_3"
          ],
          "line": 359
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wallet->NotifyAddressBookChanged.disconnect",
          "args": [
            "boost::bind(NotifyAddressBookChanged, this,\n      boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3,\n      boost::placeholders::_4, boost::placeholders::_5)"
          ],
          "line": 356
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "boost::bind",
          "args": [
            "NotifyAddressBookChanged",
            "this",
            "boost::placeholders::_1",
            "boost::placeholders::_2",
            "boost::placeholders::_3",
            "boost::placeholders::_4",
            "boost::placeholders::_5"
          ],
          "line": 356
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wallet->NotifyStatusChanged.disconnect",
          "args": [
            "boost::bind(&NotifyKeyStoreStatusChanged, this,\n      boost::placeholders::_1)"
          ],
          "line": 354
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "boost::bind",
          "args": [
            "&NotifyKeyStoreStatusChanged",
            "this",
            "boost::placeholders::_1"
          ],
          "line": 354
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  void WalletModel::unsubscribeFromCoreSignals()\n  {\n      // Disconnect signals from wallet\n      wallet->NotifyStatusChanged.disconnect(boost::bind(&NotifyKeyStoreStatusChanged, this,\n        boost::placeholders::_1));\n      wallet->NotifyAddressBookChanged.disconnect(boost::bind(NotifyAddressBookChanged, this,\n        boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3,\n        boost::placeholders::_4, boost::placeholders::_5));\n      wallet->NotifyTransactionChanged.disconnect(boost::bind(NotifyTransactionChanged, this,\n        boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3));\n  }\n}"
  },
  {
    "function_name": "subscribeToCoreSignals",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "339-349",
    "snippet": "void WalletModel::subscribeToCoreSignals()\n{\n    // Connect signals to wallet\n    wallet->NotifyStatusChanged.connect(boost::bind(&NotifyKeyStoreStatusChanged, this,\n      boost::placeholders::_1));\n    wallet->NotifyAddressBookChanged.connect(boost::bind(NotifyAddressBookChanged, this,\n      boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3,\n      boost::placeholders::_4, boost::placeholders::_5));\n    wallet->NotifyTransactionChanged.connect(boost::bind(NotifyTransactionChanged, this,\n      boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3));\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wallet->NotifyTransactionChanged.connect",
          "args": [
            "boost::bind(NotifyTransactionChanged, this,\n      boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3)"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "boost::bind",
          "args": [
            "NotifyTransactionChanged",
            "this",
            "boost::placeholders::_1",
            "boost::placeholders::_2",
            "boost::placeholders::_3"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wallet->NotifyAddressBookChanged.connect",
          "args": [
            "boost::bind(NotifyAddressBookChanged, this,\n      boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3,\n      boost::placeholders::_4, boost::placeholders::_5)"
          ],
          "line": 344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "boost::bind",
          "args": [
            "NotifyAddressBookChanged",
            "this",
            "boost::placeholders::_1",
            "boost::placeholders::_2",
            "boost::placeholders::_3",
            "boost::placeholders::_4",
            "boost::placeholders::_5"
          ],
          "line": 344
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wallet->NotifyStatusChanged.connect",
          "args": [
            "boost::bind(&NotifyKeyStoreStatusChanged, this,\n      boost::placeholders::_1)"
          ],
          "line": 342
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "boost::bind",
          "args": [
            "&NotifyKeyStoreStatusChanged",
            "this",
            "boost::placeholders::_1"
          ],
          "line": 342
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  void WalletModel::subscribeToCoreSignals()\n  {\n      // Connect signals to wallet\n      wallet->NotifyStatusChanged.connect(boost::bind(&NotifyKeyStoreStatusChanged, this,\n        boost::placeholders::_1));\n      wallet->NotifyAddressBookChanged.connect(boost::bind(NotifyAddressBookChanged, this,\n        boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3,\n        boost::placeholders::_4, boost::placeholders::_5));\n      wallet->NotifyTransactionChanged.connect(boost::bind(NotifyTransactionChanged, this,\n        boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3));\n  }\n}"
  },
  {
    "function_name": "NotifyTransactionChanged",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "331-337",
    "snippet": "static void NotifyTransactionChanged(WalletModel *walletmodel, CWallet *wallet, const uint256 &hash, ChangeType status)\n{\n    OutputDebugStringF(\"NotifyTransactionChanged %s status=%i\\n\", hash.GetHex().c_str(), status);\n    QMetaObject::invokeMethod(walletmodel, \"updateTransaction\", Qt::QueuedConnection,\n                              Q_ARG(QString, QString::fromStdString(hash.GetHex())),\n                              Q_ARG(int, status));\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "QMetaObject::invokeMethod",
          "args": [
            "walletmodel",
            "\"updateTransaction\"",
            "Qt::QueuedConnection",
            "Q_ARG(QString, QString::fromStdString(hash.GetHex()))",
            "Q_ARG(int, status)"
          ],
          "line": 334
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Q_ARG",
          "args": [
            "int,status"
          ],
          "line": 336
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Q_ARG",
          "args": [
            "QString",
            "QString::fromStdString(hash.GetHex())"
          ],
          "line": 335
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString::fromStdString",
          "args": [
            "hash.GetHex()"
          ],
          "line": 335
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hash.GetHex",
          "args": [],
          "line": 335
        },
        "resolved": true,
        "details": {
          "function_name": "GetHex",
          "container": "CBigNum",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bignum.h",
          "lines": "402-405",
          "snippet": "std::string GetHex() const\n    {\n        return ToString(16);\n    }",
          "includes": [
            "#include <stdint.h>",
            "#include <vector>",
            "#include <stdexcept>",
            "#include <openssl/bn.h>",
            "#include \"version.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdint.h>\n#include <vector>\n#include <stdexcept>\n#include <openssl/bn.h>\n#include \"version.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n\nCBigNum {\n  std::string GetHex() const\n      {\n          return ToString(16);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "OutputDebugStringF",
          "args": [
            "\"NotifyTransactionChanged %s status=%i\\n\"",
            "hash.GetHex().c_str()",
            "status"
          ],
          "line": 333
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nstatic void NotifyTransactionChanged(WalletModel *walletmodel, CWallet *wallet, const uint256 &hash, ChangeType status)\n{\n    OutputDebugStringF(\"NotifyTransactionChanged %s status=%i\\n\", hash.GetHex().c_str(), status);\n    QMetaObject::invokeMethod(walletmodel, \"updateTransaction\", Qt::QueuedConnection,\n                              Q_ARG(QString, QString::fromStdString(hash.GetHex())),\n                              Q_ARG(int, status));\n}"
  },
  {
    "function_name": "NotifyAddressBookChanged",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "321-329",
    "snippet": "static void NotifyAddressBookChanged(WalletModel *walletmodel, CWallet *wallet, const CTxDestination &address, const std::string &label, bool isMine, ChangeType status)\n{\n    OutputDebugStringF(\"NotifyAddressBookChanged %s %s isMine=%i status=%i\\n\", CBitcoinAddress(address).ToString().c_str(), label.c_str(), isMine, status);\n    QMetaObject::invokeMethod(walletmodel, \"updateAddressBook\", Qt::QueuedConnection,\n                              Q_ARG(QString, QString::fromStdString(CBitcoinAddress(address).ToString())),\n                              Q_ARG(QString, QString::fromStdString(label)),\n                              Q_ARG(bool, isMine),\n                              Q_ARG(int, status));\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "QMetaObject::invokeMethod",
          "args": [
            "walletmodel",
            "\"updateAddressBook\"",
            "Qt::QueuedConnection",
            "Q_ARG(QString, QString::fromStdString(CBitcoinAddress(address).ToString()))",
            "Q_ARG(QString, QString::fromStdString(label))",
            "Q_ARG(bool, isMine)",
            "Q_ARG(int, status)"
          ],
          "line": 324
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Q_ARG",
          "args": [
            "int,status"
          ],
          "line": 328
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Q_ARG",
          "args": [
            "bool,isMine"
          ],
          "line": 327
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Q_ARG",
          "args": [
            "QString",
            "QString::fromStdString(label)"
          ],
          "line": 326
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString::fromStdString",
          "args": [
            "label"
          ],
          "line": 326
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Q_ARG",
          "args": [
            "QString",
            "QString::fromStdString(CBitcoinAddress(address).ToString())"
          ],
          "line": 325
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString::fromStdString",
          "args": [
            "CBitcoinAddress(address).ToString()"
          ],
          "line": 325
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CBitcoinAddress",
          "args": [],
          "line": 325
        },
        "resolved": true,
        "details": {
          "function_name": "IsScript",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "384-394",
          "snippet": "bool IsScript() const {\n        if (!IsValid())\n            return false;\n        switch (nVersion) {\n        case SCRIPT_ADDRESS:\n        case SCRIPT_ADDRESS_TEST: {\n            return true;\n        }\n        default: return false;\n        }\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  bool IsScript() const {\n          if (!IsValid())\n              return false;\n          switch (nVersion) {\n          case SCRIPT_ADDRESS:\n          case SCRIPT_ADDRESS_TEST: {\n              return true;\n          }\n          default: return false;\n          }\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "CBitcoinAddress",
          "args": [
            "address"
          ],
          "line": 325
        },
        "resolved": true,
        "details": {
          "function_name": "operator()",
          "container": "CBitcoinAddressVisitor",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "399-399",
          "snippet": "bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddressVisitor {\n  bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "OutputDebugStringF",
          "args": [
            "\"NotifyAddressBookChanged %s %s isMine=%i status=%i\\n\"",
            "CBitcoinAddress(address).ToString().c_str()",
            "label.c_str()",
            "isMine",
            "status"
          ],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "label.c_str",
          "args": [],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nstatic void NotifyAddressBookChanged(WalletModel *walletmodel, CWallet *wallet, const CTxDestination &address, const std::string &label, bool isMine, ChangeType status)\n{\n    OutputDebugStringF(\"NotifyAddressBookChanged %s %s isMine=%i status=%i\\n\", CBitcoinAddress(address).ToString().c_str(), label.c_str(), isMine, status);\n    QMetaObject::invokeMethod(walletmodel, \"updateAddressBook\", Qt::QueuedConnection,\n                              Q_ARG(QString, QString::fromStdString(CBitcoinAddress(address).ToString())),\n                              Q_ARG(QString, QString::fromStdString(label)),\n                              Q_ARG(bool, isMine),\n                              Q_ARG(int, status));\n}"
  },
  {
    "function_name": "NotifyKeyStoreStatusChanged",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "315-319",
    "snippet": "static void NotifyKeyStoreStatusChanged(WalletModel *walletmodel, CCryptoKeyStore *wallet)\n{\n    OutputDebugStringF(\"NotifyKeyStoreStatusChanged\\n\");\n    QMetaObject::invokeMethod(walletmodel, \"updateStatus\", Qt::QueuedConnection);\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "QMetaObject::invokeMethod",
          "args": [
            "walletmodel",
            "\"updateStatus\"",
            "Qt::QueuedConnection"
          ],
          "line": 318
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "OutputDebugStringF",
          "args": [
            "\"NotifyKeyStoreStatusChanged\\n\""
          ],
          "line": 317
        },
        "resolved": true,
        "details": {
          "function_name": "OutputDebugStringF",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "207-289",
          "snippet": "inline int OutputDebugStringF(const char* pszFormat, ...)\n{\n    int ret = 0;\n    if (fPrintToConsole)\n    {\n        // print to console\n        va_list arg_ptr;\n        va_start(arg_ptr, pszFormat);\n        ret = vprintf(pszFormat, arg_ptr);\n        va_end(arg_ptr);\n    }\n    else if (!fPrintToDebugger)\n    {\n        // print to debug.log\n\n        if (!fileout)\n        {\n            boost::filesystem::path pathDebug = GetDataDir() / \"debug.log\";\n            fileout = fopen(pathDebug.string().c_str(), \"a\");\n            if (fileout) setbuf(fileout, NULL); // unbuffered\n        }\n        if (fileout)\n        {\n            static bool fStartedNewLine = true;\n\n            // This routine may be called by global destructors during shutdown.\n            // Since the order of destruction of static/global objects is undefined,\n            // allocate mutexDebugLog on the heap the first time this routine\n            // is called to avoid crashes during shutdown.\n            static boost::mutex* mutexDebugLog = NULL;\n            if (mutexDebugLog == NULL) mutexDebugLog = new boost::mutex();\n            boost::mutex::scoped_lock scoped_lock(*mutexDebugLog);\n\n            // reopen the log file, if requested\n            if (fReopenDebugLog) {\n                fReopenDebugLog = false;\n                boost::filesystem::path pathDebug = GetDataDir() / \"debug.log\";\n                if (freopen(pathDebug.string().c_str(),\"a\",fileout) != NULL)\n                    setbuf(fileout, NULL); // unbuffered\n            }\n\n            // Debug print useful for profiling\n            if (fLogTimestamps && fStartedNewLine)\n                fprintf(fileout, \"%s \", DateTimeStrFormat(\"%x %H:%M:%S\", GetTime()).c_str());\n            if (pszFormat[strlen(pszFormat) - 1] == '\\n')\n                fStartedNewLine = true;\n            else\n                fStartedNewLine = false;\n\n            va_list arg_ptr;\n            va_start(arg_ptr, pszFormat);\n            ret = vfprintf(fileout, pszFormat, arg_ptr);\n            va_end(arg_ptr);\n        }\n    }\n\n#ifdef WIN32\n    if (fPrintToDebugger)\n    {\n        static CCriticalSection cs_OutputDebugStringF;\n\n        // accumulate and output a line at a time\n        {\n            LOCK(cs_OutputDebugStringF);\n            static std::string buffer;\n\n            va_list arg_ptr;\n            va_start(arg_ptr, pszFormat);\n            buffer += vstrprintf(pszFormat, arg_ptr);\n            va_end(arg_ptr);\n\n            int line_start = 0, line_end;\n            while((line_end = buffer.find('\\n', line_start)) != -1)\n            {\n                OutputDebugStringA(buffer.substr(line_start, line_end - line_start).c_str());\n                line_start = line_end + 1;\n            }\n            buffer.erase(0, line_start);\n        }\n    }\n#endif\n    return ret;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "bool fPrintToConsole = false;",
            "bool fPrintToDebugger = false;",
            "bool fLogTimestamps = false;",
            "bool fReopenDebugLog = false;",
            "static FILE* fileout = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nbool fPrintToConsole = false;\nbool fPrintToDebugger = false;\nbool fLogTimestamps = false;\nbool fReopenDebugLog = false;\nstatic FILE* fileout = NULL;\n\ninline int OutputDebugStringF(const char* pszFormat, ...)\n{\n    int ret = 0;\n    if (fPrintToConsole)\n    {\n        // print to console\n        va_list arg_ptr;\n        va_start(arg_ptr, pszFormat);\n        ret = vprintf(pszFormat, arg_ptr);\n        va_end(arg_ptr);\n    }\n    else if (!fPrintToDebugger)\n    {\n        // print to debug.log\n\n        if (!fileout)\n        {\n            boost::filesystem::path pathDebug = GetDataDir() / \"debug.log\";\n            fileout = fopen(pathDebug.string().c_str(), \"a\");\n            if (fileout) setbuf(fileout, NULL); // unbuffered\n        }\n        if (fileout)\n        {\n            static bool fStartedNewLine = true;\n\n            // This routine may be called by global destructors during shutdown.\n            // Since the order of destruction of static/global objects is undefined,\n            // allocate mutexDebugLog on the heap the first time this routine\n            // is called to avoid crashes during shutdown.\n            static boost::mutex* mutexDebugLog = NULL;\n            if (mutexDebugLog == NULL) mutexDebugLog = new boost::mutex();\n            boost::mutex::scoped_lock scoped_lock(*mutexDebugLog);\n\n            // reopen the log file, if requested\n            if (fReopenDebugLog) {\n                fReopenDebugLog = false;\n                boost::filesystem::path pathDebug = GetDataDir() / \"debug.log\";\n                if (freopen(pathDebug.string().c_str(),\"a\",fileout) != NULL)\n                    setbuf(fileout, NULL); // unbuffered\n            }\n\n            // Debug print useful for profiling\n            if (fLogTimestamps && fStartedNewLine)\n                fprintf(fileout, \"%s \", DateTimeStrFormat(\"%x %H:%M:%S\", GetTime()).c_str());\n            if (pszFormat[strlen(pszFormat) - 1] == '\\n')\n                fStartedNewLine = true;\n            else\n                fStartedNewLine = false;\n\n            va_list arg_ptr;\n            va_start(arg_ptr, pszFormat);\n            ret = vfprintf(fileout, pszFormat, arg_ptr);\n            va_end(arg_ptr);\n        }\n    }\n\n#ifdef WIN32\n    if (fPrintToDebugger)\n    {\n        static CCriticalSection cs_OutputDebugStringF;\n\n        // accumulate and output a line at a time\n        {\n            LOCK(cs_OutputDebugStringF);\n            static std::string buffer;\n\n            va_list arg_ptr;\n            va_start(arg_ptr, pszFormat);\n            buffer += vstrprintf(pszFormat, arg_ptr);\n            va_end(arg_ptr);\n\n            int line_start = 0, line_end;\n            while((line_end = buffer.find('\\n', line_start)) != -1)\n            {\n                OutputDebugStringA(buffer.substr(line_start, line_end - line_start).c_str());\n                line_start = line_end + 1;\n            }\n            buffer.erase(0, line_start);\n        }\n    }\n#endif\n    return ret;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nstatic void NotifyKeyStoreStatusChanged(WalletModel *walletmodel, CCryptoKeyStore *wallet)\n{\n    OutputDebugStringF(\"NotifyKeyStoreStatusChanged\\n\");\n    QMetaObject::invokeMethod(walletmodel, \"updateStatus\", Qt::QueuedConnection);\n}"
  },
  {
    "function_name": "backupWallet",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "309-312",
    "snippet": "bool WalletModel::backupWallet(const QString &filename)\n{\n    return BackupWallet(*wallet, filename.toLocal8Bit().data());\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "BackupWallet",
          "args": [
            "*wallet",
            "filename.toLocal8Bit().data()"
          ],
          "line": 311
        },
        "resolved": true,
        "details": {
          "function_name": "BackupWallet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/walletdb.cpp",
          "lines": "595-633",
          "snippet": "bool BackupWallet(const CWallet& wallet, const string& strDest)\n{\n    if (!wallet.fFileBacked)\n        return false;\n    while (!fShutdown)\n    {\n        {\n            LOCK(bitdb.cs_db);\n            if (!bitdb.mapFileUseCount.count(wallet.strWalletFile) || bitdb.mapFileUseCount[wallet.strWalletFile] == 0)\n            {\n                // Flush log data to the dat file\n                bitdb.CloseDb(wallet.strWalletFile);\n                bitdb.CheckpointLSN(wallet.strWalletFile);\n                bitdb.mapFileUseCount.erase(wallet.strWalletFile);\n\n                // Copy wallet.dat\n                filesystem::path pathSrc = GetDataDir() / wallet.strWalletFile;\n                filesystem::path pathDest(strDest);\n                if (filesystem::is_directory(pathDest))\n                    pathDest /= wallet.strWalletFile;\n\n                try {\n#if BOOST_VERSION >= 104000\n                    filesystem::copy_file(pathSrc, pathDest, filesystem::copy_option::overwrite_if_exists);\n#else\n                    filesystem::copy_file(pathSrc, pathDest);\n#endif\n                    printf(\"copied wallet.dat to %s\\n\", pathDest.string().c_str());\n                    return true;\n                } catch(const filesystem::filesystem_error &e) {\n                    printf(\"error copying wallet.dat to %s - %s\\n\", pathDest.string().c_str(), e.what());\n                    return false;\n                }\n            }\n        }\n        MilliSleep(100);\n    }\n    return false;\n}",
          "includes": [
            "#include <boost/filesystem.hpp>",
            "#include <boost/version.hpp>",
            "#include \"wallet.h\"",
            "#include \"walletdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem.hpp>\n#include <boost/version.hpp>\n#include \"wallet.h\"\n#include \"walletdb.h\"\n\nbool BackupWallet(const CWallet& wallet, const string& strDest)\n{\n    if (!wallet.fFileBacked)\n        return false;\n    while (!fShutdown)\n    {\n        {\n            LOCK(bitdb.cs_db);\n            if (!bitdb.mapFileUseCount.count(wallet.strWalletFile) || bitdb.mapFileUseCount[wallet.strWalletFile] == 0)\n            {\n                // Flush log data to the dat file\n                bitdb.CloseDb(wallet.strWalletFile);\n                bitdb.CheckpointLSN(wallet.strWalletFile);\n                bitdb.mapFileUseCount.erase(wallet.strWalletFile);\n\n                // Copy wallet.dat\n                filesystem::path pathSrc = GetDataDir() / wallet.strWalletFile;\n                filesystem::path pathDest(strDest);\n                if (filesystem::is_directory(pathDest))\n                    pathDest /= wallet.strWalletFile;\n\n                try {\n#if BOOST_VERSION >= 104000\n                    filesystem::copy_file(pathSrc, pathDest, filesystem::copy_option::overwrite_if_exists);\n#else\n                    filesystem::copy_file(pathSrc, pathDest);\n#endif\n                    printf(\"copied wallet.dat to %s\\n\", pathDest.string().c_str());\n                    return true;\n                } catch(const filesystem::filesystem_error &e) {\n                    printf(\"error copying wallet.dat to %s - %s\\n\", pathDest.string().c_str(), e.what());\n                    return false;\n                }\n            }\n        }\n        MilliSleep(100);\n    }\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "filename.toLocal8Bit",
          "args": [],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.toLocal8Bit",
          "args": [],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  bool WalletModel::backupWallet(const QString &filename)\n  {\n      return BackupWallet(*wallet, filename.toLocal8Bit().data());\n  }\n}"
  },
  {
    "function_name": "changePassphrase",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "298-307",
    "snippet": "bool WalletModel::changePassphrase(const SecureString &oldPass, const SecureString &newPass)\n{\n    bool retval;\n    {\n        LOCK(wallet->cs_wallet);\n        wallet->Lock(); // Make sure wallet is locked before attempting pass change\n        retval = wallet->ChangeWalletPassphrase(oldPass, newPass);\n    }\n    return retval;\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wallet->ChangeWalletPassphrase",
          "args": [
            "oldPass",
            "newPass"
          ],
          "line": 304
        },
        "resolved": true,
        "details": {
          "function_name": "ChangeWalletPassphrase",
          "container": "CWallet",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.cpp",
          "lines": "138-182",
          "snippet": "bool CWallet::ChangeWalletPassphrase(const SecureString& strOldWalletPassphrase, const SecureString& strNewWalletPassphrase)\n{\n    bool fWasLocked = IsLocked();\n\n    {\n        LOCK(cs_wallet);\n        Lock();\n\n        CCrypter crypter;\n        CKeyingMaterial vMasterKey;\n        BOOST_FOREACH(MasterKeyMap::value_type& pMasterKey, mapMasterKeys)\n        {\n            if(!crypter.SetKeyFromPassphrase(strOldWalletPassphrase, pMasterKey.second.vchSalt, pMasterKey.second.nDeriveIterations, pMasterKey.second.nDerivationMethod))\n                return false;\n            if (!crypter.Decrypt(pMasterKey.second.vchCryptedKey, vMasterKey))\n                return false;\n            if (CCryptoKeyStore::Unlock(vMasterKey))\n            {\n                int64_t nStartTime = GetTimeMillis();\n                crypter.SetKeyFromPassphrase(strNewWalletPassphrase, pMasterKey.second.vchSalt, pMasterKey.second.nDeriveIterations, pMasterKey.second.nDerivationMethod);\n                pMasterKey.second.nDeriveIterations = pMasterKey.second.nDeriveIterations * (100 / ((double)(GetTimeMillis() - nStartTime)));\n\n                nStartTime = GetTimeMillis();\n                crypter.SetKeyFromPassphrase(strNewWalletPassphrase, pMasterKey.second.vchSalt, pMasterKey.second.nDeriveIterations, pMasterKey.second.nDerivationMethod);\n                pMasterKey.second.nDeriveIterations = (pMasterKey.second.nDeriveIterations + pMasterKey.second.nDeriveIterations * 100 / ((double)(GetTimeMillis() - nStartTime))) / 2;\n\n                if (pMasterKey.second.nDeriveIterations < 25000)\n                    pMasterKey.second.nDeriveIterations = 25000;\n\n                printf(\"Wallet passphrase changed to an nDeriveIterations of %i\\n\", pMasterKey.second.nDeriveIterations);\n\n                if (!crypter.SetKeyFromPassphrase(strNewWalletPassphrase, pMasterKey.second.vchSalt, pMasterKey.second.nDeriveIterations, pMasterKey.second.nDerivationMethod))\n                    return false;\n                if (!crypter.Encrypt(vMasterKey, pMasterKey.second.vchCryptedKey))\n                    return false;\n                CWalletDB(strWalletFile).WriteMasterKey(pMasterKey.first, pMasterKey.second);\n                if (fWasLocked)\n                    Lock();\n                return true;\n            }\n        }\n    }\n\n    return false;\n}",
          "includes": [
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"coincontrol.h\"",
            "#include \"kernel.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"crypter.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\"",
            "#include \"txdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/replace.hpp>\n#include \"coincontrol.h\"\n#include \"kernel.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"crypter.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n#include \"txdb.h\"\n\nCWallet {\n  bool CWallet::ChangeWalletPassphrase(const SecureString& strOldWalletPassphrase, const SecureString& strNewWalletPassphrase)\n  {\n      bool fWasLocked = IsLocked();\n  \n      {\n          LOCK(cs_wallet);\n          Lock();\n  \n          CCrypter crypter;\n          CKeyingMaterial vMasterKey;\n          BOOST_FOREACH(MasterKeyMap::value_type& pMasterKey, mapMasterKeys)\n          {\n              if(!crypter.SetKeyFromPassphrase(strOldWalletPassphrase, pMasterKey.second.vchSalt, pMasterKey.second.nDeriveIterations, pMasterKey.second.nDerivationMethod))\n                  return false;\n              if (!crypter.Decrypt(pMasterKey.second.vchCryptedKey, vMasterKey))\n                  return false;\n              if (CCryptoKeyStore::Unlock(vMasterKey))\n              {\n                  int64_t nStartTime = GetTimeMillis();\n                  crypter.SetKeyFromPassphrase(strNewWalletPassphrase, pMasterKey.second.vchSalt, pMasterKey.second.nDeriveIterations, pMasterKey.second.nDerivationMethod);\n                  pMasterKey.second.nDeriveIterations = pMasterKey.second.nDeriveIterations * (100 / ((double)(GetTimeMillis() - nStartTime)));\n  \n                  nStartTime = GetTimeMillis();\n                  crypter.SetKeyFromPassphrase(strNewWalletPassphrase, pMasterKey.second.vchSalt, pMasterKey.second.nDeriveIterations, pMasterKey.second.nDerivationMethod);\n                  pMasterKey.second.nDeriveIterations = (pMasterKey.second.nDeriveIterations + pMasterKey.second.nDeriveIterations * 100 / ((double)(GetTimeMillis() - nStartTime))) / 2;\n  \n                  if (pMasterKey.second.nDeriveIterations < 25000)\n                      pMasterKey.second.nDeriveIterations = 25000;\n  \n                  printf(\"Wallet passphrase changed to an nDeriveIterations of %i\\n\", pMasterKey.second.nDeriveIterations);\n  \n                  if (!crypter.SetKeyFromPassphrase(strNewWalletPassphrase, pMasterKey.second.vchSalt, pMasterKey.second.nDeriveIterations, pMasterKey.second.nDerivationMethod))\n                      return false;\n                  if (!crypter.Encrypt(vMasterKey, pMasterKey.second.vchCryptedKey))\n                      return false;\n                  CWalletDB(strWalletFile).WriteMasterKey(pMasterKey.first, pMasterKey.second);\n                  if (fWasLocked)\n                      Lock();\n                  return true;\n              }\n          }\n      }\n  \n      return false;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wallet->Lock",
          "args": [],
          "line": 303
        },
        "resolved": true,
        "details": {
          "function_name": "Lock",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.cpp",
          "lines": "76-88",
          "snippet": "bool CCryptoKeyStore::Lock()\n{\n    if (!SetCrypted())\n        return false;\n\n    {\n        LOCK(cs_KeyStore);\n        vMasterKey.clear();\n    }\n\n    NotifyStatusChanged(this);\n    return true;\n}",
          "includes": [
            "#include \"script.h\"",
            "#include \"keystore.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"keystore.h\"\n\nCCryptoKeyStore {\n  bool CCryptoKeyStore::Lock()\n  {\n      if (!SetCrypted())\n          return false;\n  \n      {\n          LOCK(cs_KeyStore);\n          vMasterKey.clear();\n      }\n  \n      NotifyStatusChanged(this);\n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "wallet->cs_wallet"
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  bool WalletModel::changePassphrase(const SecureString &oldPass, const SecureString &newPass)\n  {\n      bool retval;\n      {\n          LOCK(wallet->cs_wallet);\n          wallet->Lock(); // Make sure wallet is locked before attempting pass change\n          retval = wallet->ChangeWalletPassphrase(oldPass, newPass);\n      }\n      return retval;\n  }\n}"
  },
  {
    "function_name": "setWalletLocked",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "284-296",
    "snippet": "bool WalletModel::setWalletLocked(bool locked, const SecureString &passPhrase)\n{\n    if(locked)\n    {\n        // Lock\n        return wallet->Lock();\n    }\n    else\n    {\n        // Unlock\n        return wallet->Unlock(passPhrase);\n    }\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wallet->Unlock",
          "args": [
            "passPhrase"
          ],
          "line": 294
        },
        "resolved": true,
        "details": {
          "function_name": "Unlock",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.cpp",
          "lines": "90-118",
          "snippet": "bool CCryptoKeyStore::Unlock(const CKeyingMaterial& vMasterKeyIn)\n{\n    {\n        LOCK(cs_KeyStore);\n        if (!SetCrypted())\n            return false;\n\n        CryptedKeyMap::const_iterator mi = mapCryptedKeys.begin();\n        for (; mi != mapCryptedKeys.end(); ++mi)\n        {\n            const CPubKey &vchPubKey = (*mi).second.first;\n            const std::vector<unsigned char> &vchCryptedSecret = (*mi).second.second;\n            CSecret vchSecret;\n            if(!DecryptSecret(vMasterKeyIn, vchCryptedSecret, vchPubKey.GetHash(), vchSecret))\n                return false;\n            if (vchSecret.size() != 32)\n                return false;\n            CKey key;\n            key.SetPubKey(vchPubKey);\n            key.SetSecret(vchSecret);\n            if (key.GetPubKey() == vchPubKey)\n                break;\n            return false;\n        }\n        vMasterKey = vMasterKeyIn;\n    }\n    NotifyStatusChanged(this);\n    return true;\n}",
          "includes": [
            "#include \"script.h\"",
            "#include \"keystore.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"keystore.h\"\n\nCCryptoKeyStore {\n  bool CCryptoKeyStore::Unlock(const CKeyingMaterial& vMasterKeyIn)\n  {\n      {\n          LOCK(cs_KeyStore);\n          if (!SetCrypted())\n              return false;\n  \n          CryptedKeyMap::const_iterator mi = mapCryptedKeys.begin();\n          for (; mi != mapCryptedKeys.end(); ++mi)\n          {\n              const CPubKey &vchPubKey = (*mi).second.first;\n              const std::vector<unsigned char> &vchCryptedSecret = (*mi).second.second;\n              CSecret vchSecret;\n              if(!DecryptSecret(vMasterKeyIn, vchCryptedSecret, vchPubKey.GetHash(), vchSecret))\n                  return false;\n              if (vchSecret.size() != 32)\n                  return false;\n              CKey key;\n              key.SetPubKey(vchPubKey);\n              key.SetSecret(vchSecret);\n              if (key.GetPubKey() == vchPubKey)\n                  break;\n              return false;\n          }\n          vMasterKey = vMasterKeyIn;\n      }\n      NotifyStatusChanged(this);\n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wallet->Lock",
          "args": [],
          "line": 289
        },
        "resolved": true,
        "details": {
          "function_name": "Lock",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.cpp",
          "lines": "76-88",
          "snippet": "bool CCryptoKeyStore::Lock()\n{\n    if (!SetCrypted())\n        return false;\n\n    {\n        LOCK(cs_KeyStore);\n        vMasterKey.clear();\n    }\n\n    NotifyStatusChanged(this);\n    return true;\n}",
          "includes": [
            "#include \"script.h\"",
            "#include \"keystore.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"keystore.h\"\n\nCCryptoKeyStore {\n  bool CCryptoKeyStore::Lock()\n  {\n      if (!SetCrypted())\n          return false;\n  \n      {\n          LOCK(cs_KeyStore);\n          vMasterKey.clear();\n      }\n  \n      NotifyStatusChanged(this);\n      return true;\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  bool WalletModel::setWalletLocked(bool locked, const SecureString &passPhrase)\n  {\n      if(locked)\n      {\n          // Lock\n          return wallet->Lock();\n      }\n      else\n      {\n          // Unlock\n          return wallet->Unlock(passPhrase);\n      }\n  }\n}"
  },
  {
    "function_name": "setWalletEncrypted",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "270-282",
    "snippet": "bool WalletModel::setWalletEncrypted(bool encrypted, const SecureString &passphrase)\n{\n    if(encrypted)\n    {\n        // Encrypt\n        return wallet->EncryptWallet(passphrase);\n    }\n    else\n    {\n        // Decrypt -- TODO; not supported yet\n        return false;\n    }\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wallet->EncryptWallet",
          "args": [
            "passphrase"
          ],
          "line": 275
        },
        "resolved": true,
        "details": {
          "function_name": "EncryptWallet",
          "container": "CWallet",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.cpp",
          "lines": "246-325",
          "snippet": "bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n{\n    if (IsCrypted())\n        return false;\n\n    CKeyingMaterial vMasterKey;\n    RandAddSeedPerfmon();\n\n    vMasterKey.resize(WALLET_CRYPTO_KEY_SIZE);\n    RAND_bytes(&vMasterKey[0], WALLET_CRYPTO_KEY_SIZE);\n\n    CMasterKey kMasterKey(nDerivationMethodIndex);\n\n    RandAddSeedPerfmon();\n    kMasterKey.vchSalt.resize(WALLET_CRYPTO_SALT_SIZE);\n    RAND_bytes(&kMasterKey.vchSalt[0], WALLET_CRYPTO_SALT_SIZE);\n\n    CCrypter crypter;\n    int64_t nStartTime = GetTimeMillis();\n    crypter.SetKeyFromPassphrase(strWalletPassphrase, kMasterKey.vchSalt, 25000, kMasterKey.nDerivationMethod);\n    kMasterKey.nDeriveIterations = 2500000 / ((double)(GetTimeMillis() - nStartTime));\n\n    nStartTime = GetTimeMillis();\n    crypter.SetKeyFromPassphrase(strWalletPassphrase, kMasterKey.vchSalt, kMasterKey.nDeriveIterations, kMasterKey.nDerivationMethod);\n    kMasterKey.nDeriveIterations = (kMasterKey.nDeriveIterations + kMasterKey.nDeriveIterations * 100 / ((double)(GetTimeMillis() - nStartTime))) / 2;\n\n    if (kMasterKey.nDeriveIterations < 25000)\n        kMasterKey.nDeriveIterations = 25000;\n\n    printf(\"Encrypting Wallet with an nDeriveIterations of %i\\n\", kMasterKey.nDeriveIterations);\n\n    if (!crypter.SetKeyFromPassphrase(strWalletPassphrase, kMasterKey.vchSalt, kMasterKey.nDeriveIterations, kMasterKey.nDerivationMethod))\n        return false;\n    if (!crypter.Encrypt(vMasterKey, kMasterKey.vchCryptedKey))\n        return false;\n\n    {\n        LOCK(cs_wallet);\n        mapMasterKeys[++nMasterKeyMaxID] = kMasterKey;\n        if (fFileBacked)\n        {\n            pwalletdbEncryption = new CWalletDB(strWalletFile);\n            if (!pwalletdbEncryption->TxnBegin())\n                return false;\n            pwalletdbEncryption->WriteMasterKey(nMasterKeyMaxID, kMasterKey);\n        }\n\n        if (!EncryptKeys(vMasterKey))\n        {\n            if (fFileBacked)\n                pwalletdbEncryption->TxnAbort();\n            exit(1); //We now probably have half of our keys encrypted in memory, and half not...die and let the user reload their unencrypted wallet.\n        }\n\n        // Encryption was introduced in version 0.4.0\n        SetMinVersion(FEATURE_WALLETCRYPT, pwalletdbEncryption, true);\n\n        if (fFileBacked)\n        {\n            if (!pwalletdbEncryption->TxnCommit())\n                exit(1); //We now have keys encrypted in memory, but no on disk...die to avoid confusion and let the user reload their unencrypted wallet.\n\n            delete pwalletdbEncryption;\n            pwalletdbEncryption = NULL;\n        }\n\n        Lock();\n        Unlock(strWalletPassphrase);\n        NewKeyPool();\n        Lock();\n\n        // Need to completely rewrite the wallet file; if we don't, bdb might keep\n        // bits of the unencrypted private key in slack space in the database file.\n        CDB::Rewrite(strWalletFile);\n\n    }\n    NotifyStatusChanged(this);\n\n    return true;\n}",
          "includes": [
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"coincontrol.h\"",
            "#include \"kernel.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"crypter.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\"",
            "#include \"txdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/replace.hpp>\n#include \"coincontrol.h\"\n#include \"kernel.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"crypter.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n#include \"txdb.h\"\n\nCWallet {\n  bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n  {\n      if (IsCrypted())\n          return false;\n  \n      CKeyingMaterial vMasterKey;\n      RandAddSeedPerfmon();\n  \n      vMasterKey.resize(WALLET_CRYPTO_KEY_SIZE);\n      RAND_bytes(&vMasterKey[0], WALLET_CRYPTO_KEY_SIZE);\n  \n      CMasterKey kMasterKey(nDerivationMethodIndex);\n  \n      RandAddSeedPerfmon();\n      kMasterKey.vchSalt.resize(WALLET_CRYPTO_SALT_SIZE);\n      RAND_bytes(&kMasterKey.vchSalt[0], WALLET_CRYPTO_SALT_SIZE);\n  \n      CCrypter crypter;\n      int64_t nStartTime = GetTimeMillis();\n      crypter.SetKeyFromPassphrase(strWalletPassphrase, kMasterKey.vchSalt, 25000, kMasterKey.nDerivationMethod);\n      kMasterKey.nDeriveIterations = 2500000 / ((double)(GetTimeMillis() - nStartTime));\n  \n      nStartTime = GetTimeMillis();\n      crypter.SetKeyFromPassphrase(strWalletPassphrase, kMasterKey.vchSalt, kMasterKey.nDeriveIterations, kMasterKey.nDerivationMethod);\n      kMasterKey.nDeriveIterations = (kMasterKey.nDeriveIterations + kMasterKey.nDeriveIterations * 100 / ((double)(GetTimeMillis() - nStartTime))) / 2;\n  \n      if (kMasterKey.nDeriveIterations < 25000)\n          kMasterKey.nDeriveIterations = 25000;\n  \n      printf(\"Encrypting Wallet with an nDeriveIterations of %i\\n\", kMasterKey.nDeriveIterations);\n  \n      if (!crypter.SetKeyFromPassphrase(strWalletPassphrase, kMasterKey.vchSalt, kMasterKey.nDeriveIterations, kMasterKey.nDerivationMethod))\n          return false;\n      if (!crypter.Encrypt(vMasterKey, kMasterKey.vchCryptedKey))\n          return false;\n  \n      {\n          LOCK(cs_wallet);\n          mapMasterKeys[++nMasterKeyMaxID] = kMasterKey;\n          if (fFileBacked)\n          {\n              pwalletdbEncryption = new CWalletDB(strWalletFile);\n              if (!pwalletdbEncryption->TxnBegin())\n                  return false;\n              pwalletdbEncryption->WriteMasterKey(nMasterKeyMaxID, kMasterKey);\n          }\n  \n          if (!EncryptKeys(vMasterKey))\n          {\n              if (fFileBacked)\n                  pwalletdbEncryption->TxnAbort();\n              exit(1); //We now probably have half of our keys encrypted in memory, and half not...die and let the user reload their unencrypted wallet.\n          }\n  \n          // Encryption was introduced in version 0.4.0\n          SetMinVersion(FEATURE_WALLETCRYPT, pwalletdbEncryption, true);\n  \n          if (fFileBacked)\n          {\n              if (!pwalletdbEncryption->TxnCommit())\n                  exit(1); //We now have keys encrypted in memory, but no on disk...die to avoid confusion and let the user reload their unencrypted wallet.\n  \n              delete pwalletdbEncryption;\n              pwalletdbEncryption = NULL;\n          }\n  \n          Lock();\n          Unlock(strWalletPassphrase);\n          NewKeyPool();\n          Lock();\n  \n          // Need to completely rewrite the wallet file; if we don't, bdb might keep\n          // bits of the unencrypted private key in slack space in the database file.\n          CDB::Rewrite(strWalletFile);\n  \n      }\n      NotifyStatusChanged(this);\n  \n      return true;\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  bool WalletModel::setWalletEncrypted(bool encrypted, const SecureString &passphrase)\n  {\n      if(encrypted)\n      {\n          // Encrypt\n          return wallet->EncryptWallet(passphrase);\n      }\n      else\n      {\n          // Decrypt -- TODO; not supported yet\n          return false;\n      }\n  }\n}"
  },
  {
    "function_name": "getEncryptionStatus",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "254-268",
    "snippet": "WalletModel::EncryptionStatus WalletModel::getEncryptionStatus() const\n{\n    if(!wallet->IsCrypted())\n    {\n        return Unencrypted;\n    }\n    else if(wallet->IsLocked())\n    {\n        return Locked;\n    }\n    else\n    {\n        return Unlocked;\n    }\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wallet->IsLocked",
          "args": [],
          "line": 260
        },
        "resolved": true,
        "details": {
          "function_name": "IsLocked",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "134-144",
          "snippet": "bool IsLocked() const\n    {\n        if (!IsCrypted())\n            return false;\n        bool result;\n        {\n            LOCK(cs_KeyStore);\n            result = vMasterKey.empty();\n        }\n        return result;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool IsLocked() const\n      {\n          if (!IsCrypted())\n              return false;\n          bool result;\n          {\n              LOCK(cs_KeyStore);\n              result = vMasterKey.empty();\n          }\n          return result;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wallet->IsCrypted",
          "args": [],
          "line": 256
        },
        "resolved": true,
        "details": {
          "function_name": "IsCrypted",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "129-132",
          "snippet": "bool IsCrypted() const\n    {\n        return fUseCrypto;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool IsCrypted() const\n      {\n          return fUseCrypto;\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  WalletModel::EncryptionStatus WalletModel::getEncryptionStatus() const\n  {\n      if(!wallet->IsCrypted())\n      {\n          return Unencrypted;\n      }\n      else if(wallet->IsLocked())\n      {\n          return Locked;\n      }\n      else\n      {\n          return Unlocked;\n      }\n  }\n}"
  },
  {
    "function_name": "sendCoins",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "132-237",
    "snippet": "WalletModel::SendCoinsReturn WalletModel::sendCoins(const QList<SendCoinsRecipient> &recipients, const CCoinControl *coinControl)\n{\n    qint64 total = 0;\n    QSet<QString> setAddress;\n    QString hex;\n\n    if(recipients.empty())\n    {\n        return OK;\n    }\n\n    // Pre-check input data for validity\n    foreach(const SendCoinsRecipient &rcp, recipients)\n    {\n        if(!validateAddress(rcp.address))\n        {\n            return InvalidAddress;\n        }\n        setAddress.insert(rcp.address);\n\n        if(rcp.amount <= 0)\n        {\n            return InvalidAmount;\n        }\n        total += rcp.amount;\n    }\n\n    if(recipients.size() > setAddress.size())\n    {\n        return DuplicateAddress;\n    }\n\n    int64_t nBalance = 0;\n    std::vector<COutput> vCoins;\n    wallet->AvailableCoins(vCoins, true, coinControl);\n\n    BOOST_FOREACH(const COutput& out, vCoins)\n        nBalance += out.tx->vout[out.i].nValue;\n\n    if(total > nBalance)\n    {\n        return AmountExceedsBalance;\n    }\n\n    if((total + nTransactionFee) > nBalance)\n    {\n        return SendCoinsReturn(AmountWithFeeExceedsBalance, nTransactionFee);\n    }\n\n    {\n        LOCK2(cs_main, wallet->cs_wallet);\n\n        // Sendmany\n        std::vector<std::pair<CScript, int64_t> > vecSend;\n        foreach(const SendCoinsRecipient &rcp, recipients)\n        {\n            CScript scriptPubKey;\n            scriptPubKey.SetDestination(CBitcoinAddress(rcp.address.toStdString()).Get());\n            vecSend.push_back(make_pair(scriptPubKey, rcp.amount));\n        }\n\n        CWalletTx wtx;\n        CReserveKey keyChange(wallet);\n        int64_t nFeeRequired = 0;\n        bool fCreated = wallet->CreateTransaction(vecSend, wtx, keyChange, nFeeRequired, coinControl);\n\n        if(!fCreated)\n        {\n            if((total + nFeeRequired) > nBalance) // FIXME: could cause collisions in the future\n            {\n                return SendCoinsReturn(AmountWithFeeExceedsBalance, nFeeRequired);\n            }\n            return TransactionCreationFailed;\n        }\n        if(!uiInterface.ThreadSafeAskFee(nFeeRequired, tr(\"Sending...\").toStdString()))\n        {\n            return Aborted;\n        }\n        if(!wallet->CommitTransaction(wtx, keyChange))\n        {\n            return TransactionCommitFailed;\n        }\n        hex = QString::fromStdString(wtx.GetHash().GetHex());\n    }\n\n    // Add addresses / update labels that we've sent to to the address book\n    foreach(const SendCoinsRecipient &rcp, recipients)\n    {\n        std::string strAddress = rcp.address.toStdString();\n        CTxDestination dest = CBitcoinAddress(strAddress).Get();\n        std::string strLabel = rcp.label.toStdString();\n        {\n            LOCK(wallet->cs_wallet);\n\n            std::map<CTxDestination, std::string>::iterator mi = wallet->mapAddressBook.find(dest);\n\n            // Check if we have a new address or an updated label\n            if (mi == wallet->mapAddressBook.end() || mi->second != strLabel)\n            {\n                wallet->SetAddressBookName(dest, strLabel);\n            }\n        }\n    }\n\n    return SendCoinsReturn(OK, 0, hex);\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "SendCoinsReturn",
          "args": [
            "OK",
            "0",
            "hex"
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wallet->SetAddressBookName",
          "args": [
            "dest",
            "strLabel"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wallet->mapAddressBook.end",
          "args": [],
          "line": 229
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wallet->mapAddressBook.find",
          "args": [
            "dest"
          ],
          "line": 226
        },
        "resolved": true,
        "details": {
          "function_name": "find",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "33-33",
          "snippet": "const_iterator find(const key_type& k) const { return map.find(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator find(const key_type& k) const { return map.find(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "wallet->cs_wallet"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rcp.label.toStdString",
          "args": [],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CBitcoinAddress",
          "args": [],
          "line": 221
        },
        "resolved": true,
        "details": {
          "function_name": "IsScript",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "384-394",
          "snippet": "bool IsScript() const {\n        if (!IsValid())\n            return false;\n        switch (nVersion) {\n        case SCRIPT_ADDRESS:\n        case SCRIPT_ADDRESS_TEST: {\n            return true;\n        }\n        default: return false;\n        }\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  bool IsScript() const {\n          if (!IsValid())\n              return false;\n          switch (nVersion) {\n          case SCRIPT_ADDRESS:\n          case SCRIPT_ADDRESS_TEST: {\n              return true;\n          }\n          default: return false;\n          }\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "CBitcoinAddress",
          "args": [
            "strAddress"
          ],
          "line": 221
        },
        "resolved": true,
        "details": {
          "function_name": "operator()",
          "container": "CBitcoinAddressVisitor",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "399-399",
          "snippet": "bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddressVisitor {\n  bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "rcp.address.toStdString",
          "args": [],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString::fromStdString",
          "args": [
            "wtx.GetHash().GetHex()"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wtx.GetHash",
          "args": [],
          "line": 214
        },
        "resolved": true,
        "details": {
          "function_name": "GetHash",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "922-928",
          "snippet": "uint64_t CNetAddr::GetHash() const\n{\n    uint256 hash = Hash(&ip[0], &ip[16]);\n    uint64_t nRet;\n    memcpy(&nRet, &hash, sizeof(nRet));\n    return nRet;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCNetAddr {\n  uint64_t CNetAddr::GetHash() const\n  {\n      uint256 hash = Hash(&ip[0], &ip[16]);\n      uint64_t nRet;\n      memcpy(&nRet, &hash, sizeof(nRet));\n      return nRet;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wallet->CommitTransaction",
          "args": [
            "wtx",
            "keyChange"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uiInterface.ThreadSafeAskFee",
          "args": [
            "nFeeRequired",
            "tr(\"Sending...\").toStdString()"
          ],
          "line": 206
        },
        "resolved": true,
        "details": {
          "function_name": "ThreadSafeAskFee",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/bitcoin.cpp",
          "lines": "58-71",
          "snippet": "static bool ThreadSafeAskFee(int64_t nFeeRequired, const std::string& strCaption)\n{\n    if(!guiref)\n        return false;\n    if(nFeeRequired < MIN_TX_FEE || nFeeRequired <= nTransactionFee || fDaemon)\n        return true;\n    bool payFee = false;\n\n    QMetaObject::invokeMethod(guiref, \"askFee\", GUIUtil::blockingGUIThreadConnection(),\n                               Q_ARG(qint64, nFeeRequired),\n                               Q_ARG(bool*, &payFee));\n\n    return payFee;\n}",
          "includes": [
            "#include <QtPlugin>",
            "#include <QLibraryInfo>",
            "#include <QSplashScreen>",
            "#include <QTranslator>",
            "#include <QLocale>",
            "#include <QTextCodec>",
            "#include <QMessageBox>",
            "#include <QApplication>",
            "#include \"qtipcserver.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"guiconstants.h\"",
            "#include \"guiutil.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"walletmodel.h\"",
            "#include \"clientmodel.h\"",
            "#include \"bitcoingui.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static BitcoinGUI *guiref;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <QtPlugin>\n#include <QLibraryInfo>\n#include <QSplashScreen>\n#include <QTranslator>\n#include <QLocale>\n#include <QTextCodec>\n#include <QMessageBox>\n#include <QApplication>\n#include \"qtipcserver.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"guiconstants.h\"\n#include \"guiutil.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"clientmodel.h\"\n#include \"bitcoingui.h\"\n\nstatic BitcoinGUI *guiref;\n\nstatic bool ThreadSafeAskFee(int64_t nFeeRequired, const std::string& strCaption)\n{\n    if(!guiref)\n        return false;\n    if(nFeeRequired < MIN_TX_FEE || nFeeRequired <= nTransactionFee || fDaemon)\n        return true;\n    bool payFee = false;\n\n    QMetaObject::invokeMethod(guiref, \"askFee\", GUIUtil::blockingGUIThreadConnection(),\n                               Q_ARG(qint64, nFeeRequired),\n                               Q_ARG(bool*, &payFee));\n\n    return payFee;\n}"
        }
      },
      {
        "call_info": {
          "callee": "tr",
          "args": [],
          "line": 206
        },
        "resolved": true,
        "details": {
          "function_name": "updateDisplayUnit",
          "container": "SendCoinsEntry",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/sendcoinsentry.cpp",
          "lines": "167-174",
          "snippet": "void SendCoinsEntry::updateDisplayUnit()\n{\n    if(model && model->getOptionsModel())\n    {\n        // Update payAmount with the current unit\n        ui->payAmount->setDisplayUnit(model->getOptionsModel()->getDisplayUnit());\n    }\n}",
          "includes": [
            "#include <QClipboard>",
            "#include <QApplication>",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"walletmodel.h\"",
            "#include \"addressbookpage.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"guiutil.h\"",
            "#include \"ui_sendcoinsentry.h\"",
            "#include \"sendcoinsentry.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QClipboard>\n#include <QApplication>\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"addressbookpage.h\"\n#include \"bitcoinunits.h\"\n#include \"guiutil.h\"\n#include \"ui_sendcoinsentry.h\"\n#include \"sendcoinsentry.h\"\n\nSendCoinsEntry {\n  void SendCoinsEntry::updateDisplayUnit()\n  {\n      if(model && model->getOptionsModel())\n      {\n          // Update payAmount with the current unit\n          ui->payAmount->setDisplayUnit(model->getOptionsModel()->getDisplayUnit());\n      }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "tr",
          "args": [
            "\"Sending...\""
          ],
          "line": 206
        },
        "resolved": true,
        "details": {
          "function_name": "setValue",
          "container": "SendCoinsEntry",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/sendcoinsentry.cpp",
          "lines": "150-155",
          "snippet": "void SendCoinsEntry::setValue(const SendCoinsRecipient &value)\n{\n    ui->payTo->setText(value.address);\n    ui->addAsLabel->setText(value.label);\n    ui->payAmount->setValue(value.amount);\n}",
          "includes": [
            "#include <QClipboard>",
            "#include <QApplication>",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"walletmodel.h\"",
            "#include \"addressbookpage.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"guiutil.h\"",
            "#include \"ui_sendcoinsentry.h\"",
            "#include \"sendcoinsentry.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QClipboard>\n#include <QApplication>\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"addressbookpage.h\"\n#include \"bitcoinunits.h\"\n#include \"guiutil.h\"\n#include \"ui_sendcoinsentry.h\"\n#include \"sendcoinsentry.h\"\n\nSendCoinsEntry {\n  void SendCoinsEntry::setValue(const SendCoinsRecipient &value)\n  {\n      ui->payTo->setText(value.address);\n      ui->addAsLabel->setText(value.label);\n      ui->payAmount->setValue(value.amount);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "SendCoinsReturn",
          "args": [
            "AmountWithFeeExceedsBalance",
            "nFeeRequired"
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wallet->CreateTransaction",
          "args": [
            "vecSend",
            "wtx",
            "keyChange",
            "nFeeRequired",
            "coinControl"
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vecSend.push_back",
          "args": [
            "make_pair(scriptPubKey, rcp.amount)"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "make_pair",
          "args": [
            "scriptPubKey",
            "rcp.amount"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "scriptPubKey.SetDestination",
          "args": [
            "CBitcoinAddress(rcp.address.toStdString()).Get()"
          ],
          "line": 189
        },
        "resolved": true,
        "details": {
          "function_name": "SetDestination",
          "container": "CScript",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/script.cpp",
          "lines": "2011-2014",
          "snippet": "void CScript::SetDestination(const CTxDestination& dest)\n{\n    boost::apply_visitor(CScriptVisitor(this), dest);\n}",
          "includes": [
            "#include \"util.h\"",
            "#include \"sync.h\"",
            "#include \"main.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include \"keystore.h\"",
            "#include \"script.h\"",
            "#include <boost/tuple/tuple_comparison.hpp>",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/foreach.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"sync.h\"\n#include \"main.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include \"keystore.h\"\n#include \"script.h\"\n#include <boost/tuple/tuple_comparison.hpp>\n#include <boost/tuple/tuple.hpp>\n#include <boost/foreach.hpp>\n\nCScript {\n  void CScript::SetDestination(const CTxDestination& dest)\n  {\n      boost::apply_visitor(CScriptVisitor(this), dest);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "rcp.address.toStdString",
          "args": [],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LOCK2",
          "args": [
            "cs_main",
            "wallet->cs_wallet"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SendCoinsReturn",
          "args": [
            "AmountWithFeeExceedsBalance",
            "nTransactionFee"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wallet->AvailableCoins",
          "args": [
            "vCoins",
            "true",
            "coinControl"
          ],
          "line": 166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setAddress.size",
          "args": [],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "TransactionTablePriv",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/transactiontablemodel.cpp",
          "lines": "170-173",
          "snippet": "int size()\n    {\n        return cachedWallet.size();\n    }",
          "includes": [
            "#include <QtAlgorithms>",
            "#include <QDateTime>",
            "#include <QIcon>",
            "#include <QTimer>",
            "#include <QColor>",
            "#include <QList>",
            "#include <QLocale>",
            "#include \"ui_interface.h\"",
            "#include \"wallet.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"walletmodel.h\"",
            "#include \"transactiondesc.h\"",
            "#include \"guiconstants.h\"",
            "#include \"transactionrecord.h\"",
            "#include \"guiutil.h\"",
            "#include \"transactiontablemodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QtAlgorithms>\n#include <QDateTime>\n#include <QIcon>\n#include <QTimer>\n#include <QColor>\n#include <QList>\n#include <QLocale>\n#include \"ui_interface.h\"\n#include \"wallet.h\"\n#include \"bitcoinunits.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"transactiondesc.h\"\n#include \"guiconstants.h\"\n#include \"transactionrecord.h\"\n#include \"guiutil.h\"\n#include \"transactiontablemodel.h\"\n\nTransactionTablePriv {\n  int size()\n      {\n          return cachedWallet.size();\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "setAddress.insert",
          "args": [
            "rcp.address"
          ],
          "line": 150
        },
        "resolved": true,
        "details": {
          "function_name": "insert",
          "container": "CBloomFilter",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bloom.cpp",
          "lines": "61-65",
          "snippet": "void CBloomFilter::insert(const uint256& hash)\n{\n    vector<unsigned char> data(BEGIN(hash), END(hash));\n    insert(data);\n}",
          "includes": [
            "#include \"hash.h\"",
            "#include \"script.h\"",
            "#include \"main.h\"",
            "#include \"bloom.h\"",
            "#include <stdlib.h>",
            "#include <math.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hash.h\"\n#include \"script.h\"\n#include \"main.h\"\n#include \"bloom.h\"\n#include <stdlib.h>\n#include <math.h>\n\nCBloomFilter {\n  void CBloomFilter::insert(const uint256& hash)\n  {\n      vector<unsigned char> data(BEGIN(hash), END(hash));\n      insert(data);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "validateAddress",
          "args": [
            "rcp.address"
          ],
          "line": 146
        },
        "resolved": true,
        "details": {
          "function_name": "validateAddress",
          "container": "WalletModel",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
          "lines": "126-130",
          "snippet": "bool WalletModel::validateAddress(const QString &address)\n{\n    CBitcoinAddress addressParsed(address.toStdString());\n    return addressParsed.IsValid();\n}",
          "includes": [
            "#include <QTimer>",
            "#include <QSet>",
            "#include \"base58.h\"",
            "#include \"walletdb.h\" // for BackupWallet",
            "#include \"wallet.h\"",
            "#include \"ui_interface.h\"",
            "#include \"transactiontablemodel.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"guiconstants.h\"",
            "#include \"walletmodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  bool WalletModel::validateAddress(const QString &address)\n  {\n      CBitcoinAddress addressParsed(address.toStdString());\n      return addressParsed.IsValid();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "recipients.empty",
          "args": [],
          "line": 138
        },
        "resolved": true,
        "details": {
          "function_name": "empty",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "32-32",
          "snippet": "bool empty() const { return map.empty(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  bool empty() const { return map.empty(); }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  WalletModel::SendCoinsReturn WalletModel::sendCoins(const QList<SendCoinsRecipient> &recipients, const CCoinControl *coinControl)\n  {\n      qint64 total = 0;\n      QSet<QString> setAddress;\n      QString hex;\n  \n      if(recipients.empty())\n      {\n          return OK;\n      }\n  \n      // Pre-check input data for validity\n      foreach(const SendCoinsRecipient &rcp, recipients)\n      {\n          if(!validateAddress(rcp.address))\n          {\n              return InvalidAddress;\n          }\n          setAddress.insert(rcp.address);\n  \n          if(rcp.amount <= 0)\n          {\n              return InvalidAmount;\n          }\n          total += rcp.amount;\n      }\n  \n      if(recipients.size() > setAddress.size())\n      {\n          return DuplicateAddress;\n      }\n  \n      int64_t nBalance = 0;\n      std::vector<COutput> vCoins;\n      wallet->AvailableCoins(vCoins, true, coinControl);\n  \n      BOOST_FOREACH(const COutput& out, vCoins)\n          nBalance += out.tx->vout[out.i].nValue;\n  \n      if(total > nBalance)\n      {\n          return AmountExceedsBalance;\n      }\n  \n      if((total + nTransactionFee) > nBalance)\n      {\n          return SendCoinsReturn(AmountWithFeeExceedsBalance, nTransactionFee);\n      }\n  \n      {\n          LOCK2(cs_main, wallet->cs_wallet);\n  \n          // Sendmany\n          std::vector<std::pair<CScript, int64_t> > vecSend;\n          foreach(const SendCoinsRecipient &rcp, recipients)\n          {\n              CScript scriptPubKey;\n              scriptPubKey.SetDestination(CBitcoinAddress(rcp.address.toStdString()).Get());\n              vecSend.push_back(make_pair(scriptPubKey, rcp.amount));\n          }\n  \n          CWalletTx wtx;\n          CReserveKey keyChange(wallet);\n          int64_t nFeeRequired = 0;\n          bool fCreated = wallet->CreateTransaction(vecSend, wtx, keyChange, nFeeRequired, coinControl);\n  \n          if(!fCreated)\n          {\n              if((total + nFeeRequired) > nBalance) // FIXME: could cause collisions in the future\n              {\n                  return SendCoinsReturn(AmountWithFeeExceedsBalance, nFeeRequired);\n              }\n              return TransactionCreationFailed;\n          }\n          if(!uiInterface.ThreadSafeAskFee(nFeeRequired, tr(\"Sending...\").toStdString()))\n          {\n              return Aborted;\n          }\n          if(!wallet->CommitTransaction(wtx, keyChange))\n          {\n              return TransactionCommitFailed;\n          }\n          hex = QString::fromStdString(wtx.GetHash().GetHex());\n      }\n  \n      // Add addresses / update labels that we've sent to to the address book\n      foreach(const SendCoinsRecipient &rcp, recipients)\n      {\n          std::string strAddress = rcp.address.toStdString();\n          CTxDestination dest = CBitcoinAddress(strAddress).Get();\n          std::string strLabel = rcp.label.toStdString();\n          {\n              LOCK(wallet->cs_wallet);\n  \n              std::map<CTxDestination, std::string>::iterator mi = wallet->mapAddressBook.find(dest);\n  \n              // Check if we have a new address or an updated label\n              if (mi == wallet->mapAddressBook.end() || mi->second != strLabel)\n              {\n                  wallet->SetAddressBookName(dest, strLabel);\n              }\n          }\n      }\n  \n      return SendCoinsReturn(OK, 0, hex);\n  }\n}"
  },
  {
    "function_name": "validateAddress",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "126-130",
    "snippet": "bool WalletModel::validateAddress(const QString &address)\n{\n    CBitcoinAddress addressParsed(address.toStdString());\n    return addressParsed.IsValid();\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "addressParsed.IsValid",
          "args": [],
          "line": 129
        },
        "resolved": true,
        "details": {
          "function_name": "IsValid",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "725-759",
          "snippet": "bool CNetAddr::IsValid() const\n{\n    // Cleanup 3-byte shifted addresses caused by garbage in size field\n    // of addr messages from versions before 0.2.9 checksum.\n    // Two consecutive addr messages look like this:\n    // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n    // so if the first length field is garbled, it reads the second batch\n    // of addr misaligned by 3 bytes.\n    if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n        return false;\n\n    // unspecified IPv6 address (::/128)\n    unsigned char ipNone[16] = {};\n    if (memcmp(ip, ipNone, 16) == 0)\n        return false;\n\n    // documentation IPv6 address\n    if (IsRFC3849())\n        return false;\n\n    if (IsIPv4())\n    {\n        // INADDR_NONE\n        uint32_t ipNone = INADDR_NONE;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n\n        // 0\n        ipNone = 0;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n    }\n\n    return true;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nstatic const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };\n\nCNetAddr {\n  bool CNetAddr::IsValid() const\n  {\n      // Cleanup 3-byte shifted addresses caused by garbage in size field\n      // of addr messages from versions before 0.2.9 checksum.\n      // Two consecutive addr messages look like this:\n      // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n      // so if the first length field is garbled, it reads the second batch\n      // of addr misaligned by 3 bytes.\n      if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n          return false;\n  \n      // unspecified IPv6 address (::/128)\n      unsigned char ipNone[16] = {};\n      if (memcmp(ip, ipNone, 16) == 0)\n          return false;\n  \n      // documentation IPv6 address\n      if (IsRFC3849())\n          return false;\n  \n      if (IsIPv4())\n      {\n          // INADDR_NONE\n          uint32_t ipNone = INADDR_NONE;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n  \n          // 0\n          ipNone = 0;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n      }\n  \n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "address.toStdString",
          "args": [],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  bool WalletModel::validateAddress(const QString &address)\n  {\n      CBitcoinAddress addressParsed(address.toStdString());\n      return addressParsed.IsValid();\n  }\n}"
  },
  {
    "function_name": "updateAddressBook",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "120-124",
    "snippet": "void WalletModel::updateAddressBook(const QString &address, const QString &label, bool isMine, int status)\n{\n    if(addressTableModel)\n        addressTableModel->updateEntry(address, label, isMine, status);\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "addressTableModel->updateEntry",
          "args": [
            "address",
            "label",
            "isMine",
            "status"
          ],
          "line": 123
        },
        "resolved": true,
        "details": {
          "function_name": "updateEntry",
          "container": "AddressTableModel",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/addresstablemodel.cpp",
          "lines": "315-319",
          "snippet": "void AddressTableModel::updateEntry(const QString &address, const QString &label, bool isMine, int status)\n{\n    // Update address book model from Bitcoin core\n    priv->updateEntry(address, label, isMine, status);\n}",
          "includes": [
            "#include <QColor>",
            "#include <QFont>",
            "#include \"base58.h\"",
            "#include \"wallet.h\"",
            "#include \"walletmodel.h\"",
            "#include \"guiutil.h\"",
            "#include \"addresstablemodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QColor>\n#include <QFont>\n#include \"base58.h\"\n#include \"wallet.h\"\n#include \"walletmodel.h\"\n#include \"guiutil.h\"\n#include \"addresstablemodel.h\"\n\nAddressTableModel {\n  void AddressTableModel::updateEntry(const QString &address, const QString &label, bool isMine, int status)\n  {\n      // Update address book model from Bitcoin core\n      priv->updateEntry(address, label, isMine, status);\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  void WalletModel::updateAddressBook(const QString &address, const QString &label, bool isMine, int status)\n  {\n      if(addressTableModel)\n          addressTableModel->updateEntry(address, label, isMine, status);\n  }\n}"
  },
  {
    "function_name": "updateTransaction",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "104-118",
    "snippet": "void WalletModel::updateTransaction(const QString &hash, int status)\n{\n    if(transactionTableModel)\n        transactionTableModel->updateTransaction(hash, status);\n\n    // Balance and number of transactions might have changed\n    checkBalanceChanged();\n\n    int newNumTransactions = getNumTransactions();\n    if(cachedNumTransactions != newNumTransactions)\n    {\n        cachedNumTransactions = newNumTransactions;\n        emit numTransactionsChanged(newNumTransactions);\n    }\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "getNumTransactions",
          "args": [],
          "line": 112
        },
        "resolved": true,
        "details": {
          "function_name": "getNumTransactions",
          "container": "WalletModel",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
          "lines": "59-67",
          "snippet": "int WalletModel::getNumTransactions() const\n{\n    int numTransactions = 0;\n    {\n        LOCK(wallet->cs_wallet);\n        numTransactions = wallet->mapWallet.size();\n    }\n    return numTransactions;\n}",
          "includes": [
            "#include <QTimer>",
            "#include <QSet>",
            "#include \"base58.h\"",
            "#include \"walletdb.h\" // for BackupWallet",
            "#include \"wallet.h\"",
            "#include \"ui_interface.h\"",
            "#include \"transactiontablemodel.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"guiconstants.h\"",
            "#include \"walletmodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  int WalletModel::getNumTransactions() const\n  {\n      int numTransactions = 0;\n      {\n          LOCK(wallet->cs_wallet);\n          numTransactions = wallet->mapWallet.size();\n      }\n      return numTransactions;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "checkBalanceChanged",
          "args": [],
          "line": 110
        },
        "resolved": true,
        "details": {
          "function_name": "checkBalanceChanged",
          "container": "WalletModel",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
          "lines": "87-102",
          "snippet": "void WalletModel::checkBalanceChanged()\n{\n    qint64 newBalance = getBalance();\n    qint64 newStake = getStake();\n    qint64 newUnconfirmedBalance = getUnconfirmedBalance();\n    qint64 newImmatureBalance = getImmatureBalance();\n\n    if(cachedBalance != newBalance || cachedStake != newStake || cachedUnconfirmedBalance != newUnconfirmedBalance || cachedImmatureBalance != newImmatureBalance)\n    {\n        cachedBalance = newBalance;\n        cachedStake = newStake;\n        cachedUnconfirmedBalance = newUnconfirmedBalance;\n        cachedImmatureBalance = newImmatureBalance;\n        emit balanceChanged(newBalance, newStake, newUnconfirmedBalance, newImmatureBalance);\n    }\n}",
          "includes": [
            "#include <QTimer>",
            "#include <QSet>",
            "#include \"base58.h\"",
            "#include \"walletdb.h\" // for BackupWallet",
            "#include \"wallet.h\"",
            "#include \"ui_interface.h\"",
            "#include \"transactiontablemodel.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"guiconstants.h\"",
            "#include \"walletmodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  void WalletModel::checkBalanceChanged()\n  {\n      qint64 newBalance = getBalance();\n      qint64 newStake = getStake();\n      qint64 newUnconfirmedBalance = getUnconfirmedBalance();\n      qint64 newImmatureBalance = getImmatureBalance();\n  \n      if(cachedBalance != newBalance || cachedStake != newStake || cachedUnconfirmedBalance != newUnconfirmedBalance || cachedImmatureBalance != newImmatureBalance)\n      {\n          cachedBalance = newBalance;\n          cachedStake = newStake;\n          cachedUnconfirmedBalance = newUnconfirmedBalance;\n          cachedImmatureBalance = newImmatureBalance;\n          emit balanceChanged(newBalance, newStake, newUnconfirmedBalance, newImmatureBalance);\n      }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "transactionTableModel->updateTransaction",
          "args": [
            "hash",
            "status"
          ],
          "line": 107
        },
        "resolved": true,
        "details": {
          "function_name": "updateTransaction",
          "container": "WalletModel",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
          "lines": "104-118",
          "snippet": "void WalletModel::updateTransaction(const QString &hash, int status)\n{\n    if(transactionTableModel)\n        transactionTableModel->updateTransaction(hash, status);\n\n    // Balance and number of transactions might have changed\n    checkBalanceChanged();\n\n    int newNumTransactions = getNumTransactions();\n    if(cachedNumTransactions != newNumTransactions)\n    {\n        cachedNumTransactions = newNumTransactions;\n        emit numTransactionsChanged(newNumTransactions);\n    }\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  void WalletModel::updateTransaction(const QString &hash, int status)\n  {\n      if(transactionTableModel)\n          transactionTableModel->updateTransaction(hash, status);\n  \n      // Balance and number of transactions might have changed\n      checkBalanceChanged();\n  \n      int newNumTransactions = getNumTransactions();\n      if(cachedNumTransactions != newNumTransactions)\n      {\n          cachedNumTransactions = newNumTransactions;\n          emit numTransactionsChanged(newNumTransactions);\n      }\n  }\n}"
  },
  {
    "function_name": "checkBalanceChanged",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "87-102",
    "snippet": "void WalletModel::checkBalanceChanged()\n{\n    qint64 newBalance = getBalance();\n    qint64 newStake = getStake();\n    qint64 newUnconfirmedBalance = getUnconfirmedBalance();\n    qint64 newImmatureBalance = getImmatureBalance();\n\n    if(cachedBalance != newBalance || cachedStake != newStake || cachedUnconfirmedBalance != newUnconfirmedBalance || cachedImmatureBalance != newImmatureBalance)\n    {\n        cachedBalance = newBalance;\n        cachedStake = newStake;\n        cachedUnconfirmedBalance = newUnconfirmedBalance;\n        cachedImmatureBalance = newImmatureBalance;\n        emit balanceChanged(newBalance, newStake, newUnconfirmedBalance, newImmatureBalance);\n    }\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "getImmatureBalance",
          "args": [],
          "line": 92
        },
        "resolved": true,
        "details": {
          "function_name": "getImmatureBalance",
          "container": "WalletModel",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
          "lines": "54-57",
          "snippet": "qint64 WalletModel::getImmatureBalance() const\n{\n    return wallet->GetImmatureBalance();\n}",
          "includes": [
            "#include <QTimer>",
            "#include <QSet>",
            "#include \"base58.h\"",
            "#include \"walletdb.h\" // for BackupWallet",
            "#include \"wallet.h\"",
            "#include \"ui_interface.h\"",
            "#include \"transactiontablemodel.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"guiconstants.h\"",
            "#include \"walletmodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  qint64 WalletModel::getImmatureBalance() const\n  {\n      return wallet->GetImmatureBalance();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "getUnconfirmedBalance",
          "args": [],
          "line": 91
        },
        "resolved": true,
        "details": {
          "function_name": "getUnconfirmedBalance",
          "container": "WalletModel",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
          "lines": "44-47",
          "snippet": "qint64 WalletModel::getUnconfirmedBalance() const\n{\n    return wallet->GetUnconfirmedBalance();\n}",
          "includes": [
            "#include <QTimer>",
            "#include <QSet>",
            "#include \"base58.h\"",
            "#include \"walletdb.h\" // for BackupWallet",
            "#include \"wallet.h\"",
            "#include \"ui_interface.h\"",
            "#include \"transactiontablemodel.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"guiconstants.h\"",
            "#include \"walletmodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  qint64 WalletModel::getUnconfirmedBalance() const\n  {\n      return wallet->GetUnconfirmedBalance();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "getStake",
          "args": [],
          "line": 90
        },
        "resolved": true,
        "details": {
          "function_name": "getStake",
          "container": "WalletModel",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
          "lines": "49-52",
          "snippet": "qint64 WalletModel::getStake() const\n{\n    return wallet->GetStake();\n}",
          "includes": [
            "#include <QTimer>",
            "#include <QSet>",
            "#include \"base58.h\"",
            "#include \"walletdb.h\" // for BackupWallet",
            "#include \"wallet.h\"",
            "#include \"ui_interface.h\"",
            "#include \"transactiontablemodel.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"guiconstants.h\"",
            "#include \"walletmodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  qint64 WalletModel::getStake() const\n  {\n      return wallet->GetStake();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "getBalance",
          "args": [],
          "line": 89
        },
        "resolved": true,
        "details": {
          "function_name": "getBalance",
          "container": "WalletModel",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
          "lines": "39-42",
          "snippet": "qint64 WalletModel::getBalance() const\n{\n    return wallet->GetBalance();\n}",
          "includes": [
            "#include <QTimer>",
            "#include <QSet>",
            "#include \"base58.h\"",
            "#include \"walletdb.h\" // for BackupWallet",
            "#include \"wallet.h\"",
            "#include \"ui_interface.h\"",
            "#include \"transactiontablemodel.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"guiconstants.h\"",
            "#include \"walletmodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  qint64 WalletModel::getBalance() const\n  {\n      return wallet->GetBalance();\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  void WalletModel::checkBalanceChanged()\n  {\n      qint64 newBalance = getBalance();\n      qint64 newStake = getStake();\n      qint64 newUnconfirmedBalance = getUnconfirmedBalance();\n      qint64 newImmatureBalance = getImmatureBalance();\n  \n      if(cachedBalance != newBalance || cachedStake != newStake || cachedUnconfirmedBalance != newUnconfirmedBalance || cachedImmatureBalance != newImmatureBalance)\n      {\n          cachedBalance = newBalance;\n          cachedStake = newStake;\n          cachedUnconfirmedBalance = newUnconfirmedBalance;\n          cachedImmatureBalance = newImmatureBalance;\n          emit balanceChanged(newBalance, newStake, newUnconfirmedBalance, newImmatureBalance);\n      }\n  }\n}"
  },
  {
    "function_name": "pollBalanceChanged",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "77-85",
    "snippet": "void WalletModel::pollBalanceChanged()\n{\n    if(nBestHeight != cachedNumBlocks)\n    {\n        // Balance and number of transactions might have changed\n        cachedNumBlocks = nBestHeight;\n        checkBalanceChanged();\n    }\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "checkBalanceChanged",
          "args": [],
          "line": 83
        },
        "resolved": true,
        "details": {
          "function_name": "checkBalanceChanged",
          "container": "WalletModel",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
          "lines": "87-102",
          "snippet": "void WalletModel::checkBalanceChanged()\n{\n    qint64 newBalance = getBalance();\n    qint64 newStake = getStake();\n    qint64 newUnconfirmedBalance = getUnconfirmedBalance();\n    qint64 newImmatureBalance = getImmatureBalance();\n\n    if(cachedBalance != newBalance || cachedStake != newStake || cachedUnconfirmedBalance != newUnconfirmedBalance || cachedImmatureBalance != newImmatureBalance)\n    {\n        cachedBalance = newBalance;\n        cachedStake = newStake;\n        cachedUnconfirmedBalance = newUnconfirmedBalance;\n        cachedImmatureBalance = newImmatureBalance;\n        emit balanceChanged(newBalance, newStake, newUnconfirmedBalance, newImmatureBalance);\n    }\n}",
          "includes": [
            "#include <QTimer>",
            "#include <QSet>",
            "#include \"base58.h\"",
            "#include \"walletdb.h\" // for BackupWallet",
            "#include \"wallet.h\"",
            "#include \"ui_interface.h\"",
            "#include \"transactiontablemodel.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"guiconstants.h\"",
            "#include \"walletmodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  void WalletModel::checkBalanceChanged()\n  {\n      qint64 newBalance = getBalance();\n      qint64 newStake = getStake();\n      qint64 newUnconfirmedBalance = getUnconfirmedBalance();\n      qint64 newImmatureBalance = getImmatureBalance();\n  \n      if(cachedBalance != newBalance || cachedStake != newStake || cachedUnconfirmedBalance != newUnconfirmedBalance || cachedImmatureBalance != newImmatureBalance)\n      {\n          cachedBalance = newBalance;\n          cachedStake = newStake;\n          cachedUnconfirmedBalance = newUnconfirmedBalance;\n          cachedImmatureBalance = newImmatureBalance;\n          emit balanceChanged(newBalance, newStake, newUnconfirmedBalance, newImmatureBalance);\n      }\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  void WalletModel::pollBalanceChanged()\n  {\n      if(nBestHeight != cachedNumBlocks)\n      {\n          // Balance and number of transactions might have changed\n          cachedNumBlocks = nBestHeight;\n          checkBalanceChanged();\n      }\n  }\n}"
  },
  {
    "function_name": "updateStatus",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "69-75",
    "snippet": "void WalletModel::updateStatus()\n{\n    EncryptionStatus newEncryptionStatus = getEncryptionStatus();\n\n    if(cachedEncryptionStatus != newEncryptionStatus)\n        emit encryptionStatusChanged(newEncryptionStatus);\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "encryptionStatusChanged",
          "args": [
            "newEncryptionStatus"
          ],
          "line": 74
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getEncryptionStatus",
          "args": [],
          "line": 71
        },
        "resolved": true,
        "details": {
          "function_name": "getEncryptionStatus",
          "container": "WalletModel",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
          "lines": "254-268",
          "snippet": "WalletModel::EncryptionStatus WalletModel::getEncryptionStatus() const\n{\n    if(!wallet->IsCrypted())\n    {\n        return Unencrypted;\n    }\n    else if(wallet->IsLocked())\n    {\n        return Locked;\n    }\n    else\n    {\n        return Unlocked;\n    }\n}",
          "includes": [
            "#include <QTimer>",
            "#include <QSet>",
            "#include \"base58.h\"",
            "#include \"walletdb.h\" // for BackupWallet",
            "#include \"wallet.h\"",
            "#include \"ui_interface.h\"",
            "#include \"transactiontablemodel.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"guiconstants.h\"",
            "#include \"walletmodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  WalletModel::EncryptionStatus WalletModel::getEncryptionStatus() const\n  {\n      if(!wallet->IsCrypted())\n      {\n          return Unencrypted;\n      }\n      else if(wallet->IsLocked())\n      {\n          return Locked;\n      }\n      else\n      {\n          return Unlocked;\n      }\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  void WalletModel::updateStatus()\n  {\n      EncryptionStatus newEncryptionStatus = getEncryptionStatus();\n  \n      if(cachedEncryptionStatus != newEncryptionStatus)\n          emit encryptionStatusChanged(newEncryptionStatus);\n  }\n}"
  },
  {
    "function_name": "getNumTransactions",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "59-67",
    "snippet": "int WalletModel::getNumTransactions() const\n{\n    int numTransactions = 0;\n    {\n        LOCK(wallet->cs_wallet);\n        numTransactions = wallet->mapWallet.size();\n    }\n    return numTransactions;\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wallet->mapWallet.size",
          "args": [],
          "line": 64
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "TransactionTablePriv",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/transactiontablemodel.cpp",
          "lines": "170-173",
          "snippet": "int size()\n    {\n        return cachedWallet.size();\n    }",
          "includes": [
            "#include <QtAlgorithms>",
            "#include <QDateTime>",
            "#include <QIcon>",
            "#include <QTimer>",
            "#include <QColor>",
            "#include <QList>",
            "#include <QLocale>",
            "#include \"ui_interface.h\"",
            "#include \"wallet.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"walletmodel.h\"",
            "#include \"transactiondesc.h\"",
            "#include \"guiconstants.h\"",
            "#include \"transactionrecord.h\"",
            "#include \"guiutil.h\"",
            "#include \"transactiontablemodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QtAlgorithms>\n#include <QDateTime>\n#include <QIcon>\n#include <QTimer>\n#include <QColor>\n#include <QList>\n#include <QLocale>\n#include \"ui_interface.h\"\n#include \"wallet.h\"\n#include \"bitcoinunits.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"transactiondesc.h\"\n#include \"guiconstants.h\"\n#include \"transactionrecord.h\"\n#include \"guiutil.h\"\n#include \"transactiontablemodel.h\"\n\nTransactionTablePriv {\n  int size()\n      {\n          return cachedWallet.size();\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "wallet->cs_wallet"
          ],
          "line": 63
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  int WalletModel::getNumTransactions() const\n  {\n      int numTransactions = 0;\n      {\n          LOCK(wallet->cs_wallet);\n          numTransactions = wallet->mapWallet.size();\n      }\n      return numTransactions;\n  }\n}"
  },
  {
    "function_name": "getImmatureBalance",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "54-57",
    "snippet": "qint64 WalletModel::getImmatureBalance() const\n{\n    return wallet->GetImmatureBalance();\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wallet->GetImmatureBalance",
          "args": [],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  qint64 WalletModel::getImmatureBalance() const\n  {\n      return wallet->GetImmatureBalance();\n  }\n}"
  },
  {
    "function_name": "getStake",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "49-52",
    "snippet": "qint64 WalletModel::getStake() const\n{\n    return wallet->GetStake();\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wallet->GetStake",
          "args": [],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  qint64 WalletModel::getStake() const\n  {\n      return wallet->GetStake();\n  }\n}"
  },
  {
    "function_name": "getUnconfirmedBalance",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "44-47",
    "snippet": "qint64 WalletModel::getUnconfirmedBalance() const\n{\n    return wallet->GetUnconfirmedBalance();\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wallet->GetUnconfirmedBalance",
          "args": [],
          "line": 46
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  qint64 WalletModel::getUnconfirmedBalance() const\n  {\n      return wallet->GetUnconfirmedBalance();\n  }\n}"
  },
  {
    "function_name": "getBalance",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "39-42",
    "snippet": "qint64 WalletModel::getBalance() const\n{\n    return wallet->GetBalance();\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wallet->GetBalance",
          "args": [],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  qint64 WalletModel::getBalance() const\n  {\n      return wallet->GetBalance();\n  }\n}"
  },
  {
    "function_name": "~WalletModel",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "34-37",
    "snippet": "WalletModel::~WalletModel()\n{\n    unsubscribeFromCoreSignals();\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "unsubscribeFromCoreSignals",
          "args": [],
          "line": 36
        },
        "resolved": true,
        "details": {
          "function_name": "unsubscribeFromCoreSignals",
          "container": "WalletModel",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
          "lines": "351-361",
          "snippet": "void WalletModel::unsubscribeFromCoreSignals()\n{\n    // Disconnect signals from wallet\n    wallet->NotifyStatusChanged.disconnect(boost::bind(&NotifyKeyStoreStatusChanged, this,\n      boost::placeholders::_1));\n    wallet->NotifyAddressBookChanged.disconnect(boost::bind(NotifyAddressBookChanged, this,\n      boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3,\n      boost::placeholders::_4, boost::placeholders::_5));\n    wallet->NotifyTransactionChanged.disconnect(boost::bind(NotifyTransactionChanged, this,\n      boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3));\n}",
          "includes": [
            "#include <QTimer>",
            "#include <QSet>",
            "#include \"base58.h\"",
            "#include \"walletdb.h\" // for BackupWallet",
            "#include \"wallet.h\"",
            "#include \"ui_interface.h\"",
            "#include \"transactiontablemodel.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"guiconstants.h\"",
            "#include \"walletmodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  void WalletModel::unsubscribeFromCoreSignals()\n  {\n      // Disconnect signals from wallet\n      wallet->NotifyStatusChanged.disconnect(boost::bind(&NotifyKeyStoreStatusChanged, this,\n        boost::placeholders::_1));\n      wallet->NotifyAddressBookChanged.disconnect(boost::bind(NotifyAddressBookChanged, this,\n        boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3,\n        boost::placeholders::_4, boost::placeholders::_5));\n      wallet->NotifyTransactionChanged.disconnect(boost::bind(NotifyTransactionChanged, this,\n        boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3));\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  WalletModel::~WalletModel()\n  {\n      unsubscribeFromCoreSignals();\n  }\n}"
  },
  {
    "function_name": "WalletModel",
    "container": "WalletModel",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
    "lines": "15-32",
    "snippet": "WalletModel::WalletModel(CWallet *wallet, OptionsModel *optionsModel, QObject *parent) :\n    QObject(parent), wallet(wallet), optionsModel(optionsModel), addressTableModel(0),\n    transactionTableModel(0),\n    cachedBalance(0), cachedStake(0), cachedUnconfirmedBalance(0), cachedImmatureBalance(0),\n    cachedNumTransactions(0),\n    cachedEncryptionStatus(Unencrypted),\n    cachedNumBlocks(0)\n{\n    addressTableModel = new AddressTableModel(wallet, this);\n    transactionTableModel = new TransactionTableModel(wallet, this);\n\n    // This timer will be fired repeatedly to update the balance\n    pollTimer = new QTimer(this);\n    connect(pollTimer, SIGNAL(timeout()), this, SLOT(pollBalanceChanged()));\n    pollTimer->start(MODEL_UPDATE_DELAY);\n\n    subscribeToCoreSignals();\n}",
    "includes": [
      "#include <QTimer>",
      "#include <QSet>",
      "#include \"base58.h\"",
      "#include \"walletdb.h\" // for BackupWallet",
      "#include \"wallet.h\"",
      "#include \"ui_interface.h\"",
      "#include \"transactiontablemodel.h\"",
      "#include \"addresstablemodel.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"guiconstants.h\"",
      "#include \"walletmodel.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "subscribeToCoreSignals",
          "args": [],
          "line": 31
        },
        "resolved": true,
        "details": {
          "function_name": "subscribeToCoreSignals",
          "container": "WalletModel",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
          "lines": "339-349",
          "snippet": "void WalletModel::subscribeToCoreSignals()\n{\n    // Connect signals to wallet\n    wallet->NotifyStatusChanged.connect(boost::bind(&NotifyKeyStoreStatusChanged, this,\n      boost::placeholders::_1));\n    wallet->NotifyAddressBookChanged.connect(boost::bind(NotifyAddressBookChanged, this,\n      boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3,\n      boost::placeholders::_4, boost::placeholders::_5));\n    wallet->NotifyTransactionChanged.connect(boost::bind(NotifyTransactionChanged, this,\n      boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3));\n}",
          "includes": [
            "#include <QTimer>",
            "#include <QSet>",
            "#include \"base58.h\"",
            "#include \"walletdb.h\" // for BackupWallet",
            "#include \"wallet.h\"",
            "#include \"ui_interface.h\"",
            "#include \"transactiontablemodel.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"guiconstants.h\"",
            "#include \"walletmodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  void WalletModel::subscribeToCoreSignals()\n  {\n      // Connect signals to wallet\n      wallet->NotifyStatusChanged.connect(boost::bind(&NotifyKeyStoreStatusChanged, this,\n        boost::placeholders::_1));\n      wallet->NotifyAddressBookChanged.connect(boost::bind(NotifyAddressBookChanged, this,\n        boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3,\n        boost::placeholders::_4, boost::placeholders::_5));\n      wallet->NotifyTransactionChanged.connect(boost::bind(NotifyTransactionChanged, this,\n        boost::placeholders::_1, boost::placeholders::_2, boost::placeholders::_3));\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pollTimer->start",
          "args": [
            "MODEL_UPDATE_DELAY"
          ],
          "line": 29
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "connect",
          "args": [
            "pollTimer",
            "SIGNAL(timeout())",
            "this",
            "SLOT(pollBalanceChanged())"
          ],
          "line": 28
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SLOT",
          "args": [
            "pollBalanceChanged()"
          ],
          "line": 28
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pollBalanceChanged",
          "args": [],
          "line": 28
        },
        "resolved": true,
        "details": {
          "function_name": "pollBalanceChanged",
          "container": "WalletModel",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/walletmodel.cpp",
          "lines": "77-85",
          "snippet": "void WalletModel::pollBalanceChanged()\n{\n    if(nBestHeight != cachedNumBlocks)\n    {\n        // Balance and number of transactions might have changed\n        cachedNumBlocks = nBestHeight;\n        checkBalanceChanged();\n    }\n}",
          "includes": [
            "#include <QTimer>",
            "#include <QSet>",
            "#include \"base58.h\"",
            "#include \"walletdb.h\" // for BackupWallet",
            "#include \"wallet.h\"",
            "#include \"ui_interface.h\"",
            "#include \"transactiontablemodel.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"guiconstants.h\"",
            "#include \"walletmodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  void WalletModel::pollBalanceChanged()\n  {\n      if(nBestHeight != cachedNumBlocks)\n      {\n          // Balance and number of transactions might have changed\n          cachedNumBlocks = nBestHeight;\n          checkBalanceChanged();\n      }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "SIGNAL",
          "args": [
            "timeout()"
          ],
          "line": 28
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "timeout",
          "args": [],
          "line": 28
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QTimer>\n#include <QSet>\n#include \"base58.h\"\n#include \"walletdb.h\" // for BackupWallet\n#include \"wallet.h\"\n#include \"ui_interface.h\"\n#include \"transactiontablemodel.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"guiconstants.h\"\n#include \"walletmodel.h\"\n\nWalletModel {\n  WalletModel::WalletModel(CWallet *wallet, OptionsModel *optionsModel, QObject *parent) :\n      QObject(parent), wallet(wallet), optionsModel(optionsModel), addressTableModel(0),\n      transactionTableModel(0),\n      cachedBalance(0), cachedStake(0), cachedUnconfirmedBalance(0), cachedImmatureBalance(0),\n      cachedNumTransactions(0),\n      cachedEncryptionStatus(Unencrypted),\n      cachedNumBlocks(0)\n  {\n      addressTableModel = new AddressTableModel(wallet, this);\n      transactionTableModel = new TransactionTableModel(wallet, this);\n  \n      // This timer will be fired repeatedly to update the balance\n      pollTimer = new QTimer(this);\n      connect(pollTimer, SIGNAL(timeout()), this, SLOT(pollBalanceChanged()));\n      pollTimer->start(MODEL_UPDATE_DELAY);\n  \n      subscribeToCoreSignals();\n  }\n}"
  }
]