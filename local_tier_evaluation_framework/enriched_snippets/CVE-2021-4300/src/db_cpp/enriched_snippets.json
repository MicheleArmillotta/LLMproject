[
  {
    "function_name": "Read",
    "container": "CAddrDB",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "540-591",
    "snippet": "bool CAddrDB::Read(CAddrMan& addr)\n{\n    // open input file, and associate with CAutoFile\n    FILE *file = fopen(pathAddr.string().c_str(), \"rb\");\n    CAutoFile filein = CAutoFile(file, SER_DISK, CLIENT_VERSION);\n    if (!filein)\n        return error(\"CAddrman::Read() : open failed\");\n\n    // use file size to size memory buffer\n    int fileSize = boost::filesystem::file_size(pathAddr);\n    int dataSize = fileSize - sizeof(uint256);\n    // Don't try to resize to a negative number if file is small\n    if ( dataSize < 0 ) dataSize = 0;\n    vector<unsigned char> vchData;\n    vchData.resize(dataSize);\n    uint256 hashIn;\n\n    // read data and checksum from file\n    try {\n        filein.read((char *)&vchData[0], dataSize);\n        filein >> hashIn;\n    }\n    catch (std::exception &e) {\n        return error(\"CAddrman::Read() 2 : I/O error or stream data corrupted\");\n    }\n    filein.fclose();\n\n    CDataStream ssPeers(vchData, SER_DISK, CLIENT_VERSION);\n\n    // verify stored checksum matches input data\n    uint256 hashTmp = Hash(ssPeers.begin(), ssPeers.end());\n    if (hashIn != hashTmp)\n        return error(\"CAddrman::Read() : checksum mismatch; data corrupted\");\n\n    unsigned char pchMsgTmp[4];\n    try {\n        // de-serialize file header (pchMessageStart magic number) and\n        ssPeers >> FLATDATA(pchMsgTmp);\n\n        // verify the network matches ours\n        if (memcmp(pchMsgTmp, pchMessageStart, sizeof(pchMsgTmp)))\n            return error(\"CAddrman::Read() : invalid network magic number\");\n\n        // de-serialize address data into one CAddrMan object\n        ssPeers >> addr;\n    }\n    catch (std::exception &e) {\n        return error(\"CAddrman::Read() : I/O error or stream data corrupted\");\n    }\n\n    return true;\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"CAddrman::Read() : I/O error or stream data corrupted\""
          ],
          "line": 587
        },
        "resolved": true,
        "details": {
          "function_name": "key_error",
          "container": "key_error",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.h",
          "lines": "44-44",
          "snippet": "explicit key_error(const std::string& str) : std::runtime_error(str) {}",
          "includes": [
            "#include <openssl/ec.h> // for EC_KEY definition",
            "#include \"util.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\"",
            "#include \"allocators.h\"",
            "#include <vector>",
            "#include <stdexcept>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <openssl/ec.h> // for EC_KEY definition\n#include \"util.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n#include \"allocators.h\"\n#include <vector>\n#include <stdexcept>\n\nkey_error {\n  explicit key_error(const std::string& str) : std::runtime_error(str) {}\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcmp",
          "args": [
            "pchMsgTmp",
            "pchMessageStart",
            "sizeof(pchMsgTmp)"
          ],
          "line": 580
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FLATDATA",
          "args": [
            "pchMsgTmp"
          ],
          "line": 577
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Hash",
          "args": [
            "ssPeers.begin()",
            "ssPeers.end()"
          ],
          "line": 570
        },
        "resolved": true,
        "details": {
          "function_name": "Hash",
          "container": "CBloomFilter",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bloom.cpp",
          "lines": "34-38",
          "snippet": "inline unsigned int CBloomFilter::Hash(unsigned int nHashNum, const std::vector<unsigned char>& vDataToHash) const\n{\n    // 0xFBA4C795 chosen as it guarantees a reasonable bit difference between nHashNum values.\n    return MurmurHash3(nHashNum * 0xFBA4C795 + nTweak, vDataToHash) % (vData.size() * 8);\n}",
          "includes": [
            "#include \"hash.h\"",
            "#include \"script.h\"",
            "#include \"main.h\"",
            "#include \"bloom.h\"",
            "#include <stdlib.h>",
            "#include <math.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hash.h\"\n#include \"script.h\"\n#include \"main.h\"\n#include \"bloom.h\"\n#include <stdlib.h>\n#include <math.h>\n\nCBloomFilter {\n  inline unsigned int CBloomFilter::Hash(unsigned int nHashNum, const std::vector<unsigned char>& vDataToHash) const\n  {\n      // 0xFBA4C795 chosen as it guarantees a reasonable bit difference between nHashNum values.\n      return MurmurHash3(nHashNum * 0xFBA4C795 + nTweak, vDataToHash) % (vData.size() * 8);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssPeers.end",
          "args": [],
          "line": 570
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssPeers.begin",
          "args": [],
          "line": 570
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "filein.fclose",
          "args": [],
          "line": 565
        },
        "resolved": true,
        "details": {
          "function_name": "fclose",
          "container": "CAutoFile",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "1051-1056",
          "snippet": "void fclose()\n    {\n        if (file != NULL && file != stdin && file != stdout && file != stderr)\n            ::fclose(file);\n        file = NULL;\n    }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCAutoFile {\n  void fclose()\n      {\n          if (file != NULL && file != stdin && file != stdout && file != stderr)\n              ::fclose(file);\n          file = NULL;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "filein.read",
          "args": [
            "(char *)&vchData[0]",
            "dataSize"
          ],
          "line": 559
        },
        "resolved": true,
        "details": {
          "function_name": "read",
          "container": "SSLIOStreamDevice",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "592-597",
          "snippet": "std::streamsize read(char* s, std::streamsize n)\n    {\n        handshake(ssl::stream_base::server); // HTTPS servers read first\n        if (fUseSSL) return stream.read_some(asio::buffer(s, n));\n        return stream.next_layer().read_some(asio::buffer(s, n));\n    }",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nSSLIOStreamDevice {\n  std::streamsize read(char* s, std::streamsize n)\n      {\n          handshake(ssl::stream_base::server); // HTTPS servers read first\n          if (fUseSSL) return stream.read_some(asio::buffer(s, n));\n          return stream.next_layer().read_some(asio::buffer(s, n));\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "vchData.resize",
          "args": [
            "dataSize"
          ],
          "line": 554
        },
        "resolved": true,
        "details": {
          "function_name": "resize",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "804-804",
          "snippet": "void resize(size_type n, value_type c=0)         { vch.resize(n + nReadPos, c); }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  void resize(size_type n, value_type c=0)         { vch.resize(n + nReadPos, c); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "boost::filesystem::file_size",
          "args": [
            "pathAddr"
          ],
          "line": 549
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CAutoFile",
          "args": [
            "file",
            "SER_DISK",
            "CLIENT_VERSION"
          ],
          "line": 544
        },
        "resolved": true,
        "details": {
          "function_name": "CAutoFile",
          "container": "CAutoFile",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "1037-1044",
          "snippet": "CAutoFile(FILE* filenew, int nTypeIn, int nVersionIn)\n    {\n        file = filenew;\n        nType = nTypeIn;\n        nVersion = nVersionIn;\n        state = 0;\n        exceptmask = std::ios::badbit | std::ios::failbit;\n    }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCAutoFile {\n  CAutoFile(FILE* filenew, int nTypeIn, int nVersionIn)\n      {\n          file = filenew;\n          nType = nTypeIn;\n          nVersion = nVersionIn;\n          state = 0;\n          exceptmask = std::ios::badbit | std::ios::failbit;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "pathAddr.string().c_str()",
            "\"rb\""
          ],
          "line": 543
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pathAddr.string",
          "args": [],
          "line": 543
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pathAddr.string",
          "args": [],
          "line": 543
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCAddrDB {\n  bool CAddrDB::Read(CAddrMan& addr)\n  {\n      // open input file, and associate with CAutoFile\n      FILE *file = fopen(pathAddr.string().c_str(), \"rb\");\n      CAutoFile filein = CAutoFile(file, SER_DISK, CLIENT_VERSION);\n      if (!filein)\n          return error(\"CAddrman::Read() : open failed\");\n  \n      // use file size to size memory buffer\n      int fileSize = boost::filesystem::file_size(pathAddr);\n      int dataSize = fileSize - sizeof(uint256);\n      // Don't try to resize to a negative number if file is small\n      if ( dataSize < 0 ) dataSize = 0;\n      vector<unsigned char> vchData;\n      vchData.resize(dataSize);\n      uint256 hashIn;\n  \n      // read data and checksum from file\n      try {\n          filein.read((char *)&vchData[0], dataSize);\n          filein >> hashIn;\n      }\n      catch (std::exception &e) {\n          return error(\"CAddrman::Read() 2 : I/O error or stream data corrupted\");\n      }\n      filein.fclose();\n  \n      CDataStream ssPeers(vchData, SER_DISK, CLIENT_VERSION);\n  \n      // verify stored checksum matches input data\n      uint256 hashTmp = Hash(ssPeers.begin(), ssPeers.end());\n      if (hashIn != hashTmp)\n          return error(\"CAddrman::Read() : checksum mismatch; data corrupted\");\n  \n      unsigned char pchMsgTmp[4];\n      try {\n          // de-serialize file header (pchMessageStart magic number) and\n          ssPeers >> FLATDATA(pchMsgTmp);\n  \n          // verify the network matches ours\n          if (memcmp(pchMsgTmp, pchMessageStart, sizeof(pchMsgTmp)))\n              return error(\"CAddrman::Read() : invalid network magic number\");\n  \n          // de-serialize address data into one CAddrMan object\n          ssPeers >> addr;\n      }\n      catch (std::exception &e) {\n          return error(\"CAddrman::Read() : I/O error or stream data corrupted\");\n      }\n  \n      return true;\n  }\n}"
  },
  {
    "function_name": "Write",
    "container": "CAddrDB",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "502-538",
    "snippet": "bool CAddrDB::Write(const CAddrMan& addr)\n{\n    // Generate random temporary filename\n    unsigned short randv = 0;\n    RAND_bytes((unsigned char *)&randv, sizeof(randv));\n    std::string tmpfn = strprintf(\"peers.dat.%04x\", randv);\n\n    // serialize addresses, checksum data up to that point, then append csum\n    CDataStream ssPeers(SER_DISK, CLIENT_VERSION);\n    ssPeers << FLATDATA(pchMessageStart);\n    ssPeers << addr;\n    uint256 hash = Hash(ssPeers.begin(), ssPeers.end());\n    ssPeers << hash;\n\n    // open temp output file, and associate with CAutoFile\n    boost::filesystem::path pathTmp = GetDataDir() / tmpfn;\n    FILE *file = fopen(pathTmp.string().c_str(), \"wb\");\n    CAutoFile fileout = CAutoFile(file, SER_DISK, CLIENT_VERSION);\n    if (!fileout)\n        return error(\"CAddrman::Write() : open failed\");\n\n    // Write and commit header, data\n    try {\n        fileout << ssPeers;\n    }\n    catch (std::exception &e) {\n        return error(\"CAddrman::Write() : I/O error\");\n    }\n    FileCommit(fileout);\n    fileout.fclose();\n\n    // replace existing peers.dat, if any, with new peers.dat.XXXX\n    if (!RenameOver(pathTmp, pathAddr))\n        return error(\"CAddrman::Write() : Rename-into-place failed\");\n\n    return true;\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"CAddrman::Write() : Rename-into-place failed\""
          ],
          "line": 535
        },
        "resolved": true,
        "details": {
          "function_name": "key_error",
          "container": "key_error",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.h",
          "lines": "44-44",
          "snippet": "explicit key_error(const std::string& str) : std::runtime_error(str) {}",
          "includes": [
            "#include <openssl/ec.h> // for EC_KEY definition",
            "#include \"util.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\"",
            "#include \"allocators.h\"",
            "#include <vector>",
            "#include <stdexcept>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <openssl/ec.h> // for EC_KEY definition\n#include \"util.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n#include \"allocators.h\"\n#include <vector>\n#include <stdexcept>\n\nkey_error {\n  explicit key_error(const std::string& str) : std::runtime_error(str) {}\n}"
        }
      },
      {
        "call_info": {
          "callee": "RenameOver",
          "args": [
            "pathTmp",
            "pathAddr"
          ],
          "line": 534
        },
        "resolved": true,
        "details": {
          "function_name": "RenameOver",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "1130-1139",
          "snippet": "bool RenameOver(boost::filesystem::path src, boost::filesystem::path dest)\n{\n#ifdef WIN32\n    return MoveFileExA(src.string().c_str(), dest.string().c_str(),\n                      MOVEFILE_REPLACE_EXISTING);\n#else\n    int rc = std::rename(src.string().c_str(), dest.string().c_str());\n    return (rc == 0);\n#endif /* WIN32 */\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nbool RenameOver(boost::filesystem::path src, boost::filesystem::path dest)\n{\n#ifdef WIN32\n    return MoveFileExA(src.string().c_str(), dest.string().c_str(),\n                      MOVEFILE_REPLACE_EXISTING);\n#else\n    int rc = std::rename(src.string().c_str(), dest.string().c_str());\n    return (rc == 0);\n#endif /* WIN32 */\n}"
        }
      },
      {
        "call_info": {
          "callee": "fileout.fclose",
          "args": [],
          "line": 531
        },
        "resolved": true,
        "details": {
          "function_name": "fclose",
          "container": "CAutoFile",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "1051-1056",
          "snippet": "void fclose()\n    {\n        if (file != NULL && file != stdin && file != stdout && file != stderr)\n            ::fclose(file);\n        file = NULL;\n    }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCAutoFile {\n  void fclose()\n      {\n          if (file != NULL && file != stdin && file != stdout && file != stderr)\n              ::fclose(file);\n          file = NULL;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "FileCommit",
          "args": [
            "fileout"
          ],
          "line": 530
        },
        "resolved": true,
        "details": {
          "function_name": "FileCommit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "1141-1149",
          "snippet": "void FileCommit(FILE *fileout)\n{\n    fflush(fileout);                // harmless if redundantly called\n#ifdef WIN32\n    _commit(_fileno(fileout));\n#else\n    fsync(fileno(fileout));\n#endif\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static FILE* fileout = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nstatic FILE* fileout = NULL;\n\nvoid FileCommit(FILE *fileout)\n{\n    fflush(fileout);                // harmless if redundantly called\n#ifdef WIN32\n    _commit(_fileno(fileout));\n#else\n    fsync(fileno(fileout));\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "CAutoFile",
          "args": [
            "file",
            "SER_DISK",
            "CLIENT_VERSION"
          ],
          "line": 519
        },
        "resolved": true,
        "details": {
          "function_name": "CAutoFile",
          "container": "CAutoFile",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "1037-1044",
          "snippet": "CAutoFile(FILE* filenew, int nTypeIn, int nVersionIn)\n    {\n        file = filenew;\n        nType = nTypeIn;\n        nVersion = nVersionIn;\n        state = 0;\n        exceptmask = std::ios::badbit | std::ios::failbit;\n    }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCAutoFile {\n  CAutoFile(FILE* filenew, int nTypeIn, int nVersionIn)\n      {\n          file = filenew;\n          nType = nTypeIn;\n          nVersion = nVersionIn;\n          state = 0;\n          exceptmask = std::ios::badbit | std::ios::failbit;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "pathTmp.string().c_str()",
            "\"wb\""
          ],
          "line": 518
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pathTmp.string",
          "args": [],
          "line": 518
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pathTmp.string",
          "args": [],
          "line": 518
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetDataDir",
          "args": [],
          "line": 517
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Hash",
          "args": [
            "ssPeers.begin()",
            "ssPeers.end()"
          ],
          "line": 513
        },
        "resolved": true,
        "details": {
          "function_name": "Hash",
          "container": "CBloomFilter",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bloom.cpp",
          "lines": "34-38",
          "snippet": "inline unsigned int CBloomFilter::Hash(unsigned int nHashNum, const std::vector<unsigned char>& vDataToHash) const\n{\n    // 0xFBA4C795 chosen as it guarantees a reasonable bit difference between nHashNum values.\n    return MurmurHash3(nHashNum * 0xFBA4C795 + nTweak, vDataToHash) % (vData.size() * 8);\n}",
          "includes": [
            "#include \"hash.h\"",
            "#include \"script.h\"",
            "#include \"main.h\"",
            "#include \"bloom.h\"",
            "#include <stdlib.h>",
            "#include <math.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hash.h\"\n#include \"script.h\"\n#include \"main.h\"\n#include \"bloom.h\"\n#include <stdlib.h>\n#include <math.h>\n\nCBloomFilter {\n  inline unsigned int CBloomFilter::Hash(unsigned int nHashNum, const std::vector<unsigned char>& vDataToHash) const\n  {\n      // 0xFBA4C795 chosen as it guarantees a reasonable bit difference between nHashNum values.\n      return MurmurHash3(nHashNum * 0xFBA4C795 + nTweak, vDataToHash) % (vData.size() * 8);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssPeers.end",
          "args": [],
          "line": 513
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssPeers.begin",
          "args": [],
          "line": 513
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "FLATDATA",
          "args": [
            "pchMessageStart"
          ],
          "line": 511
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strprintf",
          "args": [
            "\"peers.dat.%04x\"",
            "randv"
          ],
          "line": 507
        },
        "resolved": true,
        "details": {
          "function_name": "real_strprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "331-338",
          "snippet": "string real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nstring real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "RAND_bytes",
          "args": [
            "(unsigned char *)&randv",
            "sizeof(randv)"
          ],
          "line": 506
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCAddrDB {\n  bool CAddrDB::Write(const CAddrMan& addr)\n  {\n      // Generate random temporary filename\n      unsigned short randv = 0;\n      RAND_bytes((unsigned char *)&randv, sizeof(randv));\n      std::string tmpfn = strprintf(\"peers.dat.%04x\", randv);\n  \n      // serialize addresses, checksum data up to that point, then append csum\n      CDataStream ssPeers(SER_DISK, CLIENT_VERSION);\n      ssPeers << FLATDATA(pchMessageStart);\n      ssPeers << addr;\n      uint256 hash = Hash(ssPeers.begin(), ssPeers.end());\n      ssPeers << hash;\n  \n      // open temp output file, and associate with CAutoFile\n      boost::filesystem::path pathTmp = GetDataDir() / tmpfn;\n      FILE *file = fopen(pathTmp.string().c_str(), \"wb\");\n      CAutoFile fileout = CAutoFile(file, SER_DISK, CLIENT_VERSION);\n      if (!fileout)\n          return error(\"CAddrman::Write() : open failed\");\n  \n      // Write and commit header, data\n      try {\n          fileout << ssPeers;\n      }\n      catch (std::exception &e) {\n          return error(\"CAddrman::Write() : I/O error\");\n      }\n      FileCommit(fileout);\n      fileout.fclose();\n  \n      // replace existing peers.dat, if any, with new peers.dat.XXXX\n      if (!RenameOver(pathTmp, pathAddr))\n          return error(\"CAddrman::Write() : Rename-into-place failed\");\n  \n      return true;\n  }\n}"
  },
  {
    "function_name": "CAddrDB",
    "container": "CAddrDB",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "497-500",
    "snippet": "CAddrDB::CAddrDB()\n{\n    pathAddr = GetDataDir() / \"peers.dat\";\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "GetDataDir",
          "args": [],
          "line": 499
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCAddrDB {\n  CAddrDB::CAddrDB()\n  {\n      pathAddr = GetDataDir() / \"peers.dat\";\n  }\n}"
  },
  {
    "function_name": "Flush",
    "container": "CDBEnv",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "445-489",
    "snippet": "void CDBEnv::Flush(bool fShutdown)\n{\n    int64_t nStart = GetTimeMillis();\n    // Flush log data to the actual data file\n    //  on all files that are not in use\n    printf(\"Flush(%s)%s\\n\", fShutdown ? \"true\" : \"false\", fDbEnvInit ? \"\" : \" db not started\");\n    if (!fDbEnvInit)\n        return;\n    {\n        LOCK(cs_db);\n        map<string, int>::iterator mi = mapFileUseCount.begin();\n        while (mi != mapFileUseCount.end())\n        {\n            string strFile = (*mi).first;\n            int nRefCount = (*mi).second;\n            printf(\"%s refcount=%d\\n\", strFile.c_str(), nRefCount);\n            if (nRefCount == 0)\n            {\n                // Move log data to the dat file\n                CloseDb(strFile);\n                printf(\"%s checkpoint\\n\", strFile.c_str());\n                dbenv.txn_checkpoint(0, 0, 0);\n                if (!IsChainFile(strFile) || fDetachDB) {\n                    printf(\"%s detach\\n\", strFile.c_str());\n                    if (!fMockDb)\n                        dbenv.lsn_reset(strFile.c_str(), 0);\n                }\n                printf(\"%s closed\\n\", strFile.c_str());\n                mapFileUseCount.erase(mi++);\n            }\n            else\n                mi++;\n        }\n        printf(\"DBFlush(%s)%s ended %15\"PRId64\"ms\\n\", fShutdown ? \"true\" : \"false\", fDbEnvInit ? \"\" : \" db not started\", GetTimeMillis() - nStart);\n        if (fShutdown)\n        {\n            char** listp;\n            if (mapFileUseCount.empty())\n            {\n                dbenv.log_archive(&listp, DB_ARCH_REMOVE);\n                Close();\n            }\n        }\n    }\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "Close",
          "args": [],
          "line": 485
        },
        "resolved": true,
        "details": {
          "function_name": "Close",
          "container": "CDB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
          "lines": "301-325",
          "snippet": "void CDB::Close()\n{\n    if (!pdb)\n        return;\n    if (activeTxn)\n        activeTxn->abort();\n    activeTxn = NULL;\n    pdb = NULL;\n\n    // Flush database activity from memory pool to disk log\n    unsigned int nMinutes = 0;\n    if (fReadOnly)\n        nMinutes = 1;\n    if (IsChainFile(strFile))\n        nMinutes = 2;\n    if (IsChainFile(strFile) && IsInitialBlockDownload())\n        nMinutes = 5;\n\n    bitdb.dbenv.txn_checkpoint(nMinutes ? GetArg(\"-dblogsize\", 100)*1024 : 0, nMinutes, 0);\n\n    {\n        LOCK(bitdb.cs_db);\n        --bitdb.mapFileUseCount[strFile];\n    }\n}",
          "includes": [
            "#include \"sys/stat.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"main.h\"",
            "#include \"util.h\"",
            "#include \"net.h\"",
            "#include \"db.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "CDBEnv bitdb;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv bitdb;\n\nCDB {\n  void CDB::Close()\n  {\n      if (!pdb)\n          return;\n      if (activeTxn)\n          activeTxn->abort();\n      activeTxn = NULL;\n      pdb = NULL;\n  \n      // Flush database activity from memory pool to disk log\n      unsigned int nMinutes = 0;\n      if (fReadOnly)\n          nMinutes = 1;\n      if (IsChainFile(strFile))\n          nMinutes = 2;\n      if (IsChainFile(strFile) && IsInitialBlockDownload())\n          nMinutes = 5;\n  \n      bitdb.dbenv.txn_checkpoint(nMinutes ? GetArg(\"-dblogsize\", 100)*1024 : 0, nMinutes, 0);\n  \n      {\n          LOCK(bitdb.cs_db);\n          --bitdb.mapFileUseCount[strFile];\n      }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbenv.log_archive",
          "args": [
            "&listp",
            "DB_ARCH_REMOVE"
          ],
          "line": 484
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mapFileUseCount.empty",
          "args": [],
          "line": 482
        },
        "resolved": true,
        "details": {
          "function_name": "empty",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "32-32",
          "snippet": "bool empty() const { return map.empty(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  bool empty() const { return map.empty(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"DBFlush(%s)%s ended %15\"PRId64\"ms\\n\"",
            "fShutdown ? \"true\" : \"false\"",
            "fDbEnvInit ? \"\" : \" db not started\"",
            "GetTimeMillis() - nStart"
          ],
          "line": 478
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetTimeMillis",
          "args": [],
          "line": 478
        },
        "resolved": true,
        "details": {
          "function_name": "GetTimeMillis",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.h",
          "lines": "370-374",
          "snippet": "inline int64_t GetTimeMillis()\n{\n    return (boost::posix_time::ptime(boost::posix_time::microsec_clock::universal_time()) -\n            boost::posix_time::ptime(boost::gregorian::date(1970,1,1))).total_milliseconds();\n}",
          "includes": [
            "#include <inttypes.h>",
            "#include <stdint.h>",
            "#include \"netbase.h\" // for AddTimeData",
            "#include <openssl/ripemd.h>",
            "#include <openssl/sha.h>",
            "#include <boost/date_time/posix_time/posix_time_types.hpp>",
            "#include <boost/date_time/gregorian/gregorian_types.hpp>",
            "#include <boost/filesystem/path.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/thread.hpp>",
            "#include <string>",
            "#include <vector>",
            "#include <map>",
            "#include <sys/resource.h>",
            "#include <sys/time.h>",
            "#include <sys/types.h>",
            "#include \"uint256.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <inttypes.h>\n#include <stdint.h>\n#include \"netbase.h\" // for AddTimeData\n#include <openssl/ripemd.h>\n#include <openssl/sha.h>\n#include <boost/date_time/posix_time/posix_time_types.hpp>\n#include <boost/date_time/gregorian/gregorian_types.hpp>\n#include <boost/filesystem/path.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/thread.hpp>\n#include <string>\n#include <vector>\n#include <map>\n#include <sys/resource.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include \"uint256.h\"\n\ninline int64_t GetTimeMillis()\n{\n    return (boost::posix_time::ptime(boost::posix_time::microsec_clock::universal_time()) -\n            boost::posix_time::ptime(boost::gregorian::date(1970,1,1))).total_milliseconds();\n}"
        }
      },
      {
        "call_info": {
          "callee": "mapFileUseCount.erase",
          "args": [
            "mi++"
          ],
          "line": 473
        },
        "resolved": true,
        "details": {
          "function_name": "erase",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "49-65",
          "snippet": "void erase(const key_type& k)\n    {\n        iterator itTarget = map.find(k);\n        if (itTarget == map.end())\n            return;\n        std::pair<rmap_iterator, rmap_iterator> itPair = rmap.equal_range(itTarget->second);\n        for (rmap_iterator it = itPair.first; it != itPair.second; ++it)\n            if (it->second == itTarget)\n            {\n                rmap.erase(it);\n                map.erase(itTarget);\n                return;\n            }\n        // Shouldn't ever get here\n        assert(0); //TODO remove me\n        map.erase(itTarget);\n    }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  void erase(const key_type& k)\n      {\n          iterator itTarget = map.find(k);\n          if (itTarget == map.end())\n              return;\n          std::pair<rmap_iterator, rmap_iterator> itPair = rmap.equal_range(itTarget->second);\n          for (rmap_iterator it = itPair.first; it != itPair.second; ++it)\n              if (it->second == itTarget)\n              {\n                  rmap.erase(it);\n                  map.erase(itTarget);\n                  return;\n              }\n          // Shouldn't ever get here\n          assert(0); //TODO remove me\n          map.erase(itTarget);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%s closed\\n\"",
            "strFile.c_str()"
          ],
          "line": 472
        },
        "resolved": true,
        "details": {
          "function_name": "real_strprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "331-338",
          "snippet": "string real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nstring real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strFile.c_str",
          "args": [],
          "line": 472
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.lsn_reset",
          "args": [
            "strFile.c_str()",
            "0"
          ],
          "line": 470
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strFile.c_str",
          "args": [],
          "line": 470
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strFile.c_str",
          "args": [],
          "line": 468
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IsChainFile",
          "args": [
            "strFile"
          ],
          "line": 467
        },
        "resolved": true,
        "details": {
          "function_name": "IsChainFile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
          "lines": "293-299",
          "snippet": "static bool IsChainFile(std::string strFile)\n{\n    if (strFile == \"blkindex.dat\")\n        return true;\n\n    return false;\n}",
          "includes": [
            "#include \"sys/stat.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"main.h\"",
            "#include \"util.h\"",
            "#include \"net.h\"",
            "#include \"db.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nstatic bool IsChainFile(std::string strFile)\n{\n    if (strFile == \"blkindex.dat\")\n        return true;\n\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbenv.txn_checkpoint",
          "args": [
            "0",
            "0",
            "0"
          ],
          "line": 466
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strFile.c_str",
          "args": [],
          "line": 465
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CloseDb",
          "args": [
            "strFile"
          ],
          "line": 464
        },
        "resolved": true,
        "details": {
          "function_name": "CloseDb",
          "container": "CDBEnv",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
          "lines": "327-340",
          "snippet": "void CDBEnv::CloseDb(const string& strFile)\n{\n    {\n        LOCK(cs_db);\n        if (mapDb[strFile] != NULL)\n        {\n            // Close the database handle\n            Db* pdb = mapDb[strFile];\n            pdb->close(0);\n            delete pdb;\n            mapDb[strFile] = NULL;\n        }\n    }\n}",
          "includes": [
            "#include \"sys/stat.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"main.h\"",
            "#include \"util.h\"",
            "#include \"net.h\"",
            "#include \"db.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  void CDBEnv::CloseDb(const string& strFile)\n  {\n      {\n          LOCK(cs_db);\n          if (mapDb[strFile] != NULL)\n          {\n              // Close the database handle\n              Db* pdb = mapDb[strFile];\n              pdb->close(0);\n              delete pdb;\n              mapDb[strFile] = NULL;\n          }\n      }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%s refcount=%d\\n\"",
            "strFile.c_str()",
            "nRefCount"
          ],
          "line": 460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strFile.c_str",
          "args": [],
          "line": 460
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mapFileUseCount.end",
          "args": [],
          "line": 456
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "mapFileUseCount.begin",
          "args": [],
          "line": 455
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "cs_db"
          ],
          "line": 454
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Flush(%s)%s\\n\"",
            "fShutdown ? \"true\" : \"false\"",
            "fDbEnvInit ? \"\" : \" db not started\""
          ],
          "line": 450
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  void CDBEnv::Flush(bool fShutdown)\n  {\n      int64_t nStart = GetTimeMillis();\n      // Flush log data to the actual data file\n      //  on all files that are not in use\n      printf(\"Flush(%s)%s\\n\", fShutdown ? \"true\" : \"false\", fDbEnvInit ? \"\" : \" db not started\");\n      if (!fDbEnvInit)\n          return;\n      {\n          LOCK(cs_db);\n          map<string, int>::iterator mi = mapFileUseCount.begin();\n          while (mi != mapFileUseCount.end())\n          {\n              string strFile = (*mi).first;\n              int nRefCount = (*mi).second;\n              printf(\"%s refcount=%d\\n\", strFile.c_str(), nRefCount);\n              if (nRefCount == 0)\n              {\n                  // Move log data to the dat file\n                  CloseDb(strFile);\n                  printf(\"%s checkpoint\\n\", strFile.c_str());\n                  dbenv.txn_checkpoint(0, 0, 0);\n                  if (!IsChainFile(strFile) || fDetachDB) {\n                      printf(\"%s detach\\n\", strFile.c_str());\n                      if (!fMockDb)\n                          dbenv.lsn_reset(strFile.c_str(), 0);\n                  }\n                  printf(\"%s closed\\n\", strFile.c_str());\n                  mapFileUseCount.erase(mi++);\n              }\n              else\n                  mi++;\n          }\n          printf(\"DBFlush(%s)%s ended %15\"PRId64\"ms\\n\", fShutdown ? \"true\" : \"false\", fDbEnvInit ? \"\" : \" db not started\", GetTimeMillis() - nStart);\n          if (fShutdown)\n          {\n              char** listp;\n              if (mapFileUseCount.empty())\n              {\n                  dbenv.log_archive(&listp, DB_ARCH_REMOVE);\n                  Close();\n              }\n          }\n      }\n  }\n}"
  },
  {
    "function_name": "Rewrite",
    "container": "CDB",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "351-442",
    "snippet": "bool CDB::Rewrite(const string& strFile, const char* pszSkip)\n{\n    while (!fShutdown)\n    {\n        {\n            LOCK(bitdb.cs_db);\n            if (!bitdb.mapFileUseCount.count(strFile) || bitdb.mapFileUseCount[strFile] == 0)\n            {\n                // Flush log data to the dat file\n                bitdb.CloseDb(strFile);\n                bitdb.CheckpointLSN(strFile);\n                bitdb.mapFileUseCount.erase(strFile);\n\n                bool fSuccess = true;\n                printf(\"Rewriting %s...\\n\", strFile.c_str());\n                string strFileRes = strFile + \".rewrite\";\n                { // surround usage of db with extra {}\n                    CDB db(strFile.c_str(), \"r\");\n                    Db* pdbCopy = new Db(&bitdb.dbenv, 0);\n\n                    int ret = pdbCopy->open(NULL,                 // Txn pointer\n                                            strFileRes.c_str(),   // Filename\n                                            \"main\",    // Logical db name\n                                            DB_BTREE,  // Database type\n                                            DB_CREATE,    // Flags\n                                            0);\n                    if (ret > 0)\n                    {\n                        printf(\"Cannot create database file %s\\n\", strFileRes.c_str());\n                        fSuccess = false;\n                    }\n\n                    Dbc* pcursor = db.GetCursor();\n                    if (pcursor)\n                        while (fSuccess)\n                        {\n                            CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n                            CDataStream ssValue(SER_DISK, CLIENT_VERSION);\n                            int ret = db.ReadAtCursor(pcursor, ssKey, ssValue, DB_NEXT);\n                            if (ret == DB_NOTFOUND)\n                            {\n                                pcursor->close();\n                                break;\n                            }\n                            else if (ret != 0)\n                            {\n                                pcursor->close();\n                                fSuccess = false;\n                                break;\n                            }\n                            if (pszSkip &&\n                                strncmp(&ssKey[0], pszSkip, std::min(ssKey.size(), strlen(pszSkip))) == 0)\n                                continue;\n                            if (strncmp(&ssKey[0], \"\\x07version\", 8) == 0)\n                            {\n                                // Update version:\n                                ssValue.clear();\n                                ssValue << CLIENT_VERSION;\n                            }\n                            Dbt datKey(&ssKey[0], ssKey.size());\n                            Dbt datValue(&ssValue[0], ssValue.size());\n                            int ret2 = pdbCopy->put(NULL, &datKey, &datValue, DB_NOOVERWRITE);\n                            if (ret2 > 0)\n                                fSuccess = false;\n                        }\n                    if (fSuccess)\n                    {\n                        db.Close();\n                        bitdb.CloseDb(strFile);\n                        if (pdbCopy->close(0))\n                            fSuccess = false;\n                        delete pdbCopy;\n                    }\n                }\n                if (fSuccess)\n                {\n                    Db dbA(&bitdb.dbenv, 0);\n                    if (dbA.remove(strFile.c_str(), NULL, 0))\n                        fSuccess = false;\n                    Db dbB(&bitdb.dbenv, 0);\n                    if (dbB.rename(strFileRes.c_str(), NULL, strFile.c_str(), 0))\n                        fSuccess = false;\n                }\n                if (!fSuccess)\n                    printf(\"Rewriting of %s FAILED!\\n\", strFileRes.c_str());\n                return fSuccess;\n            }\n        }\n        MilliSleep(100);\n    }\n    return false;\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "CDBEnv bitdb;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "MilliSleep",
          "args": [
            "100"
          ],
          "line": 439
        },
        "resolved": true,
        "details": {
          "function_name": "MilliSleep",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.h",
          "lines": "132-139",
          "snippet": "inline void MilliSleep(int64_t n)\n{\n#if BOOST_VERSION >= 105000\n    boost::this_thread::sleep_for(boost::chrono::milliseconds(n));\n#else\n    boost::this_thread::sleep(boost::posix_time::milliseconds(n));\n#endif\n}",
          "includes": [
            "#include <inttypes.h>",
            "#include <stdint.h>",
            "#include \"netbase.h\" // for AddTimeData",
            "#include <openssl/ripemd.h>",
            "#include <openssl/sha.h>",
            "#include <boost/date_time/posix_time/posix_time_types.hpp>",
            "#include <boost/date_time/gregorian/gregorian_types.hpp>",
            "#include <boost/filesystem/path.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/thread.hpp>",
            "#include <string>",
            "#include <vector>",
            "#include <map>",
            "#include <sys/resource.h>",
            "#include <sys/time.h>",
            "#include <sys/types.h>",
            "#include \"uint256.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <inttypes.h>\n#include <stdint.h>\n#include \"netbase.h\" // for AddTimeData\n#include <openssl/ripemd.h>\n#include <openssl/sha.h>\n#include <boost/date_time/posix_time/posix_time_types.hpp>\n#include <boost/date_time/gregorian/gregorian_types.hpp>\n#include <boost/filesystem/path.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/thread.hpp>\n#include <string>\n#include <vector>\n#include <map>\n#include <sys/resource.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include \"uint256.h\"\n\ninline void MilliSleep(int64_t n)\n{\n#if BOOST_VERSION >= 105000\n    boost::this_thread::sleep_for(boost::chrono::milliseconds(n));\n#else\n    boost::this_thread::sleep(boost::posix_time::milliseconds(n));\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Rewriting of %s FAILED!\\n\"",
            "strFileRes.c_str()"
          ],
          "line": 435
        },
        "resolved": true,
        "details": {
          "function_name": "real_strprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "331-338",
          "snippet": "string real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nstring real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strFileRes.c_str",
          "args": [],
          "line": 435
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbB.rename",
          "args": [
            "strFileRes.c_str()",
            "NULL",
            "strFile.c_str()",
            "0"
          ],
          "line": 431
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strFile.c_str",
          "args": [],
          "line": 431
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strFileRes.c_str",
          "args": [],
          "line": 431
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbA.remove",
          "args": [
            "strFile.c_str()",
            "NULL",
            "0"
          ],
          "line": 428
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strFile.c_str",
          "args": [],
          "line": 428
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pdbCopy->close",
          "args": [
            "0"
          ],
          "line": 420
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bitdb.CloseDb",
          "args": [
            "strFile"
          ],
          "line": 419
        },
        "resolved": true,
        "details": {
          "function_name": "CloseDb",
          "container": "CDBEnv",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
          "lines": "327-340",
          "snippet": "void CDBEnv::CloseDb(const string& strFile)\n{\n    {\n        LOCK(cs_db);\n        if (mapDb[strFile] != NULL)\n        {\n            // Close the database handle\n            Db* pdb = mapDb[strFile];\n            pdb->close(0);\n            delete pdb;\n            mapDb[strFile] = NULL;\n        }\n    }\n}",
          "includes": [
            "#include \"sys/stat.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"main.h\"",
            "#include \"util.h\"",
            "#include \"net.h\"",
            "#include \"db.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  void CDBEnv::CloseDb(const string& strFile)\n  {\n      {\n          LOCK(cs_db);\n          if (mapDb[strFile] != NULL)\n          {\n              // Close the database handle\n              Db* pdb = mapDb[strFile];\n              pdb->close(0);\n              delete pdb;\n              mapDb[strFile] = NULL;\n          }\n      }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "db.Close",
          "args": [],
          "line": 418
        },
        "resolved": true,
        "details": {
          "function_name": "Close",
          "container": "CDB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
          "lines": "301-325",
          "snippet": "void CDB::Close()\n{\n    if (!pdb)\n        return;\n    if (activeTxn)\n        activeTxn->abort();\n    activeTxn = NULL;\n    pdb = NULL;\n\n    // Flush database activity from memory pool to disk log\n    unsigned int nMinutes = 0;\n    if (fReadOnly)\n        nMinutes = 1;\n    if (IsChainFile(strFile))\n        nMinutes = 2;\n    if (IsChainFile(strFile) && IsInitialBlockDownload())\n        nMinutes = 5;\n\n    bitdb.dbenv.txn_checkpoint(nMinutes ? GetArg(\"-dblogsize\", 100)*1024 : 0, nMinutes, 0);\n\n    {\n        LOCK(bitdb.cs_db);\n        --bitdb.mapFileUseCount[strFile];\n    }\n}",
          "includes": [
            "#include \"sys/stat.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"main.h\"",
            "#include \"util.h\"",
            "#include \"net.h\"",
            "#include \"db.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "CDBEnv bitdb;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv bitdb;\n\nCDB {\n  void CDB::Close()\n  {\n      if (!pdb)\n          return;\n      if (activeTxn)\n          activeTxn->abort();\n      activeTxn = NULL;\n      pdb = NULL;\n  \n      // Flush database activity from memory pool to disk log\n      unsigned int nMinutes = 0;\n      if (fReadOnly)\n          nMinutes = 1;\n      if (IsChainFile(strFile))\n          nMinutes = 2;\n      if (IsChainFile(strFile) && IsInitialBlockDownload())\n          nMinutes = 5;\n  \n      bitdb.dbenv.txn_checkpoint(nMinutes ? GetArg(\"-dblogsize\", 100)*1024 : 0, nMinutes, 0);\n  \n      {\n          LOCK(bitdb.cs_db);\n          --bitdb.mapFileUseCount[strFile];\n      }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pdbCopy->put",
          "args": [
            "NULL",
            "&datKey",
            "&datValue",
            "DB_NOOVERWRITE"
          ],
          "line": 412
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ssValue.size",
          "args": [],
          "line": 411
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ssValue.clear",
          "args": [],
          "line": 407
        },
        "resolved": true,
        "details": {
          "function_name": "clear",
          "container": "CTxMemPool",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
          "lines": "768-774",
          "snippet": "void CTxMemPool::clear()\n{\n    LOCK(cs);\n    mapTx.clear();\n    mapNextTx.clear();\n    ++nTransactionsUpdated;\n}",
          "includes": [
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"kernel.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"txdb.h\"",
            "#include \"db.h\"",
            "#include \"checkpoints.h\"",
            "#include \"alert.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "unsigned int nTransactionsUpdated = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/algorithm/string/replace.hpp>\n#include \"kernel.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"txdb.h\"\n#include \"db.h\"\n#include \"checkpoints.h\"\n#include \"alert.h\"\n\nunsigned int nTransactionsUpdated = 0;\n\nCTxMemPool {\n  void CTxMemPool::clear()\n  {\n      LOCK(cs);\n      mapTx.clear();\n      mapNextTx.clear();\n      ++nTransactionsUpdated;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "&ssKey[0]",
            "\"\\x07version\"",
            "8"
          ],
          "line": 404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncmp",
          "args": [
            "&ssKey[0]",
            "pszSkip",
            "std::min(ssKey.size(), strlen(pszSkip))"
          ],
          "line": 402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::min",
          "args": [
            "ssKey.size()",
            "strlen(pszSkip)"
          ],
          "line": 402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "pszSkip"
          ],
          "line": 402
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pcursor->close",
          "args": [],
          "line": 397
        },
        "resolved": true,
        "details": {
          "function_name": "close",
          "container": "AcceptedConnectionImpl",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "664-667",
          "snippet": "virtual void close()\n    {\n        _stream.close();\n    }",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nAcceptedConnectionImpl {\n  virtual void close()\n      {\n          _stream.close();\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "db.ReadAtCursor",
          "args": [
            "pcursor",
            "ssKey",
            "ssValue",
            "DB_NEXT"
          ],
          "line": 389
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "db.GetCursor",
          "args": [],
          "line": 383
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strFileRes.c_str",
          "args": [],
          "line": 379
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pdbCopy->open",
          "args": [
            "NULL",
            "// Txn pointerstrFileRes.c_str()",
            "// Filename\"main\"",
            "// Logical db nameDB_BTREE",
            "// Database typeDB_CREATE",
            "// Flags0"
          ],
          "line": 371
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strFileRes.c_str",
          "args": [],
          "line": 372
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strFile.c_str",
          "args": [],
          "line": 368
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strFile.c_str",
          "args": [],
          "line": 365
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bitdb.mapFileUseCount.erase",
          "args": [
            "strFile"
          ],
          "line": 362
        },
        "resolved": true,
        "details": {
          "function_name": "erase",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "49-65",
          "snippet": "void erase(const key_type& k)\n    {\n        iterator itTarget = map.find(k);\n        if (itTarget == map.end())\n            return;\n        std::pair<rmap_iterator, rmap_iterator> itPair = rmap.equal_range(itTarget->second);\n        for (rmap_iterator it = itPair.first; it != itPair.second; ++it)\n            if (it->second == itTarget)\n            {\n                rmap.erase(it);\n                map.erase(itTarget);\n                return;\n            }\n        // Shouldn't ever get here\n        assert(0); //TODO remove me\n        map.erase(itTarget);\n    }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  void erase(const key_type& k)\n      {\n          iterator itTarget = map.find(k);\n          if (itTarget == map.end())\n              return;\n          std::pair<rmap_iterator, rmap_iterator> itPair = rmap.equal_range(itTarget->second);\n          for (rmap_iterator it = itPair.first; it != itPair.second; ++it)\n              if (it->second == itTarget)\n              {\n                  rmap.erase(it);\n                  map.erase(itTarget);\n                  return;\n              }\n          // Shouldn't ever get here\n          assert(0); //TODO remove me\n          map.erase(itTarget);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "bitdb.CheckpointLSN",
          "args": [
            "strFile"
          ],
          "line": 361
        },
        "resolved": true,
        "details": {
          "function_name": "CheckpointLSN",
          "container": "CDBEnv",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
          "lines": "220-226",
          "snippet": "void CDBEnv::CheckpointLSN(std::string strFile)\n{\n    dbenv.txn_checkpoint(0, 0, 0);\n    if (fMockDb)\n        return;\n    dbenv.lsn_reset(strFile.c_str(), 0);\n}",
          "includes": [
            "#include \"sys/stat.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"main.h\"",
            "#include \"util.h\"",
            "#include \"net.h\"",
            "#include \"db.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  void CDBEnv::CheckpointLSN(std::string strFile)\n  {\n      dbenv.txn_checkpoint(0, 0, 0);\n      if (fMockDb)\n          return;\n      dbenv.lsn_reset(strFile.c_str(), 0);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "bitdb.mapFileUseCount.count",
          "args": [
            "strFile"
          ],
          "line": 357
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "bitdb.cs_db"
          ],
          "line": 356
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv bitdb;\n\nCDB {\n  bool CDB::Rewrite(const string& strFile, const char* pszSkip)\n  {\n      while (!fShutdown)\n      {\n          {\n              LOCK(bitdb.cs_db);\n              if (!bitdb.mapFileUseCount.count(strFile) || bitdb.mapFileUseCount[strFile] == 0)\n              {\n                  // Flush log data to the dat file\n                  bitdb.CloseDb(strFile);\n                  bitdb.CheckpointLSN(strFile);\n                  bitdb.mapFileUseCount.erase(strFile);\n  \n                  bool fSuccess = true;\n                  printf(\"Rewriting %s...\\n\", strFile.c_str());\n                  string strFileRes = strFile + \".rewrite\";\n                  { // surround usage of db with extra {}\n                      CDB db(strFile.c_str(), \"r\");\n                      Db* pdbCopy = new Db(&bitdb.dbenv, 0);\n  \n                      int ret = pdbCopy->open(NULL,                 // Txn pointer\n                                              strFileRes.c_str(),   // Filename\n                                              \"main\",    // Logical db name\n                                              DB_BTREE,  // Database type\n                                              DB_CREATE,    // Flags\n                                              0);\n                      if (ret > 0)\n                      {\n                          printf(\"Cannot create database file %s\\n\", strFileRes.c_str());\n                          fSuccess = false;\n                      }\n  \n                      Dbc* pcursor = db.GetCursor();\n                      if (pcursor)\n                          while (fSuccess)\n                          {\n                              CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n                              CDataStream ssValue(SER_DISK, CLIENT_VERSION);\n                              int ret = db.ReadAtCursor(pcursor, ssKey, ssValue, DB_NEXT);\n                              if (ret == DB_NOTFOUND)\n                              {\n                                  pcursor->close();\n                                  break;\n                              }\n                              else if (ret != 0)\n                              {\n                                  pcursor->close();\n                                  fSuccess = false;\n                                  break;\n                              }\n                              if (pszSkip &&\n                                  strncmp(&ssKey[0], pszSkip, std::min(ssKey.size(), strlen(pszSkip))) == 0)\n                                  continue;\n                              if (strncmp(&ssKey[0], \"\\x07version\", 8) == 0)\n                              {\n                                  // Update version:\n                                  ssValue.clear();\n                                  ssValue << CLIENT_VERSION;\n                              }\n                              Dbt datKey(&ssKey[0], ssKey.size());\n                              Dbt datValue(&ssValue[0], ssValue.size());\n                              int ret2 = pdbCopy->put(NULL, &datKey, &datValue, DB_NOOVERWRITE);\n                              if (ret2 > 0)\n                                  fSuccess = false;\n                          }\n                      if (fSuccess)\n                      {\n                          db.Close();\n                          bitdb.CloseDb(strFile);\n                          if (pdbCopy->close(0))\n                              fSuccess = false;\n                          delete pdbCopy;\n                      }\n                  }\n                  if (fSuccess)\n                  {\n                      Db dbA(&bitdb.dbenv, 0);\n                      if (dbA.remove(strFile.c_str(), NULL, 0))\n                          fSuccess = false;\n                      Db dbB(&bitdb.dbenv, 0);\n                      if (dbB.rename(strFileRes.c_str(), NULL, strFile.c_str(), 0))\n                          fSuccess = false;\n                  }\n                  if (!fSuccess)\n                      printf(\"Rewriting of %s FAILED!\\n\", strFileRes.c_str());\n                  return fSuccess;\n              }\n          }\n          MilliSleep(100);\n      }\n      return false;\n  }\n}"
  },
  {
    "function_name": "RemoveDb",
    "container": "CDBEnv",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "342-349",
    "snippet": "bool CDBEnv::RemoveDb(const string& strFile)\n{\n    this->CloseDb(strFile);\n\n    LOCK(cs_db);\n    int rc = dbenv.dbremove(NULL, strFile.c_str(), NULL, DB_AUTO_COMMIT);\n    return (rc == 0);\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbenv.dbremove",
          "args": [
            "NULL",
            "strFile.c_str()",
            "NULL",
            "DB_AUTO_COMMIT"
          ],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strFile.c_str",
          "args": [],
          "line": 347
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "cs_db"
          ],
          "line": 346
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "this->CloseDb",
          "args": [
            "strFile"
          ],
          "line": 344
        },
        "resolved": true,
        "details": {
          "function_name": "CloseDb",
          "container": "CDBEnv",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
          "lines": "327-340",
          "snippet": "void CDBEnv::CloseDb(const string& strFile)\n{\n    {\n        LOCK(cs_db);\n        if (mapDb[strFile] != NULL)\n        {\n            // Close the database handle\n            Db* pdb = mapDb[strFile];\n            pdb->close(0);\n            delete pdb;\n            mapDb[strFile] = NULL;\n        }\n    }\n}",
          "includes": [
            "#include \"sys/stat.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"main.h\"",
            "#include \"util.h\"",
            "#include \"net.h\"",
            "#include \"db.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  void CDBEnv::CloseDb(const string& strFile)\n  {\n      {\n          LOCK(cs_db);\n          if (mapDb[strFile] != NULL)\n          {\n              // Close the database handle\n              Db* pdb = mapDb[strFile];\n              pdb->close(0);\n              delete pdb;\n              mapDb[strFile] = NULL;\n          }\n      }\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  bool CDBEnv::RemoveDb(const string& strFile)\n  {\n      this->CloseDb(strFile);\n  \n      LOCK(cs_db);\n      int rc = dbenv.dbremove(NULL, strFile.c_str(), NULL, DB_AUTO_COMMIT);\n      return (rc == 0);\n  }\n}"
  },
  {
    "function_name": "CloseDb",
    "container": "CDBEnv",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "327-340",
    "snippet": "void CDBEnv::CloseDb(const string& strFile)\n{\n    {\n        LOCK(cs_db);\n        if (mapDb[strFile] != NULL)\n        {\n            // Close the database handle\n            Db* pdb = mapDb[strFile];\n            pdb->close(0);\n            delete pdb;\n            mapDb[strFile] = NULL;\n        }\n    }\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pdb->close",
          "args": [
            "0"
          ],
          "line": 335
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "cs_db"
          ],
          "line": 330
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  void CDBEnv::CloseDb(const string& strFile)\n  {\n      {\n          LOCK(cs_db);\n          if (mapDb[strFile] != NULL)\n          {\n              // Close the database handle\n              Db* pdb = mapDb[strFile];\n              pdb->close(0);\n              delete pdb;\n              mapDb[strFile] = NULL;\n          }\n      }\n  }\n}"
  },
  {
    "function_name": "Close",
    "container": "CDB",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "301-325",
    "snippet": "void CDB::Close()\n{\n    if (!pdb)\n        return;\n    if (activeTxn)\n        activeTxn->abort();\n    activeTxn = NULL;\n    pdb = NULL;\n\n    // Flush database activity from memory pool to disk log\n    unsigned int nMinutes = 0;\n    if (fReadOnly)\n        nMinutes = 1;\n    if (IsChainFile(strFile))\n        nMinutes = 2;\n    if (IsChainFile(strFile) && IsInitialBlockDownload())\n        nMinutes = 5;\n\n    bitdb.dbenv.txn_checkpoint(nMinutes ? GetArg(\"-dblogsize\", 100)*1024 : 0, nMinutes, 0);\n\n    {\n        LOCK(bitdb.cs_db);\n        --bitdb.mapFileUseCount[strFile];\n    }\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "CDBEnv bitdb;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "bitdb.cs_db"
          ],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bitdb.dbenv.txn_checkpoint",
          "args": [
            "nMinutes ? GetArg(\"-dblogsize\", 100)*1024 : 0",
            "nMinutes",
            "0"
          ],
          "line": 319
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetArg",
          "args": [
            "\"-dblogsize\"",
            "100"
          ],
          "line": 319
        },
        "resolved": true,
        "details": {
          "function_name": "GetArg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "562-567",
          "snippet": "int64_t GetArg(const std::string& strArg, int64_t nDefault)\n{\n    if (mapArgs.count(strArg))\n        return atoi64(mapArgs[strArg]);\n    return nDefault;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "map<string, string> mapArgs;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nmap<string, string> mapArgs;\n\nint64_t GetArg(const std::string& strArg, int64_t nDefault)\n{\n    if (mapArgs.count(strArg))\n        return atoi64(mapArgs[strArg]);\n    return nDefault;\n}"
        }
      },
      {
        "call_info": {
          "callee": "IsInitialBlockDownload",
          "args": [],
          "line": 316
        },
        "resolved": true,
        "details": {
          "function_name": "IsInitialBlockDownload",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
          "lines": "1220-1233",
          "snippet": "bool IsInitialBlockDownload()\n{\n    if (pindexBest == NULL || nBestHeight < Checkpoints::GetTotalBlocksEstimate())\n        return true;\n    static int64_t nLastUpdate;\n    static CBlockIndex* pindexLastBest;\n    if (pindexBest != pindexLastBest)\n    {\n        pindexLastBest = pindexBest;\n        nLastUpdate = GetTime();\n    }\n    return(((GetTime() - nLastUpdate) < 10) &&\n      (pindexBest->GetBlockTime() < (GetTime() - 4 * 60 * 60)));\n}",
          "includes": [
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"kernel.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"txdb.h\"",
            "#include \"db.h\"",
            "#include \"checkpoints.h\"",
            "#include \"alert.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int nBestHeight = -1;",
            "CBlockIndex* pindexBest = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/algorithm/string/replace.hpp>\n#include \"kernel.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"txdb.h\"\n#include \"db.h\"\n#include \"checkpoints.h\"\n#include \"alert.h\"\n\nint nBestHeight = -1;\nCBlockIndex* pindexBest = NULL;\n\nbool IsInitialBlockDownload()\n{\n    if (pindexBest == NULL || nBestHeight < Checkpoints::GetTotalBlocksEstimate())\n        return true;\n    static int64_t nLastUpdate;\n    static CBlockIndex* pindexLastBest;\n    if (pindexBest != pindexLastBest)\n    {\n        pindexLastBest = pindexBest;\n        nLastUpdate = GetTime();\n    }\n    return(((GetTime() - nLastUpdate) < 10) &&\n      (pindexBest->GetBlockTime() < (GetTime() - 4 * 60 * 60)));\n}"
        }
      },
      {
        "call_info": {
          "callee": "IsChainFile",
          "args": [
            "strFile"
          ],
          "line": 316
        },
        "resolved": true,
        "details": {
          "function_name": "IsChainFile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
          "lines": "293-299",
          "snippet": "static bool IsChainFile(std::string strFile)\n{\n    if (strFile == \"blkindex.dat\")\n        return true;\n\n    return false;\n}",
          "includes": [
            "#include \"sys/stat.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"main.h\"",
            "#include \"util.h\"",
            "#include \"net.h\"",
            "#include \"db.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nstatic bool IsChainFile(std::string strFile)\n{\n    if (strFile == \"blkindex.dat\")\n        return true;\n\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "activeTxn->abort",
          "args": [],
          "line": 306
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv bitdb;\n\nCDB {\n  void CDB::Close()\n  {\n      if (!pdb)\n          return;\n      if (activeTxn)\n          activeTxn->abort();\n      activeTxn = NULL;\n      pdb = NULL;\n  \n      // Flush database activity from memory pool to disk log\n      unsigned int nMinutes = 0;\n      if (fReadOnly)\n          nMinutes = 1;\n      if (IsChainFile(strFile))\n          nMinutes = 2;\n      if (IsChainFile(strFile) && IsInitialBlockDownload())\n          nMinutes = 5;\n  \n      bitdb.dbenv.txn_checkpoint(nMinutes ? GetArg(\"-dblogsize\", 100)*1024 : 0, nMinutes, 0);\n  \n      {\n          LOCK(bitdb.cs_db);\n          --bitdb.mapFileUseCount[strFile];\n      }\n  }\n}"
  },
  {
    "function_name": "IsChainFile",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "293-299",
    "snippet": "static bool IsChainFile(std::string strFile)\n{\n    if (strFile == \"blkindex.dat\")\n        return true;\n\n    return false;\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nstatic bool IsChainFile(std::string strFile)\n{\n    if (strFile == \"blkindex.dat\")\n        return true;\n\n    return false;\n}"
  },
  {
    "function_name": "CDB",
    "container": "CDB",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "229-291",
    "snippet": "CDB::CDB(const char *pszFile, const char* pszMode) :\n    pdb(NULL), activeTxn(NULL)\n{\n    int ret;\n\n    if((pszFile == NULL) || !strlen(pszFile))\n      return;\n\n    fReadOnly = (!strchr(pszMode, '+') && !strchr(pszMode, 'w'));\n    bool fCreate = strchr(pszMode, 'c');\n    unsigned int nFlags = DB_THREAD;\n    if (fCreate)\n        nFlags |= DB_CREATE;\n\n    {\n        LOCK(bitdb.cs_db);\n        if (!bitdb.Open(GetDataDir()))\n            throw runtime_error(\"env open failed\");\n\n        strFile = pszFile;\n        ++bitdb.mapFileUseCount[strFile];\n        pdb = bitdb.mapDb[strFile];\n        if (pdb == NULL)\n        {\n            pdb = new Db(&bitdb.dbenv, 0);\n\n            bool fMockDb = bitdb.IsMock();\n            if (fMockDb)\n            {\n                DbMpoolFile*mpf = pdb->get_mpf();\n                ret = mpf->set_flags(DB_MPOOL_NOFILE, 1);\n                if (ret != 0)\n                    throw runtime_error(strprintf(\"CDB() : failed to configure for no temp file backing for database %s\", pszFile));\n            }\n\n            ret = pdb->open(NULL,      // Txn pointer\n                            fMockDb ? NULL : pszFile,   // Filename\n                            \"main\",    // Logical db name\n                            DB_BTREE,  // Database type\n                            nFlags,    // Flags\n                            0);\n\n            if (ret != 0)\n            {\n                delete pdb;\n                pdb = NULL;\n                --bitdb.mapFileUseCount[strFile];\n                strFile = \"\";\n                throw runtime_error(strprintf(\"CDB() : can't open database file %s, error %d\", pszFile, ret));\n            }\n\n            if (fCreate && !Exists(string(\"version\")))\n            {\n                bool fTmp = fReadOnly;\n                fReadOnly = false;\n                WriteVersion(CLIENT_VERSION);\n                fReadOnly = fTmp;\n            }\n\n            bitdb.mapDb[strFile] = pdb;\n        }\n    }\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "CDBEnv bitdb;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "WriteVersion",
          "args": [
            "CLIENT_VERSION"
          ],
          "line": 284
        },
        "resolved": true,
        "details": {
          "function_name": "WriteVersion",
          "container": "CDB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.h",
          "lines": "306-309",
          "snippet": "bool WriteVersion(int nVersion)\n    {\n        return Write(std::string(\"version\"), nVersion);\n    }",
          "includes": [
            "#include <db_cxx.h>",
            "#include <vector>",
            "#include <string>",
            "#include <map>",
            "#include \"main.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <db_cxx.h>\n#include <vector>\n#include <string>\n#include <map>\n#include \"main.h\"\n\nCDB {\n  bool WriteVersion(int nVersion)\n      {\n          return Write(std::string(\"version\"), nVersion);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "Exists",
          "args": [
            "string(\"version\")"
          ],
          "line": 280
        },
        "resolved": true,
        "details": {
          "function_name": "Exists",
          "container": "CDB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.h",
          "lines": "201-218",
          "snippet": "bool Exists(const K& key)\n    {\n        if (!pdb)\n            return false;\n\n        // Key\n        CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n        ssKey.reserve(1000);\n        ssKey << key;\n        Dbt datKey(&ssKey[0], ssKey.size());\n\n        // Exists\n        int ret = pdb->exists(activeTxn, &datKey, 0);\n\n        // Clear memory\n        memset(datKey.get_data(), 0, datKey.get_size());\n        return (ret == 0);\n    }",
          "includes": [
            "#include <db_cxx.h>",
            "#include <vector>",
            "#include <string>",
            "#include <map>",
            "#include \"main.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <db_cxx.h>\n#include <vector>\n#include <string>\n#include <map>\n#include \"main.h\"\n\nCDB {\n  bool Exists(const K& key)\n      {\n          if (!pdb)\n              return false;\n  \n          // Key\n          CDataStream ssKey(SER_DISK, CLIENT_VERSION);\n          ssKey.reserve(1000);\n          ssKey << key;\n          Dbt datKey(&ssKey[0], ssKey.size());\n  \n          // Exists\n          int ret = pdb->exists(activeTxn, &datKey, 0);\n  \n          // Clear memory\n          memset(datKey.get_data(), 0, datKey.get_size());\n          return (ret == 0);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "string",
          "args": [
            "\"version\""
          ],
          "line": 280
        },
        "resolved": true,
        "details": {
          "function_name": "non_printable_to_string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_writer_template.h",
          "lines": "29-41",
          "snippet": "String_type non_printable_to_string( unsigned int c )\n    {\n        String_type result( 6, '\\\\' );\n\n        result[1] = 'u';\n\n        result[ 5 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 4 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 3 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 2 ] = to_hex_char( c & 0x000F );\n\n        return result;\n    }",
          "includes": [
            "#include <iomanip>",
            "#include <sstream>",
            "#include <cassert>",
            "#include \"json_spirit_value.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iomanip>\n#include <sstream>\n#include <cassert>\n#include \"json_spirit_value.h\"\n\nString_type non_printable_to_string( unsigned int c )\n    {\n        String_type result( 6, '\\\\' );\n\n        result[1] = 'u';\n\n        result[ 5 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 4 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 3 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 2 ] = to_hex_char( c & 0x000F );\n\n        return result;\n    }"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "strprintf(\"CDB() : can't open database file %s, error %d\", pszFile, ret)"
          ],
          "line": 277
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strprintf",
          "args": [
            "\"CDB() : can't open database file %s, error %d\"",
            "pszFile",
            "ret"
          ],
          "line": 277
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pdb->open",
          "args": [
            "NULL",
            "// Txn pointerfMockDb ? NULL : pszFile",
            "// Filename\"main\"",
            "// Logical db nameDB_BTREE",
            "// Database typenFlags",
            "// Flags0"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "strprintf(\"CDB() : failed to configure for no temp file backing for database %s\", pszFile)"
          ],
          "line": 261
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strprintf",
          "args": [
            "\"CDB() : failed to configure for no temp file backing for database %s\"",
            "pszFile"
          ],
          "line": 261
        },
        "resolved": true,
        "details": {
          "function_name": "real_strprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "331-338",
          "snippet": "string real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nstring real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mpf->set_flags",
          "args": [
            "DB_MPOOL_NOFILE",
            "1"
          ],
          "line": 259
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pdb->get_mpf",
          "args": [],
          "line": 258
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bitdb.IsMock",
          "args": [],
          "line": 255
        },
        "resolved": true,
        "details": {
          "function_name": "IsMock",
          "container": "CDBEnv",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.h",
          "lines": "53-53",
          "snippet": "bool IsMock() { return fMockDb; }",
          "includes": [
            "#include <db_cxx.h>",
            "#include <vector>",
            "#include <string>",
            "#include <map>",
            "#include \"main.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <db_cxx.h>\n#include <vector>\n#include <string>\n#include <map>\n#include \"main.h\"\n\nCDBEnv {\n  bool IsMock() { return fMockDb; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"env open failed\""
          ],
          "line": 246
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "bitdb.Open",
          "args": [
            "GetDataDir()"
          ],
          "line": 245
        },
        "resolved": true,
        "details": {
          "function_name": "Open",
          "container": "CDBEnv",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
          "lines": "61-113",
          "snippet": "bool CDBEnv::Open(boost::filesystem::path pathEnv_)\n{\n    if (fDbEnvInit)\n        return true;\n\n    if (fShutdown)\n        return false;\n\n    pathEnv = pathEnv_;\n    filesystem::path pathDataDir = pathEnv;\n    strPath = pathDataDir.string();\n    filesystem::path pathLogDir = pathDataDir / \"database\";\n    filesystem::create_directory(pathLogDir);\n    filesystem::path pathErrorFile = pathDataDir / \"db.log\";\n    printf(\"dbenv.open LogDir=%s ErrorFile=%s\\n\", pathLogDir.string().c_str(), pathErrorFile.string().c_str());\n\n    unsigned int nEnvFlags = 0;\n    if (GetBoolArg(\"-privdb\", true))\n        nEnvFlags |= DB_PRIVATE;\n\n    int nDbCache = GetArg(\"-dbcache\", 25);\n    dbenv.set_lg_dir(pathLogDir.string().c_str());\n    dbenv.set_cachesize(nDbCache / 1024, (nDbCache % 1024)*1048576, 1);\n    dbenv.set_lg_bsize(1048576);\n    dbenv.set_lg_max(10485760);\n\n    // Bugfix: Bump lk_max_locks default to 537000, to safely handle reorgs with up to 5 blocks reversed\n    // dbenv.set_lk_max_locks(10000);\n    dbenv.set_lk_max_locks(537000);\n\n    dbenv.set_lk_max_objects(10000);\n    dbenv.set_errfile(fopen(pathErrorFile.string().c_str(), \"a\")); /// debug\n    dbenv.set_flags(DB_AUTO_COMMIT, 1);\n    dbenv.set_flags(DB_TXN_WRITE_NOSYNC, 1);\n    dbenv.log_set_config(DB_LOG_AUTO_REMOVE, 1);\n    int ret = dbenv.open(strPath.c_str(),\n                     DB_CREATE     |\n                     DB_INIT_LOCK  |\n                     DB_INIT_LOG   |\n                     DB_INIT_MPOOL |\n                     DB_INIT_TXN   |\n                     DB_THREAD     |\n                     DB_RECOVER    |\n                     nEnvFlags,\n                     S_IRUSR | S_IWUSR);\n    if (ret != 0)\n        return error(\"CDB() : error %s (%d) opening database environment\", DbEnv::strerror(ret), ret);\n\n    fDbEnvInit = true;\n    fMockDb = false;\n\n    return true;\n}",
          "includes": [
            "#include \"sys/stat.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"main.h\"",
            "#include \"util.h\"",
            "#include \"net.h\"",
            "#include \"db.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  bool CDBEnv::Open(boost::filesystem::path pathEnv_)\n  {\n      if (fDbEnvInit)\n          return true;\n  \n      if (fShutdown)\n          return false;\n  \n      pathEnv = pathEnv_;\n      filesystem::path pathDataDir = pathEnv;\n      strPath = pathDataDir.string();\n      filesystem::path pathLogDir = pathDataDir / \"database\";\n      filesystem::create_directory(pathLogDir);\n      filesystem::path pathErrorFile = pathDataDir / \"db.log\";\n      printf(\"dbenv.open LogDir=%s ErrorFile=%s\\n\", pathLogDir.string().c_str(), pathErrorFile.string().c_str());\n  \n      unsigned int nEnvFlags = 0;\n      if (GetBoolArg(\"-privdb\", true))\n          nEnvFlags |= DB_PRIVATE;\n  \n      int nDbCache = GetArg(\"-dbcache\", 25);\n      dbenv.set_lg_dir(pathLogDir.string().c_str());\n      dbenv.set_cachesize(nDbCache / 1024, (nDbCache % 1024)*1048576, 1);\n      dbenv.set_lg_bsize(1048576);\n      dbenv.set_lg_max(10485760);\n  \n      // Bugfix: Bump lk_max_locks default to 537000, to safely handle reorgs with up to 5 blocks reversed\n      // dbenv.set_lk_max_locks(10000);\n      dbenv.set_lk_max_locks(537000);\n  \n      dbenv.set_lk_max_objects(10000);\n      dbenv.set_errfile(fopen(pathErrorFile.string().c_str(), \"a\")); /// debug\n      dbenv.set_flags(DB_AUTO_COMMIT, 1);\n      dbenv.set_flags(DB_TXN_WRITE_NOSYNC, 1);\n      dbenv.log_set_config(DB_LOG_AUTO_REMOVE, 1);\n      int ret = dbenv.open(strPath.c_str(),\n                       DB_CREATE     |\n                       DB_INIT_LOCK  |\n                       DB_INIT_LOG   |\n                       DB_INIT_MPOOL |\n                       DB_INIT_TXN   |\n                       DB_THREAD     |\n                       DB_RECOVER    |\n                       nEnvFlags,\n                       S_IRUSR | S_IWUSR);\n      if (ret != 0)\n          return error(\"CDB() : error %s (%d) opening database environment\", DbEnv::strerror(ret), ret);\n  \n      fDbEnvInit = true;\n      fMockDb = false;\n  \n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "GetDataDir",
          "args": [],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "bitdb.cs_db"
          ],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "pszMode",
            "'c'"
          ],
          "line": 238
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "pszMode",
            "'w'"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strchr",
          "args": [
            "pszMode",
            "'+'"
          ],
          "line": 237
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "pszFile"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv bitdb;\n\nCDB {\n  CDB::CDB(const char *pszFile, const char* pszMode) :\n      pdb(NULL), activeTxn(NULL)\n  {\n      int ret;\n  \n      if((pszFile == NULL) || !strlen(pszFile))\n        return;\n  \n      fReadOnly = (!strchr(pszMode, '+') && !strchr(pszMode, 'w'));\n      bool fCreate = strchr(pszMode, 'c');\n      unsigned int nFlags = DB_THREAD;\n      if (fCreate)\n          nFlags |= DB_CREATE;\n  \n      {\n          LOCK(bitdb.cs_db);\n          if (!bitdb.Open(GetDataDir()))\n              throw runtime_error(\"env open failed\");\n  \n          strFile = pszFile;\n          ++bitdb.mapFileUseCount[strFile];\n          pdb = bitdb.mapDb[strFile];\n          if (pdb == NULL)\n          {\n              pdb = new Db(&bitdb.dbenv, 0);\n  \n              bool fMockDb = bitdb.IsMock();\n              if (fMockDb)\n              {\n                  DbMpoolFile*mpf = pdb->get_mpf();\n                  ret = mpf->set_flags(DB_MPOOL_NOFILE, 1);\n                  if (ret != 0)\n                      throw runtime_error(strprintf(\"CDB() : failed to configure for no temp file backing for database %s\", pszFile));\n              }\n  \n              ret = pdb->open(NULL,      // Txn pointer\n                              fMockDb ? NULL : pszFile,   // Filename\n                              \"main\",    // Logical db name\n                              DB_BTREE,  // Database type\n                              nFlags,    // Flags\n                              0);\n  \n              if (ret != 0)\n              {\n                  delete pdb;\n                  pdb = NULL;\n                  --bitdb.mapFileUseCount[strFile];\n                  strFile = \"\";\n                  throw runtime_error(strprintf(\"CDB() : can't open database file %s, error %d\", pszFile, ret));\n              }\n  \n              if (fCreate && !Exists(string(\"version\")))\n              {\n                  bool fTmp = fReadOnly;\n                  fReadOnly = false;\n                  WriteVersion(CLIENT_VERSION);\n                  fReadOnly = fTmp;\n              }\n  \n              bitdb.mapDb[strFile] = pdb;\n          }\n      }\n  }\n}"
  },
  {
    "function_name": "CheckpointLSN",
    "container": "CDBEnv",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "220-226",
    "snippet": "void CDBEnv::CheckpointLSN(std::string strFile)\n{\n    dbenv.txn_checkpoint(0, 0, 0);\n    if (fMockDb)\n        return;\n    dbenv.lsn_reset(strFile.c_str(), 0);\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "dbenv.lsn_reset",
          "args": [
            "strFile.c_str()",
            "0"
          ],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strFile.c_str",
          "args": [],
          "line": 225
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.txn_checkpoint",
          "args": [
            "0",
            "0",
            "0"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  void CDBEnv::CheckpointLSN(std::string strFile)\n  {\n      dbenv.txn_checkpoint(0, 0, 0);\n      if (fMockDb)\n          return;\n      dbenv.lsn_reset(strFile.c_str(), 0);\n  }\n}"
  },
  {
    "function_name": "Salvage",
    "container": "CDBEnv",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "165-217",
    "snippet": "bool CDBEnv::Salvage(std::string strFile, bool fAggressive,\n                     std::vector<CDBEnv::KeyValPair >& vResult)\n{\n    LOCK(cs_db);\n    assert(mapFileUseCount.count(strFile) == 0);\n\n    u_int32_t flags = DB_SALVAGE;\n    if (fAggressive) flags |= DB_AGGRESSIVE;\n\n    stringstream strDump;\n\n    Db db(&dbenv, 0);\n    int result = db.verify(strFile.c_str(), NULL, &strDump, flags);\n    if (result == DB_VERIFY_BAD)\n    {\n        printf(\"Error: Salvage found errors, all data may not be recoverable.\\n\");\n        if (!fAggressive)\n        {\n            printf(\"Error: Rerun with aggressive mode to ignore errors and continue.\\n\");\n            return false;\n        }\n    }\n    if (result != 0 && result != DB_VERIFY_BAD)\n    {\n        printf(\"ERROR: db salvage failed: %d\\n\",result);\n        return false;\n    }\n\n    // Format of bdb dump is ascii lines:\n    // header lines...\n    // HEADER=END\n    // hexadecimal key\n    // hexadecimal value\n    // ... repeated\n    // DATA=END\n\n    string strLine;\n    while (!strDump.eof() && strLine != \"HEADER=END\")\n        getline(strDump, strLine); // Skip past header\n\n    std::string keyHex, valueHex;\n    while (!strDump.eof() && keyHex != \"DATA=END\")\n    {\n        getline(strDump, keyHex);\n        if (keyHex != \"DATA_END\")\n        {\n            getline(strDump, valueHex);\n            vResult.push_back(make_pair(ParseHex(keyHex),ParseHex(valueHex)));\n        }\n    }\n\n    return (result == 0);\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "vResult.push_back",
          "args": [
            "make_pair(ParseHex(keyHex),ParseHex(valueHex))"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "make_pair",
          "args": [
            "ParseHex(keyHex)",
            "ParseHex(valueHex)"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ParseHex",
          "args": [
            "valueHex"
          ],
          "line": 212
        },
        "resolved": true,
        "details": {
          "function_name": "ParseHex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "490-493",
          "snippet": "vector<unsigned char> ParseHex(const string& str)\n{\n    return ParseHex(str.c_str());\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nvector<unsigned char> ParseHex(const string& str)\n{\n    return ParseHex(str.c_str());\n}"
        }
      },
      {
        "call_info": {
          "callee": "getline",
          "args": [
            "strDump",
            "valueHex"
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getline",
          "args": [
            "strDump",
            "keyHex"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strDump.eof",
          "args": [],
          "line": 206
        },
        "resolved": true,
        "details": {
          "function_name": "eof",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "916-916",
          "snippet": "bool eof() const             { return size() == 0; }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  bool eof() const             { return size() == 0; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "getline",
          "args": [
            "strDump",
            "strLine"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"ERROR: db salvage failed: %d\\n\"",
            "result"
          ],
          "line": 189
        },
        "resolved": true,
        "details": {
          "function_name": "real_strprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "331-338",
          "snippet": "string real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nstring real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Error: Rerun with aggressive mode to ignore errors and continue.\\n\""
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"Error: Salvage found errors, all data may not be recoverable.\\n\""
          ],
          "line": 180
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "db.verify",
          "args": [
            "strFile.c_str()",
            "NULL",
            "&strDump",
            "flags"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strFile.c_str",
          "args": [],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "mapFileUseCount.count(strFile) == 0"
          ],
          "line": 169
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mapFileUseCount.count",
          "args": [
            "strFile"
          ],
          "line": 169
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "cs_db"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  bool CDBEnv::Salvage(std::string strFile, bool fAggressive,\n                       std::vector<CDBEnv::KeyValPair >& vResult)\n  {\n      LOCK(cs_db);\n      assert(mapFileUseCount.count(strFile) == 0);\n  \n      u_int32_t flags = DB_SALVAGE;\n      if (fAggressive) flags |= DB_AGGRESSIVE;\n  \n      stringstream strDump;\n  \n      Db db(&dbenv, 0);\n      int result = db.verify(strFile.c_str(), NULL, &strDump, flags);\n      if (result == DB_VERIFY_BAD)\n      {\n          printf(\"Error: Salvage found errors, all data may not be recoverable.\\n\");\n          if (!fAggressive)\n          {\n              printf(\"Error: Rerun with aggressive mode to ignore errors and continue.\\n\");\n              return false;\n          }\n      }\n      if (result != 0 && result != DB_VERIFY_BAD)\n      {\n          printf(\"ERROR: db salvage failed: %d\\n\",result);\n          return false;\n      }\n  \n      // Format of bdb dump is ascii lines:\n      // header lines...\n      // HEADER=END\n      // hexadecimal key\n      // hexadecimal value\n      // ... repeated\n      // DATA=END\n  \n      string strLine;\n      while (!strDump.eof() && strLine != \"HEADER=END\")\n          getline(strDump, strLine); // Skip past header\n  \n      std::string keyHex, valueHex;\n      while (!strDump.eof() && keyHex != \"DATA=END\")\n      {\n          getline(strDump, keyHex);\n          if (keyHex != \"DATA_END\")\n          {\n              getline(strDump, valueHex);\n              vResult.push_back(make_pair(ParseHex(keyHex),ParseHex(valueHex)));\n          }\n      }\n  \n      return (result == 0);\n  }\n}"
  },
  {
    "function_name": "Verify",
    "container": "CDBEnv",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "148-163",
    "snippet": "CDBEnv::VerifyResult CDBEnv::Verify(std::string strFile, bool (*recoverFunc)(CDBEnv& dbenv, std::string strFile))\n{\n    LOCK(cs_db);\n    assert(mapFileUseCount.count(strFile) == 0);\n\n    Db db(&dbenv, 0);\n    int result = db.verify(strFile.c_str(), NULL, NULL, 0);\n    if (result == 0)\n        return VERIFY_OK;\n    else if (recoverFunc == NULL)\n        return RECOVER_FAIL;\n\n    // Try to recover:\n    bool fRecovered = (*recoverFunc)(*this, strFile);\n    return (fRecovered ? RECOVER_OK : RECOVER_FAIL);\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "",
          "args": [
            "*this",
            "strFile"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "db.verify",
          "args": [
            "strFile.c_str()",
            "NULL",
            "NULL",
            "0"
          ],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strFile.c_str",
          "args": [],
          "line": 154
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "mapFileUseCount.count(strFile) == 0"
          ],
          "line": 151
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mapFileUseCount.count",
          "args": [
            "strFile"
          ],
          "line": 151
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "cs_db"
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  CDBEnv::VerifyResult CDBEnv::Verify(std::string strFile, bool (*recoverFunc)(CDBEnv& dbenv, std::string strFile))\n  {\n      LOCK(cs_db);\n      assert(mapFileUseCount.count(strFile) == 0);\n  \n      Db db(&dbenv, 0);\n      int result = db.verify(strFile.c_str(), NULL, NULL, 0);\n      if (result == 0)\n          return VERIFY_OK;\n      else if (recoverFunc == NULL)\n          return RECOVER_FAIL;\n  \n      // Try to recover:\n      bool fRecovered = (*recoverFunc)(*this, strFile);\n      return (fRecovered ? RECOVER_OK : RECOVER_FAIL);\n  }\n}"
  },
  {
    "function_name": "MakeMock",
    "container": "CDBEnv",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "115-146",
    "snippet": "void CDBEnv::MakeMock()\n{\n    if (fDbEnvInit)\n        throw runtime_error(\"CDBEnv::MakeMock(): already initialized\");\n\n    if (fShutdown)\n        throw runtime_error(\"CDBEnv::MakeMock(): during shutdown\");\n\n    printf(\"CDBEnv::MakeMock()\\n\");\n\n    dbenv.set_cachesize(1, 0, 1);\n    dbenv.set_lg_bsize(10485760*4);\n    dbenv.set_lg_max(10485760);\n    dbenv.set_lk_max_locks(200000);\n    dbenv.set_lk_max_objects(20000);\n    dbenv.set_flags(DB_AUTO_COMMIT, 1);\n    dbenv.log_set_config(DB_LOG_IN_MEMORY, 1);\n    int ret = dbenv.open(NULL,\n                     DB_CREATE     |\n                     DB_INIT_LOCK  |\n                     DB_INIT_LOG   |\n                     DB_INIT_MPOOL |\n                     DB_INIT_TXN   |\n                     DB_THREAD     |\n                     DB_PRIVATE,\n                     S_IRUSR | S_IWUSR);\n    if (ret > 0)\n        throw runtime_error(strprintf(\"CDBEnv::MakeMock(): error %d opening database environment\", ret));\n\n    fDbEnvInit = true;\n    fMockDb = true;\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "strprintf(\"CDBEnv::MakeMock(): error %d opening database environment\", ret)"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strprintf",
          "args": [
            "\"CDBEnv::MakeMock(): error %d opening database environment\"",
            "ret"
          ],
          "line": 142
        },
        "resolved": true,
        "details": {
          "function_name": "real_strprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "331-338",
          "snippet": "string real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nstring real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "dbenv.open",
          "args": [
            "NULL",
            "DB_CREATE     |\n                     DB_INIT_LOCK  |\n                     DB_INIT_LOG   |\n                     DB_INIT_MPOOL |\n                     DB_INIT_TXN   |\n                     DB_THREAD     |\n                     DB_PRIVATE",
            "S_IRUSR | S_IWUSR"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.log_set_config",
          "args": [
            "DB_LOG_IN_MEMORY",
            "1"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.set_flags",
          "args": [
            "DB_AUTO_COMMIT",
            "1"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.set_lk_max_objects",
          "args": [
            "20000"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.set_lk_max_locks",
          "args": [
            "200000"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.set_lg_max",
          "args": [
            "10485760"
          ],
          "line": 127
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.set_lg_bsize",
          "args": [
            "10485760*4"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.set_cachesize",
          "args": [
            "1",
            "0",
            "1"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"CDBEnv::MakeMock()\\n\""
          ],
          "line": 123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"CDBEnv::MakeMock(): during shutdown\""
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"CDBEnv::MakeMock(): already initialized\""
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  void CDBEnv::MakeMock()\n  {\n      if (fDbEnvInit)\n          throw runtime_error(\"CDBEnv::MakeMock(): already initialized\");\n  \n      if (fShutdown)\n          throw runtime_error(\"CDBEnv::MakeMock(): during shutdown\");\n  \n      printf(\"CDBEnv::MakeMock()\\n\");\n  \n      dbenv.set_cachesize(1, 0, 1);\n      dbenv.set_lg_bsize(10485760*4);\n      dbenv.set_lg_max(10485760);\n      dbenv.set_lk_max_locks(200000);\n      dbenv.set_lk_max_objects(20000);\n      dbenv.set_flags(DB_AUTO_COMMIT, 1);\n      dbenv.log_set_config(DB_LOG_IN_MEMORY, 1);\n      int ret = dbenv.open(NULL,\n                       DB_CREATE     |\n                       DB_INIT_LOCK  |\n                       DB_INIT_LOG   |\n                       DB_INIT_MPOOL |\n                       DB_INIT_TXN   |\n                       DB_THREAD     |\n                       DB_PRIVATE,\n                       S_IRUSR | S_IWUSR);\n      if (ret > 0)\n          throw runtime_error(strprintf(\"CDBEnv::MakeMock(): error %d opening database environment\", ret));\n  \n      fDbEnvInit = true;\n      fMockDb = true;\n  }\n}"
  },
  {
    "function_name": "Open",
    "container": "CDBEnv",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "61-113",
    "snippet": "bool CDBEnv::Open(boost::filesystem::path pathEnv_)\n{\n    if (fDbEnvInit)\n        return true;\n\n    if (fShutdown)\n        return false;\n\n    pathEnv = pathEnv_;\n    filesystem::path pathDataDir = pathEnv;\n    strPath = pathDataDir.string();\n    filesystem::path pathLogDir = pathDataDir / \"database\";\n    filesystem::create_directory(pathLogDir);\n    filesystem::path pathErrorFile = pathDataDir / \"db.log\";\n    printf(\"dbenv.open LogDir=%s ErrorFile=%s\\n\", pathLogDir.string().c_str(), pathErrorFile.string().c_str());\n\n    unsigned int nEnvFlags = 0;\n    if (GetBoolArg(\"-privdb\", true))\n        nEnvFlags |= DB_PRIVATE;\n\n    int nDbCache = GetArg(\"-dbcache\", 25);\n    dbenv.set_lg_dir(pathLogDir.string().c_str());\n    dbenv.set_cachesize(nDbCache / 1024, (nDbCache % 1024)*1048576, 1);\n    dbenv.set_lg_bsize(1048576);\n    dbenv.set_lg_max(10485760);\n\n    // Bugfix: Bump lk_max_locks default to 537000, to safely handle reorgs with up to 5 blocks reversed\n    // dbenv.set_lk_max_locks(10000);\n    dbenv.set_lk_max_locks(537000);\n\n    dbenv.set_lk_max_objects(10000);\n    dbenv.set_errfile(fopen(pathErrorFile.string().c_str(), \"a\")); /// debug\n    dbenv.set_flags(DB_AUTO_COMMIT, 1);\n    dbenv.set_flags(DB_TXN_WRITE_NOSYNC, 1);\n    dbenv.log_set_config(DB_LOG_AUTO_REMOVE, 1);\n    int ret = dbenv.open(strPath.c_str(),\n                     DB_CREATE     |\n                     DB_INIT_LOCK  |\n                     DB_INIT_LOG   |\n                     DB_INIT_MPOOL |\n                     DB_INIT_TXN   |\n                     DB_THREAD     |\n                     DB_RECOVER    |\n                     nEnvFlags,\n                     S_IRUSR | S_IWUSR);\n    if (ret != 0)\n        return error(\"CDB() : error %s (%d) opening database environment\", DbEnv::strerror(ret), ret);\n\n    fDbEnvInit = true;\n    fMockDb = false;\n\n    return true;\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "error",
          "args": [
            "\"CDB() : error %s (%d) opening database environment\"",
            "DbEnv::strerror(ret)",
            "ret"
          ],
          "line": 107
        },
        "resolved": true,
        "details": {
          "function_name": "error",
          "container": "BitcoinGUI",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/bitcoingui.cpp",
          "lines": "627-636",
          "snippet": "void BitcoinGUI::error(const QString &title, const QString &message, bool modal)\n{\n    // Report errors from network/worker thread\n    if(modal)\n    {\n        QMessageBox::critical(this, title, message, QMessageBox::Ok, QMessageBox::Ok);\n    } else {\n        notificator->notify(Notificator::Critical, title, message);\n    }\n}",
          "includes": [
            "#include <iostream>",
            "#include <QStyle>",
            "#include <QUrl>",
            "#include <QDragEnterEvent>",
            "#include <QTimer>",
            "#include <QDesktopServices>",
            "#include <QFileDialog>",
            "#include <QMovie>",
            "#include <QDateTime>",
            "#include <QStackedWidget>",
            "#include <QProgressBar>",
            "#include <QMimeData>",
            "#include <QMessageBox>",
            "#include <QLocale>",
            "#include <QPushButton>",
            "#include <QLineEdit>",
            "#include <QLabel>",
            "#include <QStatusBar>",
            "#include <QToolBar>",
            "#include <QVBoxLayout>",
            "#include <QTabWidget>",
            "#include <QIcon>",
            "#include <QMenu>",
            "#include <QMenuBar>",
            "#include <QMainWindow>",
            "#include <QApplication>",
            "#include \"macdockiconhandler.h\"",
            "#include \"blockexplorer.h\"",
            "#include \"wallet.h\"",
            "#include \"rpcconsole.h\"",
            "#include \"guiutil.h\"",
            "#include \"notificator.h\"",
            "#include \"askpassphrasedialog.h\"",
            "#include \"guiconstants.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"overviewpage.h\"",
            "#include \"transactionview.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"transactiondescdialog.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"editaddressdialog.h\"",
            "#include \"walletmodel.h\"",
            "#include \"clientmodel.h\"",
            "#include \"aboutdialog.h\"",
            "#include \"optionsdialog.h\"",
            "#include \"signverifymessagedialog.h\"",
            "#include \"sendcoinsdialog.h\"",
            "#include \"addressbookpage.h\"",
            "#include \"transactiontablemodel.h\"",
            "#include \"bitcoingui.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iostream>\n#include <QStyle>\n#include <QUrl>\n#include <QDragEnterEvent>\n#include <QTimer>\n#include <QDesktopServices>\n#include <QFileDialog>\n#include <QMovie>\n#include <QDateTime>\n#include <QStackedWidget>\n#include <QProgressBar>\n#include <QMimeData>\n#include <QMessageBox>\n#include <QLocale>\n#include <QPushButton>\n#include <QLineEdit>\n#include <QLabel>\n#include <QStatusBar>\n#include <QToolBar>\n#include <QVBoxLayout>\n#include <QTabWidget>\n#include <QIcon>\n#include <QMenu>\n#include <QMenuBar>\n#include <QMainWindow>\n#include <QApplication>\n#include \"macdockiconhandler.h\"\n#include \"blockexplorer.h\"\n#include \"wallet.h\"\n#include \"rpcconsole.h\"\n#include \"guiutil.h\"\n#include \"notificator.h\"\n#include \"askpassphrasedialog.h\"\n#include \"guiconstants.h\"\n#include \"bitcoinunits.h\"\n#include \"overviewpage.h\"\n#include \"transactionview.h\"\n#include \"addresstablemodel.h\"\n#include \"transactiondescdialog.h\"\n#include \"optionsmodel.h\"\n#include \"editaddressdialog.h\"\n#include \"walletmodel.h\"\n#include \"clientmodel.h\"\n#include \"aboutdialog.h\"\n#include \"optionsdialog.h\"\n#include \"signverifymessagedialog.h\"\n#include \"sendcoinsdialog.h\"\n#include \"addressbookpage.h\"\n#include \"transactiontablemodel.h\"\n#include \"bitcoingui.h\"\n\nBitcoinGUI {\n  void BitcoinGUI::error(const QString &title, const QString &message, bool modal)\n  {\n      // Report errors from network/worker thread\n      if(modal)\n      {\n          QMessageBox::critical(this, title, message, QMessageBox::Ok, QMessageBox::Ok);\n      } else {\n          notificator->notify(Notificator::Critical, title, message);\n      }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "DbEnv::strerror",
          "args": [
            "ret"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.open",
          "args": [
            "strPath.c_str()",
            "DB_CREATE     |\n                     DB_INIT_LOCK  |\n                     DB_INIT_LOG   |\n                     DB_INIT_MPOOL |\n                     DB_INIT_TXN   |\n                     DB_THREAD     |\n                     DB_RECOVER    |\n                     nEnvFlags",
            "S_IRUSR | S_IWUSR"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strPath.c_str",
          "args": [],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.log_set_config",
          "args": [
            "DB_LOG_AUTO_REMOVE",
            "1"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.set_flags",
          "args": [
            "DB_TXN_WRITE_NOSYNC",
            "1"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.set_flags",
          "args": [
            "DB_AUTO_COMMIT",
            "1"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.set_errfile",
          "args": [
            "fopen(pathErrorFile.string().c_str(), \"a\")"
          ],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fopen",
          "args": [
            "pathErrorFile.string().c_str()",
            "\"a\""
          ],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pathErrorFile.string",
          "args": [],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pathErrorFile.string",
          "args": [],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.set_lk_max_objects",
          "args": [
            "10000"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.set_lk_max_locks",
          "args": [
            "537000"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.set_lg_max",
          "args": [
            "10485760"
          ],
          "line": 85
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.set_lg_bsize",
          "args": [
            "1048576"
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.set_cachesize",
          "args": [
            "nDbCache / 1024",
            "(nDbCache % 1024)*1048576",
            "1"
          ],
          "line": 83
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.set_lg_dir",
          "args": [
            "pathLogDir.string().c_str()"
          ],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pathLogDir.string",
          "args": [],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pathLogDir.string",
          "args": [],
          "line": 82
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetArg",
          "args": [
            "\"-dbcache\"",
            "25"
          ],
          "line": 81
        },
        "resolved": true,
        "details": {
          "function_name": "GetArg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "562-567",
          "snippet": "int64_t GetArg(const std::string& strArg, int64_t nDefault)\n{\n    if (mapArgs.count(strArg))\n        return atoi64(mapArgs[strArg]);\n    return nDefault;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "map<string, string> mapArgs;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nmap<string, string> mapArgs;\n\nint64_t GetArg(const std::string& strArg, int64_t nDefault)\n{\n    if (mapArgs.count(strArg))\n        return atoi64(mapArgs[strArg]);\n    return nDefault;\n}"
        }
      },
      {
        "call_info": {
          "callee": "GetBoolArg",
          "args": [
            "\"-privdb\"",
            "true"
          ],
          "line": 78
        },
        "resolved": true,
        "details": {
          "function_name": "GetBoolArg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "569-578",
          "snippet": "bool GetBoolArg(const std::string& strArg, bool fDefault)\n{\n    if (mapArgs.count(strArg))\n    {\n        if (mapArgs[strArg].empty())\n            return true;\n        return (atoi(mapArgs[strArg]) != 0);\n    }\n    return fDefault;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "map<string, string> mapArgs;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nmap<string, string> mapArgs;\n\nbool GetBoolArg(const std::string& strArg, bool fDefault)\n{\n    if (mapArgs.count(strArg))\n    {\n        if (mapArgs[strArg].empty())\n            return true;\n        return (atoi(mapArgs[strArg]) != 0);\n    }\n    return fDefault;\n}"
        }
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"dbenv.open LogDir=%s ErrorFile=%s\\n\"",
            "pathLogDir.string().c_str()",
            "pathErrorFile.string().c_str()"
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pathErrorFile.string",
          "args": [],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pathErrorFile.string",
          "args": [],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pathLogDir.string",
          "args": [],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pathLogDir.string",
          "args": [],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filesystem::create_directory",
          "args": [
            "pathLogDir"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pathDataDir.string",
          "args": [],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  bool CDBEnv::Open(boost::filesystem::path pathEnv_)\n  {\n      if (fDbEnvInit)\n          return true;\n  \n      if (fShutdown)\n          return false;\n  \n      pathEnv = pathEnv_;\n      filesystem::path pathDataDir = pathEnv;\n      strPath = pathDataDir.string();\n      filesystem::path pathLogDir = pathDataDir / \"database\";\n      filesystem::create_directory(pathLogDir);\n      filesystem::path pathErrorFile = pathDataDir / \"db.log\";\n      printf(\"dbenv.open LogDir=%s ErrorFile=%s\\n\", pathLogDir.string().c_str(), pathErrorFile.string().c_str());\n  \n      unsigned int nEnvFlags = 0;\n      if (GetBoolArg(\"-privdb\", true))\n          nEnvFlags |= DB_PRIVATE;\n  \n      int nDbCache = GetArg(\"-dbcache\", 25);\n      dbenv.set_lg_dir(pathLogDir.string().c_str());\n      dbenv.set_cachesize(nDbCache / 1024, (nDbCache % 1024)*1048576, 1);\n      dbenv.set_lg_bsize(1048576);\n      dbenv.set_lg_max(10485760);\n  \n      // Bugfix: Bump lk_max_locks default to 537000, to safely handle reorgs with up to 5 blocks reversed\n      // dbenv.set_lk_max_locks(10000);\n      dbenv.set_lk_max_locks(537000);\n  \n      dbenv.set_lk_max_objects(10000);\n      dbenv.set_errfile(fopen(pathErrorFile.string().c_str(), \"a\")); /// debug\n      dbenv.set_flags(DB_AUTO_COMMIT, 1);\n      dbenv.set_flags(DB_TXN_WRITE_NOSYNC, 1);\n      dbenv.log_set_config(DB_LOG_AUTO_REMOVE, 1);\n      int ret = dbenv.open(strPath.c_str(),\n                       DB_CREATE     |\n                       DB_INIT_LOCK  |\n                       DB_INIT_LOG   |\n                       DB_INIT_MPOOL |\n                       DB_INIT_TXN   |\n                       DB_THREAD     |\n                       DB_RECOVER    |\n                       nEnvFlags,\n                       S_IRUSR | S_IWUSR);\n      if (ret != 0)\n          return error(\"CDB() : error %s (%d) opening database environment\", DbEnv::strerror(ret), ret);\n  \n      fDbEnvInit = true;\n      fMockDb = false;\n  \n      return true;\n  }\n}"
  },
  {
    "function_name": "Close",
    "container": "CDBEnv",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "56-59",
    "snippet": "void CDBEnv::Close()\n{\n    EnvShutdown();\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "EnvShutdown",
          "args": [],
          "line": 58
        },
        "resolved": true,
        "details": {
          "function_name": "EnvShutdown",
          "container": "CDBEnv",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
          "lines": "32-43",
          "snippet": "void CDBEnv::EnvShutdown()\n{\n    if (!fDbEnvInit)\n        return;\n\n    fDbEnvInit = false;\n    int ret = dbenv.close(0);\n    if (ret != 0)\n        printf(\"EnvShutdown exception: %s (%d)\\n\", DbEnv::strerror(ret), ret);\n    if (!fMockDb)\n        DbEnv(0).remove(strPath.c_str(), 0);\n}",
          "includes": [
            "#include \"sys/stat.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"main.h\"",
            "#include \"util.h\"",
            "#include \"net.h\"",
            "#include \"db.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  void CDBEnv::EnvShutdown()\n  {\n      if (!fDbEnvInit)\n          return;\n  \n      fDbEnvInit = false;\n      int ret = dbenv.close(0);\n      if (ret != 0)\n          printf(\"EnvShutdown exception: %s (%d)\\n\", DbEnv::strerror(ret), ret);\n      if (!fMockDb)\n          DbEnv(0).remove(strPath.c_str(), 0);\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  void CDBEnv::Close()\n  {\n      EnvShutdown();\n  }\n}"
  },
  {
    "function_name": "~CDBEnv",
    "container": "CDBEnv",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "51-54",
    "snippet": "CDBEnv::~CDBEnv()\n{\n    EnvShutdown();\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "EnvShutdown",
          "args": [],
          "line": 53
        },
        "resolved": true,
        "details": {
          "function_name": "EnvShutdown",
          "container": "CDBEnv",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
          "lines": "32-43",
          "snippet": "void CDBEnv::EnvShutdown()\n{\n    if (!fDbEnvInit)\n        return;\n\n    fDbEnvInit = false;\n    int ret = dbenv.close(0);\n    if (ret != 0)\n        printf(\"EnvShutdown exception: %s (%d)\\n\", DbEnv::strerror(ret), ret);\n    if (!fMockDb)\n        DbEnv(0).remove(strPath.c_str(), 0);\n}",
          "includes": [
            "#include \"sys/stat.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"main.h\"",
            "#include \"util.h\"",
            "#include \"net.h\"",
            "#include \"db.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  void CDBEnv::EnvShutdown()\n  {\n      if (!fDbEnvInit)\n          return;\n  \n      fDbEnvInit = false;\n      int ret = dbenv.close(0);\n      if (ret != 0)\n          printf(\"EnvShutdown exception: %s (%d)\\n\", DbEnv::strerror(ret), ret);\n      if (!fMockDb)\n          DbEnv(0).remove(strPath.c_str(), 0);\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  CDBEnv::~CDBEnv()\n  {\n      EnvShutdown();\n  }\n}"
  },
  {
    "function_name": "CDBEnv",
    "container": "CDBEnv",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "45-49",
    "snippet": "CDBEnv::CDBEnv() : dbenv(DB_CXX_NO_EXCEPTIONS)\n{\n    fDbEnvInit = false;\n    fMockDb = false;\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  CDBEnv::CDBEnv() : dbenv(DB_CXX_NO_EXCEPTIONS)\n  {\n      fDbEnvInit = false;\n      fMockDb = false;\n  }\n}"
  },
  {
    "function_name": "EnvShutdown",
    "container": "CDBEnv",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.cpp",
    "lines": "32-43",
    "snippet": "void CDBEnv::EnvShutdown()\n{\n    if (!fDbEnvInit)\n        return;\n\n    fDbEnvInit = false;\n    int ret = dbenv.close(0);\n    if (ret != 0)\n        printf(\"EnvShutdown exception: %s (%d)\\n\", DbEnv::strerror(ret), ret);\n    if (!fMockDb)\n        DbEnv(0).remove(strPath.c_str(), 0);\n}",
    "includes": [
      "#include \"sys/stat.h\"",
      "#include <boost/filesystem/fstream.hpp>",
      "#include <boost/filesystem.hpp>",
      "#include \"ui_interface.h\"",
      "#include \"main.h\"",
      "#include \"util.h\"",
      "#include \"net.h\"",
      "#include \"db.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DbEnv",
          "args": [
            "strPath.c_str()",
            "0"
          ],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strPath.c_str",
          "args": [],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DbEnv",
          "args": [
            "0"
          ],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"EnvShutdown exception: %s (%d)\\n\"",
            "DbEnv::strerror(ret)",
            "ret"
          ],
          "line": 40
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DbEnv::strerror",
          "args": [
            "ret"
          ],
          "line": 40
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dbenv.close",
          "args": [
            "0"
          ],
          "line": 38
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"sys/stat.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"ui_interface.h\"\n#include \"main.h\"\n#include \"util.h\"\n#include \"net.h\"\n#include \"db.h\"\n\nCDBEnv {\n  void CDBEnv::EnvShutdown()\n  {\n      if (!fDbEnvInit)\n          return;\n  \n      fDbEnvInit = false;\n      int ret = dbenv.close(0);\n      if (ret != 0)\n          printf(\"EnvShutdown exception: %s (%d)\\n\", DbEnv::strerror(ret), ret);\n      if (!fMockDb)\n          DbEnv(0).remove(strPath.c_str(), 0);\n  }\n}"
  }
]