[
  {
    "function_name": "FileSize",
    "container": "TableBuilder",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
    "lines": "266-268",
    "snippet": "uint64_t TableBuilder::FileSize() const {\n  return rep_->offset;\n}",
    "includes": [
      "#include \"util/crc32c.h\"",
      "#include \"util/coding.h\"",
      "#include \"table/format.h\"",
      "#include \"table/filter_block.h\"",
      "#include \"table/block_builder.h\"",
      "#include \"leveldb/options.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"leveldb/env.h\"",
      "#include \"leveldb/comparator.h\"",
      "#include <assert.h>",
      "#include \"leveldb/table_builder.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  uint64_t TableBuilder::FileSize() const {\n    return rep_->offset;\n  }\n}"
  },
  {
    "function_name": "NumEntries",
    "container": "TableBuilder",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
    "lines": "262-264",
    "snippet": "uint64_t TableBuilder::NumEntries() const {\n  return rep_->num_entries;\n}",
    "includes": [
      "#include \"util/crc32c.h\"",
      "#include \"util/coding.h\"",
      "#include \"table/format.h\"",
      "#include \"table/filter_block.h\"",
      "#include \"table/block_builder.h\"",
      "#include \"leveldb/options.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"leveldb/env.h\"",
      "#include \"leveldb/comparator.h\"",
      "#include <assert.h>",
      "#include \"leveldb/table_builder.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  uint64_t TableBuilder::NumEntries() const {\n    return rep_->num_entries;\n  }\n}"
  },
  {
    "function_name": "Abandon",
    "container": "TableBuilder",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
    "lines": "256-260",
    "snippet": "void TableBuilder::Abandon() {\n  Rep* r = rep_;\n  assert(!r->closed);\n  r->closed = true;\n}",
    "includes": [
      "#include \"util/crc32c.h\"",
      "#include \"util/coding.h\"",
      "#include \"table/format.h\"",
      "#include \"table/filter_block.h\"",
      "#include \"table/block_builder.h\"",
      "#include \"leveldb/options.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"leveldb/env.h\"",
      "#include \"leveldb/comparator.h\"",
      "#include <assert.h>",
      "#include \"leveldb/table_builder.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "!r->closed"
          ],
          "line": 258
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  void TableBuilder::Abandon() {\n    Rep* r = rep_;\n    assert(!r->closed);\n    r->closed = true;\n  }\n}"
  },
  {
    "function_name": "Finish",
    "container": "TableBuilder",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
    "lines": "199-254",
    "snippet": "Status TableBuilder::Finish() {\n  Rep* r = rep_;\n  Flush();\n  assert(!r->closed);\n  r->closed = true;\n\n  BlockHandle filter_block_handle, metaindex_block_handle, index_block_handle;\n\n  // Write filter block\n  if (ok() && r->filter_block != NULL) {\n    WriteRawBlock(r->filter_block->Finish(), kNoCompression,\n                  &filter_block_handle);\n  }\n\n  // Write metaindex block\n  if (ok()) {\n    BlockBuilder meta_index_block(&r->options);\n    if (r->filter_block != NULL) {\n      // Add mapping from \"filter.Name\" to location of filter data\n      std::string key = \"filter.\";\n      key.append(r->options.filter_policy->Name());\n      std::string handle_encoding;\n      filter_block_handle.EncodeTo(&handle_encoding);\n      meta_index_block.Add(key, handle_encoding);\n    }\n\n    // TODO(postrelease): Add stats and other meta blocks\n    WriteBlock(&meta_index_block, &metaindex_block_handle);\n  }\n\n  // Write index block\n  if (ok()) {\n    if (r->pending_index_entry) {\n      r->options.comparator->FindShortSuccessor(&r->last_key);\n      std::string handle_encoding;\n      r->pending_handle.EncodeTo(&handle_encoding);\n      r->index_block.Add(r->last_key, Slice(handle_encoding));\n      r->pending_index_entry = false;\n    }\n    WriteBlock(&r->index_block, &index_block_handle);\n  }\n\n  // Write footer\n  if (ok()) {\n    Footer footer;\n    footer.set_metaindex_handle(metaindex_block_handle);\n    footer.set_index_handle(index_block_handle);\n    std::string footer_encoding;\n    footer.EncodeTo(&footer_encoding);\n    r->status = r->file->Append(footer_encoding);\n    if (r->status.ok()) {\n      r->offset += footer_encoding.size();\n    }\n  }\n  return r->status;\n}",
    "includes": [
      "#include \"util/crc32c.h\"",
      "#include \"util/coding.h\"",
      "#include \"table/format.h\"",
      "#include \"table/filter_block.h\"",
      "#include \"table/block_builder.h\"",
      "#include \"leveldb/options.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"leveldb/env.h\"",
      "#include \"leveldb/comparator.h\"",
      "#include <assert.h>",
      "#include \"leveldb/table_builder.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "footer_encoding.size",
          "args": [],
          "line": 250
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "BlockHandle",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/format.h",
          "lines": "31-31",
          "snippet": "uint64_t size() const { return size_; }",
          "includes": [
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/slice.h\"",
            "#include <stdint.h>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/table_builder.h\"\n#include \"leveldb/status.h\"\n#include \"leveldb/slice.h\"\n#include <stdint.h>\n#include <string>\n\nBlockHandle {\n  uint64_t size() const { return size_; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "r->status.ok",
          "args": [],
          "line": 249
        },
        "resolved": true,
        "details": {
          "function_name": "ok",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/include/leveldb/table_builder.h",
          "lines": "78-78",
          "snippet": "bool ok() const { return status().ok(); }",
          "includes": [
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/options.h\"",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/status.h\"\n#include \"leveldb/options.h\"\n#include <stdint.h>\n\nTableBuilder {\n  bool ok() const { return status().ok(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "r->file->Append",
          "args": [
            "footer_encoding"
          ],
          "line": 248
        },
        "resolved": true,
        "details": {
          "function_name": "Append",
          "container": "StringSink",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_test.cc",
          "lines": "100-103",
          "snippet": "virtual Status Append(const Slice& data) {\n    contents_.append(data.data(), data.size());\n    return Status::OK();\n  }",
          "includes": [
            "#include \"util/testutil.h\"",
            "#include \"util/testharness.h\"",
            "#include \"util/random.h\"",
            "#include \"table/format.h\"",
            "#include \"table/block_builder.h\"",
            "#include \"table/block.h\"",
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/iterator.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"leveldb/db.h\"",
            "#include \"db/write_batch_internal.h\"",
            "#include \"db/memtable.h\"",
            "#include \"db/dbformat.h\"",
            "#include <string>",
            "#include <map>",
            "#include \"leveldb/table.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/testutil.h\"\n#include \"util/testharness.h\"\n#include \"util/random.h\"\n#include \"table/format.h\"\n#include \"table/block_builder.h\"\n#include \"table/block.h\"\n#include \"leveldb/table_builder.h\"\n#include \"leveldb/iterator.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/db.h\"\n#include \"db/write_batch_internal.h\"\n#include \"db/memtable.h\"\n#include \"db/dbformat.h\"\n#include <string>\n#include <map>\n#include \"leveldb/table.h\"\n\nStringSink {\n  virtual Status Append(const Slice& data) {\n      contents_.append(data.data(), data.size());\n      return Status::OK();\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "footer.EncodeTo",
          "args": [
            "&footer_encoding"
          ],
          "line": 247
        },
        "resolved": true,
        "details": {
          "function_name": "EncodeTo",
          "container": "Footer",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/format.cc",
          "lines": "32-42",
          "snippet": "void Footer::EncodeTo(std::string* dst) const {\n#ifndef NDEBUG\n  const size_t original_size = dst->size();\n#endif\n  metaindex_handle_.EncodeTo(dst);\n  index_handle_.EncodeTo(dst);\n  dst->resize(2 * BlockHandle::kMaxEncodedLength);  // Padding\n  PutFixed32(dst, static_cast<uint32_t>(kTableMagicNumber & 0xffffffffu));\n  PutFixed32(dst, static_cast<uint32_t>(kTableMagicNumber >> 32));\n  assert(dst->size() == original_size + kEncodedLength);\n}",
          "includes": [
            "#include \"util/crc32c.h\"",
            "#include \"util/coding.h\"",
            "#include \"table/block.h\"",
            "#include \"port/port.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"table/format.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/block.h\"\n#include \"port/port.h\"\n#include \"leveldb/env.h\"\n#include \"table/format.h\"\n\nFooter {\n  void Footer::EncodeTo(std::string* dst) const {\n  #ifndef NDEBUG\n    const size_t original_size = dst->size();\n  #endif\n    metaindex_handle_.EncodeTo(dst);\n    index_handle_.EncodeTo(dst);\n    dst->resize(2 * BlockHandle::kMaxEncodedLength);  // Padding\n    PutFixed32(dst, static_cast<uint32_t>(kTableMagicNumber & 0xffffffffu));\n    PutFixed32(dst, static_cast<uint32_t>(kTableMagicNumber >> 32));\n    assert(dst->size() == original_size + kEncodedLength);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "footer.set_index_handle",
          "args": [
            "index_block_handle"
          ],
          "line": 245
        },
        "resolved": true,
        "details": {
          "function_name": "set_index_handle",
          "container": "Footer",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/format.h",
          "lines": "59-61",
          "snippet": "void set_index_handle(const BlockHandle& h) {\n    index_handle_ = h;\n  }",
          "includes": [
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/slice.h\"",
            "#include <stdint.h>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/table_builder.h\"\n#include \"leveldb/status.h\"\n#include \"leveldb/slice.h\"\n#include <stdint.h>\n#include <string>\n\nFooter {\n  void set_index_handle(const BlockHandle& h) {\n      index_handle_ = h;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "footer.set_metaindex_handle",
          "args": [
            "metaindex_block_handle"
          ],
          "line": 244
        },
        "resolved": true,
        "details": {
          "function_name": "set_metaindex_handle",
          "container": "Footer",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/format.h",
          "lines": "53-53",
          "snippet": "void set_metaindex_handle(const BlockHandle& h) { metaindex_handle_ = h; }",
          "includes": [
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/slice.h\"",
            "#include <stdint.h>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/table_builder.h\"\n#include \"leveldb/status.h\"\n#include \"leveldb/slice.h\"\n#include <stdint.h>\n#include <string>\n\nFooter {\n  void set_metaindex_handle(const BlockHandle& h) { metaindex_handle_ = h; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "WriteBlock",
          "args": [
            "&r->index_block",
            "&index_block_handle"
          ],
          "line": 238
        },
        "resolved": true,
        "details": {
          "function_name": "WriteBlock",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
          "lines": "139-173",
          "snippet": "void TableBuilder::WriteBlock(BlockBuilder* block, BlockHandle* handle) {\n  // File format contains a sequence of blocks where each block has:\n  //    block_data: uint8[n]\n  //    type: uint8\n  //    crc: uint32\n  assert(ok());\n  Rep* r = rep_;\n  Slice raw = block->Finish();\n\n  Slice block_contents;\n  CompressionType type = r->options.compression;\n  // TODO(postrelease): Support more compression options: zlib?\n  switch (type) {\n    case kNoCompression:\n      block_contents = raw;\n      break;\n\n    case kSnappyCompression: {\n      std::string* compressed = &r->compressed_output;\n      if (port::Snappy_Compress(raw.data(), raw.size(), compressed) &&\n          compressed->size() < raw.size() - (raw.size() / 8u)) {\n        block_contents = *compressed;\n      } else {\n        // Snappy not supported, or compressed less than 12.5%, so just\n        // store uncompressed form\n        block_contents = raw;\n        type = kNoCompression;\n      }\n      break;\n    }\n  }\n  WriteRawBlock(block_contents, type, handle);\n  r->compressed_output.clear();\n  block->Reset();\n}",
          "includes": [
            "#include \"util/crc32c.h\"",
            "#include \"util/coding.h\"",
            "#include \"table/format.h\"",
            "#include \"table/filter_block.h\"",
            "#include \"table/block_builder.h\"",
            "#include \"leveldb/options.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"leveldb/comparator.h\"",
            "#include <assert.h>",
            "#include \"leveldb/table_builder.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  void TableBuilder::WriteBlock(BlockBuilder* block, BlockHandle* handle) {\n    // File format contains a sequence of blocks where each block has:\n    //    block_data: uint8[n]\n    //    type: uint8\n    //    crc: uint32\n    assert(ok());\n    Rep* r = rep_;\n    Slice raw = block->Finish();\n  \n    Slice block_contents;\n    CompressionType type = r->options.compression;\n    // TODO(postrelease): Support more compression options: zlib?\n    switch (type) {\n      case kNoCompression:\n        block_contents = raw;\n        break;\n  \n      case kSnappyCompression: {\n        std::string* compressed = &r->compressed_output;\n        if (port::Snappy_Compress(raw.data(), raw.size(), compressed) &&\n            compressed->size() < raw.size() - (raw.size() / 8u)) {\n          block_contents = *compressed;\n        } else {\n          // Snappy not supported, or compressed less than 12.5%, so just\n          // store uncompressed form\n          block_contents = raw;\n          type = kNoCompression;\n        }\n        break;\n      }\n    }\n    WriteRawBlock(block_contents, type, handle);\n    r->compressed_output.clear();\n    block->Reset();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "r->index_block.Add",
          "args": [
            "r->last_key",
            "Slice(handle_encoding)"
          ],
          "line": 235
        },
        "resolved": true,
        "details": {
          "function_name": "Add",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
          "lines": "92-121",
          "snippet": "void TableBuilder::Add(const Slice& key, const Slice& value) {\n  Rep* r = rep_;\n  assert(!r->closed);\n  if (!ok()) return;\n  if (r->num_entries > 0) {\n    assert(r->options.comparator->Compare(key, Slice(r->last_key)) > 0);\n  }\n\n  if (r->pending_index_entry) {\n    assert(r->data_block.empty());\n    r->options.comparator->FindShortestSeparator(&r->last_key, key);\n    std::string handle_encoding;\n    r->pending_handle.EncodeTo(&handle_encoding);\n    r->index_block.Add(r->last_key, Slice(handle_encoding));\n    r->pending_index_entry = false;\n  }\n\n  if (r->filter_block != NULL) {\n    r->filter_block->AddKey(key);\n  }\n\n  r->last_key.assign(key.data(), key.size());\n  r->num_entries++;\n  r->data_block.Add(key, value);\n\n  const size_t estimated_block_size = r->data_block.CurrentSizeEstimate();\n  if (estimated_block_size >= r->options.block_size) {\n    Flush();\n  }\n}",
          "includes": [
            "#include \"util/crc32c.h\"",
            "#include \"util/coding.h\"",
            "#include \"table/format.h\"",
            "#include \"table/filter_block.h\"",
            "#include \"table/block_builder.h\"",
            "#include \"leveldb/options.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"leveldb/comparator.h\"",
            "#include <assert.h>",
            "#include \"leveldb/table_builder.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  void TableBuilder::Add(const Slice& key, const Slice& value) {\n    Rep* r = rep_;\n    assert(!r->closed);\n    if (!ok()) return;\n    if (r->num_entries > 0) {\n      assert(r->options.comparator->Compare(key, Slice(r->last_key)) > 0);\n    }\n  \n    if (r->pending_index_entry) {\n      assert(r->data_block.empty());\n      r->options.comparator->FindShortestSeparator(&r->last_key, key);\n      std::string handle_encoding;\n      r->pending_handle.EncodeTo(&handle_encoding);\n      r->index_block.Add(r->last_key, Slice(handle_encoding));\n      r->pending_index_entry = false;\n    }\n  \n    if (r->filter_block != NULL) {\n      r->filter_block->AddKey(key);\n    }\n  \n    r->last_key.assign(key.data(), key.size());\n    r->num_entries++;\n    r->data_block.Add(key, value);\n  \n    const size_t estimated_block_size = r->data_block.CurrentSizeEstimate();\n    if (estimated_block_size >= r->options.block_size) {\n      Flush();\n    }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "Slice",
          "args": [
            "handle_encoding"
          ],
          "line": 235
        },
        "resolved": true,
        "details": {
          "function_name": "HashSlice",
          "container": "ShardedLRUCache",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/cache.cc",
          "lines": "276-278",
          "snippet": "static inline uint32_t HashSlice(const Slice& s) {\n    return Hash(s.data(), s.size(), 0);\n  }",
          "includes": [
            "#include \"util/mutexlock.h\"",
            "#include \"util/hash.h\"",
            "#include \"port/port.h\"",
            "#include \"leveldb/cache.h\"",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <assert.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/mutexlock.h\"\n#include \"util/hash.h\"\n#include \"port/port.h\"\n#include \"leveldb/cache.h\"\n#include <stdlib.h>\n#include <stdio.h>\n#include <assert.h>\n\nShardedLRUCache {\n  static inline uint32_t HashSlice(const Slice& s) {\n      return Hash(s.data(), s.size(), 0);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "r->options.comparator->FindShortSuccessor",
          "args": [
            "&r->last_key"
          ],
          "line": 232
        },
        "resolved": true,
        "details": {
          "function_name": "FindShortSuccessor",
          "container": "ReverseKeyComparator",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_test.cc",
          "lines": "57-61",
          "snippet": "virtual void FindShortSuccessor(std::string* key) const {\n    std::string s = Reverse(*key);\n    BytewiseComparator()->FindShortSuccessor(&s);\n    *key = Reverse(s);\n  }",
          "includes": [
            "#include \"util/testutil.h\"",
            "#include \"util/testharness.h\"",
            "#include \"util/random.h\"",
            "#include \"table/format.h\"",
            "#include \"table/block_builder.h\"",
            "#include \"table/block.h\"",
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/iterator.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"leveldb/db.h\"",
            "#include \"db/write_batch_internal.h\"",
            "#include \"db/memtable.h\"",
            "#include \"db/dbformat.h\"",
            "#include <string>",
            "#include <map>",
            "#include \"leveldb/table.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/testutil.h\"\n#include \"util/testharness.h\"\n#include \"util/random.h\"\n#include \"table/format.h\"\n#include \"table/block_builder.h\"\n#include \"table/block.h\"\n#include \"leveldb/table_builder.h\"\n#include \"leveldb/iterator.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/db.h\"\n#include \"db/write_batch_internal.h\"\n#include \"db/memtable.h\"\n#include \"db/dbformat.h\"\n#include <string>\n#include <map>\n#include \"leveldb/table.h\"\n\nReverseKeyComparator {\n  virtual void FindShortSuccessor(std::string* key) const {\n      std::string s = Reverse(*key);\n      BytewiseComparator()->FindShortSuccessor(&s);\n      *key = Reverse(s);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "key.append",
          "args": [
            "r->options.filter_policy->Name()"
          ],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r->options.filter_policy->Name",
          "args": [],
          "line": 219
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WriteRawBlock",
          "args": [
            "r->filter_block->Finish()",
            "kNoCompression",
            "&filter_block_handle"
          ],
          "line": 209
        },
        "resolved": true,
        "details": {
          "function_name": "WriteRawBlock",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
          "lines": "175-193",
          "snippet": "void TableBuilder::WriteRawBlock(const Slice& block_contents,\n                                 CompressionType type,\n                                 BlockHandle* handle) {\n  Rep* r = rep_;\n  handle->set_offset(r->offset);\n  handle->set_size(block_contents.size());\n  r->status = r->file->Append(block_contents);\n  if (r->status.ok()) {\n    char trailer[kBlockTrailerSize];\n    trailer[0] = type;\n    uint32_t crc = crc32c::Value(block_contents.data(), block_contents.size());\n    crc = crc32c::Extend(crc, trailer, 1);  // Extend crc to cover block type\n    EncodeFixed32(trailer+1, crc32c::Mask(crc));\n    r->status = r->file->Append(Slice(trailer, kBlockTrailerSize));\n    if (r->status.ok()) {\n      r->offset += block_contents.size() + kBlockTrailerSize;\n    }\n  }\n}",
          "includes": [
            "#include \"util/crc32c.h\"",
            "#include \"util/coding.h\"",
            "#include \"table/format.h\"",
            "#include \"table/filter_block.h\"",
            "#include \"table/block_builder.h\"",
            "#include \"leveldb/options.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"leveldb/comparator.h\"",
            "#include <assert.h>",
            "#include \"leveldb/table_builder.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  void TableBuilder::WriteRawBlock(const Slice& block_contents,\n                                   CompressionType type,\n                                   BlockHandle* handle) {\n    Rep* r = rep_;\n    handle->set_offset(r->offset);\n    handle->set_size(block_contents.size());\n    r->status = r->file->Append(block_contents);\n    if (r->status.ok()) {\n      char trailer[kBlockTrailerSize];\n      trailer[0] = type;\n      uint32_t crc = crc32c::Value(block_contents.data(), block_contents.size());\n      crc = crc32c::Extend(crc, trailer, 1);  // Extend crc to cover block type\n      EncodeFixed32(trailer+1, crc32c::Mask(crc));\n      r->status = r->file->Append(Slice(trailer, kBlockTrailerSize));\n      if (r->status.ok()) {\n        r->offset += block_contents.size() + kBlockTrailerSize;\n      }\n    }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "r->filter_block->Finish",
          "args": [],
          "line": 209
        },
        "resolved": true,
        "details": {
          "function_name": "Finish",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
          "lines": "199-254",
          "snippet": "Status TableBuilder::Finish() {\n  Rep* r = rep_;\n  Flush();\n  assert(!r->closed);\n  r->closed = true;\n\n  BlockHandle filter_block_handle, metaindex_block_handle, index_block_handle;\n\n  // Write filter block\n  if (ok() && r->filter_block != NULL) {\n    WriteRawBlock(r->filter_block->Finish(), kNoCompression,\n                  &filter_block_handle);\n  }\n\n  // Write metaindex block\n  if (ok()) {\n    BlockBuilder meta_index_block(&r->options);\n    if (r->filter_block != NULL) {\n      // Add mapping from \"filter.Name\" to location of filter data\n      std::string key = \"filter.\";\n      key.append(r->options.filter_policy->Name());\n      std::string handle_encoding;\n      filter_block_handle.EncodeTo(&handle_encoding);\n      meta_index_block.Add(key, handle_encoding);\n    }\n\n    // TODO(postrelease): Add stats and other meta blocks\n    WriteBlock(&meta_index_block, &metaindex_block_handle);\n  }\n\n  // Write index block\n  if (ok()) {\n    if (r->pending_index_entry) {\n      r->options.comparator->FindShortSuccessor(&r->last_key);\n      std::string handle_encoding;\n      r->pending_handle.EncodeTo(&handle_encoding);\n      r->index_block.Add(r->last_key, Slice(handle_encoding));\n      r->pending_index_entry = false;\n    }\n    WriteBlock(&r->index_block, &index_block_handle);\n  }\n\n  // Write footer\n  if (ok()) {\n    Footer footer;\n    footer.set_metaindex_handle(metaindex_block_handle);\n    footer.set_index_handle(index_block_handle);\n    std::string footer_encoding;\n    footer.EncodeTo(&footer_encoding);\n    r->status = r->file->Append(footer_encoding);\n    if (r->status.ok()) {\n      r->offset += footer_encoding.size();\n    }\n  }\n  return r->status;\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "!r->closed"
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Flush",
          "args": [],
          "line": 201
        },
        "resolved": true,
        "details": {
          "function_name": "Flush",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
          "lines": "123-137",
          "snippet": "void TableBuilder::Flush() {\n  Rep* r = rep_;\n  assert(!r->closed);\n  if (!ok()) return;\n  if (r->data_block.empty()) return;\n  assert(!r->pending_index_entry);\n  WriteBlock(&r->data_block, &r->pending_handle);\n  if (ok()) {\n    r->pending_index_entry = true;\n    r->status = r->file->Flush();\n  }\n  if (r->filter_block != NULL) {\n    r->filter_block->StartBlock(r->offset);\n  }\n}",
          "includes": [
            "#include \"util/crc32c.h\"",
            "#include \"util/coding.h\"",
            "#include \"table/format.h\"",
            "#include \"table/filter_block.h\"",
            "#include \"table/block_builder.h\"",
            "#include \"leveldb/options.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"leveldb/comparator.h\"",
            "#include <assert.h>",
            "#include \"leveldb/table_builder.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  void TableBuilder::Flush() {\n    Rep* r = rep_;\n    assert(!r->closed);\n    if (!ok()) return;\n    if (r->data_block.empty()) return;\n    assert(!r->pending_index_entry);\n    WriteBlock(&r->data_block, &r->pending_handle);\n    if (ok()) {\n      r->pending_index_entry = true;\n      r->status = r->file->Flush();\n    }\n    if (r->filter_block != NULL) {\n      r->filter_block->StartBlock(r->offset);\n    }\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  Status TableBuilder::Finish() {\n    Rep* r = rep_;\n    Flush();\n    assert(!r->closed);\n    r->closed = true;\n  \n    BlockHandle filter_block_handle, metaindex_block_handle, index_block_handle;\n  \n    // Write filter block\n    if (ok() && r->filter_block != NULL) {\n      WriteRawBlock(r->filter_block->Finish(), kNoCompression,\n                    &filter_block_handle);\n    }\n  \n    // Write metaindex block\n    if (ok()) {\n      BlockBuilder meta_index_block(&r->options);\n      if (r->filter_block != NULL) {\n        // Add mapping from \"filter.Name\" to location of filter data\n        std::string key = \"filter.\";\n        key.append(r->options.filter_policy->Name());\n        std::string handle_encoding;\n        filter_block_handle.EncodeTo(&handle_encoding);\n        meta_index_block.Add(key, handle_encoding);\n      }\n  \n      // TODO(postrelease): Add stats and other meta blocks\n      WriteBlock(&meta_index_block, &metaindex_block_handle);\n    }\n  \n    // Write index block\n    if (ok()) {\n      if (r->pending_index_entry) {\n        r->options.comparator->FindShortSuccessor(&r->last_key);\n        std::string handle_encoding;\n        r->pending_handle.EncodeTo(&handle_encoding);\n        r->index_block.Add(r->last_key, Slice(handle_encoding));\n        r->pending_index_entry = false;\n      }\n      WriteBlock(&r->index_block, &index_block_handle);\n    }\n  \n    // Write footer\n    if (ok()) {\n      Footer footer;\n      footer.set_metaindex_handle(metaindex_block_handle);\n      footer.set_index_handle(index_block_handle);\n      std::string footer_encoding;\n      footer.EncodeTo(&footer_encoding);\n      r->status = r->file->Append(footer_encoding);\n      if (r->status.ok()) {\n        r->offset += footer_encoding.size();\n      }\n    }\n    return r->status;\n  }\n}"
  },
  {
    "function_name": "status",
    "container": "TableBuilder",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
    "lines": "195-197",
    "snippet": "Status TableBuilder::status() const {\n  return rep_->status;\n}",
    "includes": [
      "#include \"util/crc32c.h\"",
      "#include \"util/coding.h\"",
      "#include \"table/format.h\"",
      "#include \"table/filter_block.h\"",
      "#include \"table/block_builder.h\"",
      "#include \"leveldb/options.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"leveldb/env.h\"",
      "#include \"leveldb/comparator.h\"",
      "#include <assert.h>",
      "#include \"leveldb/table_builder.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  Status TableBuilder::status() const {\n    return rep_->status;\n  }\n}"
  },
  {
    "function_name": "WriteRawBlock",
    "container": "TableBuilder",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
    "lines": "175-193",
    "snippet": "void TableBuilder::WriteRawBlock(const Slice& block_contents,\n                                 CompressionType type,\n                                 BlockHandle* handle) {\n  Rep* r = rep_;\n  handle->set_offset(r->offset);\n  handle->set_size(block_contents.size());\n  r->status = r->file->Append(block_contents);\n  if (r->status.ok()) {\n    char trailer[kBlockTrailerSize];\n    trailer[0] = type;\n    uint32_t crc = crc32c::Value(block_contents.data(), block_contents.size());\n    crc = crc32c::Extend(crc, trailer, 1);  // Extend crc to cover block type\n    EncodeFixed32(trailer+1, crc32c::Mask(crc));\n    r->status = r->file->Append(Slice(trailer, kBlockTrailerSize));\n    if (r->status.ok()) {\n      r->offset += block_contents.size() + kBlockTrailerSize;\n    }\n  }\n}",
    "includes": [
      "#include \"util/crc32c.h\"",
      "#include \"util/coding.h\"",
      "#include \"table/format.h\"",
      "#include \"table/filter_block.h\"",
      "#include \"table/block_builder.h\"",
      "#include \"leveldb/options.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"leveldb/env.h\"",
      "#include \"leveldb/comparator.h\"",
      "#include <assert.h>",
      "#include \"leveldb/table_builder.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "block_contents.size",
          "args": [],
          "line": 190
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "BlockHandle",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/format.h",
          "lines": "31-31",
          "snippet": "uint64_t size() const { return size_; }",
          "includes": [
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/slice.h\"",
            "#include <stdint.h>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/table_builder.h\"\n#include \"leveldb/status.h\"\n#include \"leveldb/slice.h\"\n#include <stdint.h>\n#include <string>\n\nBlockHandle {\n  uint64_t size() const { return size_; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "r->status.ok",
          "args": [],
          "line": 189
        },
        "resolved": true,
        "details": {
          "function_name": "ok",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/include/leveldb/table_builder.h",
          "lines": "78-78",
          "snippet": "bool ok() const { return status().ok(); }",
          "includes": [
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/options.h\"",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/status.h\"\n#include \"leveldb/options.h\"\n#include <stdint.h>\n\nTableBuilder {\n  bool ok() const { return status().ok(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "r->file->Append",
          "args": [
            "Slice(trailer, kBlockTrailerSize)"
          ],
          "line": 188
        },
        "resolved": true,
        "details": {
          "function_name": "Append",
          "container": "StringSink",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_test.cc",
          "lines": "100-103",
          "snippet": "virtual Status Append(const Slice& data) {\n    contents_.append(data.data(), data.size());\n    return Status::OK();\n  }",
          "includes": [
            "#include \"util/testutil.h\"",
            "#include \"util/testharness.h\"",
            "#include \"util/random.h\"",
            "#include \"table/format.h\"",
            "#include \"table/block_builder.h\"",
            "#include \"table/block.h\"",
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/iterator.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"leveldb/db.h\"",
            "#include \"db/write_batch_internal.h\"",
            "#include \"db/memtable.h\"",
            "#include \"db/dbformat.h\"",
            "#include <string>",
            "#include <map>",
            "#include \"leveldb/table.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/testutil.h\"\n#include \"util/testharness.h\"\n#include \"util/random.h\"\n#include \"table/format.h\"\n#include \"table/block_builder.h\"\n#include \"table/block.h\"\n#include \"leveldb/table_builder.h\"\n#include \"leveldb/iterator.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/db.h\"\n#include \"db/write_batch_internal.h\"\n#include \"db/memtable.h\"\n#include \"db/dbformat.h\"\n#include <string>\n#include <map>\n#include \"leveldb/table.h\"\n\nStringSink {\n  virtual Status Append(const Slice& data) {\n      contents_.append(data.data(), data.size());\n      return Status::OK();\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "Slice",
          "args": [
            "trailer",
            "kBlockTrailerSize"
          ],
          "line": 188
        },
        "resolved": true,
        "details": {
          "function_name": "GetLengthPrefixedSlice",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/coding.cc",
          "lines": "182-192",
          "snippet": "bool GetLengthPrefixedSlice(Slice* input, Slice* result) {\n  uint32_t len;\n  if (GetVarint32(input, &len) &&\n      input->size() >= len) {\n    *result = Slice(input->data(), len);\n    input->remove_prefix(len);\n    return true;\n  } else {\n    return false;\n  }\n}",
          "includes": [
            "#include \"util/coding.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/coding.h\"\n\nbool GetLengthPrefixedSlice(Slice* input, Slice* result) {\n  uint32_t len;\n  if (GetVarint32(input, &len) &&\n      input->size() >= len) {\n    *result = Slice(input->data(), len);\n    input->remove_prefix(len);\n    return true;\n  } else {\n    return false;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "EncodeFixed32",
          "args": [
            "trailer+1",
            "crc32c::Mask(crc)"
          ],
          "line": 187
        },
        "resolved": true,
        "details": {
          "function_name": "EncodeFixed32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/coding.cc",
          "lines": "9-18",
          "snippet": "void EncodeFixed32(char* buf, uint32_t value) {\n  if (port::kLittleEndian) {\n    memcpy(buf, &value, sizeof(value));\n  } else {\n    buf[0] = value & 0xff;\n    buf[1] = (value >> 8) & 0xff;\n    buf[2] = (value >> 16) & 0xff;\n    buf[3] = (value >> 24) & 0xff;\n  }\n}",
          "includes": [
            "#include \"util/coding.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/coding.h\"\n\nvoid EncodeFixed32(char* buf, uint32_t value) {\n  if (port::kLittleEndian) {\n    memcpy(buf, &value, sizeof(value));\n  } else {\n    buf[0] = value & 0xff;\n    buf[1] = (value >> 8) & 0xff;\n    buf[2] = (value >> 16) & 0xff;\n    buf[3] = (value >> 24) & 0xff;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "crc32c::Mask",
          "args": [
            "crc"
          ],
          "line": 187
        },
        "resolved": true,
        "details": {
          "function_name": "Mask",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/crc32c.h",
          "lines": "31-34",
          "snippet": "inline uint32_t Mask(uint32_t crc) {\n  // Rotate right by 15 bits and add a constant.\n  return ((crc >> 15) | (crc << 17)) + kMaskDelta;\n}",
          "includes": [
            "#include <stdint.h>",
            "#include <stddef.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdint.h>\n#include <stddef.h>\n\ninline uint32_t Mask(uint32_t crc) {\n  // Rotate right by 15 bits and add a constant.\n  return ((crc >> 15) | (crc << 17)) + kMaskDelta;\n}"
        }
      },
      {
        "call_info": {
          "callee": "crc32c::Extend",
          "args": [
            "crc",
            "trailer",
            "1"
          ],
          "line": 186
        },
        "resolved": true,
        "details": {
          "function_name": "Extend",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/crc32c.cc",
          "lines": "286-329",
          "snippet": "uint32_t Extend(uint32_t crc, const char* buf, size_t size) {\n  const uint8_t *p = reinterpret_cast<const uint8_t *>(buf);\n  const uint8_t *e = p + size;\n  uint32_t l = crc ^ 0xffffffffu;\n\n#define STEP1 do {                              \\\n    int c = (l & 0xff) ^ *p++;                  \\\n    l = table0_[c] ^ (l >> 8);                  \\\n} while (0)\n#define STEP4 do {                              \\\n    uint32_t c = l ^ LE_LOAD32(p);              \\\n    p += 4;                                     \\\n    l = table3_[c & 0xff] ^                     \\\n        table2_[(c >> 8) & 0xff] ^              \\\n        table1_[(c >> 16) & 0xff] ^             \\\n        table0_[c >> 24];                       \\\n} while (0)\n\n  // Point x at first 4-byte aligned byte in string.  This might be\n  // just past the end of the string.\n  const uintptr_t pval = reinterpret_cast<uintptr_t>(p);\n  const uint8_t* x = reinterpret_cast<const uint8_t*>(((pval + 3) >> 2) << 2);\n  if (x <= e) {\n    // Process bytes until finished or p is 4-byte aligned\n    while (p != x) {\n      STEP1;\n    }\n  }\n  // Process bytes 16 at a time\n  while ((e-p) >= 16) {\n    STEP4; STEP4; STEP4; STEP4;\n  }\n  // Process bytes 4 at a time\n  while ((e-p) >= 4) {\n    STEP4;\n  }\n  // Process the last few bytes\n  while (p != e) {\n    STEP1;\n  }\n#undef STEP4\n#undef STEP1\n  return l ^ 0xffffffffu;\n}",
          "includes": [
            "#include \"util/coding.h\"",
            "#include <stdint.h>",
            "#include \"util/crc32c.h\""
          ],
          "macros_used": [
            "#define STEP4 do {                              \\\n    uint32_t c = l ^ LE_LOAD32(p);              \\\n    p += 4;                                     \\\n    l = table3_[c & 0xff] ^                     \\\n        table2_[(c >> 8) & 0xff] ^              \\\n        table1_[(c >> 16) & 0xff] ^             \\\n        table0_[c >> 24];                       \\\n} while (0)",
            "#define STEP1 do {                              \\\n    int c = (l & 0xff) ^ *p++;                  \\\n    l = table0_[c] ^ (l >> 8);                  \\\n} while (0)"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/coding.h\"\n#include <stdint.h>\n#include \"util/crc32c.h\"\n\n#define STEP4 do {                              \\\n    uint32_t c = l ^ LE_LOAD32(p);              \\\n    p += 4;                                     \\\n    l = table3_[c & 0xff] ^                     \\\n        table2_[(c >> 8) & 0xff] ^              \\\n        table1_[(c >> 16) & 0xff] ^             \\\n        table0_[c >> 24];                       \\\n} while (0)\n#define STEP1 do {                              \\\n    int c = (l & 0xff) ^ *p++;                  \\\n    l = table0_[c] ^ (l >> 8);                  \\\n} while (0)\n\nuint32_t Extend(uint32_t crc, const char* buf, size_t size) {\n  const uint8_t *p = reinterpret_cast<const uint8_t *>(buf);\n  const uint8_t *e = p + size;\n  uint32_t l = crc ^ 0xffffffffu;\n\n#define STEP1 do {                              \\\n    int c = (l & 0xff) ^ *p++;                  \\\n    l = table0_[c] ^ (l >> 8);                  \\\n} while (0)\n#define STEP4 do {                              \\\n    uint32_t c = l ^ LE_LOAD32(p);              \\\n    p += 4;                                     \\\n    l = table3_[c & 0xff] ^                     \\\n        table2_[(c >> 8) & 0xff] ^              \\\n        table1_[(c >> 16) & 0xff] ^             \\\n        table0_[c >> 24];                       \\\n} while (0)\n\n  // Point x at first 4-byte aligned byte in string.  This might be\n  // just past the end of the string.\n  const uintptr_t pval = reinterpret_cast<uintptr_t>(p);\n  const uint8_t* x = reinterpret_cast<const uint8_t*>(((pval + 3) >> 2) << 2);\n  if (x <= e) {\n    // Process bytes until finished or p is 4-byte aligned\n    while (p != x) {\n      STEP1;\n    }\n  }\n  // Process bytes 16 at a time\n  while ((e-p) >= 16) {\n    STEP4; STEP4; STEP4; STEP4;\n  }\n  // Process bytes 4 at a time\n  while ((e-p) >= 4) {\n    STEP4;\n  }\n  // Process the last few bytes\n  while (p != e) {\n    STEP1;\n  }\n#undef STEP4\n#undef STEP1\n  return l ^ 0xffffffffu;\n}"
        }
      },
      {
        "call_info": {
          "callee": "crc32c::Value",
          "args": [
            "block_contents.data()",
            "block_contents.size()"
          ],
          "line": 185
        },
        "resolved": true,
        "details": {
          "function_name": "Value",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/crc32c.h",
          "lines": "20-22",
          "snippet": "inline uint32_t Value(const char* data, size_t n) {\n  return Extend(0, data, n);\n}",
          "includes": [
            "#include <stdint.h>",
            "#include <stddef.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdint.h>\n#include <stddef.h>\n\ninline uint32_t Value(const char* data, size_t n) {\n  return Extend(0, data, n);\n}"
        }
      },
      {
        "call_info": {
          "callee": "block_contents.data",
          "args": [],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "handle->set_size",
          "args": [
            "block_contents.size()"
          ],
          "line": 180
        },
        "resolved": true,
        "details": {
          "function_name": "set_size",
          "container": "BlockHandle",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/format.h",
          "lines": "32-32",
          "snippet": "void set_size(uint64_t size) { size_ = size; }",
          "includes": [
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/slice.h\"",
            "#include <stdint.h>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/table_builder.h\"\n#include \"leveldb/status.h\"\n#include \"leveldb/slice.h\"\n#include <stdint.h>\n#include <string>\n\nBlockHandle {\n  void set_size(uint64_t size) { size_ = size; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "handle->set_offset",
          "args": [
            "r->offset"
          ],
          "line": 179
        },
        "resolved": true,
        "details": {
          "function_name": "set_offset",
          "container": "BlockHandle",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/format.h",
          "lines": "28-28",
          "snippet": "void set_offset(uint64_t offset) { offset_ = offset; }",
          "includes": [
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/slice.h\"",
            "#include <stdint.h>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/table_builder.h\"\n#include \"leveldb/status.h\"\n#include \"leveldb/slice.h\"\n#include <stdint.h>\n#include <string>\n\nBlockHandle {\n  void set_offset(uint64_t offset) { offset_ = offset; }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  void TableBuilder::WriteRawBlock(const Slice& block_contents,\n                                   CompressionType type,\n                                   BlockHandle* handle) {\n    Rep* r = rep_;\n    handle->set_offset(r->offset);\n    handle->set_size(block_contents.size());\n    r->status = r->file->Append(block_contents);\n    if (r->status.ok()) {\n      char trailer[kBlockTrailerSize];\n      trailer[0] = type;\n      uint32_t crc = crc32c::Value(block_contents.data(), block_contents.size());\n      crc = crc32c::Extend(crc, trailer, 1);  // Extend crc to cover block type\n      EncodeFixed32(trailer+1, crc32c::Mask(crc));\n      r->status = r->file->Append(Slice(trailer, kBlockTrailerSize));\n      if (r->status.ok()) {\n        r->offset += block_contents.size() + kBlockTrailerSize;\n      }\n    }\n  }\n}"
  },
  {
    "function_name": "WriteBlock",
    "container": "TableBuilder",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
    "lines": "139-173",
    "snippet": "void TableBuilder::WriteBlock(BlockBuilder* block, BlockHandle* handle) {\n  // File format contains a sequence of blocks where each block has:\n  //    block_data: uint8[n]\n  //    type: uint8\n  //    crc: uint32\n  assert(ok());\n  Rep* r = rep_;\n  Slice raw = block->Finish();\n\n  Slice block_contents;\n  CompressionType type = r->options.compression;\n  // TODO(postrelease): Support more compression options: zlib?\n  switch (type) {\n    case kNoCompression:\n      block_contents = raw;\n      break;\n\n    case kSnappyCompression: {\n      std::string* compressed = &r->compressed_output;\n      if (port::Snappy_Compress(raw.data(), raw.size(), compressed) &&\n          compressed->size() < raw.size() - (raw.size() / 8u)) {\n        block_contents = *compressed;\n      } else {\n        // Snappy not supported, or compressed less than 12.5%, so just\n        // store uncompressed form\n        block_contents = raw;\n        type = kNoCompression;\n      }\n      break;\n    }\n  }\n  WriteRawBlock(block_contents, type, handle);\n  r->compressed_output.clear();\n  block->Reset();\n}",
    "includes": [
      "#include \"util/crc32c.h\"",
      "#include \"util/coding.h\"",
      "#include \"table/format.h\"",
      "#include \"table/filter_block.h\"",
      "#include \"table/block_builder.h\"",
      "#include \"leveldb/options.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"leveldb/env.h\"",
      "#include \"leveldb/comparator.h\"",
      "#include <assert.h>",
      "#include \"leveldb/table_builder.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "block->Reset",
          "args": [],
          "line": 172
        },
        "resolved": true,
        "details": {
          "function_name": "Reset",
          "container": "TableConstructor",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_test.cc",
          "lines": "262-267",
          "snippet": "void Reset() {\n    delete table_;\n    delete source_;\n    table_ = NULL;\n    source_ = NULL;\n  }",
          "includes": [
            "#include \"util/testutil.h\"",
            "#include \"util/testharness.h\"",
            "#include \"util/random.h\"",
            "#include \"table/format.h\"",
            "#include \"table/block_builder.h\"",
            "#include \"table/block.h\"",
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/iterator.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"leveldb/db.h\"",
            "#include \"db/write_batch_internal.h\"",
            "#include \"db/memtable.h\"",
            "#include \"db/dbformat.h\"",
            "#include <string>",
            "#include <map>",
            "#include \"leveldb/table.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/testutil.h\"\n#include \"util/testharness.h\"\n#include \"util/random.h\"\n#include \"table/format.h\"\n#include \"table/block_builder.h\"\n#include \"table/block.h\"\n#include \"leveldb/table_builder.h\"\n#include \"leveldb/iterator.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/db.h\"\n#include \"db/write_batch_internal.h\"\n#include \"db/memtable.h\"\n#include \"db/dbformat.h\"\n#include <string>\n#include <map>\n#include \"leveldb/table.h\"\n\nTableConstructor {\n  void Reset() {\n      delete table_;\n      delete source_;\n      table_ = NULL;\n      source_ = NULL;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "r->compressed_output.clear",
          "args": [],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "clear",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "808-808",
          "snippet": "void clear()                                     { vch.clear(); nReadPos = 0; }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  void clear()                                     { vch.clear(); nReadPos = 0; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "WriteRawBlock",
          "args": [
            "block_contents",
            "type",
            "handle"
          ],
          "line": 170
        },
        "resolved": true,
        "details": {
          "function_name": "WriteRawBlock",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
          "lines": "175-193",
          "snippet": "void TableBuilder::WriteRawBlock(const Slice& block_contents,\n                                 CompressionType type,\n                                 BlockHandle* handle) {\n  Rep* r = rep_;\n  handle->set_offset(r->offset);\n  handle->set_size(block_contents.size());\n  r->status = r->file->Append(block_contents);\n  if (r->status.ok()) {\n    char trailer[kBlockTrailerSize];\n    trailer[0] = type;\n    uint32_t crc = crc32c::Value(block_contents.data(), block_contents.size());\n    crc = crc32c::Extend(crc, trailer, 1);  // Extend crc to cover block type\n    EncodeFixed32(trailer+1, crc32c::Mask(crc));\n    r->status = r->file->Append(Slice(trailer, kBlockTrailerSize));\n    if (r->status.ok()) {\n      r->offset += block_contents.size() + kBlockTrailerSize;\n    }\n  }\n}",
          "includes": [
            "#include \"util/crc32c.h\"",
            "#include \"util/coding.h\"",
            "#include \"table/format.h\"",
            "#include \"table/filter_block.h\"",
            "#include \"table/block_builder.h\"",
            "#include \"leveldb/options.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"leveldb/comparator.h\"",
            "#include <assert.h>",
            "#include \"leveldb/table_builder.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  void TableBuilder::WriteRawBlock(const Slice& block_contents,\n                                   CompressionType type,\n                                   BlockHandle* handle) {\n    Rep* r = rep_;\n    handle->set_offset(r->offset);\n    handle->set_size(block_contents.size());\n    r->status = r->file->Append(block_contents);\n    if (r->status.ok()) {\n      char trailer[kBlockTrailerSize];\n      trailer[0] = type;\n      uint32_t crc = crc32c::Value(block_contents.data(), block_contents.size());\n      crc = crc32c::Extend(crc, trailer, 1);  // Extend crc to cover block type\n      EncodeFixed32(trailer+1, crc32c::Mask(crc));\n      r->status = r->file->Append(Slice(trailer, kBlockTrailerSize));\n      if (r->status.ok()) {\n        r->offset += block_contents.size() + kBlockTrailerSize;\n      }\n    }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "raw.size",
          "args": [],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "BlockHandle",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/format.h",
          "lines": "31-31",
          "snippet": "uint64_t size() const { return size_; }",
          "includes": [
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/slice.h\"",
            "#include <stdint.h>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/table_builder.h\"\n#include \"leveldb/status.h\"\n#include \"leveldb/slice.h\"\n#include <stdint.h>\n#include <string>\n\nBlockHandle {\n  uint64_t size() const { return size_; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "port::Snappy_Compress",
          "args": [
            "raw.data()",
            "raw.size()",
            "compressed"
          ],
          "line": 158
        },
        "resolved": true,
        "details": {
          "function_name": "Snappy_Compress",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/port/port_win.h",
          "lines": "136-147",
          "snippet": "inline bool Snappy_Compress(const char* input, size_t length,\n                            ::std::string* output) {\n#ifdef SNAPPY\n  output->resize(snappy::MaxCompressedLength(length));\n  size_t outlen;\n  snappy::RawCompress(input, length, &(*output)[0], &outlen);\n  output->resize(outlen);\n  return true;\n#endif\n\n  return false;\n}",
          "includes": [
            "#include <snappy.h>",
            "#include <stdint.h>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <snappy.h>\n#include <stdint.h>\n#include <string>\n\ninline bool Snappy_Compress(const char* input, size_t length,\n                            ::std::string* output) {\n#ifdef SNAPPY\n  output->resize(snappy::MaxCompressedLength(length));\n  size_t outlen;\n  snappy::RawCompress(input, length, &(*output)[0], &outlen);\n  output->resize(outlen);\n  return true;\n#endif\n\n  return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "raw.data",
          "args": [],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "block->Finish",
          "args": [],
          "line": 146
        },
        "resolved": true,
        "details": {
          "function_name": "Finish",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
          "lines": "199-254",
          "snippet": "Status TableBuilder::Finish() {\n  Rep* r = rep_;\n  Flush();\n  assert(!r->closed);\n  r->closed = true;\n\n  BlockHandle filter_block_handle, metaindex_block_handle, index_block_handle;\n\n  // Write filter block\n  if (ok() && r->filter_block != NULL) {\n    WriteRawBlock(r->filter_block->Finish(), kNoCompression,\n                  &filter_block_handle);\n  }\n\n  // Write metaindex block\n  if (ok()) {\n    BlockBuilder meta_index_block(&r->options);\n    if (r->filter_block != NULL) {\n      // Add mapping from \"filter.Name\" to location of filter data\n      std::string key = \"filter.\";\n      key.append(r->options.filter_policy->Name());\n      std::string handle_encoding;\n      filter_block_handle.EncodeTo(&handle_encoding);\n      meta_index_block.Add(key, handle_encoding);\n    }\n\n    // TODO(postrelease): Add stats and other meta blocks\n    WriteBlock(&meta_index_block, &metaindex_block_handle);\n  }\n\n  // Write index block\n  if (ok()) {\n    if (r->pending_index_entry) {\n      r->options.comparator->FindShortSuccessor(&r->last_key);\n      std::string handle_encoding;\n      r->pending_handle.EncodeTo(&handle_encoding);\n      r->index_block.Add(r->last_key, Slice(handle_encoding));\n      r->pending_index_entry = false;\n    }\n    WriteBlock(&r->index_block, &index_block_handle);\n  }\n\n  // Write footer\n  if (ok()) {\n    Footer footer;\n    footer.set_metaindex_handle(metaindex_block_handle);\n    footer.set_index_handle(index_block_handle);\n    std::string footer_encoding;\n    footer.EncodeTo(&footer_encoding);\n    r->status = r->file->Append(footer_encoding);\n    if (r->status.ok()) {\n      r->offset += footer_encoding.size();\n    }\n  }\n  return r->status;\n}",
          "includes": [
            "#include \"util/crc32c.h\"",
            "#include \"util/coding.h\"",
            "#include \"table/format.h\"",
            "#include \"table/filter_block.h\"",
            "#include \"table/block_builder.h\"",
            "#include \"leveldb/options.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"leveldb/comparator.h\"",
            "#include <assert.h>",
            "#include \"leveldb/table_builder.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  Status TableBuilder::Finish() {\n    Rep* r = rep_;\n    Flush();\n    assert(!r->closed);\n    r->closed = true;\n  \n    BlockHandle filter_block_handle, metaindex_block_handle, index_block_handle;\n  \n    // Write filter block\n    if (ok() && r->filter_block != NULL) {\n      WriteRawBlock(r->filter_block->Finish(), kNoCompression,\n                    &filter_block_handle);\n    }\n  \n    // Write metaindex block\n    if (ok()) {\n      BlockBuilder meta_index_block(&r->options);\n      if (r->filter_block != NULL) {\n        // Add mapping from \"filter.Name\" to location of filter data\n        std::string key = \"filter.\";\n        key.append(r->options.filter_policy->Name());\n        std::string handle_encoding;\n        filter_block_handle.EncodeTo(&handle_encoding);\n        meta_index_block.Add(key, handle_encoding);\n      }\n  \n      // TODO(postrelease): Add stats and other meta blocks\n      WriteBlock(&meta_index_block, &metaindex_block_handle);\n    }\n  \n    // Write index block\n    if (ok()) {\n      if (r->pending_index_entry) {\n        r->options.comparator->FindShortSuccessor(&r->last_key);\n        std::string handle_encoding;\n        r->pending_handle.EncodeTo(&handle_encoding);\n        r->index_block.Add(r->last_key, Slice(handle_encoding));\n        r->pending_index_entry = false;\n      }\n      WriteBlock(&r->index_block, &index_block_handle);\n    }\n  \n    // Write footer\n    if (ok()) {\n      Footer footer;\n      footer.set_metaindex_handle(metaindex_block_handle);\n      footer.set_index_handle(index_block_handle);\n      std::string footer_encoding;\n      footer.EncodeTo(&footer_encoding);\n      r->status = r->file->Append(footer_encoding);\n      if (r->status.ok()) {\n        r->offset += footer_encoding.size();\n      }\n    }\n    return r->status;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "ok()"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ok",
          "args": [],
          "line": 144
        },
        "resolved": true,
        "details": {
          "function_name": "ok",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/include/leveldb/table_builder.h",
          "lines": "78-78",
          "snippet": "bool ok() const { return status().ok(); }",
          "includes": [
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/options.h\"",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/status.h\"\n#include \"leveldb/options.h\"\n#include <stdint.h>\n\nTableBuilder {\n  bool ok() const { return status().ok(); }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  void TableBuilder::WriteBlock(BlockBuilder* block, BlockHandle* handle) {\n    // File format contains a sequence of blocks where each block has:\n    //    block_data: uint8[n]\n    //    type: uint8\n    //    crc: uint32\n    assert(ok());\n    Rep* r = rep_;\n    Slice raw = block->Finish();\n  \n    Slice block_contents;\n    CompressionType type = r->options.compression;\n    // TODO(postrelease): Support more compression options: zlib?\n    switch (type) {\n      case kNoCompression:\n        block_contents = raw;\n        break;\n  \n      case kSnappyCompression: {\n        std::string* compressed = &r->compressed_output;\n        if (port::Snappy_Compress(raw.data(), raw.size(), compressed) &&\n            compressed->size() < raw.size() - (raw.size() / 8u)) {\n          block_contents = *compressed;\n        } else {\n          // Snappy not supported, or compressed less than 12.5%, so just\n          // store uncompressed form\n          block_contents = raw;\n          type = kNoCompression;\n        }\n        break;\n      }\n    }\n    WriteRawBlock(block_contents, type, handle);\n    r->compressed_output.clear();\n    block->Reset();\n  }\n}"
  },
  {
    "function_name": "Flush",
    "container": "TableBuilder",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
    "lines": "123-137",
    "snippet": "void TableBuilder::Flush() {\n  Rep* r = rep_;\n  assert(!r->closed);\n  if (!ok()) return;\n  if (r->data_block.empty()) return;\n  assert(!r->pending_index_entry);\n  WriteBlock(&r->data_block, &r->pending_handle);\n  if (ok()) {\n    r->pending_index_entry = true;\n    r->status = r->file->Flush();\n  }\n  if (r->filter_block != NULL) {\n    r->filter_block->StartBlock(r->offset);\n  }\n}",
    "includes": [
      "#include \"util/crc32c.h\"",
      "#include \"util/coding.h\"",
      "#include \"table/format.h\"",
      "#include \"table/filter_block.h\"",
      "#include \"table/block_builder.h\"",
      "#include \"leveldb/options.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"leveldb/env.h\"",
      "#include \"leveldb/comparator.h\"",
      "#include <assert.h>",
      "#include \"leveldb/table_builder.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "r->filter_block->StartBlock",
          "args": [
            "r->offset"
          ],
          "line": 135
        },
        "resolved": true,
        "details": {
          "function_name": "StartBlock",
          "container": "FilterBlockBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block.cc",
          "lines": "22-28",
          "snippet": "void FilterBlockBuilder::StartBlock(uint64_t block_offset) {\n  uint64_t filter_index = (block_offset / kFilterBase);\n  assert(filter_index >= filter_offsets_.size());\n  while (filter_index > filter_offsets_.size()) {\n    GenerateFilter();\n  }\n}",
          "includes": [
            "#include \"util/coding.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"table/filter_block.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nFilterBlockBuilder {\n  void FilterBlockBuilder::StartBlock(uint64_t block_offset) {\n    uint64_t filter_index = (block_offset / kFilterBase);\n    assert(filter_index >= filter_offsets_.size());\n    while (filter_index > filter_offsets_.size()) {\n      GenerateFilter();\n    }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "r->file->Flush",
          "args": [],
          "line": 132
        },
        "resolved": true,
        "details": {
          "function_name": "Flush",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
          "lines": "123-137",
          "snippet": "void TableBuilder::Flush() {\n  Rep* r = rep_;\n  assert(!r->closed);\n  if (!ok()) return;\n  if (r->data_block.empty()) return;\n  assert(!r->pending_index_entry);\n  WriteBlock(&r->data_block, &r->pending_handle);\n  if (ok()) {\n    r->pending_index_entry = true;\n    r->status = r->file->Flush();\n  }\n  if (r->filter_block != NULL) {\n    r->filter_block->StartBlock(r->offset);\n  }\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "ok",
          "args": [],
          "line": 130
        },
        "resolved": true,
        "details": {
          "function_name": "ok",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/include/leveldb/table_builder.h",
          "lines": "78-78",
          "snippet": "bool ok() const { return status().ok(); }",
          "includes": [
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/options.h\"",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/status.h\"\n#include \"leveldb/options.h\"\n#include <stdint.h>\n\nTableBuilder {\n  bool ok() const { return status().ok(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "WriteBlock",
          "args": [
            "&r->data_block",
            "&r->pending_handle"
          ],
          "line": 129
        },
        "resolved": true,
        "details": {
          "function_name": "WriteBlock",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
          "lines": "139-173",
          "snippet": "void TableBuilder::WriteBlock(BlockBuilder* block, BlockHandle* handle) {\n  // File format contains a sequence of blocks where each block has:\n  //    block_data: uint8[n]\n  //    type: uint8\n  //    crc: uint32\n  assert(ok());\n  Rep* r = rep_;\n  Slice raw = block->Finish();\n\n  Slice block_contents;\n  CompressionType type = r->options.compression;\n  // TODO(postrelease): Support more compression options: zlib?\n  switch (type) {\n    case kNoCompression:\n      block_contents = raw;\n      break;\n\n    case kSnappyCompression: {\n      std::string* compressed = &r->compressed_output;\n      if (port::Snappy_Compress(raw.data(), raw.size(), compressed) &&\n          compressed->size() < raw.size() - (raw.size() / 8u)) {\n        block_contents = *compressed;\n      } else {\n        // Snappy not supported, or compressed less than 12.5%, so just\n        // store uncompressed form\n        block_contents = raw;\n        type = kNoCompression;\n      }\n      break;\n    }\n  }\n  WriteRawBlock(block_contents, type, handle);\n  r->compressed_output.clear();\n  block->Reset();\n}",
          "includes": [
            "#include \"util/crc32c.h\"",
            "#include \"util/coding.h\"",
            "#include \"table/format.h\"",
            "#include \"table/filter_block.h\"",
            "#include \"table/block_builder.h\"",
            "#include \"leveldb/options.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"leveldb/comparator.h\"",
            "#include <assert.h>",
            "#include \"leveldb/table_builder.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  void TableBuilder::WriteBlock(BlockBuilder* block, BlockHandle* handle) {\n    // File format contains a sequence of blocks where each block has:\n    //    block_data: uint8[n]\n    //    type: uint8\n    //    crc: uint32\n    assert(ok());\n    Rep* r = rep_;\n    Slice raw = block->Finish();\n  \n    Slice block_contents;\n    CompressionType type = r->options.compression;\n    // TODO(postrelease): Support more compression options: zlib?\n    switch (type) {\n      case kNoCompression:\n        block_contents = raw;\n        break;\n  \n      case kSnappyCompression: {\n        std::string* compressed = &r->compressed_output;\n        if (port::Snappy_Compress(raw.data(), raw.size(), compressed) &&\n            compressed->size() < raw.size() - (raw.size() / 8u)) {\n          block_contents = *compressed;\n        } else {\n          // Snappy not supported, or compressed less than 12.5%, so just\n          // store uncompressed form\n          block_contents = raw;\n          type = kNoCompression;\n        }\n        break;\n      }\n    }\n    WriteRawBlock(block_contents, type, handle);\n    r->compressed_output.clear();\n    block->Reset();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "!r->pending_index_entry"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r->data_block.empty",
          "args": [],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "empty",
          "container": "BlockBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/block_builder.h",
          "lines": "38-40",
          "snippet": "bool empty() const {\n    return buffer_.empty();\n  }",
          "includes": [
            "#include \"leveldb/slice.h\"",
            "#include <stdint.h>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/slice.h\"\n#include <stdint.h>\n#include <vector>\n\nBlockBuilder {\n  bool empty() const {\n      return buffer_.empty();\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "!r->closed"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  void TableBuilder::Flush() {\n    Rep* r = rep_;\n    assert(!r->closed);\n    if (!ok()) return;\n    if (r->data_block.empty()) return;\n    assert(!r->pending_index_entry);\n    WriteBlock(&r->data_block, &r->pending_handle);\n    if (ok()) {\n      r->pending_index_entry = true;\n      r->status = r->file->Flush();\n    }\n    if (r->filter_block != NULL) {\n      r->filter_block->StartBlock(r->offset);\n    }\n  }\n}"
  },
  {
    "function_name": "Add",
    "container": "TableBuilder",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
    "lines": "92-121",
    "snippet": "void TableBuilder::Add(const Slice& key, const Slice& value) {\n  Rep* r = rep_;\n  assert(!r->closed);\n  if (!ok()) return;\n  if (r->num_entries > 0) {\n    assert(r->options.comparator->Compare(key, Slice(r->last_key)) > 0);\n  }\n\n  if (r->pending_index_entry) {\n    assert(r->data_block.empty());\n    r->options.comparator->FindShortestSeparator(&r->last_key, key);\n    std::string handle_encoding;\n    r->pending_handle.EncodeTo(&handle_encoding);\n    r->index_block.Add(r->last_key, Slice(handle_encoding));\n    r->pending_index_entry = false;\n  }\n\n  if (r->filter_block != NULL) {\n    r->filter_block->AddKey(key);\n  }\n\n  r->last_key.assign(key.data(), key.size());\n  r->num_entries++;\n  r->data_block.Add(key, value);\n\n  const size_t estimated_block_size = r->data_block.CurrentSizeEstimate();\n  if (estimated_block_size >= r->options.block_size) {\n    Flush();\n  }\n}",
    "includes": [
      "#include \"util/crc32c.h\"",
      "#include \"util/coding.h\"",
      "#include \"table/format.h\"",
      "#include \"table/filter_block.h\"",
      "#include \"table/block_builder.h\"",
      "#include \"leveldb/options.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"leveldb/env.h\"",
      "#include \"leveldb/comparator.h\"",
      "#include <assert.h>",
      "#include \"leveldb/table_builder.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "Flush",
          "args": [],
          "line": 119
        },
        "resolved": true,
        "details": {
          "function_name": "Flush",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
          "lines": "123-137",
          "snippet": "void TableBuilder::Flush() {\n  Rep* r = rep_;\n  assert(!r->closed);\n  if (!ok()) return;\n  if (r->data_block.empty()) return;\n  assert(!r->pending_index_entry);\n  WriteBlock(&r->data_block, &r->pending_handle);\n  if (ok()) {\n    r->pending_index_entry = true;\n    r->status = r->file->Flush();\n  }\n  if (r->filter_block != NULL) {\n    r->filter_block->StartBlock(r->offset);\n  }\n}",
          "includes": [
            "#include \"util/crc32c.h\"",
            "#include \"util/coding.h\"",
            "#include \"table/format.h\"",
            "#include \"table/filter_block.h\"",
            "#include \"table/block_builder.h\"",
            "#include \"leveldb/options.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"leveldb/comparator.h\"",
            "#include <assert.h>",
            "#include \"leveldb/table_builder.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  void TableBuilder::Flush() {\n    Rep* r = rep_;\n    assert(!r->closed);\n    if (!ok()) return;\n    if (r->data_block.empty()) return;\n    assert(!r->pending_index_entry);\n    WriteBlock(&r->data_block, &r->pending_handle);\n    if (ok()) {\n      r->pending_index_entry = true;\n      r->status = r->file->Flush();\n    }\n    if (r->filter_block != NULL) {\n      r->filter_block->StartBlock(r->offset);\n    }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "r->data_block.CurrentSizeEstimate",
          "args": [],
          "line": 117
        },
        "resolved": true,
        "details": {
          "function_name": "CurrentSizeEstimate",
          "container": "BlockBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/block_builder.cc",
          "lines": "57-61",
          "snippet": "size_t BlockBuilder::CurrentSizeEstimate() const {\n  return (buffer_.size() +                        // Raw data buffer\n          restarts_.size() * sizeof(uint32_t) +   // Restart array\n          sizeof(uint32_t));                      // Restart array length\n}",
          "includes": [
            "#include \"util/coding.h\"",
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/comparator.h\"",
            "#include <assert.h>",
            "#include <algorithm>",
            "#include \"table/block_builder.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/coding.h\"\n#include \"leveldb/table_builder.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include <algorithm>\n#include \"table/block_builder.h\"\n\nBlockBuilder {\n  size_t BlockBuilder::CurrentSizeEstimate() const {\n    return (buffer_.size() +                        // Raw data buffer\n            restarts_.size() * sizeof(uint32_t) +   // Restart array\n            sizeof(uint32_t));                      // Restart array length\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "r->data_block.Add",
          "args": [
            "key",
            "value"
          ],
          "line": 115
        },
        "resolved": true,
        "details": {
          "function_name": "Add",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
          "lines": "92-121",
          "snippet": "void TableBuilder::Add(const Slice& key, const Slice& value) {\n  Rep* r = rep_;\n  assert(!r->closed);\n  if (!ok()) return;\n  if (r->num_entries > 0) {\n    assert(r->options.comparator->Compare(key, Slice(r->last_key)) > 0);\n  }\n\n  if (r->pending_index_entry) {\n    assert(r->data_block.empty());\n    r->options.comparator->FindShortestSeparator(&r->last_key, key);\n    std::string handle_encoding;\n    r->pending_handle.EncodeTo(&handle_encoding);\n    r->index_block.Add(r->last_key, Slice(handle_encoding));\n    r->pending_index_entry = false;\n  }\n\n  if (r->filter_block != NULL) {\n    r->filter_block->AddKey(key);\n  }\n\n  r->last_key.assign(key.data(), key.size());\n  r->num_entries++;\n  r->data_block.Add(key, value);\n\n  const size_t estimated_block_size = r->data_block.CurrentSizeEstimate();\n  if (estimated_block_size >= r->options.block_size) {\n    Flush();\n  }\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "r->last_key.assign",
          "args": [
            "key.data()",
            "key.size()"
          ],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "key.size",
          "args": [],
          "line": 113
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "BlockHandle",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/format.h",
          "lines": "31-31",
          "snippet": "uint64_t size() const { return size_; }",
          "includes": [
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/slice.h\"",
            "#include <stdint.h>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/table_builder.h\"\n#include \"leveldb/status.h\"\n#include \"leveldb/slice.h\"\n#include <stdint.h>\n#include <string>\n\nBlockHandle {\n  uint64_t size() const { return size_; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "key.data",
          "args": [],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r->filter_block->AddKey",
          "args": [
            "key"
          ],
          "line": 110
        },
        "resolved": true,
        "details": {
          "function_name": "AddKey",
          "container": "FilterBlockBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block.cc",
          "lines": "30-34",
          "snippet": "void FilterBlockBuilder::AddKey(const Slice& key) {\n  Slice k = key;\n  start_.push_back(keys_.size());\n  keys_.append(k.data(), k.size());\n}",
          "includes": [
            "#include \"util/coding.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"table/filter_block.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nFilterBlockBuilder {\n  void FilterBlockBuilder::AddKey(const Slice& key) {\n    Slice k = key;\n    start_.push_back(keys_.size());\n    keys_.append(k.data(), k.size());\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "Slice",
          "args": [
            "handle_encoding"
          ],
          "line": 105
        },
        "resolved": true,
        "details": {
          "function_name": "HashSlice",
          "container": "ShardedLRUCache",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/cache.cc",
          "lines": "276-278",
          "snippet": "static inline uint32_t HashSlice(const Slice& s) {\n    return Hash(s.data(), s.size(), 0);\n  }",
          "includes": [
            "#include \"util/mutexlock.h\"",
            "#include \"util/hash.h\"",
            "#include \"port/port.h\"",
            "#include \"leveldb/cache.h\"",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <assert.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/mutexlock.h\"\n#include \"util/hash.h\"\n#include \"port/port.h\"\n#include \"leveldb/cache.h\"\n#include <stdlib.h>\n#include <stdio.h>\n#include <assert.h>\n\nShardedLRUCache {\n  static inline uint32_t HashSlice(const Slice& s) {\n      return Hash(s.data(), s.size(), 0);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "r->pending_handle.EncodeTo",
          "args": [
            "&handle_encoding"
          ],
          "line": 104
        },
        "resolved": true,
        "details": {
          "function_name": "EncodeTo",
          "container": "Footer",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/format.cc",
          "lines": "32-42",
          "snippet": "void Footer::EncodeTo(std::string* dst) const {\n#ifndef NDEBUG\n  const size_t original_size = dst->size();\n#endif\n  metaindex_handle_.EncodeTo(dst);\n  index_handle_.EncodeTo(dst);\n  dst->resize(2 * BlockHandle::kMaxEncodedLength);  // Padding\n  PutFixed32(dst, static_cast<uint32_t>(kTableMagicNumber & 0xffffffffu));\n  PutFixed32(dst, static_cast<uint32_t>(kTableMagicNumber >> 32));\n  assert(dst->size() == original_size + kEncodedLength);\n}",
          "includes": [
            "#include \"util/crc32c.h\"",
            "#include \"util/coding.h\"",
            "#include \"table/block.h\"",
            "#include \"port/port.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"table/format.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/block.h\"\n#include \"port/port.h\"\n#include \"leveldb/env.h\"\n#include \"table/format.h\"\n\nFooter {\n  void Footer::EncodeTo(std::string* dst) const {\n  #ifndef NDEBUG\n    const size_t original_size = dst->size();\n  #endif\n    metaindex_handle_.EncodeTo(dst);\n    index_handle_.EncodeTo(dst);\n    dst->resize(2 * BlockHandle::kMaxEncodedLength);  // Padding\n    PutFixed32(dst, static_cast<uint32_t>(kTableMagicNumber & 0xffffffffu));\n    PutFixed32(dst, static_cast<uint32_t>(kTableMagicNumber >> 32));\n    assert(dst->size() == original_size + kEncodedLength);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "r->options.comparator->FindShortestSeparator",
          "args": [
            "&r->last_key",
            "key"
          ],
          "line": 102
        },
        "resolved": true,
        "details": {
          "function_name": "FindShortestSeparator",
          "container": "ReverseKeyComparator",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_test.cc",
          "lines": "48-55",
          "snippet": "virtual void FindShortestSeparator(\n      std::string* start,\n      const Slice& limit) const {\n    std::string s = Reverse(*start);\n    std::string l = Reverse(limit);\n    BytewiseComparator()->FindShortestSeparator(&s, l);\n    *start = Reverse(s);\n  }",
          "includes": [
            "#include \"util/testutil.h\"",
            "#include \"util/testharness.h\"",
            "#include \"util/random.h\"",
            "#include \"table/format.h\"",
            "#include \"table/block_builder.h\"",
            "#include \"table/block.h\"",
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/iterator.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"leveldb/db.h\"",
            "#include \"db/write_batch_internal.h\"",
            "#include \"db/memtable.h\"",
            "#include \"db/dbformat.h\"",
            "#include <string>",
            "#include <map>",
            "#include \"leveldb/table.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/testutil.h\"\n#include \"util/testharness.h\"\n#include \"util/random.h\"\n#include \"table/format.h\"\n#include \"table/block_builder.h\"\n#include \"table/block.h\"\n#include \"leveldb/table_builder.h\"\n#include \"leveldb/iterator.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/db.h\"\n#include \"db/write_batch_internal.h\"\n#include \"db/memtable.h\"\n#include \"db/dbformat.h\"\n#include <string>\n#include <map>\n#include \"leveldb/table.h\"\n\nReverseKeyComparator {\n  virtual void FindShortestSeparator(\n        std::string* start,\n        const Slice& limit) const {\n      std::string s = Reverse(*start);\n      std::string l = Reverse(limit);\n      BytewiseComparator()->FindShortestSeparator(&s, l);\n      *start = Reverse(s);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "r->data_block.empty()"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r->data_block.empty",
          "args": [],
          "line": 101
        },
        "resolved": true,
        "details": {
          "function_name": "empty",
          "container": "BlockBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/block_builder.h",
          "lines": "38-40",
          "snippet": "bool empty() const {\n    return buffer_.empty();\n  }",
          "includes": [
            "#include \"leveldb/slice.h\"",
            "#include <stdint.h>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/slice.h\"\n#include <stdint.h>\n#include <vector>\n\nBlockBuilder {\n  bool empty() const {\n      return buffer_.empty();\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "r->options.comparator->Compare(key, Slice(r->last_key)) > 0"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r->options.comparator->Compare",
          "args": [
            "key",
            "Slice(r->last_key)"
          ],
          "line": 97
        },
        "resolved": true,
        "details": {
          "function_name": "Compare",
          "container": "ReverseKeyComparator",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_test.cc",
          "lines": "44-46",
          "snippet": "virtual int Compare(const Slice& a, const Slice& b) const {\n    return BytewiseComparator()->Compare(Reverse(a), Reverse(b));\n  }",
          "includes": [
            "#include \"util/testutil.h\"",
            "#include \"util/testharness.h\"",
            "#include \"util/random.h\"",
            "#include \"table/format.h\"",
            "#include \"table/block_builder.h\"",
            "#include \"table/block.h\"",
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/iterator.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"leveldb/db.h\"",
            "#include \"db/write_batch_internal.h\"",
            "#include \"db/memtable.h\"",
            "#include \"db/dbformat.h\"",
            "#include <string>",
            "#include <map>",
            "#include \"leveldb/table.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/testutil.h\"\n#include \"util/testharness.h\"\n#include \"util/random.h\"\n#include \"table/format.h\"\n#include \"table/block_builder.h\"\n#include \"table/block.h\"\n#include \"leveldb/table_builder.h\"\n#include \"leveldb/iterator.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/db.h\"\n#include \"db/write_batch_internal.h\"\n#include \"db/memtable.h\"\n#include \"db/dbformat.h\"\n#include <string>\n#include <map>\n#include \"leveldb/table.h\"\n\nReverseKeyComparator {\n  virtual int Compare(const Slice& a, const Slice& b) const {\n      return BytewiseComparator()->Compare(Reverse(a), Reverse(b));\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ok",
          "args": [],
          "line": 95
        },
        "resolved": true,
        "details": {
          "function_name": "ok",
          "container": "TableBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/include/leveldb/table_builder.h",
          "lines": "78-78",
          "snippet": "bool ok() const { return status().ok(); }",
          "includes": [
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/options.h\"",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/status.h\"\n#include \"leveldb/options.h\"\n#include <stdint.h>\n\nTableBuilder {\n  bool ok() const { return status().ok(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "!r->closed"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  void TableBuilder::Add(const Slice& key, const Slice& value) {\n    Rep* r = rep_;\n    assert(!r->closed);\n    if (!ok()) return;\n    if (r->num_entries > 0) {\n      assert(r->options.comparator->Compare(key, Slice(r->last_key)) > 0);\n    }\n  \n    if (r->pending_index_entry) {\n      assert(r->data_block.empty());\n      r->options.comparator->FindShortestSeparator(&r->last_key, key);\n      std::string handle_encoding;\n      r->pending_handle.EncodeTo(&handle_encoding);\n      r->index_block.Add(r->last_key, Slice(handle_encoding));\n      r->pending_index_entry = false;\n    }\n  \n    if (r->filter_block != NULL) {\n      r->filter_block->AddKey(key);\n    }\n  \n    r->last_key.assign(key.data(), key.size());\n    r->num_entries++;\n    r->data_block.Add(key, value);\n  \n    const size_t estimated_block_size = r->data_block.CurrentSizeEstimate();\n    if (estimated_block_size >= r->options.block_size) {\n      Flush();\n    }\n  }\n}"
  },
  {
    "function_name": "ChangeOptions",
    "container": "TableBuilder",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
    "lines": "76-90",
    "snippet": "Status TableBuilder::ChangeOptions(const Options& options) {\n  // Note: if more fields are added to Options, update\n  // this function to catch changes that should not be allowed to\n  // change in the middle of building a Table.\n  if (options.comparator != rep_->options.comparator) {\n    return Status::InvalidArgument(\"changing comparator while building table\");\n  }\n\n  // Note that any live BlockBuilders point to rep_->options and therefore\n  // will automatically pick up the updated options.\n  rep_->options = options;\n  rep_->index_block_options = options;\n  rep_->index_block_options.block_restart_interval = 1;\n  return Status::OK();\n}",
    "includes": [
      "#include \"util/crc32c.h\"",
      "#include \"util/coding.h\"",
      "#include \"table/format.h\"",
      "#include \"table/filter_block.h\"",
      "#include \"table/block_builder.h\"",
      "#include \"leveldb/options.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"leveldb/env.h\"",
      "#include \"leveldb/comparator.h\"",
      "#include <assert.h>",
      "#include \"leveldb/table_builder.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "Status::OK",
          "args": [],
          "line": 89
        },
        "resolved": true,
        "details": {
          "function_name": "OK",
          "container": "Status",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/include/leveldb/status.h",
          "lines": "32-32",
          "snippet": "static Status OK() { return Status(); }",
          "includes": [
            "#include \"leveldb/slice.h\"",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/slice.h\"\n#include <string>\n\nStatus {\n  static Status OK() { return Status(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "Status::InvalidArgument",
          "args": [
            "\"changing comparator while building table\""
          ],
          "line": 81
        },
        "resolved": true,
        "details": {
          "function_name": "InvalidArgument",
          "container": "Status",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/include/leveldb/status.h",
          "lines": "44-46",
          "snippet": "static Status InvalidArgument(const Slice& msg, const Slice& msg2 = Slice()) {\n    return Status(kInvalidArgument, msg, msg2);\n  }",
          "includes": [
            "#include \"leveldb/slice.h\"",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/slice.h\"\n#include <string>\n\nStatus {\n  static Status InvalidArgument(const Slice& msg, const Slice& msg2 = Slice()) {\n      return Status(kInvalidArgument, msg, msg2);\n    }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  Status TableBuilder::ChangeOptions(const Options& options) {\n    // Note: if more fields are added to Options, update\n    // this function to catch changes that should not be allowed to\n    // change in the middle of building a Table.\n    if (options.comparator != rep_->options.comparator) {\n      return Status::InvalidArgument(\"changing comparator while building table\");\n    }\n  \n    // Note that any live BlockBuilders point to rep_->options and therefore\n    // will automatically pick up the updated options.\n    rep_->options = options;\n    rep_->index_block_options = options;\n    rep_->index_block_options.block_restart_interval = 1;\n    return Status::OK();\n  }\n}"
  },
  {
    "function_name": "~TableBuilder",
    "container": "TableBuilder",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
    "lines": "70-74",
    "snippet": "TableBuilder::~TableBuilder() {\n  assert(rep_->closed);  // Catch errors where caller forgot to call Finish()\n  delete rep_->filter_block;\n  delete rep_;\n}",
    "includes": [
      "#include \"util/crc32c.h\"",
      "#include \"util/coding.h\"",
      "#include \"table/format.h\"",
      "#include \"table/filter_block.h\"",
      "#include \"table/block_builder.h\"",
      "#include \"leveldb/options.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"leveldb/env.h\"",
      "#include \"leveldb/comparator.h\"",
      "#include <assert.h>",
      "#include \"leveldb/table_builder.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "assert",
          "args": [
            "rep_->closed"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  TableBuilder::~TableBuilder() {\n    assert(rep_->closed);  // Catch errors where caller forgot to call Finish()\n    delete rep_->filter_block;\n    delete rep_;\n  }\n}"
  },
  {
    "function_name": "TableBuilder",
    "container": "TableBuilder",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
    "lines": "63-68",
    "snippet": "TableBuilder::TableBuilder(const Options& options, WritableFile* file)\n    : rep_(new Rep(options, file)) {\n  if (rep_->filter_block != NULL) {\n    rep_->filter_block->StartBlock(0);\n  }\n}",
    "includes": [
      "#include \"util/crc32c.h\"",
      "#include \"util/coding.h\"",
      "#include \"table/format.h\"",
      "#include \"table/filter_block.h\"",
      "#include \"table/block_builder.h\"",
      "#include \"leveldb/options.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"leveldb/env.h\"",
      "#include \"leveldb/comparator.h\"",
      "#include <assert.h>",
      "#include \"leveldb/table_builder.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "rep_->filter_block->StartBlock",
          "args": [
            "0"
          ],
          "line": 66
        },
        "resolved": true,
        "details": {
          "function_name": "StartBlock",
          "container": "FilterBlockBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block.cc",
          "lines": "22-28",
          "snippet": "void FilterBlockBuilder::StartBlock(uint64_t block_offset) {\n  uint64_t filter_index = (block_offset / kFilterBase);\n  assert(filter_index >= filter_offsets_.size());\n  while (filter_index > filter_offsets_.size()) {\n    GenerateFilter();\n  }\n}",
          "includes": [
            "#include \"util/coding.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"table/filter_block.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nFilterBlockBuilder {\n  void FilterBlockBuilder::StartBlock(uint64_t block_offset) {\n    uint64_t filter_index = (block_offset / kFilterBase);\n    assert(filter_index >= filter_offsets_.size());\n    while (filter_index > filter_offsets_.size()) {\n      GenerateFilter();\n    }\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nTableBuilder {\n  TableBuilder::TableBuilder(const Options& options, WritableFile* file)\n      : rep_(new Rep(options, file)) {\n    if (rep_->filter_block != NULL) {\n      rep_->filter_block->StartBlock(0);\n    }\n  }\n}"
  },
  {
    "function_name": "Rep",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/table_builder.cc",
    "lines": "47-60",
    "snippet": "Rep(const Options& opt, WritableFile* f)\n      : options(opt),\n        index_block_options(opt),\n        file(f),\n        offset(0),\n        data_block(&options),\n        index_block(&index_block_options),\n        num_entries(0),\n        closed(false),\n        filter_block(opt.filter_policy == NULL ? NULL\n                     : new FilterBlockBuilder(opt.filter_policy)),\n        pending_index_entry(false) {\n    index_block_options.block_restart_interval = 1;\n  }",
    "includes": [
      "#include \"util/crc32c.h\"",
      "#include \"util/coding.h\"",
      "#include \"table/format.h\"",
      "#include \"table/filter_block.h\"",
      "#include \"table/block_builder.h\"",
      "#include \"leveldb/options.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"leveldb/env.h\"",
      "#include \"leveldb/comparator.h\"",
      "#include <assert.h>",
      "#include \"leveldb/table_builder.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"util/crc32c.h\"\n#include \"util/coding.h\"\n#include \"table/format.h\"\n#include \"table/filter_block.h\"\n#include \"table/block_builder.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/comparator.h\"\n#include <assert.h>\n#include \"leveldb/table_builder.h\"\n\nRep(const Options& opt, WritableFile* f)\n      : options(opt),\n        index_block_options(opt),\n        file(f),\n        offset(0),\n        data_block(&options),\n        index_block(&index_block_options),\n        num_entries(0),\n        closed(false),\n        filter_block(opt.filter_policy == NULL ? NULL\n                     : new FilterBlockBuilder(opt.filter_policy)),\n        pending_index_entry(false) {\n    index_block_options.block_restart_interval = 1;\n  }"
  }
]