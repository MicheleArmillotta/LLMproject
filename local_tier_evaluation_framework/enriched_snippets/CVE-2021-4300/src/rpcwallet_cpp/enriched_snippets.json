[
  {
    "function_name": "makekeypair",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1773-1793",
    "snippet": "Value makekeypair(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 1)\n        throw runtime_error(\n            \"makekeypair [prefix]\\n\"\n            \"Make a public/private key pair.\\n\"\n            \"[prefix] is optional preferred prefix for the public key.\\n\");\n\n    string strPrefix = \"\";\n    if (params.size() > 0)\n        strPrefix = params[0].get_str();\n \n    CKey key;\n    key.MakeNewKey(false);\n\n    CPrivKey vchPrivKey = key.GetPrivKey();\n    Object result;\n    result.push_back(Pair(\"PrivateKey\", HexStr<CPrivKey::iterator>(vchPrivKey.begin(), vchPrivKey.end())));\n    result.push_back(Pair(\"PublicKey\", HexStr(key.GetPubKey().Raw())));\n    return result;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"PublicKey\", HexStr(key.GetPubKey().Raw()))"
          ],
          "line": 1791
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"PublicKey\"",
            "HexStr(key.GetPubKey().Raw())"
          ],
          "line": 1791
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "HexStr",
          "args": [
            "key.GetPubKey().Raw()"
          ],
          "line": 1791
        },
        "resolved": true,
        "details": {
          "function_name": "HexStr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.h",
          "lines": "341-344",
          "snippet": "inline std::string HexStr(const std::vector<unsigned char>& vch, bool fSpaces=false)\n{\n    return HexStr(vch.begin(), vch.end(), fSpaces);\n}",
          "includes": [
            "#include <inttypes.h>",
            "#include <stdint.h>",
            "#include \"netbase.h\" // for AddTimeData",
            "#include <openssl/ripemd.h>",
            "#include <openssl/sha.h>",
            "#include <boost/date_time/posix_time/posix_time_types.hpp>",
            "#include <boost/date_time/gregorian/gregorian_types.hpp>",
            "#include <boost/filesystem/path.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/thread.hpp>",
            "#include <string>",
            "#include <vector>",
            "#include <map>",
            "#include <sys/resource.h>",
            "#include <sys/time.h>",
            "#include <sys/types.h>",
            "#include \"uint256.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <inttypes.h>\n#include <stdint.h>\n#include \"netbase.h\" // for AddTimeData\n#include <openssl/ripemd.h>\n#include <openssl/sha.h>\n#include <boost/date_time/posix_time/posix_time_types.hpp>\n#include <boost/date_time/gregorian/gregorian_types.hpp>\n#include <boost/filesystem/path.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/thread.hpp>\n#include <string>\n#include <vector>\n#include <map>\n#include <sys/resource.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include \"uint256.h\"\n\ninline std::string HexStr(const std::vector<unsigned char>& vch, bool fSpaces=false)\n{\n    return HexStr(vch.begin(), vch.end(), fSpaces);\n}"
        }
      },
      {
        "call_info": {
          "callee": "key.GetPubKey",
          "args": [],
          "line": 1791
        },
        "resolved": true,
        "details": {
          "function_name": "GetPubKey",
          "container": "CKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.cpp",
          "lines": "274-284",
          "snippet": "CPubKey CKey::GetPubKey() const\n{\n    int nSize = i2o_ECPublicKey(pkey, NULL);\n    if (!nSize)\n        throw key_error(\"CKey::GetPubKey() : i2o_ECPublicKey failed\");\n    std::vector<unsigned char> vchPubKey(nSize, 0);\n    unsigned char* pbegin = &vchPubKey[0];\n    if (i2o_ECPublicKey(pkey, &pbegin) != nSize)\n        throw key_error(\"CKey::GetPubKey() : i2o_ECPublicKey returned unexpected size\");\n    return CPubKey(vchPubKey);\n}",
          "includes": [
            "#include \"key.h\"",
            "#include <openssl/obj_mac.h>",
            "#include <openssl/ecdsa.h>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"key.h\"\n#include <openssl/obj_mac.h>\n#include <openssl/ecdsa.h>\n#include <map>\n\nCKey {\n  CPubKey CKey::GetPubKey() const\n  {\n      int nSize = i2o_ECPublicKey(pkey, NULL);\n      if (!nSize)\n          throw key_error(\"CKey::GetPubKey() : i2o_ECPublicKey failed\");\n      std::vector<unsigned char> vchPubKey(nSize, 0);\n      unsigned char* pbegin = &vchPubKey[0];\n      if (i2o_ECPublicKey(pkey, &pbegin) != nSize)\n          throw key_error(\"CKey::GetPubKey() : i2o_ECPublicKey returned unexpected size\");\n      return CPubKey(vchPubKey);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"PrivateKey\", HexStr<CPrivKey::iterator>(vchPrivKey.begin(), vchPrivKey.end()))"
          ],
          "line": 1790
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vchPrivKey.end",
          "args": [],
          "line": 1790
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "vchPrivKey.begin",
          "args": [],
          "line": 1790
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "key.GetPrivKey",
          "args": [],
          "line": 1788
        },
        "resolved": true,
        "details": {
          "function_name": "GetPrivKey",
          "container": "CKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.cpp",
          "lines": "247-257",
          "snippet": "CPrivKey CKey::GetPrivKey() const\n{\n    int nSize = i2d_ECPrivateKey(pkey, NULL);\n    if (!nSize)\n        throw key_error(\"CKey::GetPrivKey() : i2d_ECPrivateKey failed\");\n    CPrivKey vchPrivKey(nSize, 0);\n    unsigned char* pbegin = &vchPrivKey[0];\n    if (i2d_ECPrivateKey(pkey, &pbegin) != nSize)\n        throw key_error(\"CKey::GetPrivKey() : i2d_ECPrivateKey returned unexpected size\");\n    return vchPrivKey;\n}",
          "includes": [
            "#include \"key.h\"",
            "#include <openssl/obj_mac.h>",
            "#include <openssl/ecdsa.h>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"key.h\"\n#include <openssl/obj_mac.h>\n#include <openssl/ecdsa.h>\n#include <map>\n\nCKey {\n  CPrivKey CKey::GetPrivKey() const\n  {\n      int nSize = i2d_ECPrivateKey(pkey, NULL);\n      if (!nSize)\n          throw key_error(\"CKey::GetPrivKey() : i2d_ECPrivateKey failed\");\n      CPrivKey vchPrivKey(nSize, 0);\n      unsigned char* pbegin = &vchPrivKey[0];\n      if (i2d_ECPrivateKey(pkey, &pbegin) != nSize)\n          throw key_error(\"CKey::GetPrivKey() : i2d_ECPrivateKey returned unexpected size\");\n      return vchPrivKey;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "key.MakeNewKey",
          "args": [
            "false"
          ],
          "line": 1786
        },
        "resolved": true,
        "details": {
          "function_name": "MakeNewKey",
          "container": "CKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.cpp",
          "lines": "177-184",
          "snippet": "void CKey::MakeNewKey(bool fCompressed)\n{\n    if (!EC_KEY_generate_key(pkey))\n        throw key_error(\"CKey::MakeNewKey() : EC_KEY_generate_key failed\");\n    if (fCompressed)\n        SetCompressedPubKey();\n    fSet = true;\n}",
          "includes": [
            "#include \"key.h\"",
            "#include <openssl/obj_mac.h>",
            "#include <openssl/ecdsa.h>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"key.h\"\n#include <openssl/obj_mac.h>\n#include <openssl/ecdsa.h>\n#include <map>\n\nCKey {\n  void CKey::MakeNewKey(bool fCompressed)\n  {\n      if (!EC_KEY_generate_key(pkey))\n          throw key_error(\"CKey::MakeNewKey() : EC_KEY_generate_key failed\");\n      if (fCompressed)\n          SetCompressedPubKey();\n      fSet = true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 1783
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 1782
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"makekeypair [prefix]\\n\"\n            \"Make a public/private key pair.\\n\"\n            \"[prefix] is optional preferred prefix for the public key.\\n\""
          ],
          "line": 1776
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue makekeypair(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 1)\n        throw runtime_error(\n            \"makekeypair [prefix]\\n\"\n            \"Make a public/private key pair.\\n\"\n            \"[prefix] is optional preferred prefix for the public key.\\n\");\n\n    string strPrefix = \"\";\n    if (params.size() > 0)\n        strPrefix = params[0].get_str();\n \n    CKey key;\n    key.MakeNewKey(false);\n\n    CPrivKey vchPrivKey = key.GetPrivKey();\n    Object result;\n    result.push_back(Pair(\"PrivateKey\", HexStr<CPrivKey::iterator>(vchPrivKey.begin(), vchPrivKey.end())));\n    result.push_back(Pair(\"PublicKey\", HexStr(key.GetPubKey().Raw())));\n    return result;\n}"
  },
  {
    "function_name": "resendtx",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1759-1770",
    "snippet": "Value resendtx(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 1)\n        throw runtime_error(\n            \"resendtx\\n\"\n            \"Re-send unconfirmed transactions.\\n\"\n        );\n\n    ResendWalletTransactions(true);\n\n    return Value::null;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ResendWalletTransactions",
          "args": [
            "true"
          ],
          "line": 1767
        },
        "resolved": true,
        "details": {
          "function_name": "ResendWalletTransactions",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
          "lines": "193-197",
          "snippet": "void ResendWalletTransactions(bool fForce)\n{\n    BOOST_FOREACH(CWallet* pwallet, setpwalletRegistered)\n        pwallet->ResendWalletTransactions(fForce);\n}",
          "includes": [
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"kernel.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"txdb.h\"",
            "#include \"db.h\"",
            "#include \"checkpoints.h\"",
            "#include \"alert.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "set<CWallet*> setpwalletRegistered;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/algorithm/string/replace.hpp>\n#include \"kernel.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"txdb.h\"\n#include \"db.h\"\n#include \"checkpoints.h\"\n#include \"alert.h\"\n\nset<CWallet*> setpwalletRegistered;\n\nvoid ResendWalletTransactions(bool fForce)\n{\n    BOOST_FOREACH(CWallet* pwallet, setpwalletRegistered)\n        pwallet->ResendWalletTransactions(fForce);\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"resendtx\\n\"\n            \"Re-send unconfirmed transactions.\\n\""
          ],
          "line": 1762
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 1761
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue resendtx(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 1)\n        throw runtime_error(\n            \"resendtx\\n\"\n            \"Re-send unconfirmed transactions.\\n\"\n        );\n\n    ResendWalletTransactions(true);\n\n    return Value::null;\n}"
  },
  {
    "function_name": "repairwallet",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1731-1755",
    "snippet": "Value repairwallet(const Array& params, bool fHelp) {\n\n    if(fHelp || (params.size() > 0)) throw runtime_error(\n      \"repairwallet\\n\"\n      \"Wallet repair if any mismatches found.\\n\");\n\n    int nMismatchSpent;\n    int nOrphansFound;\n    int64 nBalanceInQuestion;\n    pwalletMain->FixSpentCoins(nMismatchSpent, nOrphansFound, nBalanceInQuestion, false);\n    Object result;\n    if(!nMismatchSpent && !nOrphansFound) {\n        result.push_back(Pair(\"wallet check passed\", true));\n    } else {\n        if(nMismatchSpent) {\n            result.push_back(Pair(\"mismatched spent coins\", nMismatchSpent));\n            result.push_back(Pair(\"amount affected by repair\", ValueFromAmount(nBalanceInQuestion)));\n        }\n        if(nOrphansFound) {\n            result.push_back(Pair(\"orphans removed\", nOrphansFound));\n        }\n    }\n\n    return(result);\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"orphans removed\", nOrphansFound)"
          ],
          "line": 1750
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"orphans removed\"",
            "nOrphansFound"
          ],
          "line": 1750
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"amount affected by repair\", ValueFromAmount(nBalanceInQuestion))"
          ],
          "line": 1747
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ValueFromAmount",
          "args": [
            "nBalanceInQuestion"
          ],
          "line": 1747
        },
        "resolved": true,
        "details": {
          "function_name": "ValueFromAmount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "113-116",
          "snippet": "Value ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nValue ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"mismatched spent coins\", nMismatchSpent)"
          ],
          "line": 1746
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"wallet check passed\", true)"
          ],
          "line": 1743
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->FixSpentCoins",
          "args": [
            "nMismatchSpent",
            "nOrphansFound",
            "nBalanceInQuestion",
            "false"
          ],
          "line": 1740
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"repairwallet\\n\"\n      \"Wallet repair if any mismatches found.\\n\""
          ],
          "line": 1733
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 1733
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue repairwallet(const Array& params, bool fHelp) {\n\n    if(fHelp || (params.size() > 0)) throw runtime_error(\n      \"repairwallet\\n\"\n      \"Wallet repair if any mismatches found.\\n\");\n\n    int nMismatchSpent;\n    int nOrphansFound;\n    int64 nBalanceInQuestion;\n    pwalletMain->FixSpentCoins(nMismatchSpent, nOrphansFound, nBalanceInQuestion, false);\n    Object result;\n    if(!nMismatchSpent && !nOrphansFound) {\n        result.push_back(Pair(\"wallet check passed\", true));\n    } else {\n        if(nMismatchSpent) {\n            result.push_back(Pair(\"mismatched spent coins\", nMismatchSpent));\n            result.push_back(Pair(\"amount affected by repair\", ValueFromAmount(nBalanceInQuestion)));\n        }\n        if(nOrphansFound) {\n            result.push_back(Pair(\"orphans removed\", nOrphansFound));\n        }\n    }\n\n    return(result);\n}"
  },
  {
    "function_name": "checkwallet",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1703-1727",
    "snippet": "Value checkwallet(const Array& params, bool fHelp) {\n\n    if(fHelp || (params.size() > 0)) throw runtime_error(\n      \"checkwallet\\n\"\n      \"Wallet integrity check.\\n\");\n\n    int nMismatchSpent;\n    int nOrphansFound;\n    int64 nBalanceInQuestion;\n    pwalletMain->FixSpentCoins(nMismatchSpent, nOrphansFound, nBalanceInQuestion, true);\n    Object result;\n    if(!nMismatchSpent && !nOrphansFound) {\n        result.push_back(Pair(\"wallet check passed\", true));\n    } else {\n        if(nMismatchSpent) {\n            result.push_back(Pair(\"mismatched spent coins\", nMismatchSpent));\n            result.push_back(Pair(\"amount in question\", ValueFromAmount(nBalanceInQuestion)));\n        }\n        if(nOrphansFound) {\n            result.push_back(Pair(\"orphans found\", nOrphansFound));\n        }\n    }\n\n    return(result);\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"orphans found\", nOrphansFound)"
          ],
          "line": 1722
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"orphans found\"",
            "nOrphansFound"
          ],
          "line": 1722
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"amount in question\", ValueFromAmount(nBalanceInQuestion))"
          ],
          "line": 1719
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ValueFromAmount",
          "args": [
            "nBalanceInQuestion"
          ],
          "line": 1719
        },
        "resolved": true,
        "details": {
          "function_name": "ValueFromAmount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "113-116",
          "snippet": "Value ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nValue ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"mismatched spent coins\", nMismatchSpent)"
          ],
          "line": 1718
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"wallet check passed\", true)"
          ],
          "line": 1715
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->FixSpentCoins",
          "args": [
            "nMismatchSpent",
            "nOrphansFound",
            "nBalanceInQuestion",
            "true"
          ],
          "line": 1712
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"checkwallet\\n\"\n      \"Wallet integrity check.\\n\""
          ],
          "line": 1705
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 1705
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue checkwallet(const Array& params, bool fHelp) {\n\n    if(fHelp || (params.size() > 0)) throw runtime_error(\n      \"checkwallet\\n\"\n      \"Wallet integrity check.\\n\");\n\n    int nMismatchSpent;\n    int nOrphansFound;\n    int64 nBalanceInQuestion;\n    pwalletMain->FixSpentCoins(nMismatchSpent, nOrphansFound, nBalanceInQuestion, true);\n    Object result;\n    if(!nMismatchSpent && !nOrphansFound) {\n        result.push_back(Pair(\"wallet check passed\", true));\n    } else {\n        if(nMismatchSpent) {\n            result.push_back(Pair(\"mismatched spent coins\", nMismatchSpent));\n            result.push_back(Pair(\"amount in question\", ValueFromAmount(nBalanceInQuestion)));\n        }\n        if(nOrphansFound) {\n            result.push_back(Pair(\"orphans found\", nOrphansFound));\n        }\n    }\n\n    return(result);\n}"
  },
  {
    "function_name": "reservebalance",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1664-1699",
    "snippet": "Value reservebalance(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 2)\n        throw runtime_error(\n            \"reservebalance [<reserve> [amount]]\\n\"\n            \"<reserve> is true or false to turn balance reserve on or off.\\n\"\n            \"<amount> is a real and rounded to cent.\\n\"\n            \"Set reserve amount not participating in network protection.\\n\"\n            \"If no parameters provided current setting is printed.\\n\");\n\n    if (params.size() > 0)\n    {\n        bool fReserve = params[0].get_bool();\n        if (fReserve)\n        {\n            if (params.size() == 1)\n                throw runtime_error(\"must provide amount to reserve balance.\\n\");\n            int64_t nAmount = AmountFromValue(params[1]);\n            nAmount = (nAmount / CENT) * CENT;  // round to cent\n            if (nAmount < 0)\n                throw runtime_error(\"amount cannot be negative.\\n\");\n            nReserveBalance = nAmount;\n        }\n        else\n        {\n            if (params.size() > 1)\n                throw runtime_error(\"cannot specify amount to turn off reserve.\\n\");\n            nReserveBalance = 0;\n        }\n    }\n\n    Object result;\n    result.push_back(Pair(\"reserve\", (nReserveBalance > 0)));\n    result.push_back(Pair(\"amount\", ValueFromAmount(nReserveBalance)));\n    return result;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"amount\", ValueFromAmount(nReserveBalance))"
          ],
          "line": 1697
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"amount\"",
            "ValueFromAmount(nReserveBalance)"
          ],
          "line": 1697
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ValueFromAmount",
          "args": [
            "nReserveBalance"
          ],
          "line": 1697
        },
        "resolved": true,
        "details": {
          "function_name": "ValueFromAmount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "113-116",
          "snippet": "Value ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nValue ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"reserve\", (nReserveBalance > 0))"
          ],
          "line": 1696
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"cannot specify amount to turn off reserve.\\n\""
          ],
          "line": 1690
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 1689
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"amount cannot be negative.\\n\""
          ],
          "line": 1684
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AmountFromValue",
          "args": [
            "params[1]"
          ],
          "line": 1681
        },
        "resolved": true,
        "details": {
          "function_name": "AmountFromValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "102-111",
          "snippet": "int64_t AmountFromValue(const Value& value)\n{\n    double dAmount = value.get_real();\n    if (dAmount <= 0.0 || dAmount > MAX_MONEY)\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    int64_t nAmount = roundint64(dAmount * COIN);\n    if (!MoneyRange(nAmount))\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    return nAmount;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nint64_t AmountFromValue(const Value& value)\n{\n    double dAmount = value.get_real();\n    if (dAmount <= 0.0 || dAmount > MAX_MONEY)\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    int64_t nAmount = roundint64(dAmount * COIN);\n    if (!MoneyRange(nAmount))\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    return nAmount;\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"must provide amount to reserve balance.\\n\""
          ],
          "line": 1680
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[0].get_bool",
          "args": [],
          "line": 1676
        },
        "resolved": true,
        "details": {
          "function_name": "get_bool",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "377-382",
          "snippet": "bool Value_impl< Config >::get_bool() const\n    {\n        check_type(  bool_type );\n\n        return boost::get< bool >( v_ );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  bool Value_impl< Config >::get_bool() const\n      {\n          check_type(  bool_type );\n  \n          return boost::get< bool >( v_ );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"reservebalance [<reserve> [amount]]\\n\"\n            \"<reserve> is true or false to turn balance reserve on or off.\\n\"\n            \"<amount> is a real and rounded to cent.\\n\"\n            \"Set reserve amount not participating in network protection.\\n\"\n            \"If no parameters provided current setting is printed.\\n\""
          ],
          "line": 1667
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue reservebalance(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 2)\n        throw runtime_error(\n            \"reservebalance [<reserve> [amount]]\\n\"\n            \"<reserve> is true or false to turn balance reserve on or off.\\n\"\n            \"<amount> is a real and rounded to cent.\\n\"\n            \"Set reserve amount not participating in network protection.\\n\"\n            \"If no parameters provided current setting is printed.\\n\");\n\n    if (params.size() > 0)\n    {\n        bool fReserve = params[0].get_bool();\n        if (fReserve)\n        {\n            if (params.size() == 1)\n                throw runtime_error(\"must provide amount to reserve balance.\\n\");\n            int64_t nAmount = AmountFromValue(params[1]);\n            nAmount = (nAmount / CENT) * CENT;  // round to cent\n            if (nAmount < 0)\n                throw runtime_error(\"amount cannot be negative.\\n\");\n            nReserveBalance = nAmount;\n        }\n        else\n        {\n            if (params.size() > 1)\n                throw runtime_error(\"cannot specify amount to turn off reserve.\\n\");\n            nReserveBalance = 0;\n        }\n    }\n\n    Object result;\n    result.push_back(Pair(\"reserve\", (nReserveBalance > 0)));\n    result.push_back(Pair(\"amount\", ValueFromAmount(nReserveBalance)));\n    return result;\n}"
  },
  {
    "function_name": "validatepubkey",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1626-1661",
    "snippet": "Value validatepubkey(const Array& params, bool fHelp)\n{\n    if (fHelp || !params.size() || params.size() > 2)\n        throw runtime_error(\n            \"validatepubkey <halcyonpubkey>\\n\"\n            \"Return information about <halcyonpubkey>.\");\n\n    std::vector<unsigned char> vchPubKey = ParseHex(params[0].get_str());\n    CPubKey pubKey(vchPubKey);\n\n    bool isValid = pubKey.IsValid();\n    bool isCompressed = pubKey.IsCompressed();\n    CKeyID keyID = pubKey.GetID();\n\n    CBitcoinAddress address;\n    address.Set(keyID);\n\n    Object ret;\n    ret.push_back(Pair(\"isvalid\", isValid));\n    if (isValid)\n    {\n        CTxDestination dest = address.Get();\n        string currentAddress = address.ToString();\n        ret.push_back(Pair(\"address\", currentAddress));\n        bool fMine = IsMine(*pwalletMain, dest);\n        ret.push_back(Pair(\"ismine\", fMine));\n        ret.push_back(Pair(\"iscompressed\", isCompressed));\n        if (fMine) {\n            Object detail = boost::apply_visitor(DescribeAddressVisitor(), dest);\n            ret.insert(ret.end(), detail.begin(), detail.end());\n        }\n        if (pwalletMain->mapAddressBook.count(dest))\n            ret.push_back(Pair(\"account\", pwalletMain->mapAddressBook[dest]));\n    }\n    return ret;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "Pair(\"account\", pwalletMain->mapAddressBook[dest])"
          ],
          "line": 1658
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"account\"",
            "pwalletMain->mapAddressBook[dest]"
          ],
          "line": 1658
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapAddressBook.count",
          "args": [
            "dest"
          ],
          "line": 1657
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ret.insert",
          "args": [
            "ret.end()",
            "detail.begin()",
            "detail.end()"
          ],
          "line": 1655
        },
        "resolved": true,
        "details": {
          "function_name": "insert",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "839-850",
          "snippet": "void insert(iterator it, const char* first, const char* last)\n    {\n        assert(last - first >= 0);\n        if (it == vch.begin() + nReadPos && (unsigned int)(last - first) <= nReadPos)\n        {\n            // special case for inserting at the front when there's room\n            nReadPos -= (last - first);\n            memcpy(&vch[nReadPos], &first[0], last - first);\n        }\n        else\n            vch.insert(it, first, last);\n    }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  void insert(iterator it, const char* first, const char* last)\n      {\n          assert(last - first >= 0);\n          if (it == vch.begin() + nReadPos && (unsigned int)(last - first) <= nReadPos)\n          {\n              // special case for inserting at the front when there's room\n              nReadPos -= (last - first);\n              memcpy(&vch[nReadPos], &first[0], last - first);\n          }\n          else\n              vch.insert(it, first, last);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "detail.end",
          "args": [],
          "line": 1655
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "detail.begin",
          "args": [],
          "line": 1655
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "boost::apply_visitor",
          "args": [
            "DescribeAddressVisitor()",
            "dest"
          ],
          "line": 1654
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DescribeAddressVisitor",
          "args": [],
          "line": 1654
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "Pair(\"iscompressed\", isCompressed)"
          ],
          "line": 1652
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "Pair(\"ismine\", fMine)"
          ],
          "line": 1651
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IsMine",
          "args": [
            "*pwalletMain",
            "dest"
          ],
          "line": 1650
        },
        "resolved": true,
        "details": {
          "function_name": "IsMine",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/script.cpp",
          "lines": "1551-1588",
          "snippet": "bool IsMine(const CKeyStore &keystore, const CScript& scriptPubKey)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    CKeyID keyID;\n    switch (whichType)\n    {\n    case TX_NONSTANDARD:\n        return false;\n    case TX_PUBKEY:\n        keyID = CPubKey(vSolutions[0]).GetID();\n        return keystore.HaveKey(keyID);\n    case TX_PUBKEYHASH:\n        keyID = CKeyID(uint160(vSolutions[0]));\n        return keystore.HaveKey(keyID);\n    case TX_SCRIPTHASH:\n    {\n        CScript subscript;\n        if (!keystore.GetCScript(CScriptID(uint160(vSolutions[0])), subscript))\n            return false;\n        return IsMine(keystore, subscript);\n    }\n    case TX_MULTISIG:\n    {\n        // Only consider transactions \"mine\" if we own ALL the\n        // keys involved. multi-signature transactions that are\n        // partially owned (somebody else has a key that can spend\n        // them) enable spend-out-from-under-you attacks, especially\n        // in shared-wallet situations.\n        vector<valtype> keys(vSolutions.begin()+1, vSolutions.begin()+vSolutions.size()-1);\n        return HaveKeys(keys, keystore) == keys.size();\n    }\n    }\n    return false;\n}",
          "includes": [
            "#include \"util.h\"",
            "#include \"sync.h\"",
            "#include \"main.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include \"keystore.h\"",
            "#include \"script.h\"",
            "#include <boost/tuple/tuple_comparison.hpp>",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/foreach.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"sync.h\"\n#include \"main.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include \"keystore.h\"\n#include \"script.h\"\n#include <boost/tuple/tuple_comparison.hpp>\n#include <boost/tuple/tuple.hpp>\n#include <boost/foreach.hpp>\n\nbool IsMine(const CKeyStore &keystore, const CScript& scriptPubKey)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    CKeyID keyID;\n    switch (whichType)\n    {\n    case TX_NONSTANDARD:\n        return false;\n    case TX_PUBKEY:\n        keyID = CPubKey(vSolutions[0]).GetID();\n        return keystore.HaveKey(keyID);\n    case TX_PUBKEYHASH:\n        keyID = CKeyID(uint160(vSolutions[0]));\n        return keystore.HaveKey(keyID);\n    case TX_SCRIPTHASH:\n    {\n        CScript subscript;\n        if (!keystore.GetCScript(CScriptID(uint160(vSolutions[0])), subscript))\n            return false;\n        return IsMine(keystore, subscript);\n    }\n    case TX_MULTISIG:\n    {\n        // Only consider transactions \"mine\" if we own ALL the\n        // keys involved. multi-signature transactions that are\n        // partially owned (somebody else has a key that can spend\n        // them) enable spend-out-from-under-you attacks, especially\n        // in shared-wallet situations.\n        vector<valtype> keys(vSolutions.begin()+1, vSolutions.begin()+vSolutions.size()-1);\n        return HaveKeys(keys, keystore) == keys.size();\n    }\n    }\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "Pair(\"address\", currentAddress)"
          ],
          "line": 1649
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "address.ToString",
          "args": [],
          "line": 1648
        },
        "resolved": true,
        "details": {
          "function_name": "ToString",
          "container": "CService",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "1172-1175",
          "snippet": "std::string CService::ToString() const\n{\n    return ToStringIPPort();\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCService {\n  std::string CService::ToString() const\n  {\n      return ToStringIPPort();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "address.Get",
          "args": [],
          "line": 1647
        },
        "resolved": true,
        "details": {
          "function_name": "Get",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "349-367",
          "snippet": "CTxDestination Get() const {\n        if (!IsValid())\n            return CNoDestination();\n        switch (nVersion) {\n        case PUBKEY_ADDRESS:\n        case PUBKEY_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            return CKeyID(id);\n        }\n        case SCRIPT_ADDRESS:\n        case SCRIPT_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            return CScriptID(id);\n        }\n        }\n        return CNoDestination();\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  CTxDestination Get() const {\n          if (!IsValid())\n              return CNoDestination();\n          switch (nVersion) {\n          case PUBKEY_ADDRESS:\n          case PUBKEY_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              return CKeyID(id);\n          }\n          case SCRIPT_ADDRESS:\n          case SCRIPT_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              return CScriptID(id);\n          }\n          }\n          return CNoDestination();\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "Pair(\"isvalid\", isValid)"
          ],
          "line": 1644
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "address.Set",
          "args": [
            "keyID"
          ],
          "line": 1641
        },
        "resolved": true,
        "details": {
          "function_name": "Set",
          "container": "CBlockLocator",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "1590-1605",
          "snippet": "void Set(const CBlockIndex* pindex)\n    {\n        vHave.clear();\n        int nStep = 1;\n        while (pindex)\n        {\n            vHave.push_back(pindex->GetBlockHash());\n\n            // Exponentially larger steps back\n            for (int i = 0; pindex && i < nStep; i++)\n                pindex = pindex->pprev;\n            if (vHave.size() > 10)\n                nStep *= 2;\n        }\n        vHave.push_back((!fTestNet ? hashGenesisBlock : hashGenesisBlockTestNet));\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCBlockLocator {\n  void Set(const CBlockIndex* pindex)\n      {\n          vHave.clear();\n          int nStep = 1;\n          while (pindex)\n          {\n              vHave.push_back(pindex->GetBlockHash());\n  \n              // Exponentially larger steps back\n              for (int i = 0; pindex && i < nStep; i++)\n                  pindex = pindex->pprev;\n              if (vHave.size() > 10)\n                  nStep *= 2;\n          }\n          vHave.push_back((!fTestNet ? hashGenesisBlock : hashGenesisBlockTestNet));\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pubKey.GetID",
          "args": [],
          "line": 1638
        },
        "resolved": true,
        "details": {
          "function_name": "GetID",
          "container": "CPubKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.h",
          "lines": "80-82",
          "snippet": "CKeyID GetID() const {\n        return CKeyID(Hash160(vchPubKey));\n    }",
          "includes": [
            "#include <openssl/ec.h> // for EC_KEY definition",
            "#include \"util.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\"",
            "#include \"allocators.h\"",
            "#include <vector>",
            "#include <stdexcept>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <openssl/ec.h> // for EC_KEY definition\n#include \"util.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n#include \"allocators.h\"\n#include <vector>\n#include <stdexcept>\n\nCPubKey {\n  CKeyID GetID() const {\n          return CKeyID(Hash160(vchPubKey));\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pubKey.IsCompressed",
          "args": [],
          "line": 1637
        },
        "resolved": true,
        "details": {
          "function_name": "IsCompressed",
          "container": "CPubKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.h",
          "lines": "92-94",
          "snippet": "bool IsCompressed() const {\n        return vchPubKey.size() == 33;\n    }",
          "includes": [
            "#include <openssl/ec.h> // for EC_KEY definition",
            "#include \"util.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\"",
            "#include \"allocators.h\"",
            "#include <vector>",
            "#include <stdexcept>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <openssl/ec.h> // for EC_KEY definition\n#include \"util.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n#include \"allocators.h\"\n#include <vector>\n#include <stdexcept>\n\nCPubKey {\n  bool IsCompressed() const {\n          return vchPubKey.size() == 33;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pubKey.IsValid",
          "args": [],
          "line": 1636
        },
        "resolved": true,
        "details": {
          "function_name": "IsValid",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "725-759",
          "snippet": "bool CNetAddr::IsValid() const\n{\n    // Cleanup 3-byte shifted addresses caused by garbage in size field\n    // of addr messages from versions before 0.2.9 checksum.\n    // Two consecutive addr messages look like this:\n    // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n    // so if the first length field is garbled, it reads the second batch\n    // of addr misaligned by 3 bytes.\n    if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n        return false;\n\n    // unspecified IPv6 address (::/128)\n    unsigned char ipNone[16] = {};\n    if (memcmp(ip, ipNone, 16) == 0)\n        return false;\n\n    // documentation IPv6 address\n    if (IsRFC3849())\n        return false;\n\n    if (IsIPv4())\n    {\n        // INADDR_NONE\n        uint32_t ipNone = INADDR_NONE;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n\n        // 0\n        ipNone = 0;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n    }\n\n    return true;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nstatic const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };\n\nCNetAddr {\n  bool CNetAddr::IsValid() const\n  {\n      // Cleanup 3-byte shifted addresses caused by garbage in size field\n      // of addr messages from versions before 0.2.9 checksum.\n      // Two consecutive addr messages look like this:\n      // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n      // so if the first length field is garbled, it reads the second batch\n      // of addr misaligned by 3 bytes.\n      if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n          return false;\n  \n      // unspecified IPv6 address (::/128)\n      unsigned char ipNone[16] = {};\n      if (memcmp(ip, ipNone, 16) == 0)\n          return false;\n  \n      // documentation IPv6 address\n      if (IsRFC3849())\n          return false;\n  \n      if (IsIPv4())\n      {\n          // INADDR_NONE\n          uint32_t ipNone = INADDR_NONE;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n  \n          // 0\n          ipNone = 0;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n      }\n  \n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ParseHex",
          "args": [
            "params[0].get_str()"
          ],
          "line": 1633
        },
        "resolved": true,
        "details": {
          "function_name": "ParseHex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "490-493",
          "snippet": "vector<unsigned char> ParseHex(const string& str)\n{\n    return ParseHex(str.c_str());\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nvector<unsigned char> ParseHex(const string& str)\n{\n    return ParseHex(str.c_str());\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 1633
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"validatepubkey <halcyonpubkey>\\n\"\n            \"Return information about <halcyonpubkey>.\""
          ],
          "line": 1629
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 1628
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue validatepubkey(const Array& params, bool fHelp)\n{\n    if (fHelp || !params.size() || params.size() > 2)\n        throw runtime_error(\n            \"validatepubkey <halcyonpubkey>\\n\"\n            \"Return information about <halcyonpubkey>.\");\n\n    std::vector<unsigned char> vchPubKey = ParseHex(params[0].get_str());\n    CPubKey pubKey(vchPubKey);\n\n    bool isValid = pubKey.IsValid();\n    bool isCompressed = pubKey.IsCompressed();\n    CKeyID keyID = pubKey.GetID();\n\n    CBitcoinAddress address;\n    address.Set(keyID);\n\n    Object ret;\n    ret.push_back(Pair(\"isvalid\", isValid));\n    if (isValid)\n    {\n        CTxDestination dest = address.Get();\n        string currentAddress = address.ToString();\n        ret.push_back(Pair(\"address\", currentAddress));\n        bool fMine = IsMine(*pwalletMain, dest);\n        ret.push_back(Pair(\"ismine\", fMine));\n        ret.push_back(Pair(\"iscompressed\", isCompressed));\n        if (fMine) {\n            Object detail = boost::apply_visitor(DescribeAddressVisitor(), dest);\n            ret.insert(ret.end(), detail.begin(), detail.end());\n        }\n        if (pwalletMain->mapAddressBook.count(dest))\n            ret.push_back(Pair(\"account\", pwalletMain->mapAddressBook[dest]));\n    }\n    return ret;\n}"
  },
  {
    "function_name": "validateaddress",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1597-1624",
    "snippet": "Value validateaddress(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 1)\n        throw runtime_error(\n            \"validateaddress <halcyonaddress>\\n\"\n            \"Return information about <halcyonaddress>.\");\n\n    CBitcoinAddress address(params[0].get_str());\n    bool isValid = address.IsValid();\n\n    Object ret;\n    ret.push_back(Pair(\"isvalid\", isValid));\n    if (isValid)\n    {\n        CTxDestination dest = address.Get();\n        string currentAddress = address.ToString();\n        ret.push_back(Pair(\"address\", currentAddress));\n        bool fMine = IsMine(*pwalletMain, dest);\n        ret.push_back(Pair(\"ismine\", fMine));\n        if (fMine) {\n            Object detail = boost::apply_visitor(DescribeAddressVisitor(), dest);\n            ret.insert(ret.end(), detail.begin(), detail.end());\n        }\n        if (pwalletMain->mapAddressBook.count(dest))\n            ret.push_back(Pair(\"account\", pwalletMain->mapAddressBook[dest]));\n    }\n    return ret;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "Pair(\"account\", pwalletMain->mapAddressBook[dest])"
          ],
          "line": 1621
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"account\"",
            "pwalletMain->mapAddressBook[dest]"
          ],
          "line": 1621
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapAddressBook.count",
          "args": [
            "dest"
          ],
          "line": 1620
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ret.insert",
          "args": [
            "ret.end()",
            "detail.begin()",
            "detail.end()"
          ],
          "line": 1618
        },
        "resolved": true,
        "details": {
          "function_name": "insert",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "839-850",
          "snippet": "void insert(iterator it, const char* first, const char* last)\n    {\n        assert(last - first >= 0);\n        if (it == vch.begin() + nReadPos && (unsigned int)(last - first) <= nReadPos)\n        {\n            // special case for inserting at the front when there's room\n            nReadPos -= (last - first);\n            memcpy(&vch[nReadPos], &first[0], last - first);\n        }\n        else\n            vch.insert(it, first, last);\n    }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  void insert(iterator it, const char* first, const char* last)\n      {\n          assert(last - first >= 0);\n          if (it == vch.begin() + nReadPos && (unsigned int)(last - first) <= nReadPos)\n          {\n              // special case for inserting at the front when there's room\n              nReadPos -= (last - first);\n              memcpy(&vch[nReadPos], &first[0], last - first);\n          }\n          else\n              vch.insert(it, first, last);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "detail.end",
          "args": [],
          "line": 1618
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "detail.begin",
          "args": [],
          "line": 1618
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "boost::apply_visitor",
          "args": [
            "DescribeAddressVisitor()",
            "dest"
          ],
          "line": 1617
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DescribeAddressVisitor",
          "args": [],
          "line": 1617
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "Pair(\"ismine\", fMine)"
          ],
          "line": 1615
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IsMine",
          "args": [
            "*pwalletMain",
            "dest"
          ],
          "line": 1614
        },
        "resolved": true,
        "details": {
          "function_name": "IsMine",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/script.cpp",
          "lines": "1551-1588",
          "snippet": "bool IsMine(const CKeyStore &keystore, const CScript& scriptPubKey)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    CKeyID keyID;\n    switch (whichType)\n    {\n    case TX_NONSTANDARD:\n        return false;\n    case TX_PUBKEY:\n        keyID = CPubKey(vSolutions[0]).GetID();\n        return keystore.HaveKey(keyID);\n    case TX_PUBKEYHASH:\n        keyID = CKeyID(uint160(vSolutions[0]));\n        return keystore.HaveKey(keyID);\n    case TX_SCRIPTHASH:\n    {\n        CScript subscript;\n        if (!keystore.GetCScript(CScriptID(uint160(vSolutions[0])), subscript))\n            return false;\n        return IsMine(keystore, subscript);\n    }\n    case TX_MULTISIG:\n    {\n        // Only consider transactions \"mine\" if we own ALL the\n        // keys involved. multi-signature transactions that are\n        // partially owned (somebody else has a key that can spend\n        // them) enable spend-out-from-under-you attacks, especially\n        // in shared-wallet situations.\n        vector<valtype> keys(vSolutions.begin()+1, vSolutions.begin()+vSolutions.size()-1);\n        return HaveKeys(keys, keystore) == keys.size();\n    }\n    }\n    return false;\n}",
          "includes": [
            "#include \"util.h\"",
            "#include \"sync.h\"",
            "#include \"main.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include \"keystore.h\"",
            "#include \"script.h\"",
            "#include <boost/tuple/tuple_comparison.hpp>",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/foreach.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"sync.h\"\n#include \"main.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include \"keystore.h\"\n#include \"script.h\"\n#include <boost/tuple/tuple_comparison.hpp>\n#include <boost/tuple/tuple.hpp>\n#include <boost/foreach.hpp>\n\nbool IsMine(const CKeyStore &keystore, const CScript& scriptPubKey)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    CKeyID keyID;\n    switch (whichType)\n    {\n    case TX_NONSTANDARD:\n        return false;\n    case TX_PUBKEY:\n        keyID = CPubKey(vSolutions[0]).GetID();\n        return keystore.HaveKey(keyID);\n    case TX_PUBKEYHASH:\n        keyID = CKeyID(uint160(vSolutions[0]));\n        return keystore.HaveKey(keyID);\n    case TX_SCRIPTHASH:\n    {\n        CScript subscript;\n        if (!keystore.GetCScript(CScriptID(uint160(vSolutions[0])), subscript))\n            return false;\n        return IsMine(keystore, subscript);\n    }\n    case TX_MULTISIG:\n    {\n        // Only consider transactions \"mine\" if we own ALL the\n        // keys involved. multi-signature transactions that are\n        // partially owned (somebody else has a key that can spend\n        // them) enable spend-out-from-under-you attacks, especially\n        // in shared-wallet situations.\n        vector<valtype> keys(vSolutions.begin()+1, vSolutions.begin()+vSolutions.size()-1);\n        return HaveKeys(keys, keystore) == keys.size();\n    }\n    }\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "Pair(\"address\", currentAddress)"
          ],
          "line": 1613
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "address.ToString",
          "args": [],
          "line": 1612
        },
        "resolved": true,
        "details": {
          "function_name": "ToString",
          "container": "CService",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "1172-1175",
          "snippet": "std::string CService::ToString() const\n{\n    return ToStringIPPort();\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCService {\n  std::string CService::ToString() const\n  {\n      return ToStringIPPort();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "address.Get",
          "args": [],
          "line": 1611
        },
        "resolved": true,
        "details": {
          "function_name": "Get",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "349-367",
          "snippet": "CTxDestination Get() const {\n        if (!IsValid())\n            return CNoDestination();\n        switch (nVersion) {\n        case PUBKEY_ADDRESS:\n        case PUBKEY_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            return CKeyID(id);\n        }\n        case SCRIPT_ADDRESS:\n        case SCRIPT_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            return CScriptID(id);\n        }\n        }\n        return CNoDestination();\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  CTxDestination Get() const {\n          if (!IsValid())\n              return CNoDestination();\n          switch (nVersion) {\n          case PUBKEY_ADDRESS:\n          case PUBKEY_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              return CKeyID(id);\n          }\n          case SCRIPT_ADDRESS:\n          case SCRIPT_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              return CScriptID(id);\n          }\n          }\n          return CNoDestination();\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "Pair(\"isvalid\", isValid)"
          ],
          "line": 1608
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "address.IsValid",
          "args": [],
          "line": 1605
        },
        "resolved": true,
        "details": {
          "function_name": "IsValid",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "725-759",
          "snippet": "bool CNetAddr::IsValid() const\n{\n    // Cleanup 3-byte shifted addresses caused by garbage in size field\n    // of addr messages from versions before 0.2.9 checksum.\n    // Two consecutive addr messages look like this:\n    // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n    // so if the first length field is garbled, it reads the second batch\n    // of addr misaligned by 3 bytes.\n    if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n        return false;\n\n    // unspecified IPv6 address (::/128)\n    unsigned char ipNone[16] = {};\n    if (memcmp(ip, ipNone, 16) == 0)\n        return false;\n\n    // documentation IPv6 address\n    if (IsRFC3849())\n        return false;\n\n    if (IsIPv4())\n    {\n        // INADDR_NONE\n        uint32_t ipNone = INADDR_NONE;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n\n        // 0\n        ipNone = 0;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n    }\n\n    return true;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nstatic const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };\n\nCNetAddr {\n  bool CNetAddr::IsValid() const\n  {\n      // Cleanup 3-byte shifted addresses caused by garbage in size field\n      // of addr messages from versions before 0.2.9 checksum.\n      // Two consecutive addr messages look like this:\n      // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n      // so if the first length field is garbled, it reads the second batch\n      // of addr misaligned by 3 bytes.\n      if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n          return false;\n  \n      // unspecified IPv6 address (::/128)\n      unsigned char ipNone[16] = {};\n      if (memcmp(ip, ipNone, 16) == 0)\n          return false;\n  \n      // documentation IPv6 address\n      if (IsRFC3849())\n          return false;\n  \n      if (IsIPv4())\n      {\n          // INADDR_NONE\n          uint32_t ipNone = INADDR_NONE;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n  \n          // 0\n          ipNone = 0;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n      }\n  \n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 1604
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"validateaddress <halcyonaddress>\\n\"\n            \"Return information about <halcyonaddress>.\""
          ],
          "line": 1600
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 1599
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue validateaddress(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 1)\n        throw runtime_error(\n            \"validateaddress <halcyonaddress>\\n\"\n            \"Return information about <halcyonaddress>.\");\n\n    CBitcoinAddress address(params[0].get_str());\n    bool isValid = address.IsValid();\n\n    Object ret;\n    ret.push_back(Pair(\"isvalid\", isValid));\n    if (isValid)\n    {\n        CTxDestination dest = address.Get();\n        string currentAddress = address.ToString();\n        ret.push_back(Pair(\"address\", currentAddress));\n        bool fMine = IsMine(*pwalletMain, dest);\n        ret.push_back(Pair(\"ismine\", fMine));\n        if (fMine) {\n            Object detail = boost::apply_visitor(DescribeAddressVisitor(), dest);\n            ret.insert(ret.end(), detail.begin(), detail.end());\n        }\n        if (pwalletMain->mapAddressBook.count(dest))\n            ret.push_back(Pair(\"account\", pwalletMain->mapAddressBook[dest]));\n    }\n    return ret;\n}"
  },
  {
    "function_name": "encryptwallet",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1529-1559",
    "snippet": "Value encryptwallet(const Array& params, bool fHelp)\n{\n    if (!pwalletMain->IsCrypted() && (fHelp || params.size() != 1))\n        throw runtime_error(\n            \"encryptwallet <passphrase>\\n\"\n            \"Encrypts the wallet with <passphrase>.\");\n    if (fHelp)\n        return true;\n    if (pwalletMain->IsCrypted())\n        throw JSONRPCError(RPC_WALLET_WRONG_ENC_STATE, \"Error: running with an encrypted wallet, but encryptwallet was called.\");\n\n    // TODO: get rid of this .c_str() by implementing SecureString::operator=(std::string)\n    // Alternately, find a way to make params[0] mlock()'d to begin with.\n    SecureString strWalletPass;\n    strWalletPass.reserve(100);\n    strWalletPass = params[0].get_str().c_str();\n\n    if (strWalletPass.length() < 1)\n        throw runtime_error(\n            \"encryptwallet <passphrase>\\n\"\n            \"Encrypts the wallet with <passphrase>.\");\n\n    if (!pwalletMain->EncryptWallet(strWalletPass))\n        throw JSONRPCError(RPC_WALLET_ENCRYPTION_FAILED, \"Error: Failed to encrypt the wallet.\");\n\n    // BDB seems to have a bad habit of writing old data into\n    // slack space in .dat files; that is bad if the old data is\n    // unencrypted private keys. So:\n    StartShutdown();\n    return \"wallet encrypted; Halcyon server stopping, restart to run with encrypted wallet.  The keypool has been flushed, you need to make a new backup.\";\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "StartShutdown",
          "args": [],
          "line": 1557
        },
        "resolved": true,
        "details": {
          "function_name": "StartShutdown",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/init.cpp",
          "lines": "52-61",
          "snippet": "void StartShutdown()\n{\n#ifdef QT_GUI\n    // ensure we leave the Qt main loop for a clean GUI exit (Shutdown() is called in bitcoin.cpp afterwards)\n    uiInterface.QueueShutdown();\n#else\n    // Without UI, Shutdown() can simply be started in a new thread\n    NewThread(Shutdown, NULL);\n#endif\n}",
          "includes": [
            "#include <signal.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/algorithm/string/predicate.hpp>",
            "#include <boost/interprocess/sync/file_lock.hpp>",
            "#include <boost/filesystem/convenience.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include \"checkpoints.h\"",
            "#include \"ui_interface.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"txdb.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "CClientUIInterface uiInterface;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <signal.h>\n#include <openssl/crypto.h>\n#include <boost/algorithm/string/predicate.hpp>\n#include <boost/interprocess/sync/file_lock.hpp>\n#include <boost/filesystem/convenience.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"checkpoints.h\"\n#include \"ui_interface.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"txdb.h\"\n\nCClientUIInterface uiInterface;\n\nvoid StartShutdown()\n{\n#ifdef QT_GUI\n    // ensure we leave the Qt main loop for a clean GUI exit (Shutdown() is called in bitcoin.cpp afterwards)\n    uiInterface.QueueShutdown();\n#else\n    // Without UI, Shutdown() can simply be started in a new thread\n    NewThread(Shutdown, NULL);\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_WALLET_ENCRYPTION_FAILED",
            "\"Error: Failed to encrypt the wallet.\""
          ],
          "line": 1552
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->EncryptWallet",
          "args": [
            "strWalletPass"
          ],
          "line": 1551
        },
        "resolved": true,
        "details": {
          "function_name": "EncryptWallet",
          "container": "CWallet",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.cpp",
          "lines": "246-325",
          "snippet": "bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n{\n    if (IsCrypted())\n        return false;\n\n    CKeyingMaterial vMasterKey;\n    RandAddSeedPerfmon();\n\n    vMasterKey.resize(WALLET_CRYPTO_KEY_SIZE);\n    RAND_bytes(&vMasterKey[0], WALLET_CRYPTO_KEY_SIZE);\n\n    CMasterKey kMasterKey(nDerivationMethodIndex);\n\n    RandAddSeedPerfmon();\n    kMasterKey.vchSalt.resize(WALLET_CRYPTO_SALT_SIZE);\n    RAND_bytes(&kMasterKey.vchSalt[0], WALLET_CRYPTO_SALT_SIZE);\n\n    CCrypter crypter;\n    int64_t nStartTime = GetTimeMillis();\n    crypter.SetKeyFromPassphrase(strWalletPassphrase, kMasterKey.vchSalt, 25000, kMasterKey.nDerivationMethod);\n    kMasterKey.nDeriveIterations = 2500000 / ((double)(GetTimeMillis() - nStartTime));\n\n    nStartTime = GetTimeMillis();\n    crypter.SetKeyFromPassphrase(strWalletPassphrase, kMasterKey.vchSalt, kMasterKey.nDeriveIterations, kMasterKey.nDerivationMethod);\n    kMasterKey.nDeriveIterations = (kMasterKey.nDeriveIterations + kMasterKey.nDeriveIterations * 100 / ((double)(GetTimeMillis() - nStartTime))) / 2;\n\n    if (kMasterKey.nDeriveIterations < 25000)\n        kMasterKey.nDeriveIterations = 25000;\n\n    printf(\"Encrypting Wallet with an nDeriveIterations of %i\\n\", kMasterKey.nDeriveIterations);\n\n    if (!crypter.SetKeyFromPassphrase(strWalletPassphrase, kMasterKey.vchSalt, kMasterKey.nDeriveIterations, kMasterKey.nDerivationMethod))\n        return false;\n    if (!crypter.Encrypt(vMasterKey, kMasterKey.vchCryptedKey))\n        return false;\n\n    {\n        LOCK(cs_wallet);\n        mapMasterKeys[++nMasterKeyMaxID] = kMasterKey;\n        if (fFileBacked)\n        {\n            pwalletdbEncryption = new CWalletDB(strWalletFile);\n            if (!pwalletdbEncryption->TxnBegin())\n                return false;\n            pwalletdbEncryption->WriteMasterKey(nMasterKeyMaxID, kMasterKey);\n        }\n\n        if (!EncryptKeys(vMasterKey))\n        {\n            if (fFileBacked)\n                pwalletdbEncryption->TxnAbort();\n            exit(1); //We now probably have half of our keys encrypted in memory, and half not...die and let the user reload their unencrypted wallet.\n        }\n\n        // Encryption was introduced in version 0.4.0\n        SetMinVersion(FEATURE_WALLETCRYPT, pwalletdbEncryption, true);\n\n        if (fFileBacked)\n        {\n            if (!pwalletdbEncryption->TxnCommit())\n                exit(1); //We now have keys encrypted in memory, but no on disk...die to avoid confusion and let the user reload their unencrypted wallet.\n\n            delete pwalletdbEncryption;\n            pwalletdbEncryption = NULL;\n        }\n\n        Lock();\n        Unlock(strWalletPassphrase);\n        NewKeyPool();\n        Lock();\n\n        // Need to completely rewrite the wallet file; if we don't, bdb might keep\n        // bits of the unencrypted private key in slack space in the database file.\n        CDB::Rewrite(strWalletFile);\n\n    }\n    NotifyStatusChanged(this);\n\n    return true;\n}",
          "includes": [
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"coincontrol.h\"",
            "#include \"kernel.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"crypter.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\"",
            "#include \"txdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/replace.hpp>\n#include \"coincontrol.h\"\n#include \"kernel.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"crypter.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n#include \"txdb.h\"\n\nCWallet {\n  bool CWallet::EncryptWallet(const SecureString& strWalletPassphrase)\n  {\n      if (IsCrypted())\n          return false;\n  \n      CKeyingMaterial vMasterKey;\n      RandAddSeedPerfmon();\n  \n      vMasterKey.resize(WALLET_CRYPTO_KEY_SIZE);\n      RAND_bytes(&vMasterKey[0], WALLET_CRYPTO_KEY_SIZE);\n  \n      CMasterKey kMasterKey(nDerivationMethodIndex);\n  \n      RandAddSeedPerfmon();\n      kMasterKey.vchSalt.resize(WALLET_CRYPTO_SALT_SIZE);\n      RAND_bytes(&kMasterKey.vchSalt[0], WALLET_CRYPTO_SALT_SIZE);\n  \n      CCrypter crypter;\n      int64_t nStartTime = GetTimeMillis();\n      crypter.SetKeyFromPassphrase(strWalletPassphrase, kMasterKey.vchSalt, 25000, kMasterKey.nDerivationMethod);\n      kMasterKey.nDeriveIterations = 2500000 / ((double)(GetTimeMillis() - nStartTime));\n  \n      nStartTime = GetTimeMillis();\n      crypter.SetKeyFromPassphrase(strWalletPassphrase, kMasterKey.vchSalt, kMasterKey.nDeriveIterations, kMasterKey.nDerivationMethod);\n      kMasterKey.nDeriveIterations = (kMasterKey.nDeriveIterations + kMasterKey.nDeriveIterations * 100 / ((double)(GetTimeMillis() - nStartTime))) / 2;\n  \n      if (kMasterKey.nDeriveIterations < 25000)\n          kMasterKey.nDeriveIterations = 25000;\n  \n      printf(\"Encrypting Wallet with an nDeriveIterations of %i\\n\", kMasterKey.nDeriveIterations);\n  \n      if (!crypter.SetKeyFromPassphrase(strWalletPassphrase, kMasterKey.vchSalt, kMasterKey.nDeriveIterations, kMasterKey.nDerivationMethod))\n          return false;\n      if (!crypter.Encrypt(vMasterKey, kMasterKey.vchCryptedKey))\n          return false;\n  \n      {\n          LOCK(cs_wallet);\n          mapMasterKeys[++nMasterKeyMaxID] = kMasterKey;\n          if (fFileBacked)\n          {\n              pwalletdbEncryption = new CWalletDB(strWalletFile);\n              if (!pwalletdbEncryption->TxnBegin())\n                  return false;\n              pwalletdbEncryption->WriteMasterKey(nMasterKeyMaxID, kMasterKey);\n          }\n  \n          if (!EncryptKeys(vMasterKey))\n          {\n              if (fFileBacked)\n                  pwalletdbEncryption->TxnAbort();\n              exit(1); //We now probably have half of our keys encrypted in memory, and half not...die and let the user reload their unencrypted wallet.\n          }\n  \n          // Encryption was introduced in version 0.4.0\n          SetMinVersion(FEATURE_WALLETCRYPT, pwalletdbEncryption, true);\n  \n          if (fFileBacked)\n          {\n              if (!pwalletdbEncryption->TxnCommit())\n                  exit(1); //We now have keys encrypted in memory, but no on disk...die to avoid confusion and let the user reload their unencrypted wallet.\n  \n              delete pwalletdbEncryption;\n              pwalletdbEncryption = NULL;\n          }\n  \n          Lock();\n          Unlock(strWalletPassphrase);\n          NewKeyPool();\n          Lock();\n  \n          // Need to completely rewrite the wallet file; if we don't, bdb might keep\n          // bits of the unencrypted private key in slack space in the database file.\n          CDB::Rewrite(strWalletFile);\n  \n      }\n      NotifyStatusChanged(this);\n  \n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"encryptwallet <passphrase>\\n\"\n            \"Encrypts the wallet with <passphrase>.\""
          ],
          "line": 1547
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strWalletPass.length",
          "args": [],
          "line": 1546
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 1544
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 1544
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strWalletPass.reserve",
          "args": [
            "100"
          ],
          "line": 1543
        },
        "resolved": true,
        "details": {
          "function_name": "reserve",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "805-805",
          "snippet": "void reserve(size_type n)                        { vch.reserve(n + nReadPos); }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  void reserve(size_type n)                        { vch.reserve(n + nReadPos); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->IsCrypted",
          "args": [],
          "line": 1537
        },
        "resolved": true,
        "details": {
          "function_name": "IsCrypted",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "129-132",
          "snippet": "bool IsCrypted() const\n    {\n        return fUseCrypto;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool IsCrypted() const\n      {\n          return fUseCrypto;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"encryptwallet <passphrase>\\n\"\n            \"Encrypts the wallet with <passphrase>.\""
          ],
          "line": 1532
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 1531
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue encryptwallet(const Array& params, bool fHelp)\n{\n    if (!pwalletMain->IsCrypted() && (fHelp || params.size() != 1))\n        throw runtime_error(\n            \"encryptwallet <passphrase>\\n\"\n            \"Encrypts the wallet with <passphrase>.\");\n    if (fHelp)\n        return true;\n    if (pwalletMain->IsCrypted())\n        throw JSONRPCError(RPC_WALLET_WRONG_ENC_STATE, \"Error: running with an encrypted wallet, but encryptwallet was called.\");\n\n    // TODO: get rid of this .c_str() by implementing SecureString::operator=(std::string)\n    // Alternately, find a way to make params[0] mlock()'d to begin with.\n    SecureString strWalletPass;\n    strWalletPass.reserve(100);\n    strWalletPass = params[0].get_str().c_str();\n\n    if (strWalletPass.length() < 1)\n        throw runtime_error(\n            \"encryptwallet <passphrase>\\n\"\n            \"Encrypts the wallet with <passphrase>.\");\n\n    if (!pwalletMain->EncryptWallet(strWalletPass))\n        throw JSONRPCError(RPC_WALLET_ENCRYPTION_FAILED, \"Error: Failed to encrypt the wallet.\");\n\n    // BDB seems to have a bad habit of writing old data into\n    // slack space in .dat files; that is bad if the old data is\n    // unencrypted private keys. So:\n    StartShutdown();\n    return \"wallet encrypted; Halcyon server stopping, restart to run with encrypted wallet.  The keypool has been flushed, you need to make a new backup.\";\n}"
  },
  {
    "function_name": "walletlock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1506-1526",
    "snippet": "Value walletlock(const Array& params, bool fHelp)\n{\n    if (pwalletMain->IsCrypted() && (fHelp || params.size() != 0))\n        throw runtime_error(\n            \"walletlock\\n\"\n            \"Removes the wallet encryption key from memory, locking the wallet.\\n\"\n            \"After calling this method, you will need to call walletpassphrase again\\n\"\n            \"before being able to call any methods which require the wallet to be unlocked.\");\n    if (fHelp)\n        return true;\n    if (!pwalletMain->IsCrypted())\n        throw JSONRPCError(RPC_WALLET_WRONG_ENC_STATE, \"Error: running with an unencrypted wallet, but walletlock was called.\");\n\n    {\n        LOCK(cs_nWalletUnlockTime);\n        pwalletMain->Lock();\n        nWalletUnlockTime = 0;\n    }\n\n    return Value::null;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int64_t nWalletUnlockTime;",
      "static CCriticalSection cs_nWalletUnlockTime;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "pwalletMain->Lock",
          "args": [],
          "line": 1521
        },
        "resolved": true,
        "details": {
          "function_name": "Lock",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.cpp",
          "lines": "76-88",
          "snippet": "bool CCryptoKeyStore::Lock()\n{\n    if (!SetCrypted())\n        return false;\n\n    {\n        LOCK(cs_KeyStore);\n        vMasterKey.clear();\n    }\n\n    NotifyStatusChanged(this);\n    return true;\n}",
          "includes": [
            "#include \"script.h\"",
            "#include \"keystore.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"keystore.h\"\n\nCCryptoKeyStore {\n  bool CCryptoKeyStore::Lock()\n  {\n      if (!SetCrypted())\n          return false;\n  \n      {\n          LOCK(cs_KeyStore);\n          vMasterKey.clear();\n      }\n  \n      NotifyStatusChanged(this);\n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "cs_nWalletUnlockTime"
          ],
          "line": 1520
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_WALLET_WRONG_ENC_STATE",
            "\"Error: running with an unencrypted wallet, but walletlock was called.\""
          ],
          "line": 1517
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->IsCrypted",
          "args": [],
          "line": 1516
        },
        "resolved": true,
        "details": {
          "function_name": "IsCrypted",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "129-132",
          "snippet": "bool IsCrypted() const\n    {\n        return fUseCrypto;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool IsCrypted() const\n      {\n          return fUseCrypto;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"walletlock\\n\"\n            \"Removes the wallet encryption key from memory, locking the wallet.\\n\"\n            \"After calling this method, you will need to call walletpassphrase again\\n\"\n            \"before being able to call any methods which require the wallet to be unlocked.\""
          ],
          "line": 1509
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 1508
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nint64_t nWalletUnlockTime;\nstatic CCriticalSection cs_nWalletUnlockTime;\n\nValue walletlock(const Array& params, bool fHelp)\n{\n    if (pwalletMain->IsCrypted() && (fHelp || params.size() != 0))\n        throw runtime_error(\n            \"walletlock\\n\"\n            \"Removes the wallet encryption key from memory, locking the wallet.\\n\"\n            \"After calling this method, you will need to call walletpassphrase again\\n\"\n            \"before being able to call any methods which require the wallet to be unlocked.\");\n    if (fHelp)\n        return true;\n    if (!pwalletMain->IsCrypted())\n        throw JSONRPCError(RPC_WALLET_WRONG_ENC_STATE, \"Error: running with an unencrypted wallet, but walletlock was called.\");\n\n    {\n        LOCK(cs_nWalletUnlockTime);\n        pwalletMain->Lock();\n        nWalletUnlockTime = 0;\n    }\n\n    return Value::null;\n}"
  },
  {
    "function_name": "walletpassphrasechange",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1473-1503",
    "snippet": "Value walletpassphrasechange(const Array& params, bool fHelp)\n{\n    if (pwalletMain->IsCrypted() && (fHelp || params.size() != 2))\n        throw runtime_error(\n            \"walletpassphrasechange <oldpassphrase> <newpassphrase>\\n\"\n            \"Changes the wallet passphrase from <oldpassphrase> to <newpassphrase>.\");\n    if (fHelp)\n        return true;\n    if (!pwalletMain->IsCrypted())\n        throw JSONRPCError(RPC_WALLET_WRONG_ENC_STATE, \"Error: running with an unencrypted wallet, but walletpassphrasechange was called.\");\n\n    // TODO: get rid of these .c_str() calls by implementing SecureString::operator=(std::string)\n    // Alternately, find a way to make params[0] mlock()'d to begin with.\n    SecureString strOldWalletPass;\n    strOldWalletPass.reserve(100);\n    strOldWalletPass = params[0].get_str().c_str();\n\n    SecureString strNewWalletPass;\n    strNewWalletPass.reserve(100);\n    strNewWalletPass = params[1].get_str().c_str();\n\n    if (strOldWalletPass.length() < 1 || strNewWalletPass.length() < 1)\n        throw runtime_error(\n            \"walletpassphrasechange <oldpassphrase> <newpassphrase>\\n\"\n            \"Changes the wallet passphrase from <oldpassphrase> to <newpassphrase>.\");\n\n    if (!pwalletMain->ChangeWalletPassphrase(strOldWalletPass, strNewWalletPass))\n        throw JSONRPCError(RPC_WALLET_PASSPHRASE_INCORRECT, \"Error: The wallet passphrase entered was incorrect.\");\n\n    return Value::null;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_WALLET_PASSPHRASE_INCORRECT",
            "\"Error: The wallet passphrase entered was incorrect.\""
          ],
          "line": 1500
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->ChangeWalletPassphrase",
          "args": [
            "strOldWalletPass",
            "strNewWalletPass"
          ],
          "line": 1499
        },
        "resolved": true,
        "details": {
          "function_name": "ChangeWalletPassphrase",
          "container": "CWallet",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.cpp",
          "lines": "138-182",
          "snippet": "bool CWallet::ChangeWalletPassphrase(const SecureString& strOldWalletPassphrase, const SecureString& strNewWalletPassphrase)\n{\n    bool fWasLocked = IsLocked();\n\n    {\n        LOCK(cs_wallet);\n        Lock();\n\n        CCrypter crypter;\n        CKeyingMaterial vMasterKey;\n        BOOST_FOREACH(MasterKeyMap::value_type& pMasterKey, mapMasterKeys)\n        {\n            if(!crypter.SetKeyFromPassphrase(strOldWalletPassphrase, pMasterKey.second.vchSalt, pMasterKey.second.nDeriveIterations, pMasterKey.second.nDerivationMethod))\n                return false;\n            if (!crypter.Decrypt(pMasterKey.second.vchCryptedKey, vMasterKey))\n                return false;\n            if (CCryptoKeyStore::Unlock(vMasterKey))\n            {\n                int64_t nStartTime = GetTimeMillis();\n                crypter.SetKeyFromPassphrase(strNewWalletPassphrase, pMasterKey.second.vchSalt, pMasterKey.second.nDeriveIterations, pMasterKey.second.nDerivationMethod);\n                pMasterKey.second.nDeriveIterations = pMasterKey.second.nDeriveIterations * (100 / ((double)(GetTimeMillis() - nStartTime)));\n\n                nStartTime = GetTimeMillis();\n                crypter.SetKeyFromPassphrase(strNewWalletPassphrase, pMasterKey.second.vchSalt, pMasterKey.second.nDeriveIterations, pMasterKey.second.nDerivationMethod);\n                pMasterKey.second.nDeriveIterations = (pMasterKey.second.nDeriveIterations + pMasterKey.second.nDeriveIterations * 100 / ((double)(GetTimeMillis() - nStartTime))) / 2;\n\n                if (pMasterKey.second.nDeriveIterations < 25000)\n                    pMasterKey.second.nDeriveIterations = 25000;\n\n                printf(\"Wallet passphrase changed to an nDeriveIterations of %i\\n\", pMasterKey.second.nDeriveIterations);\n\n                if (!crypter.SetKeyFromPassphrase(strNewWalletPassphrase, pMasterKey.second.vchSalt, pMasterKey.second.nDeriveIterations, pMasterKey.second.nDerivationMethod))\n                    return false;\n                if (!crypter.Encrypt(vMasterKey, pMasterKey.second.vchCryptedKey))\n                    return false;\n                CWalletDB(strWalletFile).WriteMasterKey(pMasterKey.first, pMasterKey.second);\n                if (fWasLocked)\n                    Lock();\n                return true;\n            }\n        }\n    }\n\n    return false;\n}",
          "includes": [
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"coincontrol.h\"",
            "#include \"kernel.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"crypter.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\"",
            "#include \"txdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/replace.hpp>\n#include \"coincontrol.h\"\n#include \"kernel.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"crypter.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n#include \"txdb.h\"\n\nCWallet {\n  bool CWallet::ChangeWalletPassphrase(const SecureString& strOldWalletPassphrase, const SecureString& strNewWalletPassphrase)\n  {\n      bool fWasLocked = IsLocked();\n  \n      {\n          LOCK(cs_wallet);\n          Lock();\n  \n          CCrypter crypter;\n          CKeyingMaterial vMasterKey;\n          BOOST_FOREACH(MasterKeyMap::value_type& pMasterKey, mapMasterKeys)\n          {\n              if(!crypter.SetKeyFromPassphrase(strOldWalletPassphrase, pMasterKey.second.vchSalt, pMasterKey.second.nDeriveIterations, pMasterKey.second.nDerivationMethod))\n                  return false;\n              if (!crypter.Decrypt(pMasterKey.second.vchCryptedKey, vMasterKey))\n                  return false;\n              if (CCryptoKeyStore::Unlock(vMasterKey))\n              {\n                  int64_t nStartTime = GetTimeMillis();\n                  crypter.SetKeyFromPassphrase(strNewWalletPassphrase, pMasterKey.second.vchSalt, pMasterKey.second.nDeriveIterations, pMasterKey.second.nDerivationMethod);\n                  pMasterKey.second.nDeriveIterations = pMasterKey.second.nDeriveIterations * (100 / ((double)(GetTimeMillis() - nStartTime)));\n  \n                  nStartTime = GetTimeMillis();\n                  crypter.SetKeyFromPassphrase(strNewWalletPassphrase, pMasterKey.second.vchSalt, pMasterKey.second.nDeriveIterations, pMasterKey.second.nDerivationMethod);\n                  pMasterKey.second.nDeriveIterations = (pMasterKey.second.nDeriveIterations + pMasterKey.second.nDeriveIterations * 100 / ((double)(GetTimeMillis() - nStartTime))) / 2;\n  \n                  if (pMasterKey.second.nDeriveIterations < 25000)\n                      pMasterKey.second.nDeriveIterations = 25000;\n  \n                  printf(\"Wallet passphrase changed to an nDeriveIterations of %i\\n\", pMasterKey.second.nDeriveIterations);\n  \n                  if (!crypter.SetKeyFromPassphrase(strNewWalletPassphrase, pMasterKey.second.vchSalt, pMasterKey.second.nDeriveIterations, pMasterKey.second.nDerivationMethod))\n                      return false;\n                  if (!crypter.Encrypt(vMasterKey, pMasterKey.second.vchCryptedKey))\n                      return false;\n                  CWalletDB(strWalletFile).WriteMasterKey(pMasterKey.first, pMasterKey.second);\n                  if (fWasLocked)\n                      Lock();\n                  return true;\n              }\n          }\n      }\n  \n      return false;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"walletpassphrasechange <oldpassphrase> <newpassphrase>\\n\"\n            \"Changes the wallet passphrase from <oldpassphrase> to <newpassphrase>.\""
          ],
          "line": 1495
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strNewWalletPass.length",
          "args": [],
          "line": 1494
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strOldWalletPass.length",
          "args": [],
          "line": 1494
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[1].get_str",
          "args": [],
          "line": 1492
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[1].get_str",
          "args": [],
          "line": 1492
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strNewWalletPass.reserve",
          "args": [
            "100"
          ],
          "line": 1491
        },
        "resolved": true,
        "details": {
          "function_name": "reserve",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "805-805",
          "snippet": "void reserve(size_type n)                        { vch.reserve(n + nReadPos); }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  void reserve(size_type n)                        { vch.reserve(n + nReadPos); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 1488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 1488
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->IsCrypted",
          "args": [],
          "line": 1481
        },
        "resolved": true,
        "details": {
          "function_name": "IsCrypted",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "129-132",
          "snippet": "bool IsCrypted() const\n    {\n        return fUseCrypto;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool IsCrypted() const\n      {\n          return fUseCrypto;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"walletpassphrasechange <oldpassphrase> <newpassphrase>\\n\"\n            \"Changes the wallet passphrase from <oldpassphrase> to <newpassphrase>.\""
          ],
          "line": 1476
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 1475
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue walletpassphrasechange(const Array& params, bool fHelp)\n{\n    if (pwalletMain->IsCrypted() && (fHelp || params.size() != 2))\n        throw runtime_error(\n            \"walletpassphrasechange <oldpassphrase> <newpassphrase>\\n\"\n            \"Changes the wallet passphrase from <oldpassphrase> to <newpassphrase>.\");\n    if (fHelp)\n        return true;\n    if (!pwalletMain->IsCrypted())\n        throw JSONRPCError(RPC_WALLET_WRONG_ENC_STATE, \"Error: running with an unencrypted wallet, but walletpassphrasechange was called.\");\n\n    // TODO: get rid of these .c_str() calls by implementing SecureString::operator=(std::string)\n    // Alternately, find a way to make params[0] mlock()'d to begin with.\n    SecureString strOldWalletPass;\n    strOldWalletPass.reserve(100);\n    strOldWalletPass = params[0].get_str().c_str();\n\n    SecureString strNewWalletPass;\n    strNewWalletPass.reserve(100);\n    strNewWalletPass = params[1].get_str().c_str();\n\n    if (strOldWalletPass.length() < 1 || strNewWalletPass.length() < 1)\n        throw runtime_error(\n            \"walletpassphrasechange <oldpassphrase> <newpassphrase>\\n\"\n            \"Changes the wallet passphrase from <oldpassphrase> to <newpassphrase>.\");\n\n    if (!pwalletMain->ChangeWalletPassphrase(strOldWalletPass, strNewWalletPass))\n        throw JSONRPCError(RPC_WALLET_PASSPHRASE_INCORRECT, \"Error: The wallet passphrase entered was incorrect.\");\n\n    return Value::null;\n}"
  },
  {
    "function_name": "walletpassphrase",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1428-1470",
    "snippet": "Value walletpassphrase(const Array& params, bool fHelp)\n{\n    if (pwalletMain->IsCrypted() && (fHelp || params.size() < 2 || params.size() > 3))\n        throw runtime_error(\n            \"walletpassphrase <passphrase> <timeout> [stakingonly]\\n\"\n            \"Stores the wallet decryption key in memory for <timeout> seconds.\\n\"\n            \"if [stakingonly] is true sending functions are disabled.\");\n    if (fHelp)\n        return true;\n    if (!pwalletMain->IsCrypted())\n        throw JSONRPCError(RPC_WALLET_WRONG_ENC_STATE, \"Error: running with an unencrypted wallet, but walletpassphrase was called.\");\n\n    if (!pwalletMain->IsLocked())\n        throw JSONRPCError(RPC_WALLET_ALREADY_UNLOCKED, \"Error: Wallet is already unlocked, use walletlock first if need to change unlock settings.\");\n    // Note that the walletpassphrase is stored in params[0] which is not mlock()ed\n    SecureString strWalletPass;\n    strWalletPass.reserve(100);\n    // TODO: get rid of this .c_str() by implementing SecureString::operator=(std::string)\n    // Alternately, find a way to make params[0] mlock()'d to begin with.\n    strWalletPass = params[0].get_str().c_str();\n\n    if (strWalletPass.length() > 0)\n    {\n        if (!pwalletMain->Unlock(strWalletPass))\n            throw JSONRPCError(RPC_WALLET_PASSPHRASE_INCORRECT, \"Error: The wallet passphrase entered was incorrect.\");\n    }\n    else\n        throw runtime_error(\n            \"walletpassphrase <passphrase> <timeout>\\n\"\n            \"Stores the wallet decryption key in memory for <timeout> seconds.\");\n\n    NewThread(ThreadTopUpKeyPool, NULL);\n    int64_t* pnSleepTime = new int64_t(params[1].get_int64());\n    NewThread(ThreadCleanWalletPassphrase, pnSleepTime);\n\n    // ppcoin: if user OS account compromised prevent trivial sendmoney commands\n    if (params.size() > 2)\n        fWalletUnlockStakingOnly = params[2].get_bool();\n    else\n        fWalletUnlockStakingOnly = false;\n\n    return Value::null;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "params[2].get_bool",
          "args": [],
          "line": 1465
        },
        "resolved": true,
        "details": {
          "function_name": "get_bool",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "377-382",
          "snippet": "bool Value_impl< Config >::get_bool() const\n    {\n        check_type(  bool_type );\n\n        return boost::get< bool >( v_ );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  bool Value_impl< Config >::get_bool() const\n      {\n          check_type(  bool_type );\n  \n          return boost::get< bool >( v_ );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 1464
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "NewThread",
          "args": [
            "ThreadCleanWalletPassphrase",
            "pnSleepTime"
          ],
          "line": 1461
        },
        "resolved": true,
        "details": {
          "function_name": "NewThread",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "1350-1360",
          "snippet": "bool NewThread(void(*pfn)(void*), void* parg)\n{\n    try\n    {\n        boost::thread(pfn, parg); // thread detaches when out of scope\n    } catch(boost::thread_resource_error &e) {\n        printf(\"Error creating thread: %s\\n\", e.what());\n        return false;\n    }\n    return true;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nbool NewThread(void(*pfn)(void*), void* parg)\n{\n    try\n    {\n        boost::thread(pfn, parg); // thread detaches when out of scope\n    } catch(boost::thread_resource_error &e) {\n        printf(\"Error creating thread: %s\\n\", e.what());\n        return false;\n    }\n    return true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[1].get_int64",
          "args": [],
          "line": 1460
        },
        "resolved": true,
        "details": {
          "function_name": "get_int64",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "393-398",
          "snippet": "boost::int64_t Value_impl< Config >::get_int64() const\n    {\n        check_type(  int_type );\n\n        return boost::get< boost::int64_t >( v_ );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  boost::int64_t Value_impl< Config >::get_int64() const\n      {\n          check_type(  int_type );\n  \n          return boost::get< boost::int64_t >( v_ );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"walletpassphrase <passphrase> <timeout>\\n\"\n            \"Stores the wallet decryption key in memory for <timeout> seconds.\""
          ],
          "line": 1455
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_WALLET_PASSPHRASE_INCORRECT",
            "\"Error: The wallet passphrase entered was incorrect.\""
          ],
          "line": 1452
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->Unlock",
          "args": [
            "strWalletPass"
          ],
          "line": 1451
        },
        "resolved": true,
        "details": {
          "function_name": "Unlock",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.cpp",
          "lines": "90-118",
          "snippet": "bool CCryptoKeyStore::Unlock(const CKeyingMaterial& vMasterKeyIn)\n{\n    {\n        LOCK(cs_KeyStore);\n        if (!SetCrypted())\n            return false;\n\n        CryptedKeyMap::const_iterator mi = mapCryptedKeys.begin();\n        for (; mi != mapCryptedKeys.end(); ++mi)\n        {\n            const CPubKey &vchPubKey = (*mi).second.first;\n            const std::vector<unsigned char> &vchCryptedSecret = (*mi).second.second;\n            CSecret vchSecret;\n            if(!DecryptSecret(vMasterKeyIn, vchCryptedSecret, vchPubKey.GetHash(), vchSecret))\n                return false;\n            if (vchSecret.size() != 32)\n                return false;\n            CKey key;\n            key.SetPubKey(vchPubKey);\n            key.SetSecret(vchSecret);\n            if (key.GetPubKey() == vchPubKey)\n                break;\n            return false;\n        }\n        vMasterKey = vMasterKeyIn;\n    }\n    NotifyStatusChanged(this);\n    return true;\n}",
          "includes": [
            "#include \"script.h\"",
            "#include \"keystore.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"keystore.h\"\n\nCCryptoKeyStore {\n  bool CCryptoKeyStore::Unlock(const CKeyingMaterial& vMasterKeyIn)\n  {\n      {\n          LOCK(cs_KeyStore);\n          if (!SetCrypted())\n              return false;\n  \n          CryptedKeyMap::const_iterator mi = mapCryptedKeys.begin();\n          for (; mi != mapCryptedKeys.end(); ++mi)\n          {\n              const CPubKey &vchPubKey = (*mi).second.first;\n              const std::vector<unsigned char> &vchCryptedSecret = (*mi).second.second;\n              CSecret vchSecret;\n              if(!DecryptSecret(vMasterKeyIn, vchCryptedSecret, vchPubKey.GetHash(), vchSecret))\n                  return false;\n              if (vchSecret.size() != 32)\n                  return false;\n              CKey key;\n              key.SetPubKey(vchPubKey);\n              key.SetSecret(vchSecret);\n              if (key.GetPubKey() == vchPubKey)\n                  break;\n              return false;\n          }\n          vMasterKey = vMasterKeyIn;\n      }\n      NotifyStatusChanged(this);\n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "strWalletPass.length",
          "args": [],
          "line": 1449
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 1447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 1447
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strWalletPass.reserve",
          "args": [
            "100"
          ],
          "line": 1444
        },
        "resolved": true,
        "details": {
          "function_name": "reserve",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "805-805",
          "snippet": "void reserve(size_type n)                        { vch.reserve(n + nReadPos); }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  void reserve(size_type n)                        { vch.reserve(n + nReadPos); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->IsLocked",
          "args": [],
          "line": 1440
        },
        "resolved": true,
        "details": {
          "function_name": "IsLocked",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "134-144",
          "snippet": "bool IsLocked() const\n    {\n        if (!IsCrypted())\n            return false;\n        bool result;\n        {\n            LOCK(cs_KeyStore);\n            result = vMasterKey.empty();\n        }\n        return result;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool IsLocked() const\n      {\n          if (!IsCrypted())\n              return false;\n          bool result;\n          {\n              LOCK(cs_KeyStore);\n              result = vMasterKey.empty();\n          }\n          return result;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->IsCrypted",
          "args": [],
          "line": 1437
        },
        "resolved": true,
        "details": {
          "function_name": "IsCrypted",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "129-132",
          "snippet": "bool IsCrypted() const\n    {\n        return fUseCrypto;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool IsCrypted() const\n      {\n          return fUseCrypto;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"walletpassphrase <passphrase> <timeout> [stakingonly]\\n\"\n            \"Stores the wallet decryption key in memory for <timeout> seconds.\\n\"\n            \"if [stakingonly] is true sending functions are disabled.\""
          ],
          "line": 1431
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue walletpassphrase(const Array& params, bool fHelp)\n{\n    if (pwalletMain->IsCrypted() && (fHelp || params.size() < 2 || params.size() > 3))\n        throw runtime_error(\n            \"walletpassphrase <passphrase> <timeout> [stakingonly]\\n\"\n            \"Stores the wallet decryption key in memory for <timeout> seconds.\\n\"\n            \"if [stakingonly] is true sending functions are disabled.\");\n    if (fHelp)\n        return true;\n    if (!pwalletMain->IsCrypted())\n        throw JSONRPCError(RPC_WALLET_WRONG_ENC_STATE, \"Error: running with an unencrypted wallet, but walletpassphrase was called.\");\n\n    if (!pwalletMain->IsLocked())\n        throw JSONRPCError(RPC_WALLET_ALREADY_UNLOCKED, \"Error: Wallet is already unlocked, use walletlock first if need to change unlock settings.\");\n    // Note that the walletpassphrase is stored in params[0] which is not mlock()ed\n    SecureString strWalletPass;\n    strWalletPass.reserve(100);\n    // TODO: get rid of this .c_str() by implementing SecureString::operator=(std::string)\n    // Alternately, find a way to make params[0] mlock()'d to begin with.\n    strWalletPass = params[0].get_str().c_str();\n\n    if (strWalletPass.length() > 0)\n    {\n        if (!pwalletMain->Unlock(strWalletPass))\n            throw JSONRPCError(RPC_WALLET_PASSPHRASE_INCORRECT, \"Error: The wallet passphrase entered was incorrect.\");\n    }\n    else\n        throw runtime_error(\n            \"walletpassphrase <passphrase> <timeout>\\n\"\n            \"Stores the wallet decryption key in memory for <timeout> seconds.\");\n\n    NewThread(ThreadTopUpKeyPool, NULL);\n    int64_t* pnSleepTime = new int64_t(params[1].get_int64());\n    NewThread(ThreadCleanWalletPassphrase, pnSleepTime);\n\n    // ppcoin: if user OS account compromised prevent trivial sendmoney commands\n    if (params.size() > 2)\n        fWalletUnlockStakingOnly = params[2].get_bool();\n    else\n        fWalletUnlockStakingOnly = false;\n\n    return Value::null;\n}"
  },
  {
    "function_name": "ThreadCleanWalletPassphrase",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1384-1426",
    "snippet": "void ThreadCleanWalletPassphrase(void* parg)\n{\n    // Make this thread recognisable as the wallet relocking thread\n    RenameThread(\"hal-lock-wa\");\n\n    int64_t nMyWakeTime = GetTimeMillis() + *((int64_t*)parg) * 1000;\n\n    ENTER_CRITICAL_SECTION(cs_nWalletUnlockTime);\n\n    if (nWalletUnlockTime == 0)\n    {\n        nWalletUnlockTime = nMyWakeTime;\n\n        do\n        {\n            if (nWalletUnlockTime==0)\n                break;\n            int64_t nToSleep = nWalletUnlockTime - GetTimeMillis();\n            if (nToSleep <= 0)\n                break;\n\n            LEAVE_CRITICAL_SECTION(cs_nWalletUnlockTime);\n            MilliSleep(nToSleep);\n            ENTER_CRITICAL_SECTION(cs_nWalletUnlockTime);\n\n        } while(1);\n\n        if (nWalletUnlockTime)\n        {\n            nWalletUnlockTime = 0;\n            pwalletMain->Lock();\n        }\n    }\n    else\n    {\n        if (nWalletUnlockTime < nMyWakeTime)\n            nWalletUnlockTime = nMyWakeTime;\n    }\n\n    LEAVE_CRITICAL_SECTION(cs_nWalletUnlockTime);\n\n    delete (int64_t*)parg;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int64_t nWalletUnlockTime;",
      "static CCriticalSection cs_nWalletUnlockTime;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "LEAVE_CRITICAL_SECTION",
          "args": [
            "cs_nWalletUnlockTime"
          ],
          "line": 1423
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->Lock",
          "args": [],
          "line": 1414
        },
        "resolved": true,
        "details": {
          "function_name": "Lock",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.cpp",
          "lines": "76-88",
          "snippet": "bool CCryptoKeyStore::Lock()\n{\n    if (!SetCrypted())\n        return false;\n\n    {\n        LOCK(cs_KeyStore);\n        vMasterKey.clear();\n    }\n\n    NotifyStatusChanged(this);\n    return true;\n}",
          "includes": [
            "#include \"script.h\"",
            "#include \"keystore.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"keystore.h\"\n\nCCryptoKeyStore {\n  bool CCryptoKeyStore::Lock()\n  {\n      if (!SetCrypted())\n          return false;\n  \n      {\n          LOCK(cs_KeyStore);\n          vMasterKey.clear();\n      }\n  \n      NotifyStatusChanged(this);\n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ENTER_CRITICAL_SECTION",
          "args": [
            "cs_nWalletUnlockTime"
          ],
          "line": 1407
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MilliSleep",
          "args": [
            "nToSleep"
          ],
          "line": 1406
        },
        "resolved": true,
        "details": {
          "function_name": "MilliSleep",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.h",
          "lines": "132-139",
          "snippet": "inline void MilliSleep(int64_t n)\n{\n#if BOOST_VERSION >= 105000\n    boost::this_thread::sleep_for(boost::chrono::milliseconds(n));\n#else\n    boost::this_thread::sleep(boost::posix_time::milliseconds(n));\n#endif\n}",
          "includes": [
            "#include <inttypes.h>",
            "#include <stdint.h>",
            "#include \"netbase.h\" // for AddTimeData",
            "#include <openssl/ripemd.h>",
            "#include <openssl/sha.h>",
            "#include <boost/date_time/posix_time/posix_time_types.hpp>",
            "#include <boost/date_time/gregorian/gregorian_types.hpp>",
            "#include <boost/filesystem/path.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/thread.hpp>",
            "#include <string>",
            "#include <vector>",
            "#include <map>",
            "#include <sys/resource.h>",
            "#include <sys/time.h>",
            "#include <sys/types.h>",
            "#include \"uint256.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <inttypes.h>\n#include <stdint.h>\n#include \"netbase.h\" // for AddTimeData\n#include <openssl/ripemd.h>\n#include <openssl/sha.h>\n#include <boost/date_time/posix_time/posix_time_types.hpp>\n#include <boost/date_time/gregorian/gregorian_types.hpp>\n#include <boost/filesystem/path.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/thread.hpp>\n#include <string>\n#include <vector>\n#include <map>\n#include <sys/resource.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include \"uint256.h\"\n\ninline void MilliSleep(int64_t n)\n{\n#if BOOST_VERSION >= 105000\n    boost::this_thread::sleep_for(boost::chrono::milliseconds(n));\n#else\n    boost::this_thread::sleep(boost::posix_time::milliseconds(n));\n#endif\n}"
        }
      },
      {
        "call_info": {
          "callee": "LEAVE_CRITICAL_SECTION",
          "args": [
            "cs_nWalletUnlockTime"
          ],
          "line": 1405
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetTimeMillis",
          "args": [],
          "line": 1401
        },
        "resolved": true,
        "details": {
          "function_name": "GetTimeMillis",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.h",
          "lines": "370-374",
          "snippet": "inline int64_t GetTimeMillis()\n{\n    return (boost::posix_time::ptime(boost::posix_time::microsec_clock::universal_time()) -\n            boost::posix_time::ptime(boost::gregorian::date(1970,1,1))).total_milliseconds();\n}",
          "includes": [
            "#include <inttypes.h>",
            "#include <stdint.h>",
            "#include \"netbase.h\" // for AddTimeData",
            "#include <openssl/ripemd.h>",
            "#include <openssl/sha.h>",
            "#include <boost/date_time/posix_time/posix_time_types.hpp>",
            "#include <boost/date_time/gregorian/gregorian_types.hpp>",
            "#include <boost/filesystem/path.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/thread.hpp>",
            "#include <string>",
            "#include <vector>",
            "#include <map>",
            "#include <sys/resource.h>",
            "#include <sys/time.h>",
            "#include <sys/types.h>",
            "#include \"uint256.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <inttypes.h>\n#include <stdint.h>\n#include \"netbase.h\" // for AddTimeData\n#include <openssl/ripemd.h>\n#include <openssl/sha.h>\n#include <boost/date_time/posix_time/posix_time_types.hpp>\n#include <boost/date_time/gregorian/gregorian_types.hpp>\n#include <boost/filesystem/path.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/thread.hpp>\n#include <string>\n#include <vector>\n#include <map>\n#include <sys/resource.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include \"uint256.h\"\n\ninline int64_t GetTimeMillis()\n{\n    return (boost::posix_time::ptime(boost::posix_time::microsec_clock::universal_time()) -\n            boost::posix_time::ptime(boost::gregorian::date(1970,1,1))).total_milliseconds();\n}"
        }
      },
      {
        "call_info": {
          "callee": "ENTER_CRITICAL_SECTION",
          "args": [
            "cs_nWalletUnlockTime"
          ],
          "line": 1391
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "RenameThread",
          "args": [
            "\"hal-lock-wa\""
          ],
          "line": 1387
        },
        "resolved": true,
        "details": {
          "function_name": "RenameThread",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "1329-1348",
          "snippet": "void RenameThread(const char* name)\n{\n#if defined(PR_SET_NAME)\n    // Only the first 15 characters are used (16 - NUL terminator)\n    ::prctl(PR_SET_NAME, name, 0, 0, 0);\n#elif 0 && (defined(__FreeBSD__) || defined(__OpenBSD__))\n    // TODO: This is currently disabled because it needs to be verified to work\n    //       on FreeBSD or OpenBSD first. When verified the '0 &&' part can be\n    //       removed.\n    pthread_set_name_np(pthread_self(), name);\n\n// This is XCode 10.6-and-later; bring back if we drop 10.5 support:\n// #elif defined(MAC_OSX)\n//    pthread_setname_np(name);\n\n#else\n    // Prevent warnings for unused parameters...\n    (void)name;\n#endif\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nvoid RenameThread(const char* name)\n{\n#if defined(PR_SET_NAME)\n    // Only the first 15 characters are used (16 - NUL terminator)\n    ::prctl(PR_SET_NAME, name, 0, 0, 0);\n#elif 0 && (defined(__FreeBSD__) || defined(__OpenBSD__))\n    // TODO: This is currently disabled because it needs to be verified to work\n    //       on FreeBSD or OpenBSD first. When verified the '0 &&' part can be\n    //       removed.\n    pthread_set_name_np(pthread_self(), name);\n\n// This is XCode 10.6-and-later; bring back if we drop 10.5 support:\n// #elif defined(MAC_OSX)\n//    pthread_setname_np(name);\n\n#else\n    // Prevent warnings for unused parameters...\n    (void)name;\n#endif\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nint64_t nWalletUnlockTime;\nstatic CCriticalSection cs_nWalletUnlockTime;\n\nvoid ThreadCleanWalletPassphrase(void* parg)\n{\n    // Make this thread recognisable as the wallet relocking thread\n    RenameThread(\"hal-lock-wa\");\n\n    int64_t nMyWakeTime = GetTimeMillis() + *((int64_t*)parg) * 1000;\n\n    ENTER_CRITICAL_SECTION(cs_nWalletUnlockTime);\n\n    if (nWalletUnlockTime == 0)\n    {\n        nWalletUnlockTime = nMyWakeTime;\n\n        do\n        {\n            if (nWalletUnlockTime==0)\n                break;\n            int64_t nToSleep = nWalletUnlockTime - GetTimeMillis();\n            if (nToSleep <= 0)\n                break;\n\n            LEAVE_CRITICAL_SECTION(cs_nWalletUnlockTime);\n            MilliSleep(nToSleep);\n            ENTER_CRITICAL_SECTION(cs_nWalletUnlockTime);\n\n        } while(1);\n\n        if (nWalletUnlockTime)\n        {\n            nWalletUnlockTime = 0;\n            pwalletMain->Lock();\n        }\n    }\n    else\n    {\n        if (nWalletUnlockTime < nMyWakeTime)\n            nWalletUnlockTime = nMyWakeTime;\n    }\n\n    LEAVE_CRITICAL_SECTION(cs_nWalletUnlockTime);\n\n    delete (int64_t*)parg;\n}"
  },
  {
    "function_name": "ThreadTopUpKeyPool",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1376-1382",
    "snippet": "void ThreadTopUpKeyPool(void* parg)\n{\n    // Make this thread recognisable as the key-topping-up thread\n    RenameThread(\"hal-key-top\");\n\n    pwalletMain->TopUpKeyPool();\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pwalletMain->TopUpKeyPool",
          "args": [],
          "line": 1381
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "RenameThread",
          "args": [
            "\"hal-key-top\""
          ],
          "line": 1379
        },
        "resolved": true,
        "details": {
          "function_name": "RenameThread",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "1329-1348",
          "snippet": "void RenameThread(const char* name)\n{\n#if defined(PR_SET_NAME)\n    // Only the first 15 characters are used (16 - NUL terminator)\n    ::prctl(PR_SET_NAME, name, 0, 0, 0);\n#elif 0 && (defined(__FreeBSD__) || defined(__OpenBSD__))\n    // TODO: This is currently disabled because it needs to be verified to work\n    //       on FreeBSD or OpenBSD first. When verified the '0 &&' part can be\n    //       removed.\n    pthread_set_name_np(pthread_self(), name);\n\n// This is XCode 10.6-and-later; bring back if we drop 10.5 support:\n// #elif defined(MAC_OSX)\n//    pthread_setname_np(name);\n\n#else\n    // Prevent warnings for unused parameters...\n    (void)name;\n#endif\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nvoid RenameThread(const char* name)\n{\n#if defined(PR_SET_NAME)\n    // Only the first 15 characters are used (16 - NUL terminator)\n    ::prctl(PR_SET_NAME, name, 0, 0, 0);\n#elif 0 && (defined(__FreeBSD__) || defined(__OpenBSD__))\n    // TODO: This is currently disabled because it needs to be verified to work\n    //       on FreeBSD or OpenBSD first. When verified the '0 &&' part can be\n    //       removed.\n    pthread_set_name_np(pthread_self(), name);\n\n// This is XCode 10.6-and-later; bring back if we drop 10.5 support:\n// #elif defined(MAC_OSX)\n//    pthread_setname_np(name);\n\n#else\n    // Prevent warnings for unused parameters...\n    (void)name;\n#endif\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nvoid ThreadTopUpKeyPool(void* parg)\n{\n    // Make this thread recognisable as the key-topping-up thread\n    RenameThread(\"hal-key-top\");\n\n    pwalletMain->TopUpKeyPool();\n}"
  },
  {
    "function_name": "keypoolrefill",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1350-1373",
    "snippet": "Value keypoolrefill(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 1)\n        throw runtime_error(\n            \"keypoolrefill [new-size]\\n\"\n            \"Fills the keypool.\"\n            + HelpRequiringPassphrase());\n\n    unsigned int nSize = max(GetArg(\"-keypool\", 100), (int64_t)0);\n    if (params.size() > 0) {\n        if (params[0].get_int() < 0)\n            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid parameter, expected valid size\");\n        nSize = (unsigned int) params[0].get_int();\n    }\n\n    EnsureWalletIsUnlocked();\n\n    pwalletMain->TopUpKeyPool(nSize);\n\n    if (pwalletMain->GetKeyPoolSize() < nSize)\n        throw JSONRPCError(RPC_WALLET_ERROR, \"Error refreshing keypool.\");\n\n    return Value::null;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_WALLET_ERROR",
            "\"Error refreshing keypool.\""
          ],
          "line": 1370
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->GetKeyPoolSize",
          "args": [],
          "line": 1369
        },
        "resolved": true,
        "details": {
          "function_name": "GetKeyPoolSize",
          "container": "CWallet",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.h",
          "lines": "296-299",
          "snippet": "unsigned int GetKeyPoolSize()\n    {\n        return setKeyPool.size();\n    }",
          "includes": [
            "#include \"walletdb.h\"",
            "#include \"util.h\"",
            "#include \"ui_interface.h\"",
            "#include \"script.h\"",
            "#include \"keystore.h\"",
            "#include \"key.h\"",
            "#include \"main.h\"",
            "#include <stdlib.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"walletdb.h\"\n#include \"util.h\"\n#include \"ui_interface.h\"\n#include \"script.h\"\n#include \"keystore.h\"\n#include \"key.h\"\n#include \"main.h\"\n#include <stdlib.h>\n#include <vector>\n#include <string>\n\nCWallet {\n  unsigned int GetKeyPoolSize()\n      {\n          return setKeyPool.size();\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->TopUpKeyPool",
          "args": [
            "nSize"
          ],
          "line": 1367
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EnsureWalletIsUnlocked",
          "args": [],
          "line": 1365
        },
        "resolved": true,
        "details": {
          "function_name": "EnsureWalletIsUnlocked",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "41-47",
          "snippet": "void EnsureWalletIsUnlocked()\n{\n    if (pwalletMain->IsLocked())\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Please enter the wallet passphrase with walletpassphrase first.\");\n    if (fWalletUnlockStakingOnly)\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Wallet is unlocked for staking only.\");\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nvoid EnsureWalletIsUnlocked()\n{\n    if (pwalletMain->IsLocked())\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Please enter the wallet passphrase with walletpassphrase first.\");\n    if (fWalletUnlockStakingOnly)\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Wallet is unlocked for staking only.\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_int",
          "args": [],
          "line": 1362
        },
        "resolved": true,
        "details": {
          "function_name": "get_int",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "385-390",
          "snippet": "int Value_impl< Config >::get_int() const\n    {\n        check_type(  int_type );\n\n        return static_cast< int >( get_int64() );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  int Value_impl< Config >::get_int() const\n      {\n          check_type(  int_type );\n  \n          return static_cast< int >( get_int64() );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 1359
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "max",
          "args": [
            "GetArg(\"-keypool\", 100)",
            "(int64_t)0"
          ],
          "line": 1358
        },
        "resolved": true,
        "details": {
          "function_name": "leveldb_options_set_max_open_files",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/db/c.cc",
          "lines": "433-435",
          "snippet": "void leveldb_options_set_max_open_files(leveldb_options_t* opt, int n) {\n  opt->rep.max_open_files = n;\n}",
          "includes": [
            "#include \"leveldb/write_batch.h\"",
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/options.h\"",
            "#include \"leveldb/iterator.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"leveldb/db.h\"",
            "#include \"leveldb/comparator.h\"",
            "#include \"leveldb/cache.h\"",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include \"leveldb/c.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/write_batch.h\"\n#include \"leveldb/status.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/iterator.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/db.h\"\n#include \"leveldb/comparator.h\"\n#include \"leveldb/cache.h\"\n#include <unistd.h>\n#include <stdlib.h>\n#include \"leveldb/c.h\"\n\nvoid leveldb_options_set_max_open_files(leveldb_options_t* opt, int n) {\n  opt->rep.max_open_files = n;\n}"
        }
      },
      {
        "call_info": {
          "callee": "GetArg",
          "args": [
            "\"-keypool\"",
            "100"
          ],
          "line": 1358
        },
        "resolved": true,
        "details": {
          "function_name": "GetArg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "562-567",
          "snippet": "int64_t GetArg(const std::string& strArg, int64_t nDefault)\n{\n    if (mapArgs.count(strArg))\n        return atoi64(mapArgs[strArg]);\n    return nDefault;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "map<string, string> mapArgs;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nmap<string, string> mapArgs;\n\nint64_t GetArg(const std::string& strArg, int64_t nDefault)\n{\n    if (mapArgs.count(strArg))\n        return atoi64(mapArgs[strArg]);\n    return nDefault;\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"keypoolrefill [new-size]\\n\"\n            \"Fills the keypool.\"\n            + HelpRequiringPassphrase()"
          ],
          "line": 1353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HelpRequiringPassphrase",
          "args": [],
          "line": 1356
        },
        "resolved": true,
        "details": {
          "function_name": "HelpRequiringPassphrase",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "34-39",
          "snippet": "std::string HelpRequiringPassphrase()\n{\n    return pwalletMain->IsCrypted()\n        ? \"\\nrequires wallet passphrase to be set with walletpassphrase first\"\n        : \"\";\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstd::string HelpRequiringPassphrase()\n{\n    return pwalletMain->IsCrypted()\n        ? \"\\nrequires wallet passphrase to be set with walletpassphrase first\"\n        : \"\";\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue keypoolrefill(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 1)\n        throw runtime_error(\n            \"keypoolrefill [new-size]\\n\"\n            \"Fills the keypool.\"\n            + HelpRequiringPassphrase());\n\n    unsigned int nSize = max(GetArg(\"-keypool\", 100), (int64_t)0);\n    if (params.size() > 0) {\n        if (params[0].get_int() < 0)\n            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid parameter, expected valid size\");\n        nSize = (unsigned int) params[0].get_int();\n    }\n\n    EnsureWalletIsUnlocked();\n\n    pwalletMain->TopUpKeyPool(nSize);\n\n    if (pwalletMain->GetKeyPoolSize() < nSize)\n        throw JSONRPCError(RPC_WALLET_ERROR, \"Error refreshing keypool.\");\n\n    return Value::null;\n}"
  },
  {
    "function_name": "backupwallet",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1335-1347",
    "snippet": "Value backupwallet(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 1)\n        throw runtime_error(\n            \"backupwallet <destination>\\n\"\n            \"Safely copies wallet.dat to destination, which can be a directory or a path with filename.\");\n\n    string strDest = params[0].get_str();\n    if (!BackupWallet(*pwalletMain, strDest))\n        throw JSONRPCError(RPC_WALLET_ERROR, \"Error: Wallet backup failed!\");\n\n    return Value::null;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_WALLET_ERROR",
            "\"Error: Wallet backup failed!\""
          ],
          "line": 1344
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "BackupWallet",
          "args": [
            "*pwalletMain",
            "strDest"
          ],
          "line": 1343
        },
        "resolved": true,
        "details": {
          "function_name": "BackupWallet",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/walletdb.cpp",
          "lines": "595-633",
          "snippet": "bool BackupWallet(const CWallet& wallet, const string& strDest)\n{\n    if (!wallet.fFileBacked)\n        return false;\n    while (!fShutdown)\n    {\n        {\n            LOCK(bitdb.cs_db);\n            if (!bitdb.mapFileUseCount.count(wallet.strWalletFile) || bitdb.mapFileUseCount[wallet.strWalletFile] == 0)\n            {\n                // Flush log data to the dat file\n                bitdb.CloseDb(wallet.strWalletFile);\n                bitdb.CheckpointLSN(wallet.strWalletFile);\n                bitdb.mapFileUseCount.erase(wallet.strWalletFile);\n\n                // Copy wallet.dat\n                filesystem::path pathSrc = GetDataDir() / wallet.strWalletFile;\n                filesystem::path pathDest(strDest);\n                if (filesystem::is_directory(pathDest))\n                    pathDest /= wallet.strWalletFile;\n\n                try {\n#if BOOST_VERSION >= 104000\n                    filesystem::copy_file(pathSrc, pathDest, filesystem::copy_option::overwrite_if_exists);\n#else\n                    filesystem::copy_file(pathSrc, pathDest);\n#endif\n                    printf(\"copied wallet.dat to %s\\n\", pathDest.string().c_str());\n                    return true;\n                } catch(const filesystem::filesystem_error &e) {\n                    printf(\"error copying wallet.dat to %s - %s\\n\", pathDest.string().c_str(), e.what());\n                    return false;\n                }\n            }\n        }\n        MilliSleep(100);\n    }\n    return false;\n}",
          "includes": [
            "#include <boost/filesystem.hpp>",
            "#include <boost/version.hpp>",
            "#include \"wallet.h\"",
            "#include \"walletdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem.hpp>\n#include <boost/version.hpp>\n#include \"wallet.h\"\n#include \"walletdb.h\"\n\nbool BackupWallet(const CWallet& wallet, const string& strDest)\n{\n    if (!wallet.fFileBacked)\n        return false;\n    while (!fShutdown)\n    {\n        {\n            LOCK(bitdb.cs_db);\n            if (!bitdb.mapFileUseCount.count(wallet.strWalletFile) || bitdb.mapFileUseCount[wallet.strWalletFile] == 0)\n            {\n                // Flush log data to the dat file\n                bitdb.CloseDb(wallet.strWalletFile);\n                bitdb.CheckpointLSN(wallet.strWalletFile);\n                bitdb.mapFileUseCount.erase(wallet.strWalletFile);\n\n                // Copy wallet.dat\n                filesystem::path pathSrc = GetDataDir() / wallet.strWalletFile;\n                filesystem::path pathDest(strDest);\n                if (filesystem::is_directory(pathDest))\n                    pathDest /= wallet.strWalletFile;\n\n                try {\n#if BOOST_VERSION >= 104000\n                    filesystem::copy_file(pathSrc, pathDest, filesystem::copy_option::overwrite_if_exists);\n#else\n                    filesystem::copy_file(pathSrc, pathDest);\n#endif\n                    printf(\"copied wallet.dat to %s\\n\", pathDest.string().c_str());\n                    return true;\n                } catch(const filesystem::filesystem_error &e) {\n                    printf(\"error copying wallet.dat to %s - %s\\n\", pathDest.string().c_str(), e.what());\n                    return false;\n                }\n            }\n        }\n        MilliSleep(100);\n    }\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 1342
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"backupwallet <destination>\\n\"\n            \"Safely copies wallet.dat to destination, which can be a directory or a path with filename.\""
          ],
          "line": 1338
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 1337
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue backupwallet(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 1)\n        throw runtime_error(\n            \"backupwallet <destination>\\n\"\n            \"Safely copies wallet.dat to destination, which can be a directory or a path with filename.\");\n\n    string strDest = params[0].get_str();\n    if (!BackupWallet(*pwalletMain, strDest))\n        throw JSONRPCError(RPC_WALLET_ERROR, \"Error: Wallet backup failed!\");\n\n    return Value::null;\n}"
  },
  {
    "function_name": "gettransaction",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1271-1332",
    "snippet": "Value gettransaction(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 1)\n        throw runtime_error(\n            \"gettransaction <txid>\\n\"\n            \"Get detailed information about <txid>\");\n\n    uint256 hash;\n    hash.SetHex(params[0].get_str());\n\n    Object entry;\n\n    if (pwalletMain->mapWallet.count(hash))\n    {\n        const CWalletTx& wtx = pwalletMain->mapWallet[hash];\n\n        TxToJSON(wtx, 0, entry);\n\n        int64_t nCredit = wtx.GetCredit();\n        int64_t nDebit = wtx.GetDebit();\n        int64_t nNet = nCredit - nDebit;\n        int64_t nFee = (wtx.IsFromMe() ? wtx.GetValueOut() - nDebit : 0);\n\n        entry.push_back(Pair(\"amount\", ValueFromAmount(nNet - nFee)));\n        if (wtx.IsFromMe())\n            entry.push_back(Pair(\"fee\", ValueFromAmount(nFee)));\n\n        WalletTxToJSON(wtx, entry);\n\n        Array details;\n        ListTransactions(pwalletMain->mapWallet[hash], \"*\", 0, false, details);\n        entry.push_back(Pair(\"details\", details));\n    }\n    else\n    {\n        CTransaction tx;\n        uint256 hashBlock = 0;\n        if (GetTransaction(hash, tx, hashBlock))\n        {\n            TxToJSON(tx, 0, entry);\n            if (hashBlock == 0)\n                entry.push_back(Pair(\"confirmations\", 0));\n            else\n            {\n                entry.push_back(Pair(\"blockhash\", hashBlock.GetHex()));\n                map<uint256, CBlockIndex*>::iterator mi = mapBlockIndex.find(hashBlock);\n                if (mi != mapBlockIndex.end() && (*mi).second)\n                {\n                    CBlockIndex* pindex = (*mi).second;\n                    if (pindex->IsInMainChain())\n                        entry.push_back(Pair(\"confirmations\", 1 + nBestHeight - pindex->nHeight));\n                    else\n                        entry.push_back(Pair(\"confirmations\", 0));\n                }\n            }\n        }\n        else\n            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"No information available about transaction\");\n    }\n\n    return entry;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "extern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_INVALID_ADDRESS_OR_KEY",
            "\"No information available about transaction\""
          ],
          "line": 1328
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"confirmations\", 0)"
          ],
          "line": 1323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"confirmations\"",
            "0"
          ],
          "line": 1323
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"confirmations\", 1 + nBestHeight - pindex->nHeight)"
          ],
          "line": 1321
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pindex->IsInMainChain",
          "args": [],
          "line": 1320
        },
        "resolved": true,
        "details": {
          "function_name": "IsInMainChain",
          "container": "CBlockIndex",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "1291-1294",
          "snippet": "bool IsInMainChain() const\n    {\n        return (pnext || this == pindexBest);\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCBlockIndex {\n  bool IsInMainChain() const\n      {\n          return (pnext || this == pindexBest);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "mapBlockIndex.end",
          "args": [],
          "line": 1317
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "mapBlockIndex.find",
          "args": [
            "hashBlock"
          ],
          "line": 1316
        },
        "resolved": true,
        "details": {
          "function_name": "find",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "33-33",
          "snippet": "const_iterator find(const key_type& k) const { return map.find(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator find(const key_type& k) const { return map.find(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"blockhash\", hashBlock.GetHex())"
          ],
          "line": 1315
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hashBlock.GetHex",
          "args": [],
          "line": 1315
        },
        "resolved": true,
        "details": {
          "function_name": "GetHex",
          "container": "CBigNum",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bignum.h",
          "lines": "402-405",
          "snippet": "std::string GetHex() const\n    {\n        return ToString(16);\n    }",
          "includes": [
            "#include <stdint.h>",
            "#include <vector>",
            "#include <stdexcept>",
            "#include <openssl/bn.h>",
            "#include \"version.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdint.h>\n#include <vector>\n#include <stdexcept>\n#include <openssl/bn.h>\n#include \"version.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n\nCBigNum {\n  std::string GetHex() const\n      {\n          return ToString(16);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"confirmations\", 0)"
          ],
          "line": 1312
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TxToJSON",
          "args": [
            "tx",
            "0",
            "entry"
          ],
          "line": 1310
        },
        "resolved": true,
        "details": {
          "function_name": "TxToJSON",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcrawtransaction.cpp",
          "lines": "47-103",
          "snippet": "void TxToJSON(const CTransaction& tx, const uint256 hashBlock, Object& entry)\n{\n    entry.push_back(Pair(\"txid\", tx.GetHash().GetHex()));\n    entry.push_back(Pair(\"version\", tx.nVersion));\n    entry.push_back(Pair(\"time\", (boost::int64_t)tx.nTime));\n    entry.push_back(Pair(\"locktime\", (boost::int64_t)tx.nLockTime));\n    Array vin;\n    BOOST_FOREACH(const CTxIn& txin, tx.vin)\n    {\n        Object in;\n        if (tx.IsCoinBase())\n            in.push_back(Pair(\"coinbase\", HexStr(txin.scriptSig.begin(), txin.scriptSig.end())));\n        else\n        {\n            in.push_back(Pair(\"txid\", txin.prevout.hash.GetHex()));\n            in.push_back(Pair(\"vout\", (boost::int64_t)txin.prevout.n));\n            Object o;\n            o.push_back(Pair(\"asm\", txin.scriptSig.ToString()));\n            o.push_back(Pair(\"hex\", HexStr(txin.scriptSig.begin(), txin.scriptSig.end())));\n            in.push_back(Pair(\"scriptSig\", o));\n        }\n        in.push_back(Pair(\"sequence\", (boost::int64_t)txin.nSequence));\n        vin.push_back(in);\n    }\n    entry.push_back(Pair(\"vin\", vin));\n    Array vout;\n    for (unsigned int i = 0; i < tx.vout.size(); i++)\n    {\n        const CTxOut& txout = tx.vout[i];\n        Object out;\n        out.push_back(Pair(\"value\", ValueFromAmount(txout.nValue)));\n        out.push_back(Pair(\"n\", (boost::int64_t)i));\n        Object o;\n        ScriptPubKeyToJSON(txout.scriptPubKey, o, false);\n        out.push_back(Pair(\"scriptPubKey\", o));\n        vout.push_back(out);\n    }\n    entry.push_back(Pair(\"vout\", vout));\n\n    if (hashBlock != 0)\n    {\n        entry.push_back(Pair(\"blockhash\", hashBlock.GetHex()));\n        map<uint256, CBlockIndex*>::iterator mi = mapBlockIndex.find(hashBlock);\n        if (mi != mapBlockIndex.end() && (*mi).second)\n        {\n            CBlockIndex* pindex = (*mi).second;\n            if (pindex->IsInMainChain())\n            {\n                entry.push_back(Pair(\"confirmations\", 1 + nBestHeight - pindex->nHeight));\n                entry.push_back(Pair(\"time\", (boost::int64_t)pindex->nTime));\n                entry.push_back(Pair(\"blocktime\", (boost::int64_t)pindex->nTime));\n            }\n            else\n                entry.push_back(Pair(\"confirmations\", 0));\n        }\n    }\n}",
          "includes": [
            "#include \"wallet.h\"",
            "#include \"net.h\"",
            "#include \"main.h\"",
            "#include \"init.h\"",
            "#include \"txdb.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include <boost/assign/list_of.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"wallet.h\"\n#include \"net.h\"\n#include \"main.h\"\n#include \"init.h\"\n#include \"txdb.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include <boost/assign/list_of.hpp>\n\nvoid TxToJSON(const CTransaction& tx, const uint256 hashBlock, Object& entry)\n{\n    entry.push_back(Pair(\"txid\", tx.GetHash().GetHex()));\n    entry.push_back(Pair(\"version\", tx.nVersion));\n    entry.push_back(Pair(\"time\", (boost::int64_t)tx.nTime));\n    entry.push_back(Pair(\"locktime\", (boost::int64_t)tx.nLockTime));\n    Array vin;\n    BOOST_FOREACH(const CTxIn& txin, tx.vin)\n    {\n        Object in;\n        if (tx.IsCoinBase())\n            in.push_back(Pair(\"coinbase\", HexStr(txin.scriptSig.begin(), txin.scriptSig.end())));\n        else\n        {\n            in.push_back(Pair(\"txid\", txin.prevout.hash.GetHex()));\n            in.push_back(Pair(\"vout\", (boost::int64_t)txin.prevout.n));\n            Object o;\n            o.push_back(Pair(\"asm\", txin.scriptSig.ToString()));\n            o.push_back(Pair(\"hex\", HexStr(txin.scriptSig.begin(), txin.scriptSig.end())));\n            in.push_back(Pair(\"scriptSig\", o));\n        }\n        in.push_back(Pair(\"sequence\", (boost::int64_t)txin.nSequence));\n        vin.push_back(in);\n    }\n    entry.push_back(Pair(\"vin\", vin));\n    Array vout;\n    for (unsigned int i = 0; i < tx.vout.size(); i++)\n    {\n        const CTxOut& txout = tx.vout[i];\n        Object out;\n        out.push_back(Pair(\"value\", ValueFromAmount(txout.nValue)));\n        out.push_back(Pair(\"n\", (boost::int64_t)i));\n        Object o;\n        ScriptPubKeyToJSON(txout.scriptPubKey, o, false);\n        out.push_back(Pair(\"scriptPubKey\", o));\n        vout.push_back(out);\n    }\n    entry.push_back(Pair(\"vout\", vout));\n\n    if (hashBlock != 0)\n    {\n        entry.push_back(Pair(\"blockhash\", hashBlock.GetHex()));\n        map<uint256, CBlockIndex*>::iterator mi = mapBlockIndex.find(hashBlock);\n        if (mi != mapBlockIndex.end() && (*mi).second)\n        {\n            CBlockIndex* pindex = (*mi).second;\n            if (pindex->IsInMainChain())\n            {\n                entry.push_back(Pair(\"confirmations\", 1 + nBestHeight - pindex->nHeight));\n                entry.push_back(Pair(\"time\", (boost::int64_t)pindex->nTime));\n                entry.push_back(Pair(\"blocktime\", (boost::int64_t)pindex->nTime));\n            }\n            else\n                entry.push_back(Pair(\"confirmations\", 0));\n        }\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "GetTransaction",
          "args": [
            "hash",
            "tx",
            "hashBlock"
          ],
          "line": 1308
        },
        "resolved": true,
        "details": {
          "function_name": "GetTransaction",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
          "lines": "890-913",
          "snippet": "bool GetTransaction(const uint256 &hash, CTransaction &tx, uint256 &hashBlock)\n{\n    {\n        LOCK(cs_main);\n        {\n            LOCK(mempool.cs);\n            if (mempool.exists(hash))\n            {\n                tx = mempool.lookup(hash);\n                return true;\n            }\n        }\n        CTxDB txdb(\"r\");\n        CTxIndex txindex;\n        if (tx.ReadFromDisk(txdb, COutPoint(hash, 0), txindex))\n        {\n            CBlock block;\n            if (block.ReadFromDisk(txindex.pos.nFile, txindex.pos.nBlockPos, false))\n                hashBlock = block.GetHash();\n            return true;\n        }\n    }\n    return false;\n}",
          "includes": [
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"kernel.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"txdb.h\"",
            "#include \"db.h\"",
            "#include \"checkpoints.h\"",
            "#include \"alert.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "CCriticalSection cs_main;",
            "CTxMemPool mempool;",
            "CBigNum bnProofOfWorkLimit(~uint256(0) >> 20);",
            "CBigNum bnProofOfStakeLimit(~uint256(0) >> 20);",
            "const CBigNum bnNeoScryptSwitch(~uint256(0) >> 30);",
            "CBigNum bnProofOfWorkLimitTestNet(~uint256(0) >> 16);",
            "CBigNum bnProofOfStakeLimitTestNet(~uint256(0) >> 16);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/algorithm/string/replace.hpp>\n#include \"kernel.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"txdb.h\"\n#include \"db.h\"\n#include \"checkpoints.h\"\n#include \"alert.h\"\n\nCCriticalSection cs_main;\nCTxMemPool mempool;\nCBigNum bnProofOfWorkLimit(~uint256(0) >> 20);\nCBigNum bnProofOfStakeLimit(~uint256(0) >> 20);\nconst CBigNum bnNeoScryptSwitch(~uint256(0) >> 30);\nCBigNum bnProofOfWorkLimitTestNet(~uint256(0) >> 16);\nCBigNum bnProofOfStakeLimitTestNet(~uint256(0) >> 16);\n\nbool GetTransaction(const uint256 &hash, CTransaction &tx, uint256 &hashBlock)\n{\n    {\n        LOCK(cs_main);\n        {\n            LOCK(mempool.cs);\n            if (mempool.exists(hash))\n            {\n                tx = mempool.lookup(hash);\n                return true;\n            }\n        }\n        CTxDB txdb(\"r\");\n        CTxIndex txindex;\n        if (tx.ReadFromDisk(txdb, COutPoint(hash, 0), txindex))\n        {\n            CBlock block;\n            if (block.ReadFromDisk(txindex.pos.nFile, txindex.pos.nBlockPos, false))\n                hashBlock = block.GetHash();\n            return true;\n        }\n    }\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"details\", details)"
          ],
          "line": 1302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ListTransactions",
          "args": [
            "pwalletMain->mapWallet[hash]",
            "\"*\"",
            "0",
            "false",
            "details"
          ],
          "line": 1301
        },
        "resolved": true,
        "details": {
          "function_name": "ListTransactions",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "1006-1076",
          "snippet": "void ListTransactions(const CWalletTx& wtx, const string& strAccount, int nMinDepth, bool fLong, Array& ret)\n{\n    int64_t nFee;\n    string strSentAccount;\n    list<pair<CTxDestination, int64_t> > listReceived;\n    list<pair<CTxDestination, int64_t> > listSent;\n\n    wtx.GetAmounts(listReceived, listSent, nFee, strSentAccount);\n\n    bool fAllAccounts = (strAccount == string(\"*\"));\n\n    // Sent\n    if ((!wtx.IsCoinStake()) && (!listSent.empty() || nFee != 0) && (fAllAccounts || strAccount == strSentAccount))\n    {\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& s, listSent)\n        {\n            Object entry;\n            entry.push_back(Pair(\"account\", strSentAccount));\n            MaybePushAddress(entry, s.first);\n            entry.push_back(Pair(\"category\", \"send\"));\n            entry.push_back(Pair(\"amount\", ValueFromAmount(-s.second)));\n            entry.push_back(Pair(\"fee\", ValueFromAmount(-nFee)));\n            if (fLong)\n                WalletTxToJSON(wtx, entry);\n            ret.push_back(entry);\n        }\n    }\n\n    // Received\n    if (listReceived.size() > 0 && wtx.GetDepthInMainChain() >= nMinDepth)\n    {\n        bool stop = false;\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& r, listReceived)\n        {\n            string account;\n            if (pwalletMain->mapAddressBook.count(r.first))\n                account = pwalletMain->mapAddressBook[r.first];\n            if (fAllAccounts || (account == strAccount))\n            {\n                Object entry;\n                entry.push_back(Pair(\"account\", account));\n                MaybePushAddress(entry, r.first);\n                if (wtx.IsCoinBase() || wtx.IsCoinStake())\n                {\n                    if (wtx.GetDepthInMainChain() < 1)\n                        entry.push_back(Pair(\"category\", \"orphan\"));\n                    else if (wtx.GetBlocksToMaturity() > 0)\n                        entry.push_back(Pair(\"category\", \"immature\"));\n                    else\n                        entry.push_back(Pair(\"category\", \"generate\"));\n                }\n                else\n                {\n                    entry.push_back(Pair(\"category\", \"receive\"));\n                }\n                if (!wtx.IsCoinStake())\n                    entry.push_back(Pair(\"amount\", ValueFromAmount(r.second)));\n                else\n                {\n                    entry.push_back(Pair(\"amount\", ValueFromAmount(-nFee)));\n                    stop = true; // only one coinstake output\n                }\n                if (fLong)\n                    WalletTxToJSON(wtx, entry);\n                ret.push_back(entry);\n            }\n            if (stop)\n                break;\n        }\n    }\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "extern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nextern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);\n\nvoid ListTransactions(const CWalletTx& wtx, const string& strAccount, int nMinDepth, bool fLong, Array& ret)\n{\n    int64_t nFee;\n    string strSentAccount;\n    list<pair<CTxDestination, int64_t> > listReceived;\n    list<pair<CTxDestination, int64_t> > listSent;\n\n    wtx.GetAmounts(listReceived, listSent, nFee, strSentAccount);\n\n    bool fAllAccounts = (strAccount == string(\"*\"));\n\n    // Sent\n    if ((!wtx.IsCoinStake()) && (!listSent.empty() || nFee != 0) && (fAllAccounts || strAccount == strSentAccount))\n    {\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& s, listSent)\n        {\n            Object entry;\n            entry.push_back(Pair(\"account\", strSentAccount));\n            MaybePushAddress(entry, s.first);\n            entry.push_back(Pair(\"category\", \"send\"));\n            entry.push_back(Pair(\"amount\", ValueFromAmount(-s.second)));\n            entry.push_back(Pair(\"fee\", ValueFromAmount(-nFee)));\n            if (fLong)\n                WalletTxToJSON(wtx, entry);\n            ret.push_back(entry);\n        }\n    }\n\n    // Received\n    if (listReceived.size() > 0 && wtx.GetDepthInMainChain() >= nMinDepth)\n    {\n        bool stop = false;\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& r, listReceived)\n        {\n            string account;\n            if (pwalletMain->mapAddressBook.count(r.first))\n                account = pwalletMain->mapAddressBook[r.first];\n            if (fAllAccounts || (account == strAccount))\n            {\n                Object entry;\n                entry.push_back(Pair(\"account\", account));\n                MaybePushAddress(entry, r.first);\n                if (wtx.IsCoinBase() || wtx.IsCoinStake())\n                {\n                    if (wtx.GetDepthInMainChain() < 1)\n                        entry.push_back(Pair(\"category\", \"orphan\"));\n                    else if (wtx.GetBlocksToMaturity() > 0)\n                        entry.push_back(Pair(\"category\", \"immature\"));\n                    else\n                        entry.push_back(Pair(\"category\", \"generate\"));\n                }\n                else\n                {\n                    entry.push_back(Pair(\"category\", \"receive\"));\n                }\n                if (!wtx.IsCoinStake())\n                    entry.push_back(Pair(\"amount\", ValueFromAmount(r.second)));\n                else\n                {\n                    entry.push_back(Pair(\"amount\", ValueFromAmount(-nFee)));\n                    stop = true; // only one coinstake output\n                }\n                if (fLong)\n                    WalletTxToJSON(wtx, entry);\n                ret.push_back(entry);\n            }\n            if (stop)\n                break;\n        }\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "WalletTxToJSON",
          "args": [
            "wtx",
            "entry"
          ],
          "line": 1298
        },
        "resolved": true,
        "details": {
          "function_name": "WalletTxToJSON",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "49-66",
          "snippet": "void WalletTxToJSON(const CWalletTx& wtx, Object& entry)\n{\n    int confirms = wtx.GetDepthInMainChain();\n    entry.push_back(Pair(\"confirmations\", confirms));\n    if (wtx.IsCoinBase() || wtx.IsCoinStake())\n        entry.push_back(Pair(\"generated\", true));\n    if (confirms > 0)\n    {\n        entry.push_back(Pair(\"blockhash\", wtx.hashBlock.GetHex()));\n        entry.push_back(Pair(\"blockindex\", wtx.nIndex));\n        entry.push_back(Pair(\"blocktime\", (boost::int64_t)(mapBlockIndex[wtx.hashBlock]->nTime)));\n    }\n    entry.push_back(Pair(\"txid\", wtx.GetHash().GetHex()));\n    entry.push_back(Pair(\"time\", (boost::int64_t)wtx.GetTxTime()));\n    entry.push_back(Pair(\"timereceived\", (boost::int64_t)wtx.nTimeReceived));\n    BOOST_FOREACH(const PAIRTYPE(string,string)& item, wtx.mapValue)\n        entry.push_back(Pair(item.first, item.second));\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "extern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nextern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);\n\nvoid WalletTxToJSON(const CWalletTx& wtx, Object& entry)\n{\n    int confirms = wtx.GetDepthInMainChain();\n    entry.push_back(Pair(\"confirmations\", confirms));\n    if (wtx.IsCoinBase() || wtx.IsCoinStake())\n        entry.push_back(Pair(\"generated\", true));\n    if (confirms > 0)\n    {\n        entry.push_back(Pair(\"blockhash\", wtx.hashBlock.GetHex()));\n        entry.push_back(Pair(\"blockindex\", wtx.nIndex));\n        entry.push_back(Pair(\"blocktime\", (boost::int64_t)(mapBlockIndex[wtx.hashBlock]->nTime)));\n    }\n    entry.push_back(Pair(\"txid\", wtx.GetHash().GetHex()));\n    entry.push_back(Pair(\"time\", (boost::int64_t)wtx.GetTxTime()));\n    entry.push_back(Pair(\"timereceived\", (boost::int64_t)wtx.nTimeReceived));\n    BOOST_FOREACH(const PAIRTYPE(string,string)& item, wtx.mapValue)\n        entry.push_back(Pair(item.first, item.second));\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"fee\", ValueFromAmount(nFee))"
          ],
          "line": 1296
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ValueFromAmount",
          "args": [
            "nFee"
          ],
          "line": 1296
        },
        "resolved": true,
        "details": {
          "function_name": "ValueFromAmount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "113-116",
          "snippet": "Value ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nValue ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.IsFromMe",
          "args": [],
          "line": 1295
        },
        "resolved": true,
        "details": {
          "function_name": "IsFromMe",
          "container": "CWalletTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.h",
          "lines": "641-644",
          "snippet": "bool IsFromMe() const\n    {\n        return (GetDebit() > 0);\n    }",
          "includes": [
            "#include \"walletdb.h\"",
            "#include \"util.h\"",
            "#include \"ui_interface.h\"",
            "#include \"script.h\"",
            "#include \"keystore.h\"",
            "#include \"key.h\"",
            "#include \"main.h\"",
            "#include <stdlib.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"walletdb.h\"\n#include \"util.h\"\n#include \"ui_interface.h\"\n#include \"script.h\"\n#include \"keystore.h\"\n#include \"key.h\"\n#include \"main.h\"\n#include <stdlib.h>\n#include <vector>\n#include <string>\n\nCWalletTx {\n  bool IsFromMe() const\n      {\n          return (GetDebit() > 0);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"amount\", ValueFromAmount(nNet - nFee))"
          ],
          "line": 1294
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wtx.GetValueOut",
          "args": [],
          "line": 1292
        },
        "resolved": true,
        "details": {
          "function_name": "GetValueOut",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "577-587",
          "snippet": "int64_t GetValueOut() const\n    {\n        int64_t nValueOut = 0;\n        BOOST_FOREACH(const CTxOut& txout, vout)\n        {\n            nValueOut += txout.nValue;\n            if (!MoneyRange(txout.nValue) || !MoneyRange(nValueOut))\n                throw std::runtime_error(\"CTransaction::GetValueOut() : value out of range\");\n        }\n        return nValueOut;\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  int64_t GetValueOut() const\n      {\n          int64_t nValueOut = 0;\n          BOOST_FOREACH(const CTxOut& txout, vout)\n          {\n              nValueOut += txout.nValue;\n              if (!MoneyRange(txout.nValue) || !MoneyRange(nValueOut))\n                  throw std::runtime_error(\"CTransaction::GetValueOut() : value out of range\");\n          }\n          return nValueOut;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetDebit",
          "args": [],
          "line": 1290
        },
        "resolved": true,
        "details": {
          "function_name": "GetDebit",
          "container": "CWalletTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.h",
          "lines": "574-583",
          "snippet": "int64_t GetDebit() const\n    {\n        if (vin.empty())\n            return 0;\n        if (fDebitCached)\n            return nDebitCached;\n        nDebitCached = pwallet->GetDebit(*this);\n        fDebitCached = true;\n        return nDebitCached;\n    }",
          "includes": [
            "#include \"walletdb.h\"",
            "#include \"util.h\"",
            "#include \"ui_interface.h\"",
            "#include \"script.h\"",
            "#include \"keystore.h\"",
            "#include \"key.h\"",
            "#include \"main.h\"",
            "#include <stdlib.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"walletdb.h\"\n#include \"util.h\"\n#include \"ui_interface.h\"\n#include \"script.h\"\n#include \"keystore.h\"\n#include \"key.h\"\n#include \"main.h\"\n#include <stdlib.h>\n#include <vector>\n#include <string>\n\nCWalletTx {\n  int64_t GetDebit() const\n      {\n          if (vin.empty())\n              return 0;\n          if (fDebitCached)\n              return nDebitCached;\n          nDebitCached = pwallet->GetDebit(*this);\n          fDebitCached = true;\n          return nDebitCached;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetCredit",
          "args": [],
          "line": 1289
        },
        "resolved": true,
        "details": {
          "function_name": "GetCredit",
          "container": "CWalletTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.h",
          "lines": "585-597",
          "snippet": "int64_t GetCredit(bool fUseCache=true) const\n    {\n        // Must wait until coinbase is safely deep enough in the chain before valuing it\n        if ((IsCoinBase() || IsCoinStake()) && GetBlocksToMaturity() > 0)\n            return 0;\n\n        // GetBalance can assume transactions in mapWallet won't change\n        if (fUseCache && fCreditCached)\n            return nCreditCached;\n        nCreditCached = pwallet->GetCredit(*this);\n        fCreditCached = true;\n        return nCreditCached;\n    }",
          "includes": [
            "#include \"walletdb.h\"",
            "#include \"util.h\"",
            "#include \"ui_interface.h\"",
            "#include \"script.h\"",
            "#include \"keystore.h\"",
            "#include \"key.h\"",
            "#include \"main.h\"",
            "#include <stdlib.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"walletdb.h\"\n#include \"util.h\"\n#include \"ui_interface.h\"\n#include \"script.h\"\n#include \"keystore.h\"\n#include \"key.h\"\n#include \"main.h\"\n#include <stdlib.h>\n#include <vector>\n#include <string>\n\nCWalletTx {\n  int64_t GetCredit(bool fUseCache=true) const\n      {\n          // Must wait until coinbase is safely deep enough in the chain before valuing it\n          if ((IsCoinBase() || IsCoinStake()) && GetBlocksToMaturity() > 0)\n              return 0;\n  \n          // GetBalance can assume transactions in mapWallet won't change\n          if (fUseCache && fCreditCached)\n              return nCreditCached;\n          nCreditCached = pwallet->GetCredit(*this);\n          fCreditCached = true;\n          return nCreditCached;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapWallet.count",
          "args": [
            "hash"
          ],
          "line": 1283
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "hash.SetHex",
          "args": [
            "params[0].get_str()"
          ],
          "line": 1279
        },
        "resolved": true,
        "details": {
          "function_name": "SetHex",
          "container": "CBigNum",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bignum.h",
          "lines": "346-374",
          "snippet": "void SetHex(const std::string& str)\n    {\n        // skip 0x\n        const char* psz = str.c_str();\n        while (isspace(*psz))\n            psz++;\n        bool fNegative = false;\n        if (*psz == '-')\n        {\n            fNegative = true;\n            psz++;\n        }\n        if (psz[0] == '0' && tolower(psz[1]) == 'x')\n            psz += 2;\n        while (isspace(*psz))\n            psz++;\n\n        // hex string to bignum\n        static const signed char phexdigit[256] = { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,1,2,3,4,5,6,7,8,9,0,0,0,0,0,0, 0,0xa,0xb,0xc,0xd,0xe,0xf,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0xa,0xb,0xc,0xd,0xe,0xf,0,0,0,0,0,0,0,0,0 };\n        *this = 0;\n        while (isxdigit(*psz))\n        {\n            *this <<= 4;\n            int n = phexdigit[(unsigned char)*psz++];\n            *this += n;\n        }\n        if (fNegative)\n            *this = 0 - *this;\n    }",
          "includes": [
            "#include <stdint.h>",
            "#include <vector>",
            "#include <stdexcept>",
            "#include <openssl/bn.h>",
            "#include \"version.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdint.h>\n#include <vector>\n#include <stdexcept>\n#include <openssl/bn.h>\n#include \"version.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n\nCBigNum {\n  void SetHex(const std::string& str)\n      {\n          // skip 0x\n          const char* psz = str.c_str();\n          while (isspace(*psz))\n              psz++;\n          bool fNegative = false;\n          if (*psz == '-')\n          {\n              fNegative = true;\n              psz++;\n          }\n          if (psz[0] == '0' && tolower(psz[1]) == 'x')\n              psz += 2;\n          while (isspace(*psz))\n              psz++;\n  \n          // hex string to bignum\n          static const signed char phexdigit[256] = { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,1,2,3,4,5,6,7,8,9,0,0,0,0,0,0, 0,0xa,0xb,0xc,0xd,0xe,0xf,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0xa,0xb,0xc,0xd,0xe,0xf,0,0,0,0,0,0,0,0,0 };\n          *this = 0;\n          while (isxdigit(*psz))\n          {\n              *this <<= 4;\n              int n = phexdigit[(unsigned char)*psz++];\n              *this += n;\n          }\n          if (fNegative)\n              *this = 0 - *this;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 1279
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"gettransaction <txid>\\n\"\n            \"Get detailed information about <txid>\""
          ],
          "line": 1274
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 1273
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nextern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);\n\nValue gettransaction(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 1)\n        throw runtime_error(\n            \"gettransaction <txid>\\n\"\n            \"Get detailed information about <txid>\");\n\n    uint256 hash;\n    hash.SetHex(params[0].get_str());\n\n    Object entry;\n\n    if (pwalletMain->mapWallet.count(hash))\n    {\n        const CWalletTx& wtx = pwalletMain->mapWallet[hash];\n\n        TxToJSON(wtx, 0, entry);\n\n        int64_t nCredit = wtx.GetCredit();\n        int64_t nDebit = wtx.GetDebit();\n        int64_t nNet = nCredit - nDebit;\n        int64_t nFee = (wtx.IsFromMe() ? wtx.GetValueOut() - nDebit : 0);\n\n        entry.push_back(Pair(\"amount\", ValueFromAmount(nNet - nFee)));\n        if (wtx.IsFromMe())\n            entry.push_back(Pair(\"fee\", ValueFromAmount(nFee)));\n\n        WalletTxToJSON(wtx, entry);\n\n        Array details;\n        ListTransactions(pwalletMain->mapWallet[hash], \"*\", 0, false, details);\n        entry.push_back(Pair(\"details\", details));\n    }\n    else\n    {\n        CTransaction tx;\n        uint256 hashBlock = 0;\n        if (GetTransaction(hash, tx, hashBlock))\n        {\n            TxToJSON(tx, 0, entry);\n            if (hashBlock == 0)\n                entry.push_back(Pair(\"confirmations\", 0));\n            else\n            {\n                entry.push_back(Pair(\"blockhash\", hashBlock.GetHex()));\n                map<uint256, CBlockIndex*>::iterator mi = mapBlockIndex.find(hashBlock);\n                if (mi != mapBlockIndex.end() && (*mi).second)\n                {\n                    CBlockIndex* pindex = (*mi).second;\n                    if (pindex->IsInMainChain())\n                        entry.push_back(Pair(\"confirmations\", 1 + nBestHeight - pindex->nHeight));\n                    else\n                        entry.push_back(Pair(\"confirmations\", 0));\n                }\n            }\n        }\n        else\n            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"No information available about transaction\");\n    }\n\n    return entry;\n}"
  },
  {
    "function_name": "listsinceblock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1208-1269",
    "snippet": "Value listsinceblock(const Array& params, bool fHelp)\n{\n    if (fHelp)\n        throw runtime_error(\n            \"listsinceblock [blockhash] [target-confirmations]\\n\"\n            \"Get all transactions in blocks since block [blockhash], or all transactions if omitted\");\n\n    CBlockIndex *pindex = NULL;\n    int target_confirms = 1;\n\n    if (params.size() > 0)\n    {\n        uint256 blockId = 0;\n\n        blockId.SetHex(params[0].get_str());\n        pindex = CBlockLocator(blockId).GetBlockIndex();\n    }\n\n    if (params.size() > 1)\n    {\n        target_confirms = params[1].get_int();\n\n        if (target_confirms < 1)\n            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid parameter\");\n    }\n\n    int depth = pindex ? (1 + nBestHeight - pindex->nHeight) : -1;\n\n    Array transactions;\n\n    for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); it++)\n    {\n        CWalletTx tx = (*it).second;\n\n        if (depth == -1 || tx.GetDepthInMainChain() < depth)\n            ListTransactions(tx, \"*\", 0, true, transactions);\n    }\n\n    uint256 lastblock;\n\n    if (target_confirms == 1)\n    {\n        lastblock = hashBestChain;\n    }\n    else\n    {\n        int target_height = pindexBest->nHeight + 1 - target_confirms;\n\n        CBlockIndex *block;\n        for (block = pindexBest;\n             block && block->nHeight > target_height;\n             block = block->pprev)  { }\n\n        lastblock = block ? block->GetBlockHash() : 0;\n    }\n\n    Object ret;\n    ret.push_back(Pair(\"transactions\", transactions));\n    ret.push_back(Pair(\"lastblock\", lastblock.GetHex()));\n\n    return ret;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "Pair(\"lastblock\", lastblock.GetHex())"
          ],
          "line": 1266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"lastblock\"",
            "lastblock.GetHex()"
          ],
          "line": 1266
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "lastblock.GetHex",
          "args": [],
          "line": 1266
        },
        "resolved": true,
        "details": {
          "function_name": "GetHex",
          "container": "CBigNum",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bignum.h",
          "lines": "402-405",
          "snippet": "std::string GetHex() const\n    {\n        return ToString(16);\n    }",
          "includes": [
            "#include <stdint.h>",
            "#include <vector>",
            "#include <stdexcept>",
            "#include <openssl/bn.h>",
            "#include \"version.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdint.h>\n#include <vector>\n#include <stdexcept>\n#include <openssl/bn.h>\n#include \"version.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n\nCBigNum {\n  std::string GetHex() const\n      {\n          return ToString(16);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "Pair(\"transactions\", transactions)"
          ],
          "line": 1265
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "block->GetBlockHash",
          "args": [],
          "line": 1261
        },
        "resolved": true,
        "details": {
          "function_name": "GetBlockHash",
          "container": "CBlockLocator",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "1644-1658",
          "snippet": "uint256 GetBlockHash()\n    {\n        // Find the first block the caller has in the main chain\n        BOOST_FOREACH(const uint256& hash, vHave)\n        {\n            std::map<uint256, CBlockIndex*>::iterator mi = mapBlockIndex.find(hash);\n            if (mi != mapBlockIndex.end())\n            {\n                CBlockIndex* pindex = (*mi).second;\n                if (pindex->IsInMainChain())\n                    return hash;\n            }\n        }\n        return (!fTestNet ? hashGenesisBlock : hashGenesisBlockTestNet);\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCBlockLocator {\n  uint256 GetBlockHash()\n      {\n          // Find the first block the caller has in the main chain\n          BOOST_FOREACH(const uint256& hash, vHave)\n          {\n              std::map<uint256, CBlockIndex*>::iterator mi = mapBlockIndex.find(hash);\n              if (mi != mapBlockIndex.end())\n              {\n                  CBlockIndex* pindex = (*mi).second;\n                  if (pindex->IsInMainChain())\n                      return hash;\n              }\n          }\n          return (!fTestNet ? hashGenesisBlock : hashGenesisBlockTestNet);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ListTransactions",
          "args": [
            "tx",
            "\"*\"",
            "0",
            "true",
            "transactions"
          ],
          "line": 1243
        },
        "resolved": true,
        "details": {
          "function_name": "ListTransactions",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "1006-1076",
          "snippet": "void ListTransactions(const CWalletTx& wtx, const string& strAccount, int nMinDepth, bool fLong, Array& ret)\n{\n    int64_t nFee;\n    string strSentAccount;\n    list<pair<CTxDestination, int64_t> > listReceived;\n    list<pair<CTxDestination, int64_t> > listSent;\n\n    wtx.GetAmounts(listReceived, listSent, nFee, strSentAccount);\n\n    bool fAllAccounts = (strAccount == string(\"*\"));\n\n    // Sent\n    if ((!wtx.IsCoinStake()) && (!listSent.empty() || nFee != 0) && (fAllAccounts || strAccount == strSentAccount))\n    {\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& s, listSent)\n        {\n            Object entry;\n            entry.push_back(Pair(\"account\", strSentAccount));\n            MaybePushAddress(entry, s.first);\n            entry.push_back(Pair(\"category\", \"send\"));\n            entry.push_back(Pair(\"amount\", ValueFromAmount(-s.second)));\n            entry.push_back(Pair(\"fee\", ValueFromAmount(-nFee)));\n            if (fLong)\n                WalletTxToJSON(wtx, entry);\n            ret.push_back(entry);\n        }\n    }\n\n    // Received\n    if (listReceived.size() > 0 && wtx.GetDepthInMainChain() >= nMinDepth)\n    {\n        bool stop = false;\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& r, listReceived)\n        {\n            string account;\n            if (pwalletMain->mapAddressBook.count(r.first))\n                account = pwalletMain->mapAddressBook[r.first];\n            if (fAllAccounts || (account == strAccount))\n            {\n                Object entry;\n                entry.push_back(Pair(\"account\", account));\n                MaybePushAddress(entry, r.first);\n                if (wtx.IsCoinBase() || wtx.IsCoinStake())\n                {\n                    if (wtx.GetDepthInMainChain() < 1)\n                        entry.push_back(Pair(\"category\", \"orphan\"));\n                    else if (wtx.GetBlocksToMaturity() > 0)\n                        entry.push_back(Pair(\"category\", \"immature\"));\n                    else\n                        entry.push_back(Pair(\"category\", \"generate\"));\n                }\n                else\n                {\n                    entry.push_back(Pair(\"category\", \"receive\"));\n                }\n                if (!wtx.IsCoinStake())\n                    entry.push_back(Pair(\"amount\", ValueFromAmount(r.second)));\n                else\n                {\n                    entry.push_back(Pair(\"amount\", ValueFromAmount(-nFee)));\n                    stop = true; // only one coinstake output\n                }\n                if (fLong)\n                    WalletTxToJSON(wtx, entry);\n                ret.push_back(entry);\n            }\n            if (stop)\n                break;\n        }\n    }\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "extern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nextern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);\n\nvoid ListTransactions(const CWalletTx& wtx, const string& strAccount, int nMinDepth, bool fLong, Array& ret)\n{\n    int64_t nFee;\n    string strSentAccount;\n    list<pair<CTxDestination, int64_t> > listReceived;\n    list<pair<CTxDestination, int64_t> > listSent;\n\n    wtx.GetAmounts(listReceived, listSent, nFee, strSentAccount);\n\n    bool fAllAccounts = (strAccount == string(\"*\"));\n\n    // Sent\n    if ((!wtx.IsCoinStake()) && (!listSent.empty() || nFee != 0) && (fAllAccounts || strAccount == strSentAccount))\n    {\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& s, listSent)\n        {\n            Object entry;\n            entry.push_back(Pair(\"account\", strSentAccount));\n            MaybePushAddress(entry, s.first);\n            entry.push_back(Pair(\"category\", \"send\"));\n            entry.push_back(Pair(\"amount\", ValueFromAmount(-s.second)));\n            entry.push_back(Pair(\"fee\", ValueFromAmount(-nFee)));\n            if (fLong)\n                WalletTxToJSON(wtx, entry);\n            ret.push_back(entry);\n        }\n    }\n\n    // Received\n    if (listReceived.size() > 0 && wtx.GetDepthInMainChain() >= nMinDepth)\n    {\n        bool stop = false;\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& r, listReceived)\n        {\n            string account;\n            if (pwalletMain->mapAddressBook.count(r.first))\n                account = pwalletMain->mapAddressBook[r.first];\n            if (fAllAccounts || (account == strAccount))\n            {\n                Object entry;\n                entry.push_back(Pair(\"account\", account));\n                MaybePushAddress(entry, r.first);\n                if (wtx.IsCoinBase() || wtx.IsCoinStake())\n                {\n                    if (wtx.GetDepthInMainChain() < 1)\n                        entry.push_back(Pair(\"category\", \"orphan\"));\n                    else if (wtx.GetBlocksToMaturity() > 0)\n                        entry.push_back(Pair(\"category\", \"immature\"));\n                    else\n                        entry.push_back(Pair(\"category\", \"generate\"));\n                }\n                else\n                {\n                    entry.push_back(Pair(\"category\", \"receive\"));\n                }\n                if (!wtx.IsCoinStake())\n                    entry.push_back(Pair(\"amount\", ValueFromAmount(r.second)));\n                else\n                {\n                    entry.push_back(Pair(\"amount\", ValueFromAmount(-nFee)));\n                    stop = true; // only one coinstake output\n                }\n                if (fLong)\n                    WalletTxToJSON(wtx, entry);\n                ret.push_back(entry);\n            }\n            if (stop)\n                break;\n        }\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "tx.GetDepthInMainChain",
          "args": [],
          "line": 1242
        },
        "resolved": true,
        "details": {
          "function_name": "GetDepthInMainChain",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "765-765",
          "snippet": "int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCMerkleTx {\n  int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapWallet.end",
          "args": [],
          "line": 1238
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapWallet.begin",
          "args": [],
          "line": 1238
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_INVALID_PARAMETER",
            "\"Invalid parameter\""
          ],
          "line": 1231
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[1].get_int",
          "args": [],
          "line": 1228
        },
        "resolved": true,
        "details": {
          "function_name": "get_int",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "385-390",
          "snippet": "int Value_impl< Config >::get_int() const\n    {\n        check_type(  int_type );\n\n        return static_cast< int >( get_int64() );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  int Value_impl< Config >::get_int() const\n      {\n          check_type(  int_type );\n  \n          return static_cast< int >( get_int64() );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 1226
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "CBlockLocator",
          "args": [],
          "line": 1223
        },
        "resolved": true,
        "details": {
          "function_name": "GetHeight",
          "container": "CBlockLocator",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "1660-1666",
          "snippet": "int GetHeight()\n    {\n        CBlockIndex* pindex = GetBlockIndex();\n        if (!pindex)\n            return 0;\n        return pindex->nHeight;\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCBlockLocator {\n  int GetHeight()\n      {\n          CBlockIndex* pindex = GetBlockIndex();\n          if (!pindex)\n              return 0;\n          return pindex->nHeight;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "CBlockLocator",
          "args": [
            "blockId"
          ],
          "line": 1223
        },
        "resolved": true,
        "details": {
          "function_name": "Set",
          "container": "CBlockLocator",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "1590-1605",
          "snippet": "void Set(const CBlockIndex* pindex)\n    {\n        vHave.clear();\n        int nStep = 1;\n        while (pindex)\n        {\n            vHave.push_back(pindex->GetBlockHash());\n\n            // Exponentially larger steps back\n            for (int i = 0; pindex && i < nStep; i++)\n                pindex = pindex->pprev;\n            if (vHave.size() > 10)\n                nStep *= 2;\n        }\n        vHave.push_back((!fTestNet ? hashGenesisBlock : hashGenesisBlockTestNet));\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCBlockLocator {\n  void Set(const CBlockIndex* pindex)\n      {\n          vHave.clear();\n          int nStep = 1;\n          while (pindex)\n          {\n              vHave.push_back(pindex->GetBlockHash());\n  \n              // Exponentially larger steps back\n              for (int i = 0; pindex && i < nStep; i++)\n                  pindex = pindex->pprev;\n              if (vHave.size() > 10)\n                  nStep *= 2;\n          }\n          vHave.push_back((!fTestNet ? hashGenesisBlock : hashGenesisBlockTestNet));\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "blockId.SetHex",
          "args": [
            "params[0].get_str()"
          ],
          "line": 1222
        },
        "resolved": true,
        "details": {
          "function_name": "SetHex",
          "container": "CBigNum",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bignum.h",
          "lines": "346-374",
          "snippet": "void SetHex(const std::string& str)\n    {\n        // skip 0x\n        const char* psz = str.c_str();\n        while (isspace(*psz))\n            psz++;\n        bool fNegative = false;\n        if (*psz == '-')\n        {\n            fNegative = true;\n            psz++;\n        }\n        if (psz[0] == '0' && tolower(psz[1]) == 'x')\n            psz += 2;\n        while (isspace(*psz))\n            psz++;\n\n        // hex string to bignum\n        static const signed char phexdigit[256] = { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,1,2,3,4,5,6,7,8,9,0,0,0,0,0,0, 0,0xa,0xb,0xc,0xd,0xe,0xf,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0xa,0xb,0xc,0xd,0xe,0xf,0,0,0,0,0,0,0,0,0 };\n        *this = 0;\n        while (isxdigit(*psz))\n        {\n            *this <<= 4;\n            int n = phexdigit[(unsigned char)*psz++];\n            *this += n;\n        }\n        if (fNegative)\n            *this = 0 - *this;\n    }",
          "includes": [
            "#include <stdint.h>",
            "#include <vector>",
            "#include <stdexcept>",
            "#include <openssl/bn.h>",
            "#include \"version.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdint.h>\n#include <vector>\n#include <stdexcept>\n#include <openssl/bn.h>\n#include \"version.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n\nCBigNum {\n  void SetHex(const std::string& str)\n      {\n          // skip 0x\n          const char* psz = str.c_str();\n          while (isspace(*psz))\n              psz++;\n          bool fNegative = false;\n          if (*psz == '-')\n          {\n              fNegative = true;\n              psz++;\n          }\n          if (psz[0] == '0' && tolower(psz[1]) == 'x')\n              psz += 2;\n          while (isspace(*psz))\n              psz++;\n  \n          // hex string to bignum\n          static const signed char phexdigit[256] = { 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,1,2,3,4,5,6,7,8,9,0,0,0,0,0,0, 0,0xa,0xb,0xc,0xd,0xe,0xf,0,0,0,0,0,0,0,0,0, 0,0,0,0,0,0,0,0,0,0,0,0,0,0,0,0, 0,0xa,0xb,0xc,0xd,0xe,0xf,0,0,0,0,0,0,0,0,0 };\n          *this = 0;\n          while (isxdigit(*psz))\n          {\n              *this <<= 4;\n              int n = phexdigit[(unsigned char)*psz++];\n              *this += n;\n          }\n          if (fNegative)\n              *this = 0 - *this;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 1222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"listsinceblock [blockhash] [target-confirmations]\\n\"\n            \"Get all transactions in blocks since block [blockhash], or all transactions if omitted\""
          ],
          "line": 1211
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue listsinceblock(const Array& params, bool fHelp)\n{\n    if (fHelp)\n        throw runtime_error(\n            \"listsinceblock [blockhash] [target-confirmations]\\n\"\n            \"Get all transactions in blocks since block [blockhash], or all transactions if omitted\");\n\n    CBlockIndex *pindex = NULL;\n    int target_confirms = 1;\n\n    if (params.size() > 0)\n    {\n        uint256 blockId = 0;\n\n        blockId.SetHex(params[0].get_str());\n        pindex = CBlockLocator(blockId).GetBlockIndex();\n    }\n\n    if (params.size() > 1)\n    {\n        target_confirms = params[1].get_int();\n\n        if (target_confirms < 1)\n            throw JSONRPCError(RPC_INVALID_PARAMETER, \"Invalid parameter\");\n    }\n\n    int depth = pindex ? (1 + nBestHeight - pindex->nHeight) : -1;\n\n    Array transactions;\n\n    for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); it++)\n    {\n        CWalletTx tx = (*it).second;\n\n        if (depth == -1 || tx.GetDepthInMainChain() < depth)\n            ListTransactions(tx, \"*\", 0, true, transactions);\n    }\n\n    uint256 lastblock;\n\n    if (target_confirms == 1)\n    {\n        lastblock = hashBestChain;\n    }\n    else\n    {\n        int target_height = pindexBest->nHeight + 1 - target_confirms;\n\n        CBlockIndex *block;\n        for (block = pindexBest;\n             block && block->nHeight > target_height;\n             block = block->pprev)  { }\n\n        lastblock = block ? block->GetBlockHash() : 0;\n    }\n\n    Object ret;\n    ret.push_back(Pair(\"transactions\", transactions));\n    ret.push_back(Pair(\"lastblock\", lastblock.GetHex()));\n\n    return ret;\n}"
  },
  {
    "function_name": "listaccounts",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1153-1206",
    "snippet": "Value listaccounts(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 1)\n        throw runtime_error(\n            \"listaccounts [minconf=1]\\n\"\n            \"Returns Object that has account names as keys, account balances as values.\");\n\n    accountingDeprecationCheck();\n\n    int nMinDepth = 1;\n    if (params.size() > 0)\n        nMinDepth = params[0].get_int();\n\n    map<string, int64_t> mapAccountBalances;\n    BOOST_FOREACH(const PAIRTYPE(CTxDestination, string)& entry, pwalletMain->mapAddressBook) {\n        if (IsMine(*pwalletMain, entry.first)) // This address belongs to me\n            mapAccountBalances[entry.second] = 0;\n    }\n\n    for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); ++it)\n    {\n        const CWalletTx& wtx = (*it).second;\n        int64_t nFee;\n        string strSentAccount;\n        list<pair<CTxDestination, int64_t> > listReceived;\n        list<pair<CTxDestination, int64_t> > listSent;\n        int nDepth = wtx.GetDepthInMainChain();\n        if (nDepth < 0)\n            continue;\n        wtx.GetAmounts(listReceived, listSent, nFee, strSentAccount);\n        mapAccountBalances[strSentAccount] -= nFee;\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& s, listSent)\n            mapAccountBalances[strSentAccount] -= s.second;\n        if (nDepth >= nMinDepth && wtx.GetBlocksToMaturity() == 0)\n        {\n            BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& r, listReceived)\n                if (pwalletMain->mapAddressBook.count(r.first))\n                    mapAccountBalances[pwalletMain->mapAddressBook[r.first]] += r.second;\n                else\n                    mapAccountBalances[\"\"] += r.second;\n        }\n    }\n\n    list<CAccountingEntry> acentries;\n    CWalletDB(pwalletMain->strWalletFile).ListAccountCreditDebit(\"*\", acentries);\n    BOOST_FOREACH(const CAccountingEntry& entry, acentries)\n        mapAccountBalances[entry.strAccount] += entry.nCreditDebit;\n\n    Object ret;\n    BOOST_FOREACH(const PAIRTYPE(string, int64_t)& accountBalance, mapAccountBalances) {\n        ret.push_back(Pair(accountBalance.first, ValueFromAmount(accountBalance.second)));\n    }\n    return ret;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "extern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "Pair(accountBalance.first, ValueFromAmount(accountBalance.second))"
          ],
          "line": 1203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "accountBalance.first",
            "ValueFromAmount(accountBalance.second)"
          ],
          "line": 1203
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ValueFromAmount",
          "args": [
            "accountBalance.second"
          ],
          "line": 1203
        },
        "resolved": true,
        "details": {
          "function_name": "ValueFromAmount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "113-116",
          "snippet": "Value ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nValue ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}"
        }
      },
      {
        "call_info": {
          "callee": "CWalletDB",
          "args": [
            "\"*\"",
            "acentries"
          ],
          "line": 1197
        },
        "resolved": true,
        "details": {
          "function_name": "WriteSetting",
          "container": "CWalletDB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/walletdb.h",
          "lines": "173-177",
          "snippet": "bool WriteSetting(const std::string& strKey, const T& value)\n    {\n        nWalletDBUpdated++;\n        return Write(std::make_pair(std::string(\"setting\"), strKey), value);\n    }",
          "includes": [
            "#include \"base58.h\"",
            "#include \"db.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"db.h\"\n\nCWalletDB {\n  bool WriteSetting(const std::string& strKey, const T& value)\n      {\n          nWalletDBUpdated++;\n          return Write(std::make_pair(std::string(\"setting\"), strKey), value);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "CWalletDB",
          "args": [
            "pwalletMain->strWalletFile"
          ],
          "line": 1197
        },
        "resolved": true,
        "details": {
          "function_name": "WriteMinVersion",
          "container": "CWalletDB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/walletdb.h",
          "lines": "184-187",
          "snippet": "bool WriteMinVersion(int nVersion)\n    {\n        return Write(std::string(\"minversion\"), nVersion);\n    }",
          "includes": [
            "#include \"base58.h\"",
            "#include \"db.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"db.h\"\n\nCWalletDB {\n  bool WriteMinVersion(int nVersion)\n      {\n          return Write(std::string(\"minversion\"), nVersion);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapAddressBook.count",
          "args": [
            "r.first"
          ],
          "line": 1189
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetBlocksToMaturity",
          "args": [],
          "line": 1186
        },
        "resolved": true,
        "details": {
          "function_name": "GetBlocksToMaturity",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
          "lines": "817-822",
          "snippet": "int CMerkleTx::GetBlocksToMaturity() const\n{\n    if (!(IsCoinBase() || IsCoinStake()))\n        return 0;\n    return max(0, (nCoinbaseMaturity+10) - GetDepthInMainChain());\n}",
          "includes": [
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"kernel.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"txdb.h\"",
            "#include \"db.h\"",
            "#include \"checkpoints.h\"",
            "#include \"alert.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int nCoinbaseMaturity = 50;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/algorithm/string/replace.hpp>\n#include \"kernel.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"txdb.h\"\n#include \"db.h\"\n#include \"checkpoints.h\"\n#include \"alert.h\"\n\nint nCoinbaseMaturity = 50;\n\nCMerkleTx {\n  int CMerkleTx::GetBlocksToMaturity() const\n  {\n      if (!(IsCoinBase() || IsCoinStake()))\n          return 0;\n      return max(0, (nCoinbaseMaturity+10) - GetDepthInMainChain());\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetAmounts",
          "args": [
            "listReceived",
            "listSent",
            "nFee",
            "strSentAccount"
          ],
          "line": 1182
        },
        "resolved": true,
        "details": {
          "function_name": "GetAmounts",
          "container": "CWalletTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.cpp",
          "lines": "678-733",
          "snippet": "void CWalletTx::GetAmounts(list<pair<CTxDestination, int64_t> >& listReceived,\n                           list<pair<CTxDestination, int64_t> >& listSent, int64_t& nFee, string& strSentAccount) const\n{\n    nFee = 0;\n    listReceived.clear();\n    listSent.clear();\n    strSentAccount = strFromAccount;\n\n    // Compute fee:\n    int64_t nDebit = GetDebit();\n    if (nDebit > 0) // debit>0 means we signed/sent this transaction\n    {\n        int64_t nValueOut = GetValueOut();\n        nFee = nDebit - nValueOut;\n    }\n\n    // Sent/received.\n    BOOST_FOREACH(const CTxOut& txout, vout)\n    {\n        // Skip special stake out\n        if (txout.scriptPubKey.empty())\n            continue;\n\n        bool fIsMine;\n        // Only need to handle txouts if AT LEAST one of these is true:\n        //   1) they debit from us (sent)\n        //   2) the output is to us (received)\n        if (nDebit > 0)\n        {\n            // Don't report 'change' txouts\n            if (pwallet->IsChange(txout))\n                continue;\n            fIsMine = pwallet->IsMine(txout);\n        }\n        else if (!(fIsMine = pwallet->IsMine(txout)))\n            continue;\n\n        // In either case, we need to get the destination address\n        CTxDestination address;\n        if (!ExtractDestination(txout.scriptPubKey, address))\n        {\n            printf(\"CWalletTx::GetAmounts: Unknown transaction type found, txid %s\\n\",\n                   this->GetHash().ToString().c_str());\n            address = CNoDestination();\n        }\n\n        // If we are debited by the transaction, add the output as a \"sent\" entry\n        if (nDebit > 0)\n            listSent.push_back(make_pair(address, txout.nValue));\n\n        // If we are receiving the output, add it as a \"received\" entry\n        if (fIsMine)\n            listReceived.push_back(make_pair(address, txout.nValue));\n    }\n\n}",
          "includes": [
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"coincontrol.h\"",
            "#include \"kernel.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"crypter.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\"",
            "#include \"txdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/replace.hpp>\n#include \"coincontrol.h\"\n#include \"kernel.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"crypter.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n#include \"txdb.h\"\n\nCWalletTx {\n  void CWalletTx::GetAmounts(list<pair<CTxDestination, int64_t> >& listReceived,\n                             list<pair<CTxDestination, int64_t> >& listSent, int64_t& nFee, string& strSentAccount) const\n  {\n      nFee = 0;\n      listReceived.clear();\n      listSent.clear();\n      strSentAccount = strFromAccount;\n  \n      // Compute fee:\n      int64_t nDebit = GetDebit();\n      if (nDebit > 0) // debit>0 means we signed/sent this transaction\n      {\n          int64_t nValueOut = GetValueOut();\n          nFee = nDebit - nValueOut;\n      }\n  \n      // Sent/received.\n      BOOST_FOREACH(const CTxOut& txout, vout)\n      {\n          // Skip special stake out\n          if (txout.scriptPubKey.empty())\n              continue;\n  \n          bool fIsMine;\n          // Only need to handle txouts if AT LEAST one of these is true:\n          //   1) they debit from us (sent)\n          //   2) the output is to us (received)\n          if (nDebit > 0)\n          {\n              // Don't report 'change' txouts\n              if (pwallet->IsChange(txout))\n                  continue;\n              fIsMine = pwallet->IsMine(txout);\n          }\n          else if (!(fIsMine = pwallet->IsMine(txout)))\n              continue;\n  \n          // In either case, we need to get the destination address\n          CTxDestination address;\n          if (!ExtractDestination(txout.scriptPubKey, address))\n          {\n              printf(\"CWalletTx::GetAmounts: Unknown transaction type found, txid %s\\n\",\n                     this->GetHash().ToString().c_str());\n              address = CNoDestination();\n          }\n  \n          // If we are debited by the transaction, add the output as a \"sent\" entry\n          if (nDebit > 0)\n              listSent.push_back(make_pair(address, txout.nValue));\n  \n          // If we are receiving the output, add it as a \"received\" entry\n          if (fIsMine)\n              listReceived.push_back(make_pair(address, txout.nValue));\n      }\n  \n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetDepthInMainChain",
          "args": [],
          "line": 1179
        },
        "resolved": true,
        "details": {
          "function_name": "GetDepthInMainChain",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "765-765",
          "snippet": "int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCMerkleTx {\n  int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapWallet.end",
          "args": [],
          "line": 1172
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapWallet.begin",
          "args": [],
          "line": 1172
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "IsMine",
          "args": [
            "*pwalletMain",
            "entry.first"
          ],
          "line": 1168
        },
        "resolved": true,
        "details": {
          "function_name": "IsMine",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/script.cpp",
          "lines": "1551-1588",
          "snippet": "bool IsMine(const CKeyStore &keystore, const CScript& scriptPubKey)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    CKeyID keyID;\n    switch (whichType)\n    {\n    case TX_NONSTANDARD:\n        return false;\n    case TX_PUBKEY:\n        keyID = CPubKey(vSolutions[0]).GetID();\n        return keystore.HaveKey(keyID);\n    case TX_PUBKEYHASH:\n        keyID = CKeyID(uint160(vSolutions[0]));\n        return keystore.HaveKey(keyID);\n    case TX_SCRIPTHASH:\n    {\n        CScript subscript;\n        if (!keystore.GetCScript(CScriptID(uint160(vSolutions[0])), subscript))\n            return false;\n        return IsMine(keystore, subscript);\n    }\n    case TX_MULTISIG:\n    {\n        // Only consider transactions \"mine\" if we own ALL the\n        // keys involved. multi-signature transactions that are\n        // partially owned (somebody else has a key that can spend\n        // them) enable spend-out-from-under-you attacks, especially\n        // in shared-wallet situations.\n        vector<valtype> keys(vSolutions.begin()+1, vSolutions.begin()+vSolutions.size()-1);\n        return HaveKeys(keys, keystore) == keys.size();\n    }\n    }\n    return false;\n}",
          "includes": [
            "#include \"util.h\"",
            "#include \"sync.h\"",
            "#include \"main.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include \"keystore.h\"",
            "#include \"script.h\"",
            "#include <boost/tuple/tuple_comparison.hpp>",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/foreach.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"sync.h\"\n#include \"main.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include \"keystore.h\"\n#include \"script.h\"\n#include <boost/tuple/tuple_comparison.hpp>\n#include <boost/tuple/tuple.hpp>\n#include <boost/foreach.hpp>\n\nbool IsMine(const CKeyStore &keystore, const CScript& scriptPubKey)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    CKeyID keyID;\n    switch (whichType)\n    {\n    case TX_NONSTANDARD:\n        return false;\n    case TX_PUBKEY:\n        keyID = CPubKey(vSolutions[0]).GetID();\n        return keystore.HaveKey(keyID);\n    case TX_PUBKEYHASH:\n        keyID = CKeyID(uint160(vSolutions[0]));\n        return keystore.HaveKey(keyID);\n    case TX_SCRIPTHASH:\n    {\n        CScript subscript;\n        if (!keystore.GetCScript(CScriptID(uint160(vSolutions[0])), subscript))\n            return false;\n        return IsMine(keystore, subscript);\n    }\n    case TX_MULTISIG:\n    {\n        // Only consider transactions \"mine\" if we own ALL the\n        // keys involved. multi-signature transactions that are\n        // partially owned (somebody else has a key that can spend\n        // them) enable spend-out-from-under-you attacks, especially\n        // in shared-wallet situations.\n        vector<valtype> keys(vSolutions.begin()+1, vSolutions.begin()+vSolutions.size()-1);\n        return HaveKeys(keys, keystore) == keys.size();\n    }\n    }\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_int",
          "args": [],
          "line": 1164
        },
        "resolved": true,
        "details": {
          "function_name": "get_int",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "385-390",
          "snippet": "int Value_impl< Config >::get_int() const\n    {\n        check_type(  int_type );\n\n        return static_cast< int >( get_int64() );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  int Value_impl< Config >::get_int() const\n      {\n          check_type(  int_type );\n  \n          return static_cast< int >( get_int64() );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 1163
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "accountingDeprecationCheck",
          "args": [],
          "line": 1160
        },
        "resolved": true,
        "details": {
          "function_name": "accountingDeprecationCheck",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "22-32",
          "snippet": "static void accountingDeprecationCheck()\n{\n    if (!GetBoolArg(\"-enableaccounts\", false))\n        throw runtime_error(\n            \"Accounting API is deprecated and will be removed in future.\\n\"\n            \"It can easily result in negative or odd balances if misused or misunderstood, which has happened in the field.\\n\"\n            \"If you still want to enable it, add to your config file enableaccounts=1\\n\");\n\n    if (GetBoolArg(\"-staking\", true))\n        throw runtime_error(\"If you want to use accounting API, staking must be disabled, add to your config file staking=0\\n\");\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstatic void accountingDeprecationCheck()\n{\n    if (!GetBoolArg(\"-enableaccounts\", false))\n        throw runtime_error(\n            \"Accounting API is deprecated and will be removed in future.\\n\"\n            \"It can easily result in negative or odd balances if misused or misunderstood, which has happened in the field.\\n\"\n            \"If you still want to enable it, add to your config file enableaccounts=1\\n\");\n\n    if (GetBoolArg(\"-staking\", true))\n        throw runtime_error(\"If you want to use accounting API, staking must be disabled, add to your config file staking=0\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"listaccounts [minconf=1]\\n\"\n            \"Returns Object that has account names as keys, account balances as values.\""
          ],
          "line": 1156
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nextern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);\n\nValue listaccounts(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 1)\n        throw runtime_error(\n            \"listaccounts [minconf=1]\\n\"\n            \"Returns Object that has account names as keys, account balances as values.\");\n\n    accountingDeprecationCheck();\n\n    int nMinDepth = 1;\n    if (params.size() > 0)\n        nMinDepth = params[0].get_int();\n\n    map<string, int64_t> mapAccountBalances;\n    BOOST_FOREACH(const PAIRTYPE(CTxDestination, string)& entry, pwalletMain->mapAddressBook) {\n        if (IsMine(*pwalletMain, entry.first)) // This address belongs to me\n            mapAccountBalances[entry.second] = 0;\n    }\n\n    for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); ++it)\n    {\n        const CWalletTx& wtx = (*it).second;\n        int64_t nFee;\n        string strSentAccount;\n        list<pair<CTxDestination, int64_t> > listReceived;\n        list<pair<CTxDestination, int64_t> > listSent;\n        int nDepth = wtx.GetDepthInMainChain();\n        if (nDepth < 0)\n            continue;\n        wtx.GetAmounts(listReceived, listSent, nFee, strSentAccount);\n        mapAccountBalances[strSentAccount] -= nFee;\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& s, listSent)\n            mapAccountBalances[strSentAccount] -= s.second;\n        if (nDepth >= nMinDepth && wtx.GetBlocksToMaturity() == 0)\n        {\n            BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& r, listReceived)\n                if (pwalletMain->mapAddressBook.count(r.first))\n                    mapAccountBalances[pwalletMain->mapAddressBook[r.first]] += r.second;\n                else\n                    mapAccountBalances[\"\"] += r.second;\n        }\n    }\n\n    list<CAccountingEntry> acentries;\n    CWalletDB(pwalletMain->strWalletFile).ListAccountCreditDebit(\"*\", acentries);\n    BOOST_FOREACH(const CAccountingEntry& entry, acentries)\n        mapAccountBalances[entry.strAccount] += entry.nCreditDebit;\n\n    Object ret;\n    BOOST_FOREACH(const PAIRTYPE(string, int64_t)& accountBalance, mapAccountBalances) {\n        ret.push_back(Pair(accountBalance.first, ValueFromAmount(accountBalance.second)));\n    }\n    return ret;\n}"
  },
  {
    "function_name": "listtransactions",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1095-1151",
    "snippet": "Value listtransactions(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 3)\n        throw runtime_error(\n            \"listtransactions [account] [count=10] [from=0]\\n\"\n            \"Returns up to [count] most recent transactions skipping the first [from] transactions for account [account].\");\n\n    string strAccount = \"*\";\n    if (params.size() > 0)\n        strAccount = params[0].get_str();\n    int nCount = 10;\n    if (params.size() > 1)\n        nCount = params[1].get_int();\n    int nFrom = 0;\n    if (params.size() > 2)\n        nFrom = params[2].get_int();\n\n    if (nCount < 0)\n        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Negative count\");\n    if (nFrom < 0)\n        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Negative from\");\n\n    Array ret;\n\n    std::list<CAccountingEntry> acentries;\n    CWallet::TxItems txOrdered = pwalletMain->OrderedTxItems(acentries, strAccount);\n\n    // iterate backwards until we have nCount items to return:\n    for (CWallet::TxItems::reverse_iterator it = txOrdered.rbegin(); it != txOrdered.rend(); ++it)\n    {\n        CWalletTx *const pwtx = (*it).second.first;\n        if (pwtx != 0)\n            ListTransactions(*pwtx, strAccount, 0, true, ret);\n        CAccountingEntry *const pacentry = (*it).second.second;\n        if (pacentry != 0)\n            AcentryToJSON(*pacentry, strAccount, ret);\n\n        if ((int)ret.size() >= (nCount+nFrom)) break;\n    }\n    // ret is newest to oldest\n\n    if (nFrom > (int)ret.size())\n        nFrom = ret.size();\n    if ((nFrom + nCount) > (int)ret.size())\n        nCount = ret.size() - nFrom;\n    Array::iterator first = ret.begin();\n    std::advance(first, nFrom);\n    Array::iterator last = ret.begin();\n    std::advance(last, nFrom+nCount);\n\n    if (last != ret.end()) ret.erase(last, ret.end());\n    if (first != ret.begin()) ret.erase(ret.begin(), first);\n\n    std::reverse(ret.begin(), ret.end()); // Return oldest to newest\n\n    return ret;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "std::reverse",
          "args": [
            "ret.begin()",
            "ret.end()"
          ],
          "line": 1148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ret.end",
          "args": [],
          "line": 1148
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ret.begin",
          "args": [],
          "line": 1148
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ret.erase",
          "args": [
            "ret.begin()",
            "first"
          ],
          "line": 1146
        },
        "resolved": true,
        "details": {
          "function_name": "erase",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "870-888",
          "snippet": "iterator erase(iterator first, iterator last)\n    {\n        if (first == vch.begin() + nReadPos)\n        {\n            // special case for erasing from the front\n            if (last == vch.end())\n            {\n                nReadPos = 0;\n                return vch.erase(vch.begin(), vch.end());\n            }\n            else\n            {\n                nReadPos = (last - vch.begin());\n                return last;\n            }\n        }\n        else\n            return vch.erase(first, last);\n    }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  iterator erase(iterator first, iterator last)\n      {\n          if (first == vch.begin() + nReadPos)\n          {\n              // special case for erasing from the front\n              if (last == vch.end())\n              {\n                  nReadPos = 0;\n                  return vch.erase(vch.begin(), vch.end());\n              }\n              else\n              {\n                  nReadPos = (last - vch.begin());\n                  return last;\n              }\n          }\n          else\n              return vch.erase(first, last);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "std::advance",
          "args": [
            "last",
            "nFrom+nCount"
          ],
          "line": 1143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::advance",
          "args": [
            "first",
            "nFrom"
          ],
          "line": 1141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ret.size",
          "args": [],
          "line": 1139
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "AcentryToJSON",
          "args": [
            "*pacentry",
            "strAccount",
            "ret"
          ],
          "line": 1130
        },
        "resolved": true,
        "details": {
          "function_name": "AcentryToJSON",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "1078-1093",
          "snippet": "void AcentryToJSON(const CAccountingEntry& acentry, const string& strAccount, Array& ret)\n{\n    bool fAllAccounts = (strAccount == string(\"*\"));\n\n    if (fAllAccounts || acentry.strAccount == strAccount)\n    {\n        Object entry;\n        entry.push_back(Pair(\"account\", acentry.strAccount));\n        entry.push_back(Pair(\"category\", \"move\"));\n        entry.push_back(Pair(\"time\", (boost::int64_t)acentry.nTime));\n        entry.push_back(Pair(\"amount\", ValueFromAmount(acentry.nCreditDebit)));\n        entry.push_back(Pair(\"otheraccount\", acentry.strOtherAccount));\n        entry.push_back(Pair(\"comment\", acentry.strComment));\n        ret.push_back(entry);\n    }\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "extern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nextern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);\n\nvoid AcentryToJSON(const CAccountingEntry& acentry, const string& strAccount, Array& ret)\n{\n    bool fAllAccounts = (strAccount == string(\"*\"));\n\n    if (fAllAccounts || acentry.strAccount == strAccount)\n    {\n        Object entry;\n        entry.push_back(Pair(\"account\", acentry.strAccount));\n        entry.push_back(Pair(\"category\", \"move\"));\n        entry.push_back(Pair(\"time\", (boost::int64_t)acentry.nTime));\n        entry.push_back(Pair(\"amount\", ValueFromAmount(acentry.nCreditDebit)));\n        entry.push_back(Pair(\"otheraccount\", acentry.strOtherAccount));\n        entry.push_back(Pair(\"comment\", acentry.strComment));\n        ret.push_back(entry);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ListTransactions",
          "args": [
            "*pwtx",
            "strAccount",
            "0",
            "true",
            "ret"
          ],
          "line": 1127
        },
        "resolved": true,
        "details": {
          "function_name": "ListTransactions",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "1006-1076",
          "snippet": "void ListTransactions(const CWalletTx& wtx, const string& strAccount, int nMinDepth, bool fLong, Array& ret)\n{\n    int64_t nFee;\n    string strSentAccount;\n    list<pair<CTxDestination, int64_t> > listReceived;\n    list<pair<CTxDestination, int64_t> > listSent;\n\n    wtx.GetAmounts(listReceived, listSent, nFee, strSentAccount);\n\n    bool fAllAccounts = (strAccount == string(\"*\"));\n\n    // Sent\n    if ((!wtx.IsCoinStake()) && (!listSent.empty() || nFee != 0) && (fAllAccounts || strAccount == strSentAccount))\n    {\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& s, listSent)\n        {\n            Object entry;\n            entry.push_back(Pair(\"account\", strSentAccount));\n            MaybePushAddress(entry, s.first);\n            entry.push_back(Pair(\"category\", \"send\"));\n            entry.push_back(Pair(\"amount\", ValueFromAmount(-s.second)));\n            entry.push_back(Pair(\"fee\", ValueFromAmount(-nFee)));\n            if (fLong)\n                WalletTxToJSON(wtx, entry);\n            ret.push_back(entry);\n        }\n    }\n\n    // Received\n    if (listReceived.size() > 0 && wtx.GetDepthInMainChain() >= nMinDepth)\n    {\n        bool stop = false;\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& r, listReceived)\n        {\n            string account;\n            if (pwalletMain->mapAddressBook.count(r.first))\n                account = pwalletMain->mapAddressBook[r.first];\n            if (fAllAccounts || (account == strAccount))\n            {\n                Object entry;\n                entry.push_back(Pair(\"account\", account));\n                MaybePushAddress(entry, r.first);\n                if (wtx.IsCoinBase() || wtx.IsCoinStake())\n                {\n                    if (wtx.GetDepthInMainChain() < 1)\n                        entry.push_back(Pair(\"category\", \"orphan\"));\n                    else if (wtx.GetBlocksToMaturity() > 0)\n                        entry.push_back(Pair(\"category\", \"immature\"));\n                    else\n                        entry.push_back(Pair(\"category\", \"generate\"));\n                }\n                else\n                {\n                    entry.push_back(Pair(\"category\", \"receive\"));\n                }\n                if (!wtx.IsCoinStake())\n                    entry.push_back(Pair(\"amount\", ValueFromAmount(r.second)));\n                else\n                {\n                    entry.push_back(Pair(\"amount\", ValueFromAmount(-nFee)));\n                    stop = true; // only one coinstake output\n                }\n                if (fLong)\n                    WalletTxToJSON(wtx, entry);\n                ret.push_back(entry);\n            }\n            if (stop)\n                break;\n        }\n    }\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "extern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nextern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);\n\nvoid ListTransactions(const CWalletTx& wtx, const string& strAccount, int nMinDepth, bool fLong, Array& ret)\n{\n    int64_t nFee;\n    string strSentAccount;\n    list<pair<CTxDestination, int64_t> > listReceived;\n    list<pair<CTxDestination, int64_t> > listSent;\n\n    wtx.GetAmounts(listReceived, listSent, nFee, strSentAccount);\n\n    bool fAllAccounts = (strAccount == string(\"*\"));\n\n    // Sent\n    if ((!wtx.IsCoinStake()) && (!listSent.empty() || nFee != 0) && (fAllAccounts || strAccount == strSentAccount))\n    {\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& s, listSent)\n        {\n            Object entry;\n            entry.push_back(Pair(\"account\", strSentAccount));\n            MaybePushAddress(entry, s.first);\n            entry.push_back(Pair(\"category\", \"send\"));\n            entry.push_back(Pair(\"amount\", ValueFromAmount(-s.second)));\n            entry.push_back(Pair(\"fee\", ValueFromAmount(-nFee)));\n            if (fLong)\n                WalletTxToJSON(wtx, entry);\n            ret.push_back(entry);\n        }\n    }\n\n    // Received\n    if (listReceived.size() > 0 && wtx.GetDepthInMainChain() >= nMinDepth)\n    {\n        bool stop = false;\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& r, listReceived)\n        {\n            string account;\n            if (pwalletMain->mapAddressBook.count(r.first))\n                account = pwalletMain->mapAddressBook[r.first];\n            if (fAllAccounts || (account == strAccount))\n            {\n                Object entry;\n                entry.push_back(Pair(\"account\", account));\n                MaybePushAddress(entry, r.first);\n                if (wtx.IsCoinBase() || wtx.IsCoinStake())\n                {\n                    if (wtx.GetDepthInMainChain() < 1)\n                        entry.push_back(Pair(\"category\", \"orphan\"));\n                    else if (wtx.GetBlocksToMaturity() > 0)\n                        entry.push_back(Pair(\"category\", \"immature\"));\n                    else\n                        entry.push_back(Pair(\"category\", \"generate\"));\n                }\n                else\n                {\n                    entry.push_back(Pair(\"category\", \"receive\"));\n                }\n                if (!wtx.IsCoinStake())\n                    entry.push_back(Pair(\"amount\", ValueFromAmount(r.second)));\n                else\n                {\n                    entry.push_back(Pair(\"amount\", ValueFromAmount(-nFee)));\n                    stop = true; // only one coinstake output\n                }\n                if (fLong)\n                    WalletTxToJSON(wtx, entry);\n                ret.push_back(entry);\n            }\n            if (stop)\n                break;\n        }\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "txOrdered.rend",
          "args": [],
          "line": 1123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "txOrdered.rbegin",
          "args": [],
          "line": 1123
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->OrderedTxItems",
          "args": [
            "acentries",
            "strAccount"
          ],
          "line": 1120
        },
        "resolved": true,
        "details": {
          "function_name": "OrderedTxItems",
          "container": "CWallet",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.cpp",
          "lines": "338-360",
          "snippet": "CWallet::TxItems CWallet::OrderedTxItems(std::list<CAccountingEntry>& acentries, std::string strAccount)\n{\n    CWalletDB walletdb(strWalletFile);\n\n    // First: get all CWalletTx and CAccountingEntry into a sorted-by-order multimap.\n    TxItems txOrdered;\n\n    // Note: maintaining indices in the database of (account,time) --> txid and (account, time) --> acentry\n    // would make this much faster for applications that do this a lot.\n    for (map<uint256, CWalletTx>::iterator it = mapWallet.begin(); it != mapWallet.end(); ++it)\n    {\n        CWalletTx* wtx = &((*it).second);\n        txOrdered.insert(make_pair(wtx->nOrderPos, TxPair(wtx, (CAccountingEntry*)0)));\n    }\n    acentries.clear();\n    walletdb.ListAccountCreditDebit(strAccount, acentries);\n    BOOST_FOREACH(CAccountingEntry& entry, acentries)\n    {\n        txOrdered.insert(make_pair(entry.nOrderPos, TxPair((CWalletTx*)0, &entry)));\n    }\n\n    return txOrdered;\n}",
          "includes": [
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"coincontrol.h\"",
            "#include \"kernel.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"crypter.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\"",
            "#include \"txdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/replace.hpp>\n#include \"coincontrol.h\"\n#include \"kernel.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"crypter.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n#include \"txdb.h\"\n\nCWallet {\n  CWallet::TxItems CWallet::OrderedTxItems(std::list<CAccountingEntry>& acentries, std::string strAccount)\n  {\n      CWalletDB walletdb(strWalletFile);\n  \n      // First: get all CWalletTx and CAccountingEntry into a sorted-by-order multimap.\n      TxItems txOrdered;\n  \n      // Note: maintaining indices in the database of (account,time) --> txid and (account, time) --> acentry\n      // would make this much faster for applications that do this a lot.\n      for (map<uint256, CWalletTx>::iterator it = mapWallet.begin(); it != mapWallet.end(); ++it)\n      {\n          CWalletTx* wtx = &((*it).second);\n          txOrdered.insert(make_pair(wtx->nOrderPos, TxPair(wtx, (CAccountingEntry*)0)));\n      }\n      acentries.clear();\n      walletdb.ListAccountCreditDebit(strAccount, acentries);\n      BOOST_FOREACH(CAccountingEntry& entry, acentries)\n      {\n          txOrdered.insert(make_pair(entry.nOrderPos, TxPair((CWalletTx*)0, &entry)));\n      }\n  \n      return txOrdered;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_INVALID_PARAMETER",
            "\"Negative from\""
          ],
          "line": 1115
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[2].get_int",
          "args": [],
          "line": 1110
        },
        "resolved": true,
        "details": {
          "function_name": "get_int",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "385-390",
          "snippet": "int Value_impl< Config >::get_int() const\n    {\n        check_type(  int_type );\n\n        return static_cast< int >( get_int64() );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  int Value_impl< Config >::get_int() const\n      {\n          check_type(  int_type );\n  \n          return static_cast< int >( get_int64() );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 1104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"listtransactions [account] [count=10] [from=0]\\n\"\n            \"Returns up to [count] most recent transactions skipping the first [from] transactions for account [account].\""
          ],
          "line": 1098
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue listtransactions(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 3)\n        throw runtime_error(\n            \"listtransactions [account] [count=10] [from=0]\\n\"\n            \"Returns up to [count] most recent transactions skipping the first [from] transactions for account [account].\");\n\n    string strAccount = \"*\";\n    if (params.size() > 0)\n        strAccount = params[0].get_str();\n    int nCount = 10;\n    if (params.size() > 1)\n        nCount = params[1].get_int();\n    int nFrom = 0;\n    if (params.size() > 2)\n        nFrom = params[2].get_int();\n\n    if (nCount < 0)\n        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Negative count\");\n    if (nFrom < 0)\n        throw JSONRPCError(RPC_INVALID_PARAMETER, \"Negative from\");\n\n    Array ret;\n\n    std::list<CAccountingEntry> acentries;\n    CWallet::TxItems txOrdered = pwalletMain->OrderedTxItems(acentries, strAccount);\n\n    // iterate backwards until we have nCount items to return:\n    for (CWallet::TxItems::reverse_iterator it = txOrdered.rbegin(); it != txOrdered.rend(); ++it)\n    {\n        CWalletTx *const pwtx = (*it).second.first;\n        if (pwtx != 0)\n            ListTransactions(*pwtx, strAccount, 0, true, ret);\n        CAccountingEntry *const pacentry = (*it).second.second;\n        if (pacentry != 0)\n            AcentryToJSON(*pacentry, strAccount, ret);\n\n        if ((int)ret.size() >= (nCount+nFrom)) break;\n    }\n    // ret is newest to oldest\n\n    if (nFrom > (int)ret.size())\n        nFrom = ret.size();\n    if ((nFrom + nCount) > (int)ret.size())\n        nCount = ret.size() - nFrom;\n    Array::iterator first = ret.begin();\n    std::advance(first, nFrom);\n    Array::iterator last = ret.begin();\n    std::advance(last, nFrom+nCount);\n\n    if (last != ret.end()) ret.erase(last, ret.end());\n    if (first != ret.begin()) ret.erase(ret.begin(), first);\n\n    std::reverse(ret.begin(), ret.end()); // Return oldest to newest\n\n    return ret;\n}"
  },
  {
    "function_name": "AcentryToJSON",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1078-1093",
    "snippet": "void AcentryToJSON(const CAccountingEntry& acentry, const string& strAccount, Array& ret)\n{\n    bool fAllAccounts = (strAccount == string(\"*\"));\n\n    if (fAllAccounts || acentry.strAccount == strAccount)\n    {\n        Object entry;\n        entry.push_back(Pair(\"account\", acentry.strAccount));\n        entry.push_back(Pair(\"category\", \"move\"));\n        entry.push_back(Pair(\"time\", (boost::int64_t)acentry.nTime));\n        entry.push_back(Pair(\"amount\", ValueFromAmount(acentry.nCreditDebit)));\n        entry.push_back(Pair(\"otheraccount\", acentry.strOtherAccount));\n        entry.push_back(Pair(\"comment\", acentry.strComment));\n        ret.push_back(entry);\n    }\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "extern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "entry"
          ],
          "line": 1091
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"comment\", acentry.strComment)"
          ],
          "line": 1090
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"comment\"",
            "acentry.strComment"
          ],
          "line": 1090
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"otheraccount\", acentry.strOtherAccount)"
          ],
          "line": 1089
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"amount\", ValueFromAmount(acentry.nCreditDebit))"
          ],
          "line": 1088
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ValueFromAmount",
          "args": [
            "acentry.nCreditDebit"
          ],
          "line": 1088
        },
        "resolved": true,
        "details": {
          "function_name": "ValueFromAmount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "113-116",
          "snippet": "Value ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nValue ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"time\", (boost::int64_t)acentry.nTime)"
          ],
          "line": 1087
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"category\", \"move\")"
          ],
          "line": 1086
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"account\", acentry.strAccount)"
          ],
          "line": 1085
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "string",
          "args": [
            "\"*\""
          ],
          "line": 1080
        },
        "resolved": true,
        "details": {
          "function_name": "non_printable_to_string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_writer_template.h",
          "lines": "29-41",
          "snippet": "String_type non_printable_to_string( unsigned int c )\n    {\n        String_type result( 6, '\\\\' );\n\n        result[1] = 'u';\n\n        result[ 5 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 4 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 3 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 2 ] = to_hex_char( c & 0x000F );\n\n        return result;\n    }",
          "includes": [
            "#include <iomanip>",
            "#include <sstream>",
            "#include <cassert>",
            "#include \"json_spirit_value.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iomanip>\n#include <sstream>\n#include <cassert>\n#include \"json_spirit_value.h\"\n\nString_type non_printable_to_string( unsigned int c )\n    {\n        String_type result( 6, '\\\\' );\n\n        result[1] = 'u';\n\n        result[ 5 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 4 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 3 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 2 ] = to_hex_char( c & 0x000F );\n\n        return result;\n    }"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nextern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);\n\nvoid AcentryToJSON(const CAccountingEntry& acentry, const string& strAccount, Array& ret)\n{\n    bool fAllAccounts = (strAccount == string(\"*\"));\n\n    if (fAllAccounts || acentry.strAccount == strAccount)\n    {\n        Object entry;\n        entry.push_back(Pair(\"account\", acentry.strAccount));\n        entry.push_back(Pair(\"category\", \"move\"));\n        entry.push_back(Pair(\"time\", (boost::int64_t)acentry.nTime));\n        entry.push_back(Pair(\"amount\", ValueFromAmount(acentry.nCreditDebit)));\n        entry.push_back(Pair(\"otheraccount\", acentry.strOtherAccount));\n        entry.push_back(Pair(\"comment\", acentry.strComment));\n        ret.push_back(entry);\n    }\n}"
  },
  {
    "function_name": "ListTransactions",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "1006-1076",
    "snippet": "void ListTransactions(const CWalletTx& wtx, const string& strAccount, int nMinDepth, bool fLong, Array& ret)\n{\n    int64_t nFee;\n    string strSentAccount;\n    list<pair<CTxDestination, int64_t> > listReceived;\n    list<pair<CTxDestination, int64_t> > listSent;\n\n    wtx.GetAmounts(listReceived, listSent, nFee, strSentAccount);\n\n    bool fAllAccounts = (strAccount == string(\"*\"));\n\n    // Sent\n    if ((!wtx.IsCoinStake()) && (!listSent.empty() || nFee != 0) && (fAllAccounts || strAccount == strSentAccount))\n    {\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& s, listSent)\n        {\n            Object entry;\n            entry.push_back(Pair(\"account\", strSentAccount));\n            MaybePushAddress(entry, s.first);\n            entry.push_back(Pair(\"category\", \"send\"));\n            entry.push_back(Pair(\"amount\", ValueFromAmount(-s.second)));\n            entry.push_back(Pair(\"fee\", ValueFromAmount(-nFee)));\n            if (fLong)\n                WalletTxToJSON(wtx, entry);\n            ret.push_back(entry);\n        }\n    }\n\n    // Received\n    if (listReceived.size() > 0 && wtx.GetDepthInMainChain() >= nMinDepth)\n    {\n        bool stop = false;\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& r, listReceived)\n        {\n            string account;\n            if (pwalletMain->mapAddressBook.count(r.first))\n                account = pwalletMain->mapAddressBook[r.first];\n            if (fAllAccounts || (account == strAccount))\n            {\n                Object entry;\n                entry.push_back(Pair(\"account\", account));\n                MaybePushAddress(entry, r.first);\n                if (wtx.IsCoinBase() || wtx.IsCoinStake())\n                {\n                    if (wtx.GetDepthInMainChain() < 1)\n                        entry.push_back(Pair(\"category\", \"orphan\"));\n                    else if (wtx.GetBlocksToMaturity() > 0)\n                        entry.push_back(Pair(\"category\", \"immature\"));\n                    else\n                        entry.push_back(Pair(\"category\", \"generate\"));\n                }\n                else\n                {\n                    entry.push_back(Pair(\"category\", \"receive\"));\n                }\n                if (!wtx.IsCoinStake())\n                    entry.push_back(Pair(\"amount\", ValueFromAmount(r.second)));\n                else\n                {\n                    entry.push_back(Pair(\"amount\", ValueFromAmount(-nFee)));\n                    stop = true; // only one coinstake output\n                }\n                if (fLong)\n                    WalletTxToJSON(wtx, entry);\n                ret.push_back(entry);\n            }\n            if (stop)\n                break;\n        }\n    }\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "extern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "entry"
          ],
          "line": 1070
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WalletTxToJSON",
          "args": [
            "wtx",
            "entry"
          ],
          "line": 1069
        },
        "resolved": true,
        "details": {
          "function_name": "WalletTxToJSON",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "49-66",
          "snippet": "void WalletTxToJSON(const CWalletTx& wtx, Object& entry)\n{\n    int confirms = wtx.GetDepthInMainChain();\n    entry.push_back(Pair(\"confirmations\", confirms));\n    if (wtx.IsCoinBase() || wtx.IsCoinStake())\n        entry.push_back(Pair(\"generated\", true));\n    if (confirms > 0)\n    {\n        entry.push_back(Pair(\"blockhash\", wtx.hashBlock.GetHex()));\n        entry.push_back(Pair(\"blockindex\", wtx.nIndex));\n        entry.push_back(Pair(\"blocktime\", (boost::int64_t)(mapBlockIndex[wtx.hashBlock]->nTime)));\n    }\n    entry.push_back(Pair(\"txid\", wtx.GetHash().GetHex()));\n    entry.push_back(Pair(\"time\", (boost::int64_t)wtx.GetTxTime()));\n    entry.push_back(Pair(\"timereceived\", (boost::int64_t)wtx.nTimeReceived));\n    BOOST_FOREACH(const PAIRTYPE(string,string)& item, wtx.mapValue)\n        entry.push_back(Pair(item.first, item.second));\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "extern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nextern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);\n\nvoid WalletTxToJSON(const CWalletTx& wtx, Object& entry)\n{\n    int confirms = wtx.GetDepthInMainChain();\n    entry.push_back(Pair(\"confirmations\", confirms));\n    if (wtx.IsCoinBase() || wtx.IsCoinStake())\n        entry.push_back(Pair(\"generated\", true));\n    if (confirms > 0)\n    {\n        entry.push_back(Pair(\"blockhash\", wtx.hashBlock.GetHex()));\n        entry.push_back(Pair(\"blockindex\", wtx.nIndex));\n        entry.push_back(Pair(\"blocktime\", (boost::int64_t)(mapBlockIndex[wtx.hashBlock]->nTime)));\n    }\n    entry.push_back(Pair(\"txid\", wtx.GetHash().GetHex()));\n    entry.push_back(Pair(\"time\", (boost::int64_t)wtx.GetTxTime()));\n    entry.push_back(Pair(\"timereceived\", (boost::int64_t)wtx.nTimeReceived));\n    BOOST_FOREACH(const PAIRTYPE(string,string)& item, wtx.mapValue)\n        entry.push_back(Pair(item.first, item.second));\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"amount\", ValueFromAmount(-nFee))"
          ],
          "line": 1065
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"amount\"",
            "ValueFromAmount(-nFee)"
          ],
          "line": 1065
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ValueFromAmount",
          "args": [
            "-nFee"
          ],
          "line": 1065
        },
        "resolved": true,
        "details": {
          "function_name": "ValueFromAmount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "113-116",
          "snippet": "Value ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nValue ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"amount\", ValueFromAmount(r.second))"
          ],
          "line": 1062
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wtx.IsCoinStake",
          "args": [],
          "line": 1061
        },
        "resolved": true,
        "details": {
          "function_name": "IsCoinStake",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "542-546",
          "snippet": "bool IsCoinStake() const\n    {\n        // ppcoin: the coin stake transaction is marked with the first output empty\n        return (vin.size() > 0 && (!vin[0].prevout.IsNull()) && vout.size() >= 2 && vout[0].IsEmpty());\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  bool IsCoinStake() const\n      {\n          // ppcoin: the coin stake transaction is marked with the first output empty\n          return (vin.size() > 0 && (!vin[0].prevout.IsNull()) && vout.size() >= 2 && vout[0].IsEmpty());\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"category\", \"receive\")"
          ],
          "line": 1059
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"category\", \"generate\")"
          ],
          "line": 1055
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"category\", \"immature\")"
          ],
          "line": 1053
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wtx.GetBlocksToMaturity",
          "args": [],
          "line": 1052
        },
        "resolved": true,
        "details": {
          "function_name": "GetBlocksToMaturity",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
          "lines": "817-822",
          "snippet": "int CMerkleTx::GetBlocksToMaturity() const\n{\n    if (!(IsCoinBase() || IsCoinStake()))\n        return 0;\n    return max(0, (nCoinbaseMaturity+10) - GetDepthInMainChain());\n}",
          "includes": [
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"kernel.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"txdb.h\"",
            "#include \"db.h\"",
            "#include \"checkpoints.h\"",
            "#include \"alert.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int nCoinbaseMaturity = 50;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/algorithm/string/replace.hpp>\n#include \"kernel.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"txdb.h\"\n#include \"db.h\"\n#include \"checkpoints.h\"\n#include \"alert.h\"\n\nint nCoinbaseMaturity = 50;\n\nCMerkleTx {\n  int CMerkleTx::GetBlocksToMaturity() const\n  {\n      if (!(IsCoinBase() || IsCoinStake()))\n          return 0;\n      return max(0, (nCoinbaseMaturity+10) - GetDepthInMainChain());\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"category\", \"orphan\")"
          ],
          "line": 1051
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wtx.GetDepthInMainChain",
          "args": [],
          "line": 1050
        },
        "resolved": true,
        "details": {
          "function_name": "GetDepthInMainChain",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "765-765",
          "snippet": "int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCMerkleTx {\n  int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.IsCoinBase",
          "args": [],
          "line": 1048
        },
        "resolved": true,
        "details": {
          "function_name": "IsCoinBase",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "537-540",
          "snippet": "bool IsCoinBase() const\n    {\n        return (vin.size() == 1 && vin[0].prevout.IsNull() && vout.size() >= 1);\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  bool IsCoinBase() const\n      {\n          return (vin.size() == 1 && vin[0].prevout.IsNull() && vout.size() >= 1);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "MaybePushAddress",
          "args": [
            "entry",
            "r.first"
          ],
          "line": 1047
        },
        "resolved": true,
        "details": {
          "function_name": "MaybePushAddress",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "999-1004",
          "snippet": "static void MaybePushAddress(Object & entry, const CTxDestination &dest)\n{\n    CBitcoinAddress addr;\n    if (addr.Set(dest))\n        entry.push_back(Pair(\"address\", addr.ToString()));\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "extern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nextern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);\n\nstatic void MaybePushAddress(Object & entry, const CTxDestination &dest)\n{\n    CBitcoinAddress addr;\n    if (addr.Set(dest))\n        entry.push_back(Pair(\"address\", addr.ToString()));\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"account\", account)"
          ],
          "line": 1046
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapAddressBook.count",
          "args": [
            "r.first"
          ],
          "line": 1041
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "listReceived.size",
          "args": [],
          "line": 1035
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "entry"
          ],
          "line": 1030
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"fee\", ValueFromAmount(-nFee))"
          ],
          "line": 1027
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"amount\", ValueFromAmount(-s.second))"
          ],
          "line": 1026
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"category\", \"send\")"
          ],
          "line": 1025
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"account\", strSentAccount)"
          ],
          "line": 1023
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "listSent.empty",
          "args": [],
          "line": 1018
        },
        "resolved": true,
        "details": {
          "function_name": "empty",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "32-32",
          "snippet": "bool empty() const { return map.empty(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  bool empty() const { return map.empty(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "string",
          "args": [
            "\"*\""
          ],
          "line": 1015
        },
        "resolved": true,
        "details": {
          "function_name": "non_printable_to_string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_writer_template.h",
          "lines": "29-41",
          "snippet": "String_type non_printable_to_string( unsigned int c )\n    {\n        String_type result( 6, '\\\\' );\n\n        result[1] = 'u';\n\n        result[ 5 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 4 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 3 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 2 ] = to_hex_char( c & 0x000F );\n\n        return result;\n    }",
          "includes": [
            "#include <iomanip>",
            "#include <sstream>",
            "#include <cassert>",
            "#include \"json_spirit_value.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iomanip>\n#include <sstream>\n#include <cassert>\n#include \"json_spirit_value.h\"\n\nString_type non_printable_to_string( unsigned int c )\n    {\n        String_type result( 6, '\\\\' );\n\n        result[1] = 'u';\n\n        result[ 5 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 4 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 3 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 2 ] = to_hex_char( c & 0x000F );\n\n        return result;\n    }"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetAmounts",
          "args": [
            "listReceived",
            "listSent",
            "nFee",
            "strSentAccount"
          ],
          "line": 1013
        },
        "resolved": true,
        "details": {
          "function_name": "GetAmounts",
          "container": "CWalletTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.cpp",
          "lines": "678-733",
          "snippet": "void CWalletTx::GetAmounts(list<pair<CTxDestination, int64_t> >& listReceived,\n                           list<pair<CTxDestination, int64_t> >& listSent, int64_t& nFee, string& strSentAccount) const\n{\n    nFee = 0;\n    listReceived.clear();\n    listSent.clear();\n    strSentAccount = strFromAccount;\n\n    // Compute fee:\n    int64_t nDebit = GetDebit();\n    if (nDebit > 0) // debit>0 means we signed/sent this transaction\n    {\n        int64_t nValueOut = GetValueOut();\n        nFee = nDebit - nValueOut;\n    }\n\n    // Sent/received.\n    BOOST_FOREACH(const CTxOut& txout, vout)\n    {\n        // Skip special stake out\n        if (txout.scriptPubKey.empty())\n            continue;\n\n        bool fIsMine;\n        // Only need to handle txouts if AT LEAST one of these is true:\n        //   1) they debit from us (sent)\n        //   2) the output is to us (received)\n        if (nDebit > 0)\n        {\n            // Don't report 'change' txouts\n            if (pwallet->IsChange(txout))\n                continue;\n            fIsMine = pwallet->IsMine(txout);\n        }\n        else if (!(fIsMine = pwallet->IsMine(txout)))\n            continue;\n\n        // In either case, we need to get the destination address\n        CTxDestination address;\n        if (!ExtractDestination(txout.scriptPubKey, address))\n        {\n            printf(\"CWalletTx::GetAmounts: Unknown transaction type found, txid %s\\n\",\n                   this->GetHash().ToString().c_str());\n            address = CNoDestination();\n        }\n\n        // If we are debited by the transaction, add the output as a \"sent\" entry\n        if (nDebit > 0)\n            listSent.push_back(make_pair(address, txout.nValue));\n\n        // If we are receiving the output, add it as a \"received\" entry\n        if (fIsMine)\n            listReceived.push_back(make_pair(address, txout.nValue));\n    }\n\n}",
          "includes": [
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"coincontrol.h\"",
            "#include \"kernel.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"crypter.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\"",
            "#include \"txdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/replace.hpp>\n#include \"coincontrol.h\"\n#include \"kernel.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"crypter.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n#include \"txdb.h\"\n\nCWalletTx {\n  void CWalletTx::GetAmounts(list<pair<CTxDestination, int64_t> >& listReceived,\n                             list<pair<CTxDestination, int64_t> >& listSent, int64_t& nFee, string& strSentAccount) const\n  {\n      nFee = 0;\n      listReceived.clear();\n      listSent.clear();\n      strSentAccount = strFromAccount;\n  \n      // Compute fee:\n      int64_t nDebit = GetDebit();\n      if (nDebit > 0) // debit>0 means we signed/sent this transaction\n      {\n          int64_t nValueOut = GetValueOut();\n          nFee = nDebit - nValueOut;\n      }\n  \n      // Sent/received.\n      BOOST_FOREACH(const CTxOut& txout, vout)\n      {\n          // Skip special stake out\n          if (txout.scriptPubKey.empty())\n              continue;\n  \n          bool fIsMine;\n          // Only need to handle txouts if AT LEAST one of these is true:\n          //   1) they debit from us (sent)\n          //   2) the output is to us (received)\n          if (nDebit > 0)\n          {\n              // Don't report 'change' txouts\n              if (pwallet->IsChange(txout))\n                  continue;\n              fIsMine = pwallet->IsMine(txout);\n          }\n          else if (!(fIsMine = pwallet->IsMine(txout)))\n              continue;\n  \n          // In either case, we need to get the destination address\n          CTxDestination address;\n          if (!ExtractDestination(txout.scriptPubKey, address))\n          {\n              printf(\"CWalletTx::GetAmounts: Unknown transaction type found, txid %s\\n\",\n                     this->GetHash().ToString().c_str());\n              address = CNoDestination();\n          }\n  \n          // If we are debited by the transaction, add the output as a \"sent\" entry\n          if (nDebit > 0)\n              listSent.push_back(make_pair(address, txout.nValue));\n  \n          // If we are receiving the output, add it as a \"received\" entry\n          if (fIsMine)\n              listReceived.push_back(make_pair(address, txout.nValue));\n      }\n  \n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nextern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);\n\nvoid ListTransactions(const CWalletTx& wtx, const string& strAccount, int nMinDepth, bool fLong, Array& ret)\n{\n    int64_t nFee;\n    string strSentAccount;\n    list<pair<CTxDestination, int64_t> > listReceived;\n    list<pair<CTxDestination, int64_t> > listSent;\n\n    wtx.GetAmounts(listReceived, listSent, nFee, strSentAccount);\n\n    bool fAllAccounts = (strAccount == string(\"*\"));\n\n    // Sent\n    if ((!wtx.IsCoinStake()) && (!listSent.empty() || nFee != 0) && (fAllAccounts || strAccount == strSentAccount))\n    {\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& s, listSent)\n        {\n            Object entry;\n            entry.push_back(Pair(\"account\", strSentAccount));\n            MaybePushAddress(entry, s.first);\n            entry.push_back(Pair(\"category\", \"send\"));\n            entry.push_back(Pair(\"amount\", ValueFromAmount(-s.second)));\n            entry.push_back(Pair(\"fee\", ValueFromAmount(-nFee)));\n            if (fLong)\n                WalletTxToJSON(wtx, entry);\n            ret.push_back(entry);\n        }\n    }\n\n    // Received\n    if (listReceived.size() > 0 && wtx.GetDepthInMainChain() >= nMinDepth)\n    {\n        bool stop = false;\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination, int64_t)& r, listReceived)\n        {\n            string account;\n            if (pwalletMain->mapAddressBook.count(r.first))\n                account = pwalletMain->mapAddressBook[r.first];\n            if (fAllAccounts || (account == strAccount))\n            {\n                Object entry;\n                entry.push_back(Pair(\"account\", account));\n                MaybePushAddress(entry, r.first);\n                if (wtx.IsCoinBase() || wtx.IsCoinStake())\n                {\n                    if (wtx.GetDepthInMainChain() < 1)\n                        entry.push_back(Pair(\"category\", \"orphan\"));\n                    else if (wtx.GetBlocksToMaturity() > 0)\n                        entry.push_back(Pair(\"category\", \"immature\"));\n                    else\n                        entry.push_back(Pair(\"category\", \"generate\"));\n                }\n                else\n                {\n                    entry.push_back(Pair(\"category\", \"receive\"));\n                }\n                if (!wtx.IsCoinStake())\n                    entry.push_back(Pair(\"amount\", ValueFromAmount(r.second)));\n                else\n                {\n                    entry.push_back(Pair(\"amount\", ValueFromAmount(-nFee)));\n                    stop = true; // only one coinstake output\n                }\n                if (fLong)\n                    WalletTxToJSON(wtx, entry);\n                ret.push_back(entry);\n            }\n            if (stop)\n                break;\n        }\n    }\n}"
  },
  {
    "function_name": "MaybePushAddress",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "999-1004",
    "snippet": "static void MaybePushAddress(Object & entry, const CTxDestination &dest)\n{\n    CBitcoinAddress addr;\n    if (addr.Set(dest))\n        entry.push_back(Pair(\"address\", addr.ToString()));\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "extern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"address\", addr.ToString())"
          ],
          "line": 1003
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"address\"",
            "addr.ToString()"
          ],
          "line": 1003
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "addr.ToString",
          "args": [],
          "line": 1003
        },
        "resolved": true,
        "details": {
          "function_name": "ToString",
          "container": "CService",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "1172-1175",
          "snippet": "std::string CService::ToString() const\n{\n    return ToStringIPPort();\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCService {\n  std::string CService::ToString() const\n  {\n      return ToStringIPPort();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "addr.Set",
          "args": [
            "dest"
          ],
          "line": 1002
        },
        "resolved": true,
        "details": {
          "function_name": "Set",
          "container": "CBlockLocator",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "1590-1605",
          "snippet": "void Set(const CBlockIndex* pindex)\n    {\n        vHave.clear();\n        int nStep = 1;\n        while (pindex)\n        {\n            vHave.push_back(pindex->GetBlockHash());\n\n            // Exponentially larger steps back\n            for (int i = 0; pindex && i < nStep; i++)\n                pindex = pindex->pprev;\n            if (vHave.size() > 10)\n                nStep *= 2;\n        }\n        vHave.push_back((!fTestNet ? hashGenesisBlock : hashGenesisBlockTestNet));\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCBlockLocator {\n  void Set(const CBlockIndex* pindex)\n      {\n          vHave.clear();\n          int nStep = 1;\n          while (pindex)\n          {\n              vHave.push_back(pindex->GetBlockHash());\n  \n              // Exponentially larger steps back\n              for (int i = 0; pindex && i < nStep; i++)\n                  pindex = pindex->pprev;\n              if (vHave.size() > 10)\n                  nStep *= 2;\n          }\n          vHave.push_back((!fTestNet ? hashGenesisBlock : hashGenesisBlockTestNet));\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nextern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);\n\nstatic void MaybePushAddress(Object & entry, const CTxDestination &dest)\n{\n    CBitcoinAddress addr;\n    if (addr.Set(dest))\n        entry.push_back(Pair(\"address\", addr.ToString()));\n}"
  },
  {
    "function_name": "listreceivedbyaccount",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "982-997",
    "snippet": "Value listreceivedbyaccount(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 2)\n        throw runtime_error(\n            \"listreceivedbyaccount [minconf=1] [includeempty=false]\\n\"\n            \"[minconf] is the minimum number of confirmations before payments are included.\\n\"\n            \"[includeempty] whether to include accounts that haven't received any payments.\\n\"\n            \"Returns an array of objects containing:\\n\"\n            \"  \\\"account\\\" : the account of the receiving addresses\\n\"\n            \"  \\\"amount\\\" : total amount received by addresses with this account\\n\"\n            \"  \\\"confirmations\\\" : number of confirmations of the most recent transaction included\");\n\n    accountingDeprecationCheck();\n\n    return ListReceived(params, true);\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ListReceived",
          "args": [
            "params",
            "true"
          ],
          "line": 996
        },
        "resolved": true,
        "details": {
          "function_name": "ListReceived",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "876-964",
          "snippet": "Value ListReceived(const Array& params, bool fByAccounts)\n{\n    // Minimum confirmations\n    int nMinDepth = 1;\n    if (params.size() > 0)\n        nMinDepth = params[0].get_int();\n\n    // Whether to include empty accounts\n    bool fIncludeEmpty = false;\n    if (params.size() > 1)\n        fIncludeEmpty = params[1].get_bool();\n\n    // Tally\n    map<CBitcoinAddress, tallyitem> mapTally;\n    for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); ++it)\n    {\n        const CWalletTx& wtx = (*it).second;\n\n        if (wtx.IsCoinBase() || wtx.IsCoinStake() || !wtx.IsFinal())\n            continue;\n\n        int nDepth = wtx.GetDepthInMainChain();\n        if (nDepth < nMinDepth)\n            continue;\n\n        BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n        {\n            CTxDestination address;\n            if (!ExtractDestination(txout.scriptPubKey, address) || !IsMine(*pwalletMain, address))\n                continue;\n\n            tallyitem& item = mapTally[address];\n            item.nAmount += txout.nValue;\n            item.nConf = min(item.nConf, nDepth);\n        }\n    }\n\n    // Reply\n    Array ret;\n    map<string, tallyitem> mapAccountTally;\n    BOOST_FOREACH(const PAIRTYPE(CBitcoinAddress, string)& item, pwalletMain->mapAddressBook)\n    {\n        const CBitcoinAddress& address = item.first;\n        const string& strAccount = item.second;\n        map<CBitcoinAddress, tallyitem>::iterator it = mapTally.find(address);\n        if (it == mapTally.end() && !fIncludeEmpty)\n            continue;\n\n        int64_t nAmount = 0;\n        int nConf = std::numeric_limits<int>::max();\n        if (it != mapTally.end())\n        {\n            nAmount = (*it).second.nAmount;\n            nConf = (*it).second.nConf;\n        }\n\n        if (fByAccounts)\n        {\n            tallyitem& item = mapAccountTally[strAccount];\n            item.nAmount += nAmount;\n            item.nConf = min(item.nConf, nConf);\n        }\n        else\n        {\n            Object obj;\n            obj.push_back(Pair(\"address\",       address.ToString()));\n            obj.push_back(Pair(\"account\",       strAccount));\n            obj.push_back(Pair(\"amount\",        ValueFromAmount(nAmount)));\n            obj.push_back(Pair(\"confirmations\", (nConf == std::numeric_limits<int>::max() ? 0 : nConf)));\n            ret.push_back(obj);\n        }\n    }\n\n    if (fByAccounts)\n    {\n        for (map<string, tallyitem>::iterator it = mapAccountTally.begin(); it != mapAccountTally.end(); ++it)\n        {\n            int64_t nAmount = (*it).second.nAmount;\n            int nConf = (*it).second.nConf;\n            Object obj;\n            obj.push_back(Pair(\"account\",       (*it).first));\n            obj.push_back(Pair(\"amount\",        ValueFromAmount(nAmount)));\n            obj.push_back(Pair(\"confirmations\", (nConf == std::numeric_limits<int>::max() ? 0 : nConf)));\n            ret.push_back(obj);\n        }\n    }\n\n    return ret;\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue ListReceived(const Array& params, bool fByAccounts)\n{\n    // Minimum confirmations\n    int nMinDepth = 1;\n    if (params.size() > 0)\n        nMinDepth = params[0].get_int();\n\n    // Whether to include empty accounts\n    bool fIncludeEmpty = false;\n    if (params.size() > 1)\n        fIncludeEmpty = params[1].get_bool();\n\n    // Tally\n    map<CBitcoinAddress, tallyitem> mapTally;\n    for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); ++it)\n    {\n        const CWalletTx& wtx = (*it).second;\n\n        if (wtx.IsCoinBase() || wtx.IsCoinStake() || !wtx.IsFinal())\n            continue;\n\n        int nDepth = wtx.GetDepthInMainChain();\n        if (nDepth < nMinDepth)\n            continue;\n\n        BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n        {\n            CTxDestination address;\n            if (!ExtractDestination(txout.scriptPubKey, address) || !IsMine(*pwalletMain, address))\n                continue;\n\n            tallyitem& item = mapTally[address];\n            item.nAmount += txout.nValue;\n            item.nConf = min(item.nConf, nDepth);\n        }\n    }\n\n    // Reply\n    Array ret;\n    map<string, tallyitem> mapAccountTally;\n    BOOST_FOREACH(const PAIRTYPE(CBitcoinAddress, string)& item, pwalletMain->mapAddressBook)\n    {\n        const CBitcoinAddress& address = item.first;\n        const string& strAccount = item.second;\n        map<CBitcoinAddress, tallyitem>::iterator it = mapTally.find(address);\n        if (it == mapTally.end() && !fIncludeEmpty)\n            continue;\n\n        int64_t nAmount = 0;\n        int nConf = std::numeric_limits<int>::max();\n        if (it != mapTally.end())\n        {\n            nAmount = (*it).second.nAmount;\n            nConf = (*it).second.nConf;\n        }\n\n        if (fByAccounts)\n        {\n            tallyitem& item = mapAccountTally[strAccount];\n            item.nAmount += nAmount;\n            item.nConf = min(item.nConf, nConf);\n        }\n        else\n        {\n            Object obj;\n            obj.push_back(Pair(\"address\",       address.ToString()));\n            obj.push_back(Pair(\"account\",       strAccount));\n            obj.push_back(Pair(\"amount\",        ValueFromAmount(nAmount)));\n            obj.push_back(Pair(\"confirmations\", (nConf == std::numeric_limits<int>::max() ? 0 : nConf)));\n            ret.push_back(obj);\n        }\n    }\n\n    if (fByAccounts)\n    {\n        for (map<string, tallyitem>::iterator it = mapAccountTally.begin(); it != mapAccountTally.end(); ++it)\n        {\n            int64_t nAmount = (*it).second.nAmount;\n            int nConf = (*it).second.nConf;\n            Object obj;\n            obj.push_back(Pair(\"account\",       (*it).first));\n            obj.push_back(Pair(\"amount\",        ValueFromAmount(nAmount)));\n            obj.push_back(Pair(\"confirmations\", (nConf == std::numeric_limits<int>::max() ? 0 : nConf)));\n            ret.push_back(obj);\n        }\n    }\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "accountingDeprecationCheck",
          "args": [],
          "line": 994
        },
        "resolved": true,
        "details": {
          "function_name": "accountingDeprecationCheck",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "22-32",
          "snippet": "static void accountingDeprecationCheck()\n{\n    if (!GetBoolArg(\"-enableaccounts\", false))\n        throw runtime_error(\n            \"Accounting API is deprecated and will be removed in future.\\n\"\n            \"It can easily result in negative or odd balances if misused or misunderstood, which has happened in the field.\\n\"\n            \"If you still want to enable it, add to your config file enableaccounts=1\\n\");\n\n    if (GetBoolArg(\"-staking\", true))\n        throw runtime_error(\"If you want to use accounting API, staking must be disabled, add to your config file staking=0\\n\");\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstatic void accountingDeprecationCheck()\n{\n    if (!GetBoolArg(\"-enableaccounts\", false))\n        throw runtime_error(\n            \"Accounting API is deprecated and will be removed in future.\\n\"\n            \"It can easily result in negative or odd balances if misused or misunderstood, which has happened in the field.\\n\"\n            \"If you still want to enable it, add to your config file enableaccounts=1\\n\");\n\n    if (GetBoolArg(\"-staking\", true))\n        throw runtime_error(\"If you want to use accounting API, staking must be disabled, add to your config file staking=0\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"listreceivedbyaccount [minconf=1] [includeempty=false]\\n\"\n            \"[minconf] is the minimum number of confirmations before payments are included.\\n\"\n            \"[includeempty] whether to include accounts that haven't received any payments.\\n\"\n            \"Returns an array of objects containing:\\n\"\n            \"  \\\"account\\\" : the account of the receiving addresses\\n\"\n            \"  \\\"amount\\\" : total amount received by addresses with this account\\n\"\n            \"  \\\"confirmations\\\" : number of confirmations of the most recent transaction included\""
          ],
          "line": 985
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 984
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue listreceivedbyaccount(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 2)\n        throw runtime_error(\n            \"listreceivedbyaccount [minconf=1] [includeempty=false]\\n\"\n            \"[minconf] is the minimum number of confirmations before payments are included.\\n\"\n            \"[includeempty] whether to include accounts that haven't received any payments.\\n\"\n            \"Returns an array of objects containing:\\n\"\n            \"  \\\"account\\\" : the account of the receiving addresses\\n\"\n            \"  \\\"amount\\\" : total amount received by addresses with this account\\n\"\n            \"  \\\"confirmations\\\" : number of confirmations of the most recent transaction included\");\n\n    accountingDeprecationCheck();\n\n    return ListReceived(params, true);\n}"
  },
  {
    "function_name": "listreceivedbyaddress",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "966-980",
    "snippet": "Value listreceivedbyaddress(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 2)\n        throw runtime_error(\n            \"listreceivedbyaddress [minconf=1] [includeempty=false]\\n\"\n            \"[minconf] is the minimum number of confirmations before payments are included.\\n\"\n            \"[includeempty] whether to include addresses that haven't received any payments.\\n\"\n            \"Returns an array of objects containing:\\n\"\n            \"  \\\"address\\\" : receiving address\\n\"\n            \"  \\\"account\\\" : the account of the receiving address\\n\"\n            \"  \\\"amount\\\" : total amount received by the address\\n\"\n            \"  \\\"confirmations\\\" : number of confirmations of the most recent transaction included\");\n\n    return ListReceived(params, false);\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ListReceived",
          "args": [
            "params",
            "false"
          ],
          "line": 979
        },
        "resolved": true,
        "details": {
          "function_name": "ListReceived",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "876-964",
          "snippet": "Value ListReceived(const Array& params, bool fByAccounts)\n{\n    // Minimum confirmations\n    int nMinDepth = 1;\n    if (params.size() > 0)\n        nMinDepth = params[0].get_int();\n\n    // Whether to include empty accounts\n    bool fIncludeEmpty = false;\n    if (params.size() > 1)\n        fIncludeEmpty = params[1].get_bool();\n\n    // Tally\n    map<CBitcoinAddress, tallyitem> mapTally;\n    for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); ++it)\n    {\n        const CWalletTx& wtx = (*it).second;\n\n        if (wtx.IsCoinBase() || wtx.IsCoinStake() || !wtx.IsFinal())\n            continue;\n\n        int nDepth = wtx.GetDepthInMainChain();\n        if (nDepth < nMinDepth)\n            continue;\n\n        BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n        {\n            CTxDestination address;\n            if (!ExtractDestination(txout.scriptPubKey, address) || !IsMine(*pwalletMain, address))\n                continue;\n\n            tallyitem& item = mapTally[address];\n            item.nAmount += txout.nValue;\n            item.nConf = min(item.nConf, nDepth);\n        }\n    }\n\n    // Reply\n    Array ret;\n    map<string, tallyitem> mapAccountTally;\n    BOOST_FOREACH(const PAIRTYPE(CBitcoinAddress, string)& item, pwalletMain->mapAddressBook)\n    {\n        const CBitcoinAddress& address = item.first;\n        const string& strAccount = item.second;\n        map<CBitcoinAddress, tallyitem>::iterator it = mapTally.find(address);\n        if (it == mapTally.end() && !fIncludeEmpty)\n            continue;\n\n        int64_t nAmount = 0;\n        int nConf = std::numeric_limits<int>::max();\n        if (it != mapTally.end())\n        {\n            nAmount = (*it).second.nAmount;\n            nConf = (*it).second.nConf;\n        }\n\n        if (fByAccounts)\n        {\n            tallyitem& item = mapAccountTally[strAccount];\n            item.nAmount += nAmount;\n            item.nConf = min(item.nConf, nConf);\n        }\n        else\n        {\n            Object obj;\n            obj.push_back(Pair(\"address\",       address.ToString()));\n            obj.push_back(Pair(\"account\",       strAccount));\n            obj.push_back(Pair(\"amount\",        ValueFromAmount(nAmount)));\n            obj.push_back(Pair(\"confirmations\", (nConf == std::numeric_limits<int>::max() ? 0 : nConf)));\n            ret.push_back(obj);\n        }\n    }\n\n    if (fByAccounts)\n    {\n        for (map<string, tallyitem>::iterator it = mapAccountTally.begin(); it != mapAccountTally.end(); ++it)\n        {\n            int64_t nAmount = (*it).second.nAmount;\n            int nConf = (*it).second.nConf;\n            Object obj;\n            obj.push_back(Pair(\"account\",       (*it).first));\n            obj.push_back(Pair(\"amount\",        ValueFromAmount(nAmount)));\n            obj.push_back(Pair(\"confirmations\", (nConf == std::numeric_limits<int>::max() ? 0 : nConf)));\n            ret.push_back(obj);\n        }\n    }\n\n    return ret;\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue ListReceived(const Array& params, bool fByAccounts)\n{\n    // Minimum confirmations\n    int nMinDepth = 1;\n    if (params.size() > 0)\n        nMinDepth = params[0].get_int();\n\n    // Whether to include empty accounts\n    bool fIncludeEmpty = false;\n    if (params.size() > 1)\n        fIncludeEmpty = params[1].get_bool();\n\n    // Tally\n    map<CBitcoinAddress, tallyitem> mapTally;\n    for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); ++it)\n    {\n        const CWalletTx& wtx = (*it).second;\n\n        if (wtx.IsCoinBase() || wtx.IsCoinStake() || !wtx.IsFinal())\n            continue;\n\n        int nDepth = wtx.GetDepthInMainChain();\n        if (nDepth < nMinDepth)\n            continue;\n\n        BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n        {\n            CTxDestination address;\n            if (!ExtractDestination(txout.scriptPubKey, address) || !IsMine(*pwalletMain, address))\n                continue;\n\n            tallyitem& item = mapTally[address];\n            item.nAmount += txout.nValue;\n            item.nConf = min(item.nConf, nDepth);\n        }\n    }\n\n    // Reply\n    Array ret;\n    map<string, tallyitem> mapAccountTally;\n    BOOST_FOREACH(const PAIRTYPE(CBitcoinAddress, string)& item, pwalletMain->mapAddressBook)\n    {\n        const CBitcoinAddress& address = item.first;\n        const string& strAccount = item.second;\n        map<CBitcoinAddress, tallyitem>::iterator it = mapTally.find(address);\n        if (it == mapTally.end() && !fIncludeEmpty)\n            continue;\n\n        int64_t nAmount = 0;\n        int nConf = std::numeric_limits<int>::max();\n        if (it != mapTally.end())\n        {\n            nAmount = (*it).second.nAmount;\n            nConf = (*it).second.nConf;\n        }\n\n        if (fByAccounts)\n        {\n            tallyitem& item = mapAccountTally[strAccount];\n            item.nAmount += nAmount;\n            item.nConf = min(item.nConf, nConf);\n        }\n        else\n        {\n            Object obj;\n            obj.push_back(Pair(\"address\",       address.ToString()));\n            obj.push_back(Pair(\"account\",       strAccount));\n            obj.push_back(Pair(\"amount\",        ValueFromAmount(nAmount)));\n            obj.push_back(Pair(\"confirmations\", (nConf == std::numeric_limits<int>::max() ? 0 : nConf)));\n            ret.push_back(obj);\n        }\n    }\n\n    if (fByAccounts)\n    {\n        for (map<string, tallyitem>::iterator it = mapAccountTally.begin(); it != mapAccountTally.end(); ++it)\n        {\n            int64_t nAmount = (*it).second.nAmount;\n            int nConf = (*it).second.nConf;\n            Object obj;\n            obj.push_back(Pair(\"account\",       (*it).first));\n            obj.push_back(Pair(\"amount\",        ValueFromAmount(nAmount)));\n            obj.push_back(Pair(\"confirmations\", (nConf == std::numeric_limits<int>::max() ? 0 : nConf)));\n            ret.push_back(obj);\n        }\n    }\n\n    return ret;\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"listreceivedbyaddress [minconf=1] [includeempty=false]\\n\"\n            \"[minconf] is the minimum number of confirmations before payments are included.\\n\"\n            \"[includeempty] whether to include addresses that haven't received any payments.\\n\"\n            \"Returns an array of objects containing:\\n\"\n            \"  \\\"address\\\" : receiving address\\n\"\n            \"  \\\"account\\\" : the account of the receiving address\\n\"\n            \"  \\\"amount\\\" : total amount received by the address\\n\"\n            \"  \\\"confirmations\\\" : number of confirmations of the most recent transaction included\""
          ],
          "line": 969
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 968
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue listreceivedbyaddress(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 2)\n        throw runtime_error(\n            \"listreceivedbyaddress [minconf=1] [includeempty=false]\\n\"\n            \"[minconf] is the minimum number of confirmations before payments are included.\\n\"\n            \"[includeempty] whether to include addresses that haven't received any payments.\\n\"\n            \"Returns an array of objects containing:\\n\"\n            \"  \\\"address\\\" : receiving address\\n\"\n            \"  \\\"account\\\" : the account of the receiving address\\n\"\n            \"  \\\"amount\\\" : total amount received by the address\\n\"\n            \"  \\\"confirmations\\\" : number of confirmations of the most recent transaction included\");\n\n    return ListReceived(params, false);\n}"
  },
  {
    "function_name": "ListReceived",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "876-964",
    "snippet": "Value ListReceived(const Array& params, bool fByAccounts)\n{\n    // Minimum confirmations\n    int nMinDepth = 1;\n    if (params.size() > 0)\n        nMinDepth = params[0].get_int();\n\n    // Whether to include empty accounts\n    bool fIncludeEmpty = false;\n    if (params.size() > 1)\n        fIncludeEmpty = params[1].get_bool();\n\n    // Tally\n    map<CBitcoinAddress, tallyitem> mapTally;\n    for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); ++it)\n    {\n        const CWalletTx& wtx = (*it).second;\n\n        if (wtx.IsCoinBase() || wtx.IsCoinStake() || !wtx.IsFinal())\n            continue;\n\n        int nDepth = wtx.GetDepthInMainChain();\n        if (nDepth < nMinDepth)\n            continue;\n\n        BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n        {\n            CTxDestination address;\n            if (!ExtractDestination(txout.scriptPubKey, address) || !IsMine(*pwalletMain, address))\n                continue;\n\n            tallyitem& item = mapTally[address];\n            item.nAmount += txout.nValue;\n            item.nConf = min(item.nConf, nDepth);\n        }\n    }\n\n    // Reply\n    Array ret;\n    map<string, tallyitem> mapAccountTally;\n    BOOST_FOREACH(const PAIRTYPE(CBitcoinAddress, string)& item, pwalletMain->mapAddressBook)\n    {\n        const CBitcoinAddress& address = item.first;\n        const string& strAccount = item.second;\n        map<CBitcoinAddress, tallyitem>::iterator it = mapTally.find(address);\n        if (it == mapTally.end() && !fIncludeEmpty)\n            continue;\n\n        int64_t nAmount = 0;\n        int nConf = std::numeric_limits<int>::max();\n        if (it != mapTally.end())\n        {\n            nAmount = (*it).second.nAmount;\n            nConf = (*it).second.nConf;\n        }\n\n        if (fByAccounts)\n        {\n            tallyitem& item = mapAccountTally[strAccount];\n            item.nAmount += nAmount;\n            item.nConf = min(item.nConf, nConf);\n        }\n        else\n        {\n            Object obj;\n            obj.push_back(Pair(\"address\",       address.ToString()));\n            obj.push_back(Pair(\"account\",       strAccount));\n            obj.push_back(Pair(\"amount\",        ValueFromAmount(nAmount)));\n            obj.push_back(Pair(\"confirmations\", (nConf == std::numeric_limits<int>::max() ? 0 : nConf)));\n            ret.push_back(obj);\n        }\n    }\n\n    if (fByAccounts)\n    {\n        for (map<string, tallyitem>::iterator it = mapAccountTally.begin(); it != mapAccountTally.end(); ++it)\n        {\n            int64_t nAmount = (*it).second.nAmount;\n            int nConf = (*it).second.nConf;\n            Object obj;\n            obj.push_back(Pair(\"account\",       (*it).first));\n            obj.push_back(Pair(\"amount\",        ValueFromAmount(nAmount)));\n            obj.push_back(Pair(\"confirmations\", (nConf == std::numeric_limits<int>::max() ? 0 : nConf)));\n            ret.push_back(obj);\n        }\n    }\n\n    return ret;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "obj"
          ],
          "line": 959
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"confirmations\", (nConf == std::numeric_limits<int>::max() ? 0 : nConf))"
          ],
          "line": 958
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"confirmations\"",
            "(nConf == std::numeric_limits<int>::max() ? 0 : nConf)"
          ],
          "line": 958
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "std::numeric_limits<int>::max",
          "args": [],
          "line": 958
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"amount\",        ValueFromAmount(nAmount))"
          ],
          "line": 957
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ValueFromAmount",
          "args": [
            "nAmount"
          ],
          "line": 957
        },
        "resolved": true,
        "details": {
          "function_name": "ValueFromAmount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "113-116",
          "snippet": "Value ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nValue ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}"
        }
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"account\",       (*it).first)"
          ],
          "line": 956
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mapAccountTally.end",
          "args": [],
          "line": 951
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "mapAccountTally.begin",
          "args": [],
          "line": 951
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "obj"
          ],
          "line": 945
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"confirmations\", (nConf == std::numeric_limits<int>::max() ? 0 : nConf))"
          ],
          "line": 944
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::numeric_limits<int>::max",
          "args": [],
          "line": 944
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"amount\",        ValueFromAmount(nAmount))"
          ],
          "line": 943
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"account\",       strAccount)"
          ],
          "line": 942
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"address\",       address.ToString())"
          ],
          "line": 941
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "address.ToString",
          "args": [],
          "line": 941
        },
        "resolved": true,
        "details": {
          "function_name": "ToString",
          "container": "CService",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "1172-1175",
          "snippet": "std::string CService::ToString() const\n{\n    return ToStringIPPort();\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCService {\n  std::string CService::ToString() const\n  {\n      return ToStringIPPort();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "min",
          "args": [
            "item.nConf",
            "nConf"
          ],
          "line": 936
        },
        "resolved": true,
        "details": {
          "function_name": "TimingResistantEqual",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.h",
          "lines": "569-576",
          "snippet": "bool TimingResistantEqual(const T& a, const T& b)\n{\n    if (b.size() == 0) return a.size() == 0;\n    size_t accumulator = a.size() ^ b.size();\n    for (size_t i = 0; i < a.size(); i++)\n        accumulator |= a[i] ^ b[i%b.size()];\n    return accumulator == 0;\n}",
          "includes": [
            "#include <inttypes.h>",
            "#include <stdint.h>",
            "#include \"netbase.h\" // for AddTimeData",
            "#include <openssl/ripemd.h>",
            "#include <openssl/sha.h>",
            "#include <boost/date_time/posix_time/posix_time_types.hpp>",
            "#include <boost/date_time/gregorian/gregorian_types.hpp>",
            "#include <boost/filesystem/path.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/thread.hpp>",
            "#include <string>",
            "#include <vector>",
            "#include <map>",
            "#include <sys/resource.h>",
            "#include <sys/time.h>",
            "#include <sys/types.h>",
            "#include \"uint256.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <inttypes.h>\n#include <stdint.h>\n#include \"netbase.h\" // for AddTimeData\n#include <openssl/ripemd.h>\n#include <openssl/sha.h>\n#include <boost/date_time/posix_time/posix_time_types.hpp>\n#include <boost/date_time/gregorian/gregorian_types.hpp>\n#include <boost/filesystem/path.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/thread.hpp>\n#include <string>\n#include <vector>\n#include <map>\n#include <sys/resource.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include \"uint256.h\"\n\nbool TimingResistantEqual(const T& a, const T& b)\n{\n    if (b.size() == 0) return a.size() == 0;\n    size_t accumulator = a.size() ^ b.size();\n    for (size_t i = 0; i < a.size(); i++)\n        accumulator |= a[i] ^ b[i%b.size()];\n    return accumulator == 0;\n}"
        }
      },
      {
        "call_info": {
          "callee": "std::numeric_limits<int>::max",
          "args": [],
          "line": 925
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mapTally.find",
          "args": [
            "address"
          ],
          "line": 920
        },
        "resolved": true,
        "details": {
          "function_name": "find",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "33-33",
          "snippet": "const_iterator find(const key_type& k) const { return map.find(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator find(const key_type& k) const { return map.find(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "IsMine",
          "args": [
            "*pwalletMain",
            "address"
          ],
          "line": 904
        },
        "resolved": true,
        "details": {
          "function_name": "IsMine",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/script.cpp",
          "lines": "1551-1588",
          "snippet": "bool IsMine(const CKeyStore &keystore, const CScript& scriptPubKey)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    CKeyID keyID;\n    switch (whichType)\n    {\n    case TX_NONSTANDARD:\n        return false;\n    case TX_PUBKEY:\n        keyID = CPubKey(vSolutions[0]).GetID();\n        return keystore.HaveKey(keyID);\n    case TX_PUBKEYHASH:\n        keyID = CKeyID(uint160(vSolutions[0]));\n        return keystore.HaveKey(keyID);\n    case TX_SCRIPTHASH:\n    {\n        CScript subscript;\n        if (!keystore.GetCScript(CScriptID(uint160(vSolutions[0])), subscript))\n            return false;\n        return IsMine(keystore, subscript);\n    }\n    case TX_MULTISIG:\n    {\n        // Only consider transactions \"mine\" if we own ALL the\n        // keys involved. multi-signature transactions that are\n        // partially owned (somebody else has a key that can spend\n        // them) enable spend-out-from-under-you attacks, especially\n        // in shared-wallet situations.\n        vector<valtype> keys(vSolutions.begin()+1, vSolutions.begin()+vSolutions.size()-1);\n        return HaveKeys(keys, keystore) == keys.size();\n    }\n    }\n    return false;\n}",
          "includes": [
            "#include \"util.h\"",
            "#include \"sync.h\"",
            "#include \"main.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include \"keystore.h\"",
            "#include \"script.h\"",
            "#include <boost/tuple/tuple_comparison.hpp>",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/foreach.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"sync.h\"\n#include \"main.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include \"keystore.h\"\n#include \"script.h\"\n#include <boost/tuple/tuple_comparison.hpp>\n#include <boost/tuple/tuple.hpp>\n#include <boost/foreach.hpp>\n\nbool IsMine(const CKeyStore &keystore, const CScript& scriptPubKey)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    CKeyID keyID;\n    switch (whichType)\n    {\n    case TX_NONSTANDARD:\n        return false;\n    case TX_PUBKEY:\n        keyID = CPubKey(vSolutions[0]).GetID();\n        return keystore.HaveKey(keyID);\n    case TX_PUBKEYHASH:\n        keyID = CKeyID(uint160(vSolutions[0]));\n        return keystore.HaveKey(keyID);\n    case TX_SCRIPTHASH:\n    {\n        CScript subscript;\n        if (!keystore.GetCScript(CScriptID(uint160(vSolutions[0])), subscript))\n            return false;\n        return IsMine(keystore, subscript);\n    }\n    case TX_MULTISIG:\n    {\n        // Only consider transactions \"mine\" if we own ALL the\n        // keys involved. multi-signature transactions that are\n        // partially owned (somebody else has a key that can spend\n        // them) enable spend-out-from-under-you attacks, especially\n        // in shared-wallet situations.\n        vector<valtype> keys(vSolutions.begin()+1, vSolutions.begin()+vSolutions.size()-1);\n        return HaveKeys(keys, keystore) == keys.size();\n    }\n    }\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ExtractDestination",
          "args": [
            "txout.scriptPubKey",
            "address"
          ],
          "line": 904
        },
        "resolved": true,
        "details": {
          "function_name": "ExtractDestination",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/script.cpp",
          "lines": "1590-1614",
          "snippet": "bool ExtractDestination(const CScript& scriptPubKey, CTxDestination& addressRet)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    if (whichType == TX_PUBKEY)\n    {\n        addressRet = CPubKey(vSolutions[0]).GetID();\n        return true;\n    }\n    else if (whichType == TX_PUBKEYHASH)\n    {\n        addressRet = CKeyID(uint160(vSolutions[0]));\n        return true;\n    }\n    else if (whichType == TX_SCRIPTHASH)\n    {\n        addressRet = CScriptID(uint160(vSolutions[0]));\n        return true;\n    }\n    // Multisig txns have more than one address...\n    return false;\n}",
          "includes": [
            "#include \"util.h\"",
            "#include \"sync.h\"",
            "#include \"main.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include \"keystore.h\"",
            "#include \"script.h\"",
            "#include <boost/tuple/tuple_comparison.hpp>",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/foreach.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"sync.h\"\n#include \"main.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include \"keystore.h\"\n#include \"script.h\"\n#include <boost/tuple/tuple_comparison.hpp>\n#include <boost/tuple/tuple.hpp>\n#include <boost/foreach.hpp>\n\nbool ExtractDestination(const CScript& scriptPubKey, CTxDestination& addressRet)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    if (whichType == TX_PUBKEY)\n    {\n        addressRet = CPubKey(vSolutions[0]).GetID();\n        return true;\n    }\n    else if (whichType == TX_PUBKEYHASH)\n    {\n        addressRet = CKeyID(uint160(vSolutions[0]));\n        return true;\n    }\n    else if (whichType == TX_SCRIPTHASH)\n    {\n        addressRet = CScriptID(uint160(vSolutions[0]));\n        return true;\n    }\n    // Multisig txns have more than one address...\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetDepthInMainChain",
          "args": [],
          "line": 897
        },
        "resolved": true,
        "details": {
          "function_name": "GetDepthInMainChain",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "765-765",
          "snippet": "int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCMerkleTx {\n  int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.IsFinal",
          "args": [],
          "line": 894
        },
        "resolved": true,
        "details": {
          "function_name": "IsFinal",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "491-506",
          "snippet": "bool IsFinal(int nBlockHeight=0, int64_t nBlockTime=0) const\n    {\n        // Time based nLockTime implemented in 0.1.6\n        if (nLockTime == 0)\n            return true;\n        if (nBlockHeight == 0)\n            nBlockHeight = nBestHeight;\n        if (nBlockTime == 0)\n            nBlockTime = GetAdjustedTime();\n        if ((int64_t)nLockTime < ((int64_t)nLockTime < LOCKTIME_THRESHOLD ? (int64_t)nBlockHeight : nBlockTime))\n            return true;\n        BOOST_FOREACH(const CTxIn& txin, vin)\n            if (!txin.IsFinal())\n                return false;\n        return true;\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  bool IsFinal(int nBlockHeight=0, int64_t nBlockTime=0) const\n      {\n          // Time based nLockTime implemented in 0.1.6\n          if (nLockTime == 0)\n              return true;\n          if (nBlockHeight == 0)\n              nBlockHeight = nBestHeight;\n          if (nBlockTime == 0)\n              nBlockTime = GetAdjustedTime();\n          if ((int64_t)nLockTime < ((int64_t)nLockTime < LOCKTIME_THRESHOLD ? (int64_t)nBlockHeight : nBlockTime))\n              return true;\n          BOOST_FOREACH(const CTxIn& txin, vin)\n              if (!txin.IsFinal())\n                  return false;\n          return true;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.IsCoinStake",
          "args": [],
          "line": 894
        },
        "resolved": true,
        "details": {
          "function_name": "IsCoinStake",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "542-546",
          "snippet": "bool IsCoinStake() const\n    {\n        // ppcoin: the coin stake transaction is marked with the first output empty\n        return (vin.size() > 0 && (!vin[0].prevout.IsNull()) && vout.size() >= 2 && vout[0].IsEmpty());\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  bool IsCoinStake() const\n      {\n          // ppcoin: the coin stake transaction is marked with the first output empty\n          return (vin.size() > 0 && (!vin[0].prevout.IsNull()) && vout.size() >= 2 && vout[0].IsEmpty());\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.IsCoinBase",
          "args": [],
          "line": 894
        },
        "resolved": true,
        "details": {
          "function_name": "IsCoinBase",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "537-540",
          "snippet": "bool IsCoinBase() const\n    {\n        return (vin.size() == 1 && vin[0].prevout.IsNull() && vout.size() >= 1);\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  bool IsCoinBase() const\n      {\n          return (vin.size() == 1 && vin[0].prevout.IsNull() && vout.size() >= 1);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[1].get_bool",
          "args": [],
          "line": 886
        },
        "resolved": true,
        "details": {
          "function_name": "get_bool",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "377-382",
          "snippet": "bool Value_impl< Config >::get_bool() const\n    {\n        check_type(  bool_type );\n\n        return boost::get< bool >( v_ );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  bool Value_impl< Config >::get_bool() const\n      {\n          check_type(  bool_type );\n  \n          return boost::get< bool >( v_ );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 885
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_int",
          "args": [],
          "line": 881
        },
        "resolved": true,
        "details": {
          "function_name": "get_int",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "385-390",
          "snippet": "int Value_impl< Config >::get_int() const\n    {\n        check_type(  int_type );\n\n        return static_cast< int >( get_int64() );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  int Value_impl< Config >::get_int() const\n      {\n          check_type(  int_type );\n  \n          return static_cast< int >( get_int64() );\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue ListReceived(const Array& params, bool fByAccounts)\n{\n    // Minimum confirmations\n    int nMinDepth = 1;\n    if (params.size() > 0)\n        nMinDepth = params[0].get_int();\n\n    // Whether to include empty accounts\n    bool fIncludeEmpty = false;\n    if (params.size() > 1)\n        fIncludeEmpty = params[1].get_bool();\n\n    // Tally\n    map<CBitcoinAddress, tallyitem> mapTally;\n    for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); ++it)\n    {\n        const CWalletTx& wtx = (*it).second;\n\n        if (wtx.IsCoinBase() || wtx.IsCoinStake() || !wtx.IsFinal())\n            continue;\n\n        int nDepth = wtx.GetDepthInMainChain();\n        if (nDepth < nMinDepth)\n            continue;\n\n        BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n        {\n            CTxDestination address;\n            if (!ExtractDestination(txout.scriptPubKey, address) || !IsMine(*pwalletMain, address))\n                continue;\n\n            tallyitem& item = mapTally[address];\n            item.nAmount += txout.nValue;\n            item.nConf = min(item.nConf, nDepth);\n        }\n    }\n\n    // Reply\n    Array ret;\n    map<string, tallyitem> mapAccountTally;\n    BOOST_FOREACH(const PAIRTYPE(CBitcoinAddress, string)& item, pwalletMain->mapAddressBook)\n    {\n        const CBitcoinAddress& address = item.first;\n        const string& strAccount = item.second;\n        map<CBitcoinAddress, tallyitem>::iterator it = mapTally.find(address);\n        if (it == mapTally.end() && !fIncludeEmpty)\n            continue;\n\n        int64_t nAmount = 0;\n        int nConf = std::numeric_limits<int>::max();\n        if (it != mapTally.end())\n        {\n            nAmount = (*it).second.nAmount;\n            nConf = (*it).second.nConf;\n        }\n\n        if (fByAccounts)\n        {\n            tallyitem& item = mapAccountTally[strAccount];\n            item.nAmount += nAmount;\n            item.nConf = min(item.nConf, nConf);\n        }\n        else\n        {\n            Object obj;\n            obj.push_back(Pair(\"address\",       address.ToString()));\n            obj.push_back(Pair(\"account\",       strAccount));\n            obj.push_back(Pair(\"amount\",        ValueFromAmount(nAmount)));\n            obj.push_back(Pair(\"confirmations\", (nConf == std::numeric_limits<int>::max() ? 0 : nConf)));\n            ret.push_back(obj);\n        }\n    }\n\n    if (fByAccounts)\n    {\n        for (map<string, tallyitem>::iterator it = mapAccountTally.begin(); it != mapAccountTally.end(); ++it)\n        {\n            int64_t nAmount = (*it).second.nAmount;\n            int nConf = (*it).second.nConf;\n            Object obj;\n            obj.push_back(Pair(\"account\",       (*it).first));\n            obj.push_back(Pair(\"amount\",        ValueFromAmount(nAmount)));\n            obj.push_back(Pair(\"confirmations\", (nConf == std::numeric_limits<int>::max() ? 0 : nConf)));\n            ret.push_back(obj);\n        }\n    }\n\n    return ret;\n}"
  },
  {
    "function_name": "tallyitem",
    "container": "tallyitem",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "869-873",
    "snippet": "tallyitem()\n    {\n        nAmount = 0;\n        nConf = std::numeric_limits<int>::max();\n    }",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "std::numeric_limits<int>::max",
          "args": [],
          "line": 872
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\ntallyitem {\n  tallyitem()\n      {\n          nAmount = 0;\n          nConf = std::numeric_limits<int>::max();\n      }\n}"
  },
  {
    "function_name": "addredeemscript",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "841-863",
    "snippet": "Value addredeemscript(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 1 || params.size() > 2)\n    {\n        string msg = \"addredeemscript <redeemScript> [account]\\n\"\n            \"Add a P2SH address with a specified redeemScript to the wallet.\\n\"\n            \"If [account] is specified, assign address to [account].\";\n        throw runtime_error(msg);\n    }\n\n    string strAccount;\n    if (params.size() > 1)\n        strAccount = AccountFromValue(params[1]);\n\n    // Construct using pay-to-script-hash:\n    vector<unsigned char> innerData = ParseHexV(params[0], \"redeemScript\");\n    CScript inner(innerData.begin(), innerData.end());\n    CScriptID innerID = inner.GetID();\n    pwalletMain->AddCScript(inner);\n\n    pwalletMain->SetAddressBookName(innerID, strAccount);\n    return CBitcoinAddress(innerID).ToString();\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "CBitcoinAddress",
          "args": [],
          "line": 862
        },
        "resolved": true,
        "details": {
          "function_name": "IsScript",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "384-394",
          "snippet": "bool IsScript() const {\n        if (!IsValid())\n            return false;\n        switch (nVersion) {\n        case SCRIPT_ADDRESS:\n        case SCRIPT_ADDRESS_TEST: {\n            return true;\n        }\n        default: return false;\n        }\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  bool IsScript() const {\n          if (!IsValid())\n              return false;\n          switch (nVersion) {\n          case SCRIPT_ADDRESS:\n          case SCRIPT_ADDRESS_TEST: {\n              return true;\n          }\n          default: return false;\n          }\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "CBitcoinAddress",
          "args": [
            "innerID"
          ],
          "line": 862
        },
        "resolved": true,
        "details": {
          "function_name": "operator()",
          "container": "CBitcoinAddressVisitor",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "399-399",
          "snippet": "bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddressVisitor {\n  bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->SetAddressBookName",
          "args": [
            "innerID",
            "strAccount"
          ],
          "line": 861
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->AddCScript",
          "args": [
            "inner"
          ],
          "line": 859
        },
        "resolved": true,
        "details": {
          "function_name": "AddCScript",
          "container": "CBasicKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.cpp",
          "lines": "29-36",
          "snippet": "bool CBasicKeyStore::AddCScript(const CScript& redeemScript)\n{\n    {\n        LOCK(cs_KeyStore);\n        mapScripts[redeemScript.GetID()] = redeemScript;\n    }\n    return true;\n}",
          "includes": [
            "#include \"script.h\"",
            "#include \"keystore.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"keystore.h\"\n\nCBasicKeyStore {\n  bool CBasicKeyStore::AddCScript(const CScript& redeemScript)\n  {\n      {\n          LOCK(cs_KeyStore);\n          mapScripts[redeemScript.GetID()] = redeemScript;\n      }\n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "inner.GetID",
          "args": [],
          "line": 858
        },
        "resolved": true,
        "details": {
          "function_name": "GetID",
          "container": "CPubKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.h",
          "lines": "80-82",
          "snippet": "CKeyID GetID() const {\n        return CKeyID(Hash160(vchPubKey));\n    }",
          "includes": [
            "#include <openssl/ec.h> // for EC_KEY definition",
            "#include \"util.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\"",
            "#include \"allocators.h\"",
            "#include <vector>",
            "#include <stdexcept>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <openssl/ec.h> // for EC_KEY definition\n#include \"util.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n#include \"allocators.h\"\n#include <vector>\n#include <stdexcept>\n\nCPubKey {\n  CKeyID GetID() const {\n          return CKeyID(Hash160(vchPubKey));\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "innerData.end",
          "args": [],
          "line": 857
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "innerData.begin",
          "args": [],
          "line": 857
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ParseHexV",
          "args": [
            "params[0]",
            "\"redeemScript\""
          ],
          "line": 856
        },
        "resolved": true,
        "details": {
          "function_name": "ParseHexV",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "150-158",
          "snippet": "vector<unsigned char> ParseHexV(const Value& v, string strName)\n{\n    string strHex;\n    if (v.type() == str_type)\n        strHex = v.get_str();\n    if (!IsHex(strHex))\n        throw JSONRPCError(RPC_INVALID_PARAMETER, strName+\" must be hexadecimal string (not '\"+strHex+\"')\");\n    return ParseHex(strHex);\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nvector<unsigned char> ParseHexV(const Value& v, string strName)\n{\n    string strHex;\n    if (v.type() == str_type)\n        strHex = v.get_str();\n    if (!IsHex(strHex))\n        throw JSONRPCError(RPC_INVALID_PARAMETER, strName+\" must be hexadecimal string (not '\"+strHex+\"')\");\n    return ParseHex(strHex);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AccountFromValue",
          "args": [
            "params[1]"
          ],
          "line": 853
        },
        "resolved": true,
        "details": {
          "function_name": "AccountFromValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "68-74",
          "snippet": "string AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstring AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}"
        }
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 852
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "msg"
          ],
          "line": 848
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue addredeemscript(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 1 || params.size() > 2)\n    {\n        string msg = \"addredeemscript <redeemScript> [account]\\n\"\n            \"Add a P2SH address with a specified redeemScript to the wallet.\\n\"\n            \"If [account] is specified, assign address to [account].\";\n        throw runtime_error(msg);\n    }\n\n    string strAccount;\n    if (params.size() > 1)\n        strAccount = AccountFromValue(params[1]);\n\n    // Construct using pay-to-script-hash:\n    vector<unsigned char> innerData = ParseHexV(params[0], \"redeemScript\");\n    CScript inner(innerData.begin(), innerData.end());\n    CScriptID innerID = inner.GetID();\n    pwalletMain->AddCScript(inner);\n\n    pwalletMain->SetAddressBookName(innerID, strAccount);\n    return CBitcoinAddress(innerID).ToString();\n}"
  },
  {
    "function_name": "addmultisigaddress",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "772-839",
    "snippet": "Value addmultisigaddress(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 2 || params.size() > 3)\n    {\n        string msg = \"addmultisigaddress <nrequired> <'[\\\"key\\\",\\\"key\\\"]'> [account]\\n\"\n            \"Add a nrequired-to-sign multisignature address to the wallet\\\"\\n\"\n            \"each key is a Halcyon address or hex-encoded public key\\n\"\n            \"If [account] is specified, assign address to [account].\";\n        throw runtime_error(msg);\n    }\n\n    int nRequired = params[0].get_int();\n    const Array& keys = params[1].get_array();\n    string strAccount;\n    if (params.size() > 2)\n        strAccount = AccountFromValue(params[2]);\n\n    // Gather public keys\n    if (nRequired < 1)\n        throw runtime_error(\"a multisignature address must require at least one key to redeem\");\n    if ((int)keys.size() < nRequired)\n        throw runtime_error(\n            strprintf(\"not enough keys supplied \"\n                      \"(got %\"PRIszu\" keys, but need at least %d to redeem)\", keys.size(), nRequired));\n    std::vector<CKey> pubkeys;\n    pubkeys.resize(keys.size());\n    for (unsigned int i = 0; i < keys.size(); i++)\n    {\n        const std::string& ks = keys[i].get_str();\n\n        // Case 1: Bitcoin address and we have full public key:\n        CBitcoinAddress address(ks);\n        if (address.IsValid())\n        {\n            CKeyID keyID;\n            if (!address.GetKeyID(keyID))\n                throw runtime_error(\n                    strprintf(\"%s does not refer to a key\",ks.c_str()));\n            CPubKey vchPubKey;\n            if (!pwalletMain->GetPubKey(keyID, vchPubKey))\n                throw runtime_error(\n                    strprintf(\"no full public key for address %s\",ks.c_str()));\n            if (!vchPubKey.IsValid() || !pubkeys[i].SetPubKey(vchPubKey))\n                throw runtime_error(\" Invalid public key: \"+ks);\n        }\n\n        // Case 2: hex public key\n        else if (IsHex(ks))\n        {\n            CPubKey vchPubKey(ParseHex(ks));\n            if (!vchPubKey.IsValid() || !pubkeys[i].SetPubKey(vchPubKey))\n                throw runtime_error(\" Invalid public key: \"+ks);\n        }\n        else\n        {\n            throw runtime_error(\" Invalid public key: \"+ks);\n        }\n    }\n\n    // Construct using pay-to-script-hash:\n    CScript inner;\n    inner.SetMultisig(nRequired, pubkeys);\n    CScriptID innerID = inner.GetID();\n    pwalletMain->AddCScript(inner);\n\n    pwalletMain->SetAddressBookName(innerID, strAccount);\n    return CBitcoinAddress(innerID).ToString();\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "CBitcoinAddress",
          "args": [],
          "line": 838
        },
        "resolved": true,
        "details": {
          "function_name": "IsScript",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "384-394",
          "snippet": "bool IsScript() const {\n        if (!IsValid())\n            return false;\n        switch (nVersion) {\n        case SCRIPT_ADDRESS:\n        case SCRIPT_ADDRESS_TEST: {\n            return true;\n        }\n        default: return false;\n        }\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  bool IsScript() const {\n          if (!IsValid())\n              return false;\n          switch (nVersion) {\n          case SCRIPT_ADDRESS:\n          case SCRIPT_ADDRESS_TEST: {\n              return true;\n          }\n          default: return false;\n          }\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "CBitcoinAddress",
          "args": [
            "innerID"
          ],
          "line": 838
        },
        "resolved": true,
        "details": {
          "function_name": "operator()",
          "container": "CBitcoinAddressVisitor",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "399-399",
          "snippet": "bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddressVisitor {\n  bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->SetAddressBookName",
          "args": [
            "innerID",
            "strAccount"
          ],
          "line": 837
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->AddCScript",
          "args": [
            "inner"
          ],
          "line": 835
        },
        "resolved": true,
        "details": {
          "function_name": "AddCScript",
          "container": "CBasicKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.cpp",
          "lines": "29-36",
          "snippet": "bool CBasicKeyStore::AddCScript(const CScript& redeemScript)\n{\n    {\n        LOCK(cs_KeyStore);\n        mapScripts[redeemScript.GetID()] = redeemScript;\n    }\n    return true;\n}",
          "includes": [
            "#include \"script.h\"",
            "#include \"keystore.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"keystore.h\"\n\nCBasicKeyStore {\n  bool CBasicKeyStore::AddCScript(const CScript& redeemScript)\n  {\n      {\n          LOCK(cs_KeyStore);\n          mapScripts[redeemScript.GetID()] = redeemScript;\n      }\n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "inner.GetID",
          "args": [],
          "line": 834
        },
        "resolved": true,
        "details": {
          "function_name": "GetID",
          "container": "CPubKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.h",
          "lines": "80-82",
          "snippet": "CKeyID GetID() const {\n        return CKeyID(Hash160(vchPubKey));\n    }",
          "includes": [
            "#include <openssl/ec.h> // for EC_KEY definition",
            "#include \"util.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\"",
            "#include \"allocators.h\"",
            "#include <vector>",
            "#include <stdexcept>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <openssl/ec.h> // for EC_KEY definition\n#include \"util.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n#include \"allocators.h\"\n#include <vector>\n#include <stdexcept>\n\nCPubKey {\n  CKeyID GetID() const {\n          return CKeyID(Hash160(vchPubKey));\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "inner.SetMultisig",
          "args": [
            "nRequired",
            "pubkeys"
          ],
          "line": 833
        },
        "resolved": true,
        "details": {
          "function_name": "SetMultisig",
          "container": "CScript",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/script.cpp",
          "lines": "2016-2024",
          "snippet": "void CScript::SetMultisig(int nRequired, const std::vector<CKey>& keys)\n{\n    this->clear();\n\n    *this << EncodeOP_N(nRequired);\n    BOOST_FOREACH(const CKey& key, keys)\n        *this << key.GetPubKey();\n    *this << EncodeOP_N(keys.size()) << OP_CHECKMULTISIG;\n}",
          "includes": [
            "#include \"util.h\"",
            "#include \"sync.h\"",
            "#include \"main.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include \"keystore.h\"",
            "#include \"script.h\"",
            "#include <boost/tuple/tuple_comparison.hpp>",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/foreach.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"sync.h\"\n#include \"main.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include \"keystore.h\"\n#include \"script.h\"\n#include <boost/tuple/tuple_comparison.hpp>\n#include <boost/tuple/tuple.hpp>\n#include <boost/foreach.hpp>\n\nCScript {\n  void CScript::SetMultisig(int nRequired, const std::vector<CKey>& keys)\n  {\n      this->clear();\n  \n      *this << EncodeOP_N(nRequired);\n      BOOST_FOREACH(const CKey& key, keys)\n          *this << key.GetPubKey();\n      *this << EncodeOP_N(keys.size()) << OP_CHECKMULTISIG;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\" Invalid public key: \"+ks"
          ],
          "line": 827
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\" Invalid public key: \"+ks"
          ],
          "line": 823
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pubkeys[i].SetPubKey",
          "args": [
            "vchPubKey"
          ],
          "line": 822
        },
        "resolved": true,
        "details": {
          "function_name": "SetPubKey",
          "container": "CKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.cpp",
          "lines": "259-272",
          "snippet": "bool CKey::SetPubKey(const CPubKey& vchPubKey)\n{\n    const unsigned char* pbegin = &vchPubKey.vchPubKey[0];\n    if (o2i_ECPublicKey(&pkey, &pbegin, vchPubKey.vchPubKey.size()))\n    {\n        fSet = true;\n        if (vchPubKey.vchPubKey.size() == 33)\n            SetCompressedPubKey();\n        return true;\n    }\n    pkey = NULL;\n    Reset();\n    return false;\n}",
          "includes": [
            "#include \"key.h\"",
            "#include <openssl/obj_mac.h>",
            "#include <openssl/ecdsa.h>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"key.h\"\n#include <openssl/obj_mac.h>\n#include <openssl/ecdsa.h>\n#include <map>\n\nCKey {\n  bool CKey::SetPubKey(const CPubKey& vchPubKey)\n  {\n      const unsigned char* pbegin = &vchPubKey.vchPubKey[0];\n      if (o2i_ECPublicKey(&pkey, &pbegin, vchPubKey.vchPubKey.size()))\n      {\n          fSet = true;\n          if (vchPubKey.vchPubKey.size() == 33)\n              SetCompressedPubKey();\n          return true;\n      }\n      pkey = NULL;\n      Reset();\n      return false;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "vchPubKey.IsValid",
          "args": [],
          "line": 822
        },
        "resolved": true,
        "details": {
          "function_name": "IsValid",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "725-759",
          "snippet": "bool CNetAddr::IsValid() const\n{\n    // Cleanup 3-byte shifted addresses caused by garbage in size field\n    // of addr messages from versions before 0.2.9 checksum.\n    // Two consecutive addr messages look like this:\n    // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n    // so if the first length field is garbled, it reads the second batch\n    // of addr misaligned by 3 bytes.\n    if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n        return false;\n\n    // unspecified IPv6 address (::/128)\n    unsigned char ipNone[16] = {};\n    if (memcmp(ip, ipNone, 16) == 0)\n        return false;\n\n    // documentation IPv6 address\n    if (IsRFC3849())\n        return false;\n\n    if (IsIPv4())\n    {\n        // INADDR_NONE\n        uint32_t ipNone = INADDR_NONE;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n\n        // 0\n        ipNone = 0;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n    }\n\n    return true;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nstatic const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };\n\nCNetAddr {\n  bool CNetAddr::IsValid() const\n  {\n      // Cleanup 3-byte shifted addresses caused by garbage in size field\n      // of addr messages from versions before 0.2.9 checksum.\n      // Two consecutive addr messages look like this:\n      // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n      // so if the first length field is garbled, it reads the second batch\n      // of addr misaligned by 3 bytes.\n      if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n          return false;\n  \n      // unspecified IPv6 address (::/128)\n      unsigned char ipNone[16] = {};\n      if (memcmp(ip, ipNone, 16) == 0)\n          return false;\n  \n      // documentation IPv6 address\n      if (IsRFC3849())\n          return false;\n  \n      if (IsIPv4())\n      {\n          // INADDR_NONE\n          uint32_t ipNone = INADDR_NONE;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n  \n          // 0\n          ipNone = 0;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n      }\n  \n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "IsHex",
          "args": [
            "ks"
          ],
          "line": 819
        },
        "resolved": true,
        "details": {
          "function_name": "IsHex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "459-467",
          "snippet": "bool IsHex(const string& str)\n{\n    BOOST_FOREACH(unsigned char c, str)\n    {\n        if (phexdigit[c] < 0)\n            return false;\n    }\n    return (str.size() > 0) && (str.size()%2 == 0);\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const signed char phexdigit[256] =\n{ -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,\n  -1,0xa,0xb,0xc,0xd,0xe,0xf,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,0xa,0xb,0xc,0xd,0xe,0xf,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nstatic const signed char phexdigit[256] =\n{ -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  0,1,2,3,4,5,6,7,8,9,-1,-1,-1,-1,-1,-1,\n  -1,0xa,0xb,0xc,0xd,0xe,0xf,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,0xa,0xb,0xc,0xd,0xe,0xf,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,\n  -1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1, };\n\nbool IsHex(const string& str)\n{\n    BOOST_FOREACH(unsigned char c, str)\n    {\n        if (phexdigit[c] < 0)\n            return false;\n    }\n    return (str.size() > 0) && (str.size()%2 == 0);\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\" Invalid public key: \"+ks"
          ],
          "line": 815
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "strprintf(\"no full public key for address %s\",ks.c_str())"
          ],
          "line": 812
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strprintf",
          "args": [
            "\"no full public key for address %s\"",
            "ks.c_str()"
          ],
          "line": 813
        },
        "resolved": true,
        "details": {
          "function_name": "real_strprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "331-338",
          "snippet": "string real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nstring real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ks.c_str",
          "args": [],
          "line": 813
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->GetPubKey",
          "args": [
            "keyID",
            "vchPubKey"
          ],
          "line": 811
        },
        "resolved": true,
        "details": {
          "function_name": "GetPubKey",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.cpp",
          "lines": "180-195",
          "snippet": "bool CCryptoKeyStore::GetPubKey(const CKeyID &address, CPubKey& vchPubKeyOut) const\n{\n    {\n        LOCK(cs_KeyStore);\n        if (!IsCrypted())\n            return CKeyStore::GetPubKey(address, vchPubKeyOut);\n\n        CryptedKeyMap::const_iterator mi = mapCryptedKeys.find(address);\n        if (mi != mapCryptedKeys.end())\n        {\n            vchPubKeyOut = (*mi).second.first;\n            return true;\n        }\n    }\n    return false;\n}",
          "includes": [
            "#include \"script.h\"",
            "#include \"keystore.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"keystore.h\"\n\nCCryptoKeyStore {\n  bool CCryptoKeyStore::GetPubKey(const CKeyID &address, CPubKey& vchPubKeyOut) const\n  {\n      {\n          LOCK(cs_KeyStore);\n          if (!IsCrypted())\n              return CKeyStore::GetPubKey(address, vchPubKeyOut);\n  \n          CryptedKeyMap::const_iterator mi = mapCryptedKeys.find(address);\n          if (mi != mapCryptedKeys.end())\n          {\n              vchPubKeyOut = (*mi).second.first;\n              return true;\n          }\n      }\n      return false;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "strprintf(\"%s does not refer to a key\",ks.c_str())"
          ],
          "line": 808
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ks.c_str",
          "args": [],
          "line": 809
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "address.GetKeyID",
          "args": [
            "keyID"
          ],
          "line": 807
        },
        "resolved": true,
        "details": {
          "function_name": "GetKeyID",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "369-382",
          "snippet": "bool GetKeyID(CKeyID &keyID) const {\n        if (!IsValid())\n            return false;\n        switch (nVersion) {\n        case PUBKEY_ADDRESS:\n        case PUBKEY_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            keyID = CKeyID(id);\n            return true;\n        }\n        default: return false;\n        }\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  bool GetKeyID(CKeyID &keyID) const {\n          if (!IsValid())\n              return false;\n          switch (nVersion) {\n          case PUBKEY_ADDRESS:\n          case PUBKEY_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              keyID = CKeyID(id);\n              return true;\n          }\n          default: return false;\n          }\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "keys[i].get_str",
          "args": [],
          "line": 800
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "keys.size",
          "args": [],
          "line": 798
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pubkeys.resize",
          "args": [
            "keys.size()"
          ],
          "line": 797
        },
        "resolved": true,
        "details": {
          "function_name": "resize",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "804-804",
          "snippet": "void resize(size_type n, value_type c=0)         { vch.resize(n + nReadPos, c); }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  void resize(size_type n, value_type c=0)         { vch.resize(n + nReadPos, c); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "strprintf(\"not enough keys supplied \"\n                      \"(got %\"PRIszu\" keys, but need at least %d to redeem)\", keys.size(), nRequired)"
          ],
          "line": 793
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strprintf",
          "args": [
            "\"not enough keys supplied \"\n                      \"(got %\"PRIszu\" keys, but need at least %d to redeem)\"",
            "keys.size()",
            "nRequired"
          ],
          "line": 794
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"a multisignature address must require at least one key to redeem\""
          ],
          "line": 791
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AccountFromValue",
          "args": [
            "params[2]"
          ],
          "line": 787
        },
        "resolved": true,
        "details": {
          "function_name": "AccountFromValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "68-74",
          "snippet": "string AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstring AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[1].get_array",
          "args": [],
          "line": 784
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[0].get_int",
          "args": [],
          "line": 783
        },
        "resolved": true,
        "details": {
          "function_name": "get_int",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "385-390",
          "snippet": "int Value_impl< Config >::get_int() const\n    {\n        check_type(  int_type );\n\n        return static_cast< int >( get_int64() );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  int Value_impl< Config >::get_int() const\n      {\n          check_type(  int_type );\n  \n          return static_cast< int >( get_int64() );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "msg"
          ],
          "line": 780
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue addmultisigaddress(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 2 || params.size() > 3)\n    {\n        string msg = \"addmultisigaddress <nrequired> <'[\\\"key\\\",\\\"key\\\"]'> [account]\\n\"\n            \"Add a nrequired-to-sign multisignature address to the wallet\\\"\\n\"\n            \"each key is a Halcyon address or hex-encoded public key\\n\"\n            \"If [account] is specified, assign address to [account].\";\n        throw runtime_error(msg);\n    }\n\n    int nRequired = params[0].get_int();\n    const Array& keys = params[1].get_array();\n    string strAccount;\n    if (params.size() > 2)\n        strAccount = AccountFromValue(params[2]);\n\n    // Gather public keys\n    if (nRequired < 1)\n        throw runtime_error(\"a multisignature address must require at least one key to redeem\");\n    if ((int)keys.size() < nRequired)\n        throw runtime_error(\n            strprintf(\"not enough keys supplied \"\n                      \"(got %\"PRIszu\" keys, but need at least %d to redeem)\", keys.size(), nRequired));\n    std::vector<CKey> pubkeys;\n    pubkeys.resize(keys.size());\n    for (unsigned int i = 0; i < keys.size(); i++)\n    {\n        const std::string& ks = keys[i].get_str();\n\n        // Case 1: Bitcoin address and we have full public key:\n        CBitcoinAddress address(ks);\n        if (address.IsValid())\n        {\n            CKeyID keyID;\n            if (!address.GetKeyID(keyID))\n                throw runtime_error(\n                    strprintf(\"%s does not refer to a key\",ks.c_str()));\n            CPubKey vchPubKey;\n            if (!pwalletMain->GetPubKey(keyID, vchPubKey))\n                throw runtime_error(\n                    strprintf(\"no full public key for address %s\",ks.c_str()));\n            if (!vchPubKey.IsValid() || !pubkeys[i].SetPubKey(vchPubKey))\n                throw runtime_error(\" Invalid public key: \"+ks);\n        }\n\n        // Case 2: hex public key\n        else if (IsHex(ks))\n        {\n            CPubKey vchPubKey(ParseHex(ks));\n            if (!vchPubKey.IsValid() || !pubkeys[i].SetPubKey(vchPubKey))\n                throw runtime_error(\" Invalid public key: \"+ks);\n        }\n        else\n        {\n            throw runtime_error(\" Invalid public key: \"+ks);\n        }\n    }\n\n    // Construct using pay-to-script-hash:\n    CScript inner;\n    inner.SetMultisig(nRequired, pubkeys);\n    CScriptID innerID = inner.GetID();\n    pwalletMain->AddCScript(inner);\n\n    pwalletMain->SetAddressBookName(innerID, strAccount);\n    return CBitcoinAddress(innerID).ToString();\n}"
  },
  {
    "function_name": "sendmany",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "707-770",
    "snippet": "Value sendmany(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 2 || params.size() > 4)\n        throw runtime_error(\n            \"sendmany <fromaccount> {address:amount,...} [minconf=1] [comment]\\n\"\n            \"amounts are double-precision floating point numbers\"\n            + HelpRequiringPassphrase());\n\n    string strAccount = AccountFromValue(params[0]);\n    Object sendTo = params[1].get_obj();\n    int nMinDepth = 1;\n    if (params.size() > 2)\n        nMinDepth = params[2].get_int();\n\n    CWalletTx wtx;\n    wtx.strFromAccount = strAccount;\n    if (params.size() > 3 && params[3].type() != null_type && !params[3].get_str().empty())\n        wtx.mapValue[\"comment\"] = params[3].get_str();\n\n    set<CBitcoinAddress> setAddress;\n    vector<pair<CScript, int64_t> > vecSend;\n\n    int64_t totalAmount = 0;\n    BOOST_FOREACH(const Pair& s, sendTo)\n    {\n        CBitcoinAddress address(s.name_);\n        if (!address.IsValid())\n            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, string(\"Invalid Halcyon address: \")+s.name_);\n\n        if (setAddress.count(address))\n            throw JSONRPCError(RPC_INVALID_PARAMETER, string(\"Invalid parameter, duplicated address: \")+s.name_);\n        setAddress.insert(address);\n\n        CScript scriptPubKey;\n        scriptPubKey.SetDestination(address.Get());\n        int64_t nAmount = AmountFromValue(s.value_);\n\n        totalAmount += nAmount;\n\n        vecSend.push_back(make_pair(scriptPubKey, nAmount));\n    }\n\n    EnsureWalletIsUnlocked();\n\n    // Check funds\n    int64_t nBalance = GetAccountBalance(strAccount, nMinDepth);\n    if (totalAmount > nBalance)\n        throw JSONRPCError(RPC_WALLET_INSUFFICIENT_FUNDS, \"Account has insufficient funds\");\n\n    // Send\n    CReserveKey keyChange(pwalletMain);\n    int64_t nFeeRequired = 0;\n    bool fCreated = pwalletMain->CreateTransaction(vecSend, wtx, keyChange, nFeeRequired);\n    if (!fCreated)\n    {\n        if (totalAmount + nFeeRequired > pwalletMain->GetBalance())\n            throw JSONRPCError(RPC_WALLET_INSUFFICIENT_FUNDS, \"Insufficient funds\");\n        throw JSONRPCError(RPC_WALLET_ERROR, \"Transaction creation failed\");\n    }\n    if (!pwalletMain->CommitTransaction(wtx, keyChange))\n        throw JSONRPCError(RPC_WALLET_ERROR, \"Transaction commit failed\");\n\n    return wtx.GetHash().GetHex();\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wtx.GetHash",
          "args": [],
          "line": 769
        },
        "resolved": true,
        "details": {
          "function_name": "GetHash",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "922-928",
          "snippet": "uint64_t CNetAddr::GetHash() const\n{\n    uint256 hash = Hash(&ip[0], &ip[16]);\n    uint64_t nRet;\n    memcpy(&nRet, &hash, sizeof(nRet));\n    return nRet;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCNetAddr {\n  uint64_t CNetAddr::GetHash() const\n  {\n      uint256 hash = Hash(&ip[0], &ip[16]);\n      uint64_t nRet;\n      memcpy(&nRet, &hash, sizeof(nRet));\n      return nRet;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_WALLET_ERROR",
            "\"Transaction commit failed\""
          ],
          "line": 767
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->CommitTransaction",
          "args": [
            "wtx",
            "keyChange"
          ],
          "line": 766
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->GetBalance",
          "args": [],
          "line": 762
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->CreateTransaction",
          "args": [
            "vecSend",
            "wtx",
            "keyChange",
            "nFeeRequired"
          ],
          "line": 759
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetAccountBalance",
          "args": [
            "strAccount",
            "nMinDepth"
          ],
          "line": 752
        },
        "resolved": true,
        "details": {
          "function_name": "GetAccountBalance",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "553-557",
          "snippet": "int64_t GetAccountBalance(const string& strAccount, int nMinDepth)\n{\n    CWalletDB walletdb(pwalletMain->strWalletFile);\n    return GetAccountBalance(walletdb, strAccount, nMinDepth);\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nint64_t GetAccountBalance(const string& strAccount, int nMinDepth)\n{\n    CWalletDB walletdb(pwalletMain->strWalletFile);\n    return GetAccountBalance(walletdb, strAccount, nMinDepth);\n}"
        }
      },
      {
        "call_info": {
          "callee": "EnsureWalletIsUnlocked",
          "args": [],
          "line": 749
        },
        "resolved": true,
        "details": {
          "function_name": "EnsureWalletIsUnlocked",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "41-47",
          "snippet": "void EnsureWalletIsUnlocked()\n{\n    if (pwalletMain->IsLocked())\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Please enter the wallet passphrase with walletpassphrase first.\");\n    if (fWalletUnlockStakingOnly)\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Wallet is unlocked for staking only.\");\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nvoid EnsureWalletIsUnlocked()\n{\n    if (pwalletMain->IsLocked())\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Please enter the wallet passphrase with walletpassphrase first.\");\n    if (fWalletUnlockStakingOnly)\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Wallet is unlocked for staking only.\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "vecSend.push_back",
          "args": [
            "make_pair(scriptPubKey, nAmount)"
          ],
          "line": 746
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "make_pair",
          "args": [
            "scriptPubKey",
            "nAmount"
          ],
          "line": 746
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AmountFromValue",
          "args": [
            "s.value_"
          ],
          "line": 742
        },
        "resolved": true,
        "details": {
          "function_name": "AmountFromValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "102-111",
          "snippet": "int64_t AmountFromValue(const Value& value)\n{\n    double dAmount = value.get_real();\n    if (dAmount <= 0.0 || dAmount > MAX_MONEY)\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    int64_t nAmount = roundint64(dAmount * COIN);\n    if (!MoneyRange(nAmount))\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    return nAmount;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nint64_t AmountFromValue(const Value& value)\n{\n    double dAmount = value.get_real();\n    if (dAmount <= 0.0 || dAmount > MAX_MONEY)\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    int64_t nAmount = roundint64(dAmount * COIN);\n    if (!MoneyRange(nAmount))\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    return nAmount;\n}"
        }
      },
      {
        "call_info": {
          "callee": "scriptPubKey.SetDestination",
          "args": [
            "address.Get()"
          ],
          "line": 741
        },
        "resolved": true,
        "details": {
          "function_name": "SetDestination",
          "container": "CScript",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/script.cpp",
          "lines": "2011-2014",
          "snippet": "void CScript::SetDestination(const CTxDestination& dest)\n{\n    boost::apply_visitor(CScriptVisitor(this), dest);\n}",
          "includes": [
            "#include \"util.h\"",
            "#include \"sync.h\"",
            "#include \"main.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include \"keystore.h\"",
            "#include \"script.h\"",
            "#include <boost/tuple/tuple_comparison.hpp>",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/foreach.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"sync.h\"\n#include \"main.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include \"keystore.h\"\n#include \"script.h\"\n#include <boost/tuple/tuple_comparison.hpp>\n#include <boost/tuple/tuple.hpp>\n#include <boost/foreach.hpp>\n\nCScript {\n  void CScript::SetDestination(const CTxDestination& dest)\n  {\n      boost::apply_visitor(CScriptVisitor(this), dest);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "address.Get",
          "args": [],
          "line": 741
        },
        "resolved": true,
        "details": {
          "function_name": "Get",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "349-367",
          "snippet": "CTxDestination Get() const {\n        if (!IsValid())\n            return CNoDestination();\n        switch (nVersion) {\n        case PUBKEY_ADDRESS:\n        case PUBKEY_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            return CKeyID(id);\n        }\n        case SCRIPT_ADDRESS:\n        case SCRIPT_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            return CScriptID(id);\n        }\n        }\n        return CNoDestination();\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  CTxDestination Get() const {\n          if (!IsValid())\n              return CNoDestination();\n          switch (nVersion) {\n          case PUBKEY_ADDRESS:\n          case PUBKEY_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              return CKeyID(id);\n          }\n          case SCRIPT_ADDRESS:\n          case SCRIPT_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              return CScriptID(id);\n          }\n          }\n          return CNoDestination();\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "setAddress.insert",
          "args": [
            "address"
          ],
          "line": 738
        },
        "resolved": true,
        "details": {
          "function_name": "insert",
          "container": "CBloomFilter",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bloom.cpp",
          "lines": "61-65",
          "snippet": "void CBloomFilter::insert(const uint256& hash)\n{\n    vector<unsigned char> data(BEGIN(hash), END(hash));\n    insert(data);\n}",
          "includes": [
            "#include \"hash.h\"",
            "#include \"script.h\"",
            "#include \"main.h\"",
            "#include \"bloom.h\"",
            "#include <stdlib.h>",
            "#include <math.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hash.h\"\n#include \"script.h\"\n#include \"main.h\"\n#include \"bloom.h\"\n#include <stdlib.h>\n#include <math.h>\n\nCBloomFilter {\n  void CBloomFilter::insert(const uint256& hash)\n  {\n      vector<unsigned char> data(BEGIN(hash), END(hash));\n      insert(data);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "string",
          "args": [
            "\"Invalid parameter, duplicated address: \""
          ],
          "line": 737
        },
        "resolved": true,
        "details": {
          "function_name": "non_printable_to_string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_writer_template.h",
          "lines": "29-41",
          "snippet": "String_type non_printable_to_string( unsigned int c )\n    {\n        String_type result( 6, '\\\\' );\n\n        result[1] = 'u';\n\n        result[ 5 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 4 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 3 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 2 ] = to_hex_char( c & 0x000F );\n\n        return result;\n    }",
          "includes": [
            "#include <iomanip>",
            "#include <sstream>",
            "#include <cassert>",
            "#include \"json_spirit_value.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iomanip>\n#include <sstream>\n#include <cassert>\n#include \"json_spirit_value.h\"\n\nString_type non_printable_to_string( unsigned int c )\n    {\n        String_type result( 6, '\\\\' );\n\n        result[1] = 'u';\n\n        result[ 5 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 4 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 3 ] = to_hex_char( c & 0x000F ); c >>= 4;\n        result[ 2 ] = to_hex_char( c & 0x000F );\n\n        return result;\n    }"
        }
      },
      {
        "call_info": {
          "callee": "setAddress.count",
          "args": [
            "address"
          ],
          "line": 736
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "address.IsValid",
          "args": [],
          "line": 733
        },
        "resolved": true,
        "details": {
          "function_name": "IsValid",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "725-759",
          "snippet": "bool CNetAddr::IsValid() const\n{\n    // Cleanup 3-byte shifted addresses caused by garbage in size field\n    // of addr messages from versions before 0.2.9 checksum.\n    // Two consecutive addr messages look like this:\n    // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n    // so if the first length field is garbled, it reads the second batch\n    // of addr misaligned by 3 bytes.\n    if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n        return false;\n\n    // unspecified IPv6 address (::/128)\n    unsigned char ipNone[16] = {};\n    if (memcmp(ip, ipNone, 16) == 0)\n        return false;\n\n    // documentation IPv6 address\n    if (IsRFC3849())\n        return false;\n\n    if (IsIPv4())\n    {\n        // INADDR_NONE\n        uint32_t ipNone = INADDR_NONE;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n\n        // 0\n        ipNone = 0;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n    }\n\n    return true;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nstatic const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };\n\nCNetAddr {\n  bool CNetAddr::IsValid() const\n  {\n      // Cleanup 3-byte shifted addresses caused by garbage in size field\n      // of addr messages from versions before 0.2.9 checksum.\n      // Two consecutive addr messages look like this:\n      // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n      // so if the first length field is garbled, it reads the second batch\n      // of addr misaligned by 3 bytes.\n      if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n          return false;\n  \n      // unspecified IPv6 address (::/128)\n      unsigned char ipNone[16] = {};\n      if (memcmp(ip, ipNone, 16) == 0)\n          return false;\n  \n      // documentation IPv6 address\n      if (IsRFC3849())\n          return false;\n  \n      if (IsIPv4())\n      {\n          // INADDR_NONE\n          uint32_t ipNone = INADDR_NONE;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n  \n          // 0\n          ipNone = 0;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n      }\n  \n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[3].get_str",
          "args": [],
          "line": 724
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[3].get_str",
          "args": [],
          "line": 723
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[3].get_str",
          "args": [],
          "line": 723
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[3].type",
          "args": [],
          "line": 723
        },
        "resolved": true,
        "details": {
          "function_name": "type",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "321-324",
          "snippet": "Value_type Value_impl< Config >::type() const\n    {\n        return type_;\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  Value_type Value_impl< Config >::type() const\n      {\n          return type_;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 723
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[2].get_int",
          "args": [],
          "line": 719
        },
        "resolved": true,
        "details": {
          "function_name": "get_int",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "385-390",
          "snippet": "int Value_impl< Config >::get_int() const\n    {\n        check_type(  int_type );\n\n        return static_cast< int >( get_int64() );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  int Value_impl< Config >::get_int() const\n      {\n          check_type(  int_type );\n  \n          return static_cast< int >( get_int64() );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[1].get_obj",
          "args": [],
          "line": 716
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AccountFromValue",
          "args": [
            "params[0]"
          ],
          "line": 715
        },
        "resolved": true,
        "details": {
          "function_name": "AccountFromValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "68-74",
          "snippet": "string AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstring AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"sendmany <fromaccount> {address:amount,...} [minconf=1] [comment]\\n\"\n            \"amounts are double-precision floating point numbers\"\n            + HelpRequiringPassphrase()"
          ],
          "line": 710
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HelpRequiringPassphrase",
          "args": [],
          "line": 713
        },
        "resolved": true,
        "details": {
          "function_name": "HelpRequiringPassphrase",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "34-39",
          "snippet": "std::string HelpRequiringPassphrase()\n{\n    return pwalletMain->IsCrypted()\n        ? \"\\nrequires wallet passphrase to be set with walletpassphrase first\"\n        : \"\";\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstd::string HelpRequiringPassphrase()\n{\n    return pwalletMain->IsCrypted()\n        ? \"\\nrequires wallet passphrase to be set with walletpassphrase first\"\n        : \"\";\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue sendmany(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 2 || params.size() > 4)\n        throw runtime_error(\n            \"sendmany <fromaccount> {address:amount,...} [minconf=1] [comment]\\n\"\n            \"amounts are double-precision floating point numbers\"\n            + HelpRequiringPassphrase());\n\n    string strAccount = AccountFromValue(params[0]);\n    Object sendTo = params[1].get_obj();\n    int nMinDepth = 1;\n    if (params.size() > 2)\n        nMinDepth = params[2].get_int();\n\n    CWalletTx wtx;\n    wtx.strFromAccount = strAccount;\n    if (params.size() > 3 && params[3].type() != null_type && !params[3].get_str().empty())\n        wtx.mapValue[\"comment\"] = params[3].get_str();\n\n    set<CBitcoinAddress> setAddress;\n    vector<pair<CScript, int64_t> > vecSend;\n\n    int64_t totalAmount = 0;\n    BOOST_FOREACH(const Pair& s, sendTo)\n    {\n        CBitcoinAddress address(s.name_);\n        if (!address.IsValid())\n            throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, string(\"Invalid Halcyon address: \")+s.name_);\n\n        if (setAddress.count(address))\n            throw JSONRPCError(RPC_INVALID_PARAMETER, string(\"Invalid parameter, duplicated address: \")+s.name_);\n        setAddress.insert(address);\n\n        CScript scriptPubKey;\n        scriptPubKey.SetDestination(address.Get());\n        int64_t nAmount = AmountFromValue(s.value_);\n\n        totalAmount += nAmount;\n\n        vecSend.push_back(make_pair(scriptPubKey, nAmount));\n    }\n\n    EnsureWalletIsUnlocked();\n\n    // Check funds\n    int64_t nBalance = GetAccountBalance(strAccount, nMinDepth);\n    if (totalAmount > nBalance)\n        throw JSONRPCError(RPC_WALLET_INSUFFICIENT_FUNDS, \"Account has insufficient funds\");\n\n    // Send\n    CReserveKey keyChange(pwalletMain);\n    int64_t nFeeRequired = 0;\n    bool fCreated = pwalletMain->CreateTransaction(vecSend, wtx, keyChange, nFeeRequired);\n    if (!fCreated)\n    {\n        if (totalAmount + nFeeRequired > pwalletMain->GetBalance())\n            throw JSONRPCError(RPC_WALLET_INSUFFICIENT_FUNDS, \"Insufficient funds\");\n        throw JSONRPCError(RPC_WALLET_ERROR, \"Transaction creation failed\");\n    }\n    if (!pwalletMain->CommitTransaction(wtx, keyChange))\n        throw JSONRPCError(RPC_WALLET_ERROR, \"Transaction commit failed\");\n\n    return wtx.GetHash().GetHex();\n}"
  },
  {
    "function_name": "sendfrom",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "666-704",
    "snippet": "Value sendfrom(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 3 || params.size() > 6)\n        throw runtime_error(\n            \"sendfrom <fromaccount> <tohalcyonaddress> <amount> [minconf=1] [comment] [comment-to]\\n\"\n            \"<amount> is a real and is rounded to the nearest 0.000001\"\n            + HelpRequiringPassphrase());\n\n    string strAccount = AccountFromValue(params[0]);\n    CBitcoinAddress address(params[1].get_str());\n    if (!address.IsValid())\n        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid Halcyon address\");\n    int64_t nAmount = AmountFromValue(params[2]);\n\n    int nMinDepth = 1;\n    if (params.size() > 3)\n        nMinDepth = params[3].get_int();\n\n    CWalletTx wtx;\n    wtx.strFromAccount = strAccount;\n    if (params.size() > 4 && params[4].type() != null_type && !params[4].get_str().empty())\n        wtx.mapValue[\"comment\"] = params[4].get_str();\n    if (params.size() > 5 && params[5].type() != null_type && !params[5].get_str().empty())\n        wtx.mapValue[\"to\"]      = params[5].get_str();\n\n    EnsureWalletIsUnlocked();\n\n    // Check funds\n    int64_t nBalance = GetAccountBalance(strAccount, nMinDepth);\n    if (nAmount > nBalance)\n        throw JSONRPCError(RPC_WALLET_INSUFFICIENT_FUNDS, \"Account has insufficient funds\");\n\n    // Send\n    string strError = pwalletMain->SendMoneyToDestination(address.Get(), nAmount, wtx);\n    if (strError != \"\")\n        throw JSONRPCError(RPC_WALLET_ERROR, strError);\n\n    return wtx.GetHash().GetHex();\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wtx.GetHash",
          "args": [],
          "line": 703
        },
        "resolved": true,
        "details": {
          "function_name": "GetHash",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "922-928",
          "snippet": "uint64_t CNetAddr::GetHash() const\n{\n    uint256 hash = Hash(&ip[0], &ip[16]);\n    uint64_t nRet;\n    memcpy(&nRet, &hash, sizeof(nRet));\n    return nRet;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCNetAddr {\n  uint64_t CNetAddr::GetHash() const\n  {\n      uint256 hash = Hash(&ip[0], &ip[16]);\n      uint64_t nRet;\n      memcpy(&nRet, &hash, sizeof(nRet));\n      return nRet;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_WALLET_ERROR",
            "strError"
          ],
          "line": 701
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->SendMoneyToDestination",
          "args": [
            "address.Get()",
            "nAmount",
            "wtx"
          ],
          "line": 699
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "address.Get",
          "args": [],
          "line": 699
        },
        "resolved": true,
        "details": {
          "function_name": "Get",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "349-367",
          "snippet": "CTxDestination Get() const {\n        if (!IsValid())\n            return CNoDestination();\n        switch (nVersion) {\n        case PUBKEY_ADDRESS:\n        case PUBKEY_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            return CKeyID(id);\n        }\n        case SCRIPT_ADDRESS:\n        case SCRIPT_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            return CScriptID(id);\n        }\n        }\n        return CNoDestination();\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  CTxDestination Get() const {\n          if (!IsValid())\n              return CNoDestination();\n          switch (nVersion) {\n          case PUBKEY_ADDRESS:\n          case PUBKEY_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              return CKeyID(id);\n          }\n          case SCRIPT_ADDRESS:\n          case SCRIPT_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              return CScriptID(id);\n          }\n          }\n          return CNoDestination();\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "GetAccountBalance",
          "args": [
            "strAccount",
            "nMinDepth"
          ],
          "line": 694
        },
        "resolved": true,
        "details": {
          "function_name": "GetAccountBalance",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "553-557",
          "snippet": "int64_t GetAccountBalance(const string& strAccount, int nMinDepth)\n{\n    CWalletDB walletdb(pwalletMain->strWalletFile);\n    return GetAccountBalance(walletdb, strAccount, nMinDepth);\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nint64_t GetAccountBalance(const string& strAccount, int nMinDepth)\n{\n    CWalletDB walletdb(pwalletMain->strWalletFile);\n    return GetAccountBalance(walletdb, strAccount, nMinDepth);\n}"
        }
      },
      {
        "call_info": {
          "callee": "EnsureWalletIsUnlocked",
          "args": [],
          "line": 691
        },
        "resolved": true,
        "details": {
          "function_name": "EnsureWalletIsUnlocked",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "41-47",
          "snippet": "void EnsureWalletIsUnlocked()\n{\n    if (pwalletMain->IsLocked())\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Please enter the wallet passphrase with walletpassphrase first.\");\n    if (fWalletUnlockStakingOnly)\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Wallet is unlocked for staking only.\");\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nvoid EnsureWalletIsUnlocked()\n{\n    if (pwalletMain->IsLocked())\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Please enter the wallet passphrase with walletpassphrase first.\");\n    if (fWalletUnlockStakingOnly)\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Wallet is unlocked for staking only.\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[5].get_str",
          "args": [],
          "line": 689
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[5].get_str",
          "args": [],
          "line": 688
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[5].get_str",
          "args": [],
          "line": 688
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[5].type",
          "args": [],
          "line": 688
        },
        "resolved": true,
        "details": {
          "function_name": "type",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "321-324",
          "snippet": "Value_type Value_impl< Config >::type() const\n    {\n        return type_;\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  Value_type Value_impl< Config >::type() const\n      {\n          return type_;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 688
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[4].get_str",
          "args": [],
          "line": 687
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[4].get_str",
          "args": [],
          "line": 686
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[4].get_str",
          "args": [],
          "line": 686
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[3].get_int",
          "args": [],
          "line": 682
        },
        "resolved": true,
        "details": {
          "function_name": "get_int",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "385-390",
          "snippet": "int Value_impl< Config >::get_int() const\n    {\n        check_type(  int_type );\n\n        return static_cast< int >( get_int64() );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  int Value_impl< Config >::get_int() const\n      {\n          check_type(  int_type );\n  \n          return static_cast< int >( get_int64() );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "AmountFromValue",
          "args": [
            "params[2]"
          ],
          "line": 678
        },
        "resolved": true,
        "details": {
          "function_name": "AmountFromValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "102-111",
          "snippet": "int64_t AmountFromValue(const Value& value)\n{\n    double dAmount = value.get_real();\n    if (dAmount <= 0.0 || dAmount > MAX_MONEY)\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    int64_t nAmount = roundint64(dAmount * COIN);\n    if (!MoneyRange(nAmount))\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    return nAmount;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nint64_t AmountFromValue(const Value& value)\n{\n    double dAmount = value.get_real();\n    if (dAmount <= 0.0 || dAmount > MAX_MONEY)\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    int64_t nAmount = roundint64(dAmount * COIN);\n    if (!MoneyRange(nAmount))\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    return nAmount;\n}"
        }
      },
      {
        "call_info": {
          "callee": "address.IsValid",
          "args": [],
          "line": 676
        },
        "resolved": true,
        "details": {
          "function_name": "IsValid",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "725-759",
          "snippet": "bool CNetAddr::IsValid() const\n{\n    // Cleanup 3-byte shifted addresses caused by garbage in size field\n    // of addr messages from versions before 0.2.9 checksum.\n    // Two consecutive addr messages look like this:\n    // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n    // so if the first length field is garbled, it reads the second batch\n    // of addr misaligned by 3 bytes.\n    if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n        return false;\n\n    // unspecified IPv6 address (::/128)\n    unsigned char ipNone[16] = {};\n    if (memcmp(ip, ipNone, 16) == 0)\n        return false;\n\n    // documentation IPv6 address\n    if (IsRFC3849())\n        return false;\n\n    if (IsIPv4())\n    {\n        // INADDR_NONE\n        uint32_t ipNone = INADDR_NONE;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n\n        // 0\n        ipNone = 0;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n    }\n\n    return true;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nstatic const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };\n\nCNetAddr {\n  bool CNetAddr::IsValid() const\n  {\n      // Cleanup 3-byte shifted addresses caused by garbage in size field\n      // of addr messages from versions before 0.2.9 checksum.\n      // Two consecutive addr messages look like this:\n      // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n      // so if the first length field is garbled, it reads the second batch\n      // of addr misaligned by 3 bytes.\n      if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n          return false;\n  \n      // unspecified IPv6 address (::/128)\n      unsigned char ipNone[16] = {};\n      if (memcmp(ip, ipNone, 16) == 0)\n          return false;\n  \n      // documentation IPv6 address\n      if (IsRFC3849())\n          return false;\n  \n      if (IsIPv4())\n      {\n          // INADDR_NONE\n          uint32_t ipNone = INADDR_NONE;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n  \n          // 0\n          ipNone = 0;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n      }\n  \n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[1].get_str",
          "args": [],
          "line": 675
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AccountFromValue",
          "args": [
            "params[0]"
          ],
          "line": 674
        },
        "resolved": true,
        "details": {
          "function_name": "AccountFromValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "68-74",
          "snippet": "string AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstring AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"sendfrom <fromaccount> <tohalcyonaddress> <amount> [minconf=1] [comment] [comment-to]\\n\"\n            \"<amount> is a real and is rounded to the nearest 0.000001\"\n            + HelpRequiringPassphrase()"
          ],
          "line": 669
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HelpRequiringPassphrase",
          "args": [],
          "line": 672
        },
        "resolved": true,
        "details": {
          "function_name": "HelpRequiringPassphrase",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "34-39",
          "snippet": "std::string HelpRequiringPassphrase()\n{\n    return pwalletMain->IsCrypted()\n        ? \"\\nrequires wallet passphrase to be set with walletpassphrase first\"\n        : \"\";\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstd::string HelpRequiringPassphrase()\n{\n    return pwalletMain->IsCrypted()\n        ? \"\\nrequires wallet passphrase to be set with walletpassphrase first\"\n        : \"\";\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue sendfrom(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 3 || params.size() > 6)\n        throw runtime_error(\n            \"sendfrom <fromaccount> <tohalcyonaddress> <amount> [minconf=1] [comment] [comment-to]\\n\"\n            \"<amount> is a real and is rounded to the nearest 0.000001\"\n            + HelpRequiringPassphrase());\n\n    string strAccount = AccountFromValue(params[0]);\n    CBitcoinAddress address(params[1].get_str());\n    if (!address.IsValid())\n        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid Halcyon address\");\n    int64_t nAmount = AmountFromValue(params[2]);\n\n    int nMinDepth = 1;\n    if (params.size() > 3)\n        nMinDepth = params[3].get_int();\n\n    CWalletTx wtx;\n    wtx.strFromAccount = strAccount;\n    if (params.size() > 4 && params[4].type() != null_type && !params[4].get_str().empty())\n        wtx.mapValue[\"comment\"] = params[4].get_str();\n    if (params.size() > 5 && params[5].type() != null_type && !params[5].get_str().empty())\n        wtx.mapValue[\"to\"]      = params[5].get_str();\n\n    EnsureWalletIsUnlocked();\n\n    // Check funds\n    int64_t nBalance = GetAccountBalance(strAccount, nMinDepth);\n    if (nAmount > nBalance)\n        throw JSONRPCError(RPC_WALLET_INSUFFICIENT_FUNDS, \"Account has insufficient funds\");\n\n    // Send\n    string strError = pwalletMain->SendMoneyToDestination(address.Get(), nAmount, wtx);\n    if (strError != \"\")\n        throw JSONRPCError(RPC_WALLET_ERROR, strError);\n\n    return wtx.GetHash().GetHex();\n}"
  },
  {
    "function_name": "movecmd",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "613-663",
    "snippet": "Value movecmd(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 3 || params.size() > 5)\n        throw runtime_error(\n            \"move <fromaccount> <toaccount> <amount> [minconf=1] [comment]\\n\"\n            \"Move from one account in your wallet to another.\");\n\n    accountingDeprecationCheck();\n\n    string strFrom = AccountFromValue(params[0]);\n    string strTo = AccountFromValue(params[1]);\n    int64_t nAmount = AmountFromValue(params[2]);\n\n    if (params.size() > 3)\n        // unused parameter, used to be nMinDepth, keep type-checking it though\n        (void)params[3].get_int();\n    string strComment;\n    if (params.size() > 4)\n        strComment = params[4].get_str();\n\n    CWalletDB walletdb(pwalletMain->strWalletFile);\n    if (!walletdb.TxnBegin())\n        throw JSONRPCError(RPC_DATABASE_ERROR, \"database error\");\n\n    int64_t nNow = GetAdjustedTime();\n\n    // Debit\n    CAccountingEntry debit;\n    debit.nOrderPos = pwalletMain->IncOrderPosNext(&walletdb);\n    debit.strAccount = strFrom;\n    debit.nCreditDebit = -nAmount;\n    debit.nTime = nNow;\n    debit.strOtherAccount = strTo;\n    debit.strComment = strComment;\n    walletdb.WriteAccountingEntry(debit);\n\n    // Credit\n    CAccountingEntry credit;\n    credit.nOrderPos = pwalletMain->IncOrderPosNext(&walletdb);\n    credit.strAccount = strTo;\n    credit.nCreditDebit = nAmount;\n    credit.nTime = nNow;\n    credit.strOtherAccount = strFrom;\n    credit.strComment = strComment;\n    walletdb.WriteAccountingEntry(credit);\n\n    if (!walletdb.TxnCommit())\n        throw JSONRPCError(RPC_DATABASE_ERROR, \"database error\");\n\n    return true;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_DATABASE_ERROR",
            "\"database error\""
          ],
          "line": 660
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "walletdb.TxnCommit",
          "args": [],
          "line": 659
        },
        "resolved": true,
        "details": {
          "function_name": "TxnCommit",
          "container": "CDB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.h",
          "lines": "282-289",
          "snippet": "bool TxnCommit()\n    {\n        if (!pdb || !activeTxn)\n            return false;\n        int ret = activeTxn->commit(0);\n        activeTxn = NULL;\n        return (ret == 0);\n    }",
          "includes": [
            "#include <db_cxx.h>",
            "#include <vector>",
            "#include <string>",
            "#include <map>",
            "#include \"main.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <db_cxx.h>\n#include <vector>\n#include <string>\n#include <map>\n#include \"main.h\"\n\nCDB {\n  bool TxnCommit()\n      {\n          if (!pdb || !activeTxn)\n              return false;\n          int ret = activeTxn->commit(0);\n          activeTxn = NULL;\n          return (ret == 0);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "walletdb.WriteAccountingEntry",
          "args": [
            "credit"
          ],
          "line": 657
        },
        "resolved": true,
        "details": {
          "function_name": "WriteAccountingEntry",
          "container": "CWalletDB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/walletdb.cpp",
          "lines": "52-55",
          "snippet": "bool CWalletDB::WriteAccountingEntry(const CAccountingEntry& acentry)\n{\n    return WriteAccountingEntry(++nAccountingEntryNumber, acentry);\n}",
          "includes": [
            "#include <boost/filesystem.hpp>",
            "#include <boost/version.hpp>",
            "#include \"wallet.h\"",
            "#include \"walletdb.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static uint64_t nAccountingEntryNumber = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem.hpp>\n#include <boost/version.hpp>\n#include \"wallet.h\"\n#include \"walletdb.h\"\n\nstatic uint64_t nAccountingEntryNumber = 0;\n\nCWalletDB {\n  bool CWalletDB::WriteAccountingEntry(const CAccountingEntry& acentry)\n  {\n      return WriteAccountingEntry(++nAccountingEntryNumber, acentry);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->IncOrderPosNext",
          "args": [
            "&walletdb"
          ],
          "line": 651
        },
        "resolved": true,
        "details": {
          "function_name": "IncOrderPosNext",
          "container": "CWallet",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.cpp",
          "lines": "327-336",
          "snippet": "int64_t CWallet::IncOrderPosNext(CWalletDB *pwalletdb)\n{\n    int64_t nRet = nOrderPosNext++;\n    if (pwalletdb) {\n        pwalletdb->WriteOrderPosNext(nOrderPosNext);\n    } else {\n        CWalletDB(strWalletFile).WriteOrderPosNext(nOrderPosNext);\n    }\n    return nRet;\n}",
          "includes": [
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"coincontrol.h\"",
            "#include \"kernel.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"crypter.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\"",
            "#include \"txdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/replace.hpp>\n#include \"coincontrol.h\"\n#include \"kernel.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"crypter.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n#include \"txdb.h\"\n\nCWallet {\n  int64_t CWallet::IncOrderPosNext(CWalletDB *pwalletdb)\n  {\n      int64_t nRet = nOrderPosNext++;\n      if (pwalletdb) {\n          pwalletdb->WriteOrderPosNext(nOrderPosNext);\n      } else {\n          CWalletDB(strWalletFile).WriteOrderPosNext(nOrderPosNext);\n      }\n      return nRet;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "GetAdjustedTime",
          "args": [],
          "line": 637
        },
        "resolved": true,
        "details": {
          "function_name": "GetAdjustedTime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "1201-1214",
          "snippet": "int64_t GetAdjustedTime() {\n\n    int64 nTime = GetTime();\n\n     /* If the NTP and system time are within half an hour, follow the former */\n    if(abs64(nNtpOffset) < 30 * 60)\n      return(nTime + nNtpOffset);\n\n     /* If the median peer time and system time are within 1 hour, follow the former */\n    if(abs64(nPeersOffset) < 60 * 60)\n      return(nTime + nPeersOffset);\n\n     return(nTime);\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "extern int64 nNtpOffset;",
            "int64 nPeersOffset = INT64_MAX;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nextern int64 nNtpOffset;\nint64 nPeersOffset = INT64_MAX;\n\nint64_t GetAdjustedTime() {\n\n    int64 nTime = GetTime();\n\n     /* If the NTP and system time are within half an hour, follow the former */\n    if(abs64(nNtpOffset) < 30 * 60)\n      return(nTime + nNtpOffset);\n\n     /* If the median peer time and system time are within 1 hour, follow the former */\n    if(abs64(nPeersOffset) < 60 * 60)\n      return(nTime + nPeersOffset);\n\n     return(nTime);\n}"
        }
      },
      {
        "call_info": {
          "callee": "walletdb.TxnBegin",
          "args": [],
          "line": 634
        },
        "resolved": true,
        "details": {
          "function_name": "TxnBegin",
          "container": "CDB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/db.h",
          "lines": "271-280",
          "snippet": "bool TxnBegin()\n    {\n        if (!pdb || activeTxn)\n            return false;\n        DbTxn* ptxn = bitdb.TxnBegin();\n        if (!ptxn)\n            return false;\n        activeTxn = ptxn;\n        return true;\n    }",
          "includes": [
            "#include <db_cxx.h>",
            "#include <vector>",
            "#include <string>",
            "#include <map>",
            "#include \"main.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <db_cxx.h>\n#include <vector>\n#include <string>\n#include <map>\n#include \"main.h\"\n\nCDB {\n  bool TxnBegin()\n      {\n          if (!pdb || activeTxn)\n              return false;\n          DbTxn* ptxn = bitdb.TxnBegin();\n          if (!ptxn)\n              return false;\n          activeTxn = ptxn;\n          return true;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[4].get_str",
          "args": [],
          "line": 631
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 630
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[3].get_int",
          "args": [],
          "line": 628
        },
        "resolved": true,
        "details": {
          "function_name": "get_int",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "385-390",
          "snippet": "int Value_impl< Config >::get_int() const\n    {\n        check_type(  int_type );\n\n        return static_cast< int >( get_int64() );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  int Value_impl< Config >::get_int() const\n      {\n          check_type(  int_type );\n  \n          return static_cast< int >( get_int64() );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "AmountFromValue",
          "args": [
            "params[2]"
          ],
          "line": 624
        },
        "resolved": true,
        "details": {
          "function_name": "AmountFromValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "102-111",
          "snippet": "int64_t AmountFromValue(const Value& value)\n{\n    double dAmount = value.get_real();\n    if (dAmount <= 0.0 || dAmount > MAX_MONEY)\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    int64_t nAmount = roundint64(dAmount * COIN);\n    if (!MoneyRange(nAmount))\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    return nAmount;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nint64_t AmountFromValue(const Value& value)\n{\n    double dAmount = value.get_real();\n    if (dAmount <= 0.0 || dAmount > MAX_MONEY)\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    int64_t nAmount = roundint64(dAmount * COIN);\n    if (!MoneyRange(nAmount))\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    return nAmount;\n}"
        }
      },
      {
        "call_info": {
          "callee": "AccountFromValue",
          "args": [
            "params[1]"
          ],
          "line": 623
        },
        "resolved": true,
        "details": {
          "function_name": "AccountFromValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "68-74",
          "snippet": "string AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstring AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}"
        }
      },
      {
        "call_info": {
          "callee": "accountingDeprecationCheck",
          "args": [],
          "line": 620
        },
        "resolved": true,
        "details": {
          "function_name": "accountingDeprecationCheck",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "22-32",
          "snippet": "static void accountingDeprecationCheck()\n{\n    if (!GetBoolArg(\"-enableaccounts\", false))\n        throw runtime_error(\n            \"Accounting API is deprecated and will be removed in future.\\n\"\n            \"It can easily result in negative or odd balances if misused or misunderstood, which has happened in the field.\\n\"\n            \"If you still want to enable it, add to your config file enableaccounts=1\\n\");\n\n    if (GetBoolArg(\"-staking\", true))\n        throw runtime_error(\"If you want to use accounting API, staking must be disabled, add to your config file staking=0\\n\");\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstatic void accountingDeprecationCheck()\n{\n    if (!GetBoolArg(\"-enableaccounts\", false))\n        throw runtime_error(\n            \"Accounting API is deprecated and will be removed in future.\\n\"\n            \"It can easily result in negative or odd balances if misused or misunderstood, which has happened in the field.\\n\"\n            \"If you still want to enable it, add to your config file enableaccounts=1\\n\");\n\n    if (GetBoolArg(\"-staking\", true))\n        throw runtime_error(\"If you want to use accounting API, staking must be disabled, add to your config file staking=0\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"move <fromaccount> <toaccount> <amount> [minconf=1] [comment]\\n\"\n            \"Move from one account in your wallet to another.\""
          ],
          "line": 616
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue movecmd(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 3 || params.size() > 5)\n        throw runtime_error(\n            \"move <fromaccount> <toaccount> <amount> [minconf=1] [comment]\\n\"\n            \"Move from one account in your wallet to another.\");\n\n    accountingDeprecationCheck();\n\n    string strFrom = AccountFromValue(params[0]);\n    string strTo = AccountFromValue(params[1]);\n    int64_t nAmount = AmountFromValue(params[2]);\n\n    if (params.size() > 3)\n        // unused parameter, used to be nMinDepth, keep type-checking it though\n        (void)params[3].get_int();\n    string strComment;\n    if (params.size() > 4)\n        strComment = params[4].get_str();\n\n    CWalletDB walletdb(pwalletMain->strWalletFile);\n    if (!walletdb.TxnBegin())\n        throw JSONRPCError(RPC_DATABASE_ERROR, \"database error\");\n\n    int64_t nNow = GetAdjustedTime();\n\n    // Debit\n    CAccountingEntry debit;\n    debit.nOrderPos = pwalletMain->IncOrderPosNext(&walletdb);\n    debit.strAccount = strFrom;\n    debit.nCreditDebit = -nAmount;\n    debit.nTime = nNow;\n    debit.strOtherAccount = strTo;\n    debit.strComment = strComment;\n    walletdb.WriteAccountingEntry(debit);\n\n    // Credit\n    CAccountingEntry credit;\n    credit.nOrderPos = pwalletMain->IncOrderPosNext(&walletdb);\n    credit.strAccount = strTo;\n    credit.nCreditDebit = nAmount;\n    credit.nTime = nNow;\n    credit.strOtherAccount = strFrom;\n    credit.strComment = strComment;\n    walletdb.WriteAccountingEntry(credit);\n\n    if (!walletdb.TxnCommit())\n        throw JSONRPCError(RPC_DATABASE_ERROR, \"database error\");\n\n    return true;\n}"
  },
  {
    "function_name": "getbalance",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "560-610",
    "snippet": "Value getbalance(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 2)\n        throw runtime_error(\n            \"getbalance [account] [minconf=1]\\n\"\n            \"If [account] is not specified, returns the server's total available balance.\\n\"\n            \"If [account] is specified, returns the balance in the account.\");\n\n    if (params.size() == 0)\n        return  ValueFromAmount(pwalletMain->GetBalance());\n\n    int nMinDepth = 1;\n    if (params.size() > 1)\n        nMinDepth = params[1].get_int();\n\n    if (params[0].get_str() == \"*\") {\n        // Calculate total balance a different way from GetBalance()\n        // (GetBalance() sums up all unspent TxOuts)\n        // getbalance and getbalance '*' 0 should return the same number.\n        int64_t nBalance = 0;\n        for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); ++it)\n        {\n            const CWalletTx& wtx = (*it).second;\n            if (!wtx.IsTrusted())\n                continue;\n\n            int64_t allFee;\n            string strSentAccount;\n            list<pair<CTxDestination, int64_t> > listReceived;\n            list<pair<CTxDestination, int64_t> > listSent;\n            wtx.GetAmounts(listReceived, listSent, allFee, strSentAccount);\n            if (wtx.GetDepthInMainChain() >= nMinDepth && wtx.GetBlocksToMaturity() == 0)\n            {\n                BOOST_FOREACH(const PAIRTYPE(CTxDestination,int64_t)& r, listReceived)\n                    nBalance += r.second;\n            }\n            BOOST_FOREACH(const PAIRTYPE(CTxDestination,int64_t)& r, listSent)\n                nBalance -= r.second;\n            nBalance -= allFee;\n        }\n        return  ValueFromAmount(nBalance);\n    }\n\n    accountingDeprecationCheck();\n\n    string strAccount = AccountFromValue(params[0]);\n\n    int64_t nBalance = GetAccountBalance(strAccount, nMinDepth);\n\n    return ValueFromAmount(nBalance);\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ValueFromAmount",
          "args": [
            "nBalance"
          ],
          "line": 609
        },
        "resolved": true,
        "details": {
          "function_name": "ValueFromAmount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "113-116",
          "snippet": "Value ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nValue ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}"
        }
      },
      {
        "call_info": {
          "callee": "GetAccountBalance",
          "args": [
            "strAccount",
            "nMinDepth"
          ],
          "line": 607
        },
        "resolved": true,
        "details": {
          "function_name": "GetAccountBalance",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "553-557",
          "snippet": "int64_t GetAccountBalance(const string& strAccount, int nMinDepth)\n{\n    CWalletDB walletdb(pwalletMain->strWalletFile);\n    return GetAccountBalance(walletdb, strAccount, nMinDepth);\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nint64_t GetAccountBalance(const string& strAccount, int nMinDepth)\n{\n    CWalletDB walletdb(pwalletMain->strWalletFile);\n    return GetAccountBalance(walletdb, strAccount, nMinDepth);\n}"
        }
      },
      {
        "call_info": {
          "callee": "AccountFromValue",
          "args": [
            "params[0]"
          ],
          "line": 605
        },
        "resolved": true,
        "details": {
          "function_name": "AccountFromValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "68-74",
          "snippet": "string AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstring AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}"
        }
      },
      {
        "call_info": {
          "callee": "accountingDeprecationCheck",
          "args": [],
          "line": 603
        },
        "resolved": true,
        "details": {
          "function_name": "accountingDeprecationCheck",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "22-32",
          "snippet": "static void accountingDeprecationCheck()\n{\n    if (!GetBoolArg(\"-enableaccounts\", false))\n        throw runtime_error(\n            \"Accounting API is deprecated and will be removed in future.\\n\"\n            \"It can easily result in negative or odd balances if misused or misunderstood, which has happened in the field.\\n\"\n            \"If you still want to enable it, add to your config file enableaccounts=1\\n\");\n\n    if (GetBoolArg(\"-staking\", true))\n        throw runtime_error(\"If you want to use accounting API, staking must be disabled, add to your config file staking=0\\n\");\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstatic void accountingDeprecationCheck()\n{\n    if (!GetBoolArg(\"-enableaccounts\", false))\n        throw runtime_error(\n            \"Accounting API is deprecated and will be removed in future.\\n\"\n            \"It can easily result in negative or odd balances if misused or misunderstood, which has happened in the field.\\n\"\n            \"If you still want to enable it, add to your config file enableaccounts=1\\n\");\n\n    if (GetBoolArg(\"-staking\", true))\n        throw runtime_error(\"If you want to use accounting API, staking must be disabled, add to your config file staking=0\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetBlocksToMaturity",
          "args": [],
          "line": 591
        },
        "resolved": true,
        "details": {
          "function_name": "GetBlocksToMaturity",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
          "lines": "817-822",
          "snippet": "int CMerkleTx::GetBlocksToMaturity() const\n{\n    if (!(IsCoinBase() || IsCoinStake()))\n        return 0;\n    return max(0, (nCoinbaseMaturity+10) - GetDepthInMainChain());\n}",
          "includes": [
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"kernel.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"txdb.h\"",
            "#include \"db.h\"",
            "#include \"checkpoints.h\"",
            "#include \"alert.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int nCoinbaseMaturity = 50;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/algorithm/string/replace.hpp>\n#include \"kernel.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"txdb.h\"\n#include \"db.h\"\n#include \"checkpoints.h\"\n#include \"alert.h\"\n\nint nCoinbaseMaturity = 50;\n\nCMerkleTx {\n  int CMerkleTx::GetBlocksToMaturity() const\n  {\n      if (!(IsCoinBase() || IsCoinStake()))\n          return 0;\n      return max(0, (nCoinbaseMaturity+10) - GetDepthInMainChain());\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetDepthInMainChain",
          "args": [],
          "line": 591
        },
        "resolved": true,
        "details": {
          "function_name": "GetDepthInMainChain",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "765-765",
          "snippet": "int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCMerkleTx {\n  int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetAmounts",
          "args": [
            "listReceived",
            "listSent",
            "allFee",
            "strSentAccount"
          ],
          "line": 590
        },
        "resolved": true,
        "details": {
          "function_name": "GetAmounts",
          "container": "CWalletTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.cpp",
          "lines": "678-733",
          "snippet": "void CWalletTx::GetAmounts(list<pair<CTxDestination, int64_t> >& listReceived,\n                           list<pair<CTxDestination, int64_t> >& listSent, int64_t& nFee, string& strSentAccount) const\n{\n    nFee = 0;\n    listReceived.clear();\n    listSent.clear();\n    strSentAccount = strFromAccount;\n\n    // Compute fee:\n    int64_t nDebit = GetDebit();\n    if (nDebit > 0) // debit>0 means we signed/sent this transaction\n    {\n        int64_t nValueOut = GetValueOut();\n        nFee = nDebit - nValueOut;\n    }\n\n    // Sent/received.\n    BOOST_FOREACH(const CTxOut& txout, vout)\n    {\n        // Skip special stake out\n        if (txout.scriptPubKey.empty())\n            continue;\n\n        bool fIsMine;\n        // Only need to handle txouts if AT LEAST one of these is true:\n        //   1) they debit from us (sent)\n        //   2) the output is to us (received)\n        if (nDebit > 0)\n        {\n            // Don't report 'change' txouts\n            if (pwallet->IsChange(txout))\n                continue;\n            fIsMine = pwallet->IsMine(txout);\n        }\n        else if (!(fIsMine = pwallet->IsMine(txout)))\n            continue;\n\n        // In either case, we need to get the destination address\n        CTxDestination address;\n        if (!ExtractDestination(txout.scriptPubKey, address))\n        {\n            printf(\"CWalletTx::GetAmounts: Unknown transaction type found, txid %s\\n\",\n                   this->GetHash().ToString().c_str());\n            address = CNoDestination();\n        }\n\n        // If we are debited by the transaction, add the output as a \"sent\" entry\n        if (nDebit > 0)\n            listSent.push_back(make_pair(address, txout.nValue));\n\n        // If we are receiving the output, add it as a \"received\" entry\n        if (fIsMine)\n            listReceived.push_back(make_pair(address, txout.nValue));\n    }\n\n}",
          "includes": [
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"coincontrol.h\"",
            "#include \"kernel.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"crypter.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\"",
            "#include \"txdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/replace.hpp>\n#include \"coincontrol.h\"\n#include \"kernel.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"crypter.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n#include \"txdb.h\"\n\nCWalletTx {\n  void CWalletTx::GetAmounts(list<pair<CTxDestination, int64_t> >& listReceived,\n                             list<pair<CTxDestination, int64_t> >& listSent, int64_t& nFee, string& strSentAccount) const\n  {\n      nFee = 0;\n      listReceived.clear();\n      listSent.clear();\n      strSentAccount = strFromAccount;\n  \n      // Compute fee:\n      int64_t nDebit = GetDebit();\n      if (nDebit > 0) // debit>0 means we signed/sent this transaction\n      {\n          int64_t nValueOut = GetValueOut();\n          nFee = nDebit - nValueOut;\n      }\n  \n      // Sent/received.\n      BOOST_FOREACH(const CTxOut& txout, vout)\n      {\n          // Skip special stake out\n          if (txout.scriptPubKey.empty())\n              continue;\n  \n          bool fIsMine;\n          // Only need to handle txouts if AT LEAST one of these is true:\n          //   1) they debit from us (sent)\n          //   2) the output is to us (received)\n          if (nDebit > 0)\n          {\n              // Don't report 'change' txouts\n              if (pwallet->IsChange(txout))\n                  continue;\n              fIsMine = pwallet->IsMine(txout);\n          }\n          else if (!(fIsMine = pwallet->IsMine(txout)))\n              continue;\n  \n          // In either case, we need to get the destination address\n          CTxDestination address;\n          if (!ExtractDestination(txout.scriptPubKey, address))\n          {\n              printf(\"CWalletTx::GetAmounts: Unknown transaction type found, txid %s\\n\",\n                     this->GetHash().ToString().c_str());\n              address = CNoDestination();\n          }\n  \n          // If we are debited by the transaction, add the output as a \"sent\" entry\n          if (nDebit > 0)\n              listSent.push_back(make_pair(address, txout.nValue));\n  \n          // If we are receiving the output, add it as a \"received\" entry\n          if (fIsMine)\n              listReceived.push_back(make_pair(address, txout.nValue));\n      }\n  \n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.IsTrusted",
          "args": [],
          "line": 583
        },
        "resolved": true,
        "details": {
          "function_name": "IsTrusted",
          "container": "CWalletTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.h",
          "lines": "646-694",
          "snippet": "bool IsTrusted() const\n    {\n        // Quick answer in most cases\n        if (!IsFinal())\n            return false;\n        int nDepth = GetDepthInMainChain();\n        if (nDepth >= 1)\n            return true;\n        if (nDepth < 0)\n            return false;\n        if (fConfChange || !IsFromMe()) // using wtx's cached debit\n            return false;\n\n        // If no confirmations but it's from us, we can still\n        // consider it confirmed if all dependencies are confirmed\n        std::map<uint256, const CMerkleTx*> mapPrev;\n        std::vector<const CMerkleTx*> vWorkQueue;\n        vWorkQueue.reserve(vtxPrev.size()+1);\n        vWorkQueue.push_back(this);\n        for (unsigned int i = 0; i < vWorkQueue.size(); i++)\n        {\n            const CMerkleTx* ptx = vWorkQueue[i];\n\n            if (!ptx->IsFinal())\n                return false;\n            int nPDepth = ptx->GetDepthInMainChain();\n            if (nPDepth >= 1)\n                continue;\n            if (nPDepth < 0)\n                return false;\n            if (!pwallet->IsFromMe(*ptx))\n                return false;\n\n            if (mapPrev.empty())\n            {\n                BOOST_FOREACH(const CMerkleTx& tx, vtxPrev)\n                    mapPrev[tx.GetHash()] = &tx;\n            }\n\n            BOOST_FOREACH(const CTxIn& txin, ptx->vin)\n            {\n                if (!mapPrev.count(txin.prevout.hash))\n                    return false;\n                vWorkQueue.push_back(mapPrev[txin.prevout.hash]);\n            }\n        }\n\n        return true;\n    }",
          "includes": [
            "#include \"walletdb.h\"",
            "#include \"util.h\"",
            "#include \"ui_interface.h\"",
            "#include \"script.h\"",
            "#include \"keystore.h\"",
            "#include \"key.h\"",
            "#include \"main.h\"",
            "#include <stdlib.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"walletdb.h\"\n#include \"util.h\"\n#include \"ui_interface.h\"\n#include \"script.h\"\n#include \"keystore.h\"\n#include \"key.h\"\n#include \"main.h\"\n#include <stdlib.h>\n#include <vector>\n#include <string>\n\nCWalletTx {\n  bool IsTrusted() const\n      {\n          // Quick answer in most cases\n          if (!IsFinal())\n              return false;\n          int nDepth = GetDepthInMainChain();\n          if (nDepth >= 1)\n              return true;\n          if (nDepth < 0)\n              return false;\n          if (fConfChange || !IsFromMe()) // using wtx's cached debit\n              return false;\n  \n          // If no confirmations but it's from us, we can still\n          // consider it confirmed if all dependencies are confirmed\n          std::map<uint256, const CMerkleTx*> mapPrev;\n          std::vector<const CMerkleTx*> vWorkQueue;\n          vWorkQueue.reserve(vtxPrev.size()+1);\n          vWorkQueue.push_back(this);\n          for (unsigned int i = 0; i < vWorkQueue.size(); i++)\n          {\n              const CMerkleTx* ptx = vWorkQueue[i];\n  \n              if (!ptx->IsFinal())\n                  return false;\n              int nPDepth = ptx->GetDepthInMainChain();\n              if (nPDepth >= 1)\n                  continue;\n              if (nPDepth < 0)\n                  return false;\n              if (!pwallet->IsFromMe(*ptx))\n                  return false;\n  \n              if (mapPrev.empty())\n              {\n                  BOOST_FOREACH(const CMerkleTx& tx, vtxPrev)\n                      mapPrev[tx.GetHash()] = &tx;\n              }\n  \n              BOOST_FOREACH(const CTxIn& txin, ptx->vin)\n              {\n                  if (!mapPrev.count(txin.prevout.hash))\n                      return false;\n                  vWorkQueue.push_back(mapPrev[txin.prevout.hash]);\n              }\n          }\n  \n          return true;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapWallet.end",
          "args": [],
          "line": 580
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapWallet.begin",
          "args": [],
          "line": 580
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 575
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[1].get_int",
          "args": [],
          "line": 573
        },
        "resolved": true,
        "details": {
          "function_name": "get_int",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "385-390",
          "snippet": "int Value_impl< Config >::get_int() const\n    {\n        check_type(  int_type );\n\n        return static_cast< int >( get_int64() );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  int Value_impl< Config >::get_int() const\n      {\n          check_type(  int_type );\n  \n          return static_cast< int >( get_int64() );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 572
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->GetBalance",
          "args": [],
          "line": 569
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getbalance [account] [minconf=1]\\n\"\n            \"If [account] is not specified, returns the server's total available balance.\\n\"\n            \"If [account] is specified, returns the balance in the account.\""
          ],
          "line": 563
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue getbalance(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 2)\n        throw runtime_error(\n            \"getbalance [account] [minconf=1]\\n\"\n            \"If [account] is not specified, returns the server's total available balance.\\n\"\n            \"If [account] is specified, returns the balance in the account.\");\n\n    if (params.size() == 0)\n        return  ValueFromAmount(pwalletMain->GetBalance());\n\n    int nMinDepth = 1;\n    if (params.size() > 1)\n        nMinDepth = params[1].get_int();\n\n    if (params[0].get_str() == \"*\") {\n        // Calculate total balance a different way from GetBalance()\n        // (GetBalance() sums up all unspent TxOuts)\n        // getbalance and getbalance '*' 0 should return the same number.\n        int64_t nBalance = 0;\n        for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); ++it)\n        {\n            const CWalletTx& wtx = (*it).second;\n            if (!wtx.IsTrusted())\n                continue;\n\n            int64_t allFee;\n            string strSentAccount;\n            list<pair<CTxDestination, int64_t> > listReceived;\n            list<pair<CTxDestination, int64_t> > listSent;\n            wtx.GetAmounts(listReceived, listSent, allFee, strSentAccount);\n            if (wtx.GetDepthInMainChain() >= nMinDepth && wtx.GetBlocksToMaturity() == 0)\n            {\n                BOOST_FOREACH(const PAIRTYPE(CTxDestination,int64_t)& r, listReceived)\n                    nBalance += r.second;\n            }\n            BOOST_FOREACH(const PAIRTYPE(CTxDestination,int64_t)& r, listSent)\n                nBalance -= r.second;\n            nBalance -= allFee;\n        }\n        return  ValueFromAmount(nBalance);\n    }\n\n    accountingDeprecationCheck();\n\n    string strAccount = AccountFromValue(params[0]);\n\n    int64_t nBalance = GetAccountBalance(strAccount, nMinDepth);\n\n    return ValueFromAmount(nBalance);\n}"
  },
  {
    "function_name": "GetAccountBalance",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "553-557",
    "snippet": "int64_t GetAccountBalance(const string& strAccount, int nMinDepth)\n{\n    CWalletDB walletdb(pwalletMain->strWalletFile);\n    return GetAccountBalance(walletdb, strAccount, nMinDepth);\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "GetAccountBalance",
          "args": [
            "walletdb",
            "strAccount",
            "nMinDepth"
          ],
          "line": 556
        },
        "resolved": true,
        "details": {
          "function_name": "GetAccountBalance",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "528-551",
          "snippet": "int64_t GetAccountBalance(CWalletDB& walletdb, const string& strAccount, int nMinDepth)\n{\n    int64_t nBalance = 0;\n\n    // Tally wallet transactions\n    for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); ++it)\n    {\n        const CWalletTx& wtx = (*it).second;\n        if (!wtx.IsFinal() || wtx.GetDepthInMainChain() < 0)\n            continue;\n\n        int64_t nReceived, nSent, nFee;\n        wtx.GetAccountAmounts(strAccount, nReceived, nSent, nFee);\n\n        if (nReceived != 0 && wtx.GetDepthInMainChain() >= nMinDepth && wtx.GetBlocksToMaturity() == 0)\n            nBalance += nReceived;\n        nBalance -= nSent + nFee;\n    }\n\n    // Tally internal accounting entries\n    nBalance += walletdb.GetAccountCreditDebit(strAccount);\n\n    return nBalance;\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nint64_t GetAccountBalance(const string& strAccount, int nMinDepth)\n{\n    CWalletDB walletdb(pwalletMain->strWalletFile);\n    return GetAccountBalance(walletdb, strAccount, nMinDepth);\n}"
  },
  {
    "function_name": "GetAccountBalance",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "528-551",
    "snippet": "int64_t GetAccountBalance(CWalletDB& walletdb, const string& strAccount, int nMinDepth)\n{\n    int64_t nBalance = 0;\n\n    // Tally wallet transactions\n    for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); ++it)\n    {\n        const CWalletTx& wtx = (*it).second;\n        if (!wtx.IsFinal() || wtx.GetDepthInMainChain() < 0)\n            continue;\n\n        int64_t nReceived, nSent, nFee;\n        wtx.GetAccountAmounts(strAccount, nReceived, nSent, nFee);\n\n        if (nReceived != 0 && wtx.GetDepthInMainChain() >= nMinDepth && wtx.GetBlocksToMaturity() == 0)\n            nBalance += nReceived;\n        nBalance -= nSent + nFee;\n    }\n\n    // Tally internal accounting entries\n    nBalance += walletdb.GetAccountCreditDebit(strAccount);\n\n    return nBalance;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "walletdb.GetAccountCreditDebit",
          "args": [
            "strAccount"
          ],
          "line": 548
        },
        "resolved": true,
        "details": {
          "function_name": "GetAccountCreditDebit",
          "container": "CWalletDB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/walletdb.cpp",
          "lines": "57-67",
          "snippet": "int64_t CWalletDB::GetAccountCreditDebit(const string& strAccount)\n{\n    list<CAccountingEntry> entries;\n    ListAccountCreditDebit(strAccount, entries);\n\n    int64_t nCreditDebit = 0;\n    BOOST_FOREACH (const CAccountingEntry& entry, entries)\n        nCreditDebit += entry.nCreditDebit;\n\n    return nCreditDebit;\n}",
          "includes": [
            "#include <boost/filesystem.hpp>",
            "#include <boost/version.hpp>",
            "#include \"wallet.h\"",
            "#include \"walletdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem.hpp>\n#include <boost/version.hpp>\n#include \"wallet.h\"\n#include \"walletdb.h\"\n\nCWalletDB {\n  int64_t CWalletDB::GetAccountCreditDebit(const string& strAccount)\n  {\n      list<CAccountingEntry> entries;\n      ListAccountCreditDebit(strAccount, entries);\n  \n      int64_t nCreditDebit = 0;\n      BOOST_FOREACH (const CAccountingEntry& entry, entries)\n          nCreditDebit += entry.nCreditDebit;\n  \n      return nCreditDebit;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetBlocksToMaturity",
          "args": [],
          "line": 542
        },
        "resolved": true,
        "details": {
          "function_name": "GetBlocksToMaturity",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
          "lines": "817-822",
          "snippet": "int CMerkleTx::GetBlocksToMaturity() const\n{\n    if (!(IsCoinBase() || IsCoinStake()))\n        return 0;\n    return max(0, (nCoinbaseMaturity+10) - GetDepthInMainChain());\n}",
          "includes": [
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"kernel.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"txdb.h\"",
            "#include \"db.h\"",
            "#include \"checkpoints.h\"",
            "#include \"alert.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int nCoinbaseMaturity = 50;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/algorithm/string/replace.hpp>\n#include \"kernel.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"txdb.h\"\n#include \"db.h\"\n#include \"checkpoints.h\"\n#include \"alert.h\"\n\nint nCoinbaseMaturity = 50;\n\nCMerkleTx {\n  int CMerkleTx::GetBlocksToMaturity() const\n  {\n      if (!(IsCoinBase() || IsCoinStake()))\n          return 0;\n      return max(0, (nCoinbaseMaturity+10) - GetDepthInMainChain());\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetDepthInMainChain",
          "args": [],
          "line": 542
        },
        "resolved": true,
        "details": {
          "function_name": "GetDepthInMainChain",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "765-765",
          "snippet": "int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCMerkleTx {\n  int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetAccountAmounts",
          "args": [
            "strAccount",
            "nReceived",
            "nSent",
            "nFee"
          ],
          "line": 540
        },
        "resolved": true,
        "details": {
          "function_name": "GetAccountAmounts",
          "container": "CWalletTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.cpp",
          "lines": "735-768",
          "snippet": "void CWalletTx::GetAccountAmounts(const string& strAccount, int64_t& nReceived,\n                                  int64_t& nSent, int64_t& nFee) const\n{\n    nReceived = nSent = nFee = 0;\n\n    int64_t allFee;\n    string strSentAccount;\n    list<pair<CTxDestination, int64_t> > listReceived;\n    list<pair<CTxDestination, int64_t> > listSent;\n    GetAmounts(listReceived, listSent, allFee, strSentAccount);\n\n    if (strAccount == strSentAccount)\n    {\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination,int64_t)& s, listSent)\n            nSent += s.second;\n        nFee = allFee;\n    }\n    {\n        LOCK(pwallet->cs_wallet);\n        BOOST_FOREACH(const PAIRTYPE(CTxDestination,int64_t)& r, listReceived)\n        {\n            if (pwallet->mapAddressBook.count(r.first))\n            {\n                map<CTxDestination, string>::const_iterator mi = pwallet->mapAddressBook.find(r.first);\n                if (mi != pwallet->mapAddressBook.end() && (*mi).second == strAccount)\n                    nReceived += r.second;\n            }\n            else if (strAccount.empty())\n            {\n                nReceived += r.second;\n            }\n        }\n    }\n}",
          "includes": [
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"coincontrol.h\"",
            "#include \"kernel.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"crypter.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\"",
            "#include \"txdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/replace.hpp>\n#include \"coincontrol.h\"\n#include \"kernel.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"crypter.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n#include \"txdb.h\"\n\nCWalletTx {\n  void CWalletTx::GetAccountAmounts(const string& strAccount, int64_t& nReceived,\n                                    int64_t& nSent, int64_t& nFee) const\n  {\n      nReceived = nSent = nFee = 0;\n  \n      int64_t allFee;\n      string strSentAccount;\n      list<pair<CTxDestination, int64_t> > listReceived;\n      list<pair<CTxDestination, int64_t> > listSent;\n      GetAmounts(listReceived, listSent, allFee, strSentAccount);\n  \n      if (strAccount == strSentAccount)\n      {\n          BOOST_FOREACH(const PAIRTYPE(CTxDestination,int64_t)& s, listSent)\n              nSent += s.second;\n          nFee = allFee;\n      }\n      {\n          LOCK(pwallet->cs_wallet);\n          BOOST_FOREACH(const PAIRTYPE(CTxDestination,int64_t)& r, listReceived)\n          {\n              if (pwallet->mapAddressBook.count(r.first))\n              {\n                  map<CTxDestination, string>::const_iterator mi = pwallet->mapAddressBook.find(r.first);\n                  if (mi != pwallet->mapAddressBook.end() && (*mi).second == strAccount)\n                      nReceived += r.second;\n              }\n              else if (strAccount.empty())\n              {\n                  nReceived += r.second;\n              }\n          }\n      }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.IsFinal",
          "args": [],
          "line": 536
        },
        "resolved": true,
        "details": {
          "function_name": "IsFinal",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "491-506",
          "snippet": "bool IsFinal(int nBlockHeight=0, int64_t nBlockTime=0) const\n    {\n        // Time based nLockTime implemented in 0.1.6\n        if (nLockTime == 0)\n            return true;\n        if (nBlockHeight == 0)\n            nBlockHeight = nBestHeight;\n        if (nBlockTime == 0)\n            nBlockTime = GetAdjustedTime();\n        if ((int64_t)nLockTime < ((int64_t)nLockTime < LOCKTIME_THRESHOLD ? (int64_t)nBlockHeight : nBlockTime))\n            return true;\n        BOOST_FOREACH(const CTxIn& txin, vin)\n            if (!txin.IsFinal())\n                return false;\n        return true;\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  bool IsFinal(int nBlockHeight=0, int64_t nBlockTime=0) const\n      {\n          // Time based nLockTime implemented in 0.1.6\n          if (nLockTime == 0)\n              return true;\n          if (nBlockHeight == 0)\n              nBlockHeight = nBestHeight;\n          if (nBlockTime == 0)\n              nBlockTime = GetAdjustedTime();\n          if ((int64_t)nLockTime < ((int64_t)nLockTime < LOCKTIME_THRESHOLD ? (int64_t)nBlockHeight : nBlockTime))\n              return true;\n          BOOST_FOREACH(const CTxIn& txin, vin)\n              if (!txin.IsFinal())\n                  return false;\n          return true;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapWallet.end",
          "args": [],
          "line": 533
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapWallet.begin",
          "args": [],
          "line": 533
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nint64_t GetAccountBalance(CWalletDB& walletdb, const string& strAccount, int nMinDepth)\n{\n    int64_t nBalance = 0;\n\n    // Tally wallet transactions\n    for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); ++it)\n    {\n        const CWalletTx& wtx = (*it).second;\n        if (!wtx.IsFinal() || wtx.GetDepthInMainChain() < 0)\n            continue;\n\n        int64_t nReceived, nSent, nFee;\n        wtx.GetAccountAmounts(strAccount, nReceived, nSent, nFee);\n\n        if (nReceived != 0 && wtx.GetDepthInMainChain() >= nMinDepth && wtx.GetBlocksToMaturity() == 0)\n            nBalance += nReceived;\n        nBalance -= nSent + nFee;\n    }\n\n    // Tally internal accounting entries\n    nBalance += walletdb.GetAccountCreditDebit(strAccount);\n\n    return nBalance;\n}"
  },
  {
    "function_name": "getreceivedbyaccount",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "488-525",
    "snippet": "Value getreceivedbyaccount(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 1 || params.size() > 2)\n        throw runtime_error(\n            \"getreceivedbyaccount <account> [minconf=1]\\n\"\n            \"Returns the total amount received by addresses with <account> in transactions with at least [minconf] confirmations.\");\n\n    accountingDeprecationCheck();\n\n    // Minimum confirmations\n    int nMinDepth = 1;\n    if (params.size() > 1)\n        nMinDepth = params[1].get_int();\n\n    // Get the set of pub keys assigned to account\n    string strAccount = AccountFromValue(params[0]);\n    set<CTxDestination> setAddress;\n    GetAccountAddresses(strAccount, setAddress);\n\n    // Tally\n    int64_t nAmount = 0;\n    for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); ++it)\n    {\n        const CWalletTx& wtx = (*it).second;\n        if (wtx.IsCoinBase() || wtx.IsCoinStake() || !wtx.IsFinal())\n            continue;\n\n        BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n        {\n            CTxDestination address;\n            if (ExtractDestination(txout.scriptPubKey, address) && IsMine(*pwalletMain, address) && setAddress.count(address))\n                if (wtx.GetDepthInMainChain() >= nMinDepth)\n                    nAmount += txout.nValue;\n        }\n    }\n\n    return (double)nAmount / (double)COIN;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wtx.GetDepthInMainChain",
          "args": [],
          "line": 519
        },
        "resolved": true,
        "details": {
          "function_name": "GetDepthInMainChain",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "765-765",
          "snippet": "int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCMerkleTx {\n  int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "setAddress.count",
          "args": [
            "address"
          ],
          "line": 518
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "IsMine",
          "args": [
            "*pwalletMain",
            "address"
          ],
          "line": 518
        },
        "resolved": true,
        "details": {
          "function_name": "IsMine",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/script.cpp",
          "lines": "1551-1588",
          "snippet": "bool IsMine(const CKeyStore &keystore, const CScript& scriptPubKey)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    CKeyID keyID;\n    switch (whichType)\n    {\n    case TX_NONSTANDARD:\n        return false;\n    case TX_PUBKEY:\n        keyID = CPubKey(vSolutions[0]).GetID();\n        return keystore.HaveKey(keyID);\n    case TX_PUBKEYHASH:\n        keyID = CKeyID(uint160(vSolutions[0]));\n        return keystore.HaveKey(keyID);\n    case TX_SCRIPTHASH:\n    {\n        CScript subscript;\n        if (!keystore.GetCScript(CScriptID(uint160(vSolutions[0])), subscript))\n            return false;\n        return IsMine(keystore, subscript);\n    }\n    case TX_MULTISIG:\n    {\n        // Only consider transactions \"mine\" if we own ALL the\n        // keys involved. multi-signature transactions that are\n        // partially owned (somebody else has a key that can spend\n        // them) enable spend-out-from-under-you attacks, especially\n        // in shared-wallet situations.\n        vector<valtype> keys(vSolutions.begin()+1, vSolutions.begin()+vSolutions.size()-1);\n        return HaveKeys(keys, keystore) == keys.size();\n    }\n    }\n    return false;\n}",
          "includes": [
            "#include \"util.h\"",
            "#include \"sync.h\"",
            "#include \"main.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include \"keystore.h\"",
            "#include \"script.h\"",
            "#include <boost/tuple/tuple_comparison.hpp>",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/foreach.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"sync.h\"\n#include \"main.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include \"keystore.h\"\n#include \"script.h\"\n#include <boost/tuple/tuple_comparison.hpp>\n#include <boost/tuple/tuple.hpp>\n#include <boost/foreach.hpp>\n\nbool IsMine(const CKeyStore &keystore, const CScript& scriptPubKey)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    CKeyID keyID;\n    switch (whichType)\n    {\n    case TX_NONSTANDARD:\n        return false;\n    case TX_PUBKEY:\n        keyID = CPubKey(vSolutions[0]).GetID();\n        return keystore.HaveKey(keyID);\n    case TX_PUBKEYHASH:\n        keyID = CKeyID(uint160(vSolutions[0]));\n        return keystore.HaveKey(keyID);\n    case TX_SCRIPTHASH:\n    {\n        CScript subscript;\n        if (!keystore.GetCScript(CScriptID(uint160(vSolutions[0])), subscript))\n            return false;\n        return IsMine(keystore, subscript);\n    }\n    case TX_MULTISIG:\n    {\n        // Only consider transactions \"mine\" if we own ALL the\n        // keys involved. multi-signature transactions that are\n        // partially owned (somebody else has a key that can spend\n        // them) enable spend-out-from-under-you attacks, especially\n        // in shared-wallet situations.\n        vector<valtype> keys(vSolutions.begin()+1, vSolutions.begin()+vSolutions.size()-1);\n        return HaveKeys(keys, keystore) == keys.size();\n    }\n    }\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "ExtractDestination",
          "args": [
            "txout.scriptPubKey",
            "address"
          ],
          "line": 518
        },
        "resolved": true,
        "details": {
          "function_name": "ExtractDestination",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/script.cpp",
          "lines": "1590-1614",
          "snippet": "bool ExtractDestination(const CScript& scriptPubKey, CTxDestination& addressRet)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    if (whichType == TX_PUBKEY)\n    {\n        addressRet = CPubKey(vSolutions[0]).GetID();\n        return true;\n    }\n    else if (whichType == TX_PUBKEYHASH)\n    {\n        addressRet = CKeyID(uint160(vSolutions[0]));\n        return true;\n    }\n    else if (whichType == TX_SCRIPTHASH)\n    {\n        addressRet = CScriptID(uint160(vSolutions[0]));\n        return true;\n    }\n    // Multisig txns have more than one address...\n    return false;\n}",
          "includes": [
            "#include \"util.h\"",
            "#include \"sync.h\"",
            "#include \"main.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include \"keystore.h\"",
            "#include \"script.h\"",
            "#include <boost/tuple/tuple_comparison.hpp>",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/foreach.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"sync.h\"\n#include \"main.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include \"keystore.h\"\n#include \"script.h\"\n#include <boost/tuple/tuple_comparison.hpp>\n#include <boost/tuple/tuple.hpp>\n#include <boost/foreach.hpp>\n\nbool ExtractDestination(const CScript& scriptPubKey, CTxDestination& addressRet)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    if (whichType == TX_PUBKEY)\n    {\n        addressRet = CPubKey(vSolutions[0]).GetID();\n        return true;\n    }\n    else if (whichType == TX_PUBKEYHASH)\n    {\n        addressRet = CKeyID(uint160(vSolutions[0]));\n        return true;\n    }\n    else if (whichType == TX_SCRIPTHASH)\n    {\n        addressRet = CScriptID(uint160(vSolutions[0]));\n        return true;\n    }\n    // Multisig txns have more than one address...\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.IsFinal",
          "args": [],
          "line": 512
        },
        "resolved": true,
        "details": {
          "function_name": "IsFinal",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "491-506",
          "snippet": "bool IsFinal(int nBlockHeight=0, int64_t nBlockTime=0) const\n    {\n        // Time based nLockTime implemented in 0.1.6\n        if (nLockTime == 0)\n            return true;\n        if (nBlockHeight == 0)\n            nBlockHeight = nBestHeight;\n        if (nBlockTime == 0)\n            nBlockTime = GetAdjustedTime();\n        if ((int64_t)nLockTime < ((int64_t)nLockTime < LOCKTIME_THRESHOLD ? (int64_t)nBlockHeight : nBlockTime))\n            return true;\n        BOOST_FOREACH(const CTxIn& txin, vin)\n            if (!txin.IsFinal())\n                return false;\n        return true;\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  bool IsFinal(int nBlockHeight=0, int64_t nBlockTime=0) const\n      {\n          // Time based nLockTime implemented in 0.1.6\n          if (nLockTime == 0)\n              return true;\n          if (nBlockHeight == 0)\n              nBlockHeight = nBestHeight;\n          if (nBlockTime == 0)\n              nBlockTime = GetAdjustedTime();\n          if ((int64_t)nLockTime < ((int64_t)nLockTime < LOCKTIME_THRESHOLD ? (int64_t)nBlockHeight : nBlockTime))\n              return true;\n          BOOST_FOREACH(const CTxIn& txin, vin)\n              if (!txin.IsFinal())\n                  return false;\n          return true;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.IsCoinStake",
          "args": [],
          "line": 512
        },
        "resolved": true,
        "details": {
          "function_name": "IsCoinStake",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "542-546",
          "snippet": "bool IsCoinStake() const\n    {\n        // ppcoin: the coin stake transaction is marked with the first output empty\n        return (vin.size() > 0 && (!vin[0].prevout.IsNull()) && vout.size() >= 2 && vout[0].IsEmpty());\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  bool IsCoinStake() const\n      {\n          // ppcoin: the coin stake transaction is marked with the first output empty\n          return (vin.size() > 0 && (!vin[0].prevout.IsNull()) && vout.size() >= 2 && vout[0].IsEmpty());\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.IsCoinBase",
          "args": [],
          "line": 512
        },
        "resolved": true,
        "details": {
          "function_name": "IsCoinBase",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "537-540",
          "snippet": "bool IsCoinBase() const\n    {\n        return (vin.size() == 1 && vin[0].prevout.IsNull() && vout.size() >= 1);\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  bool IsCoinBase() const\n      {\n          return (vin.size() == 1 && vin[0].prevout.IsNull() && vout.size() >= 1);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapWallet.end",
          "args": [],
          "line": 509
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapWallet.begin",
          "args": [],
          "line": 509
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "GetAccountAddresses",
          "args": [
            "strAccount",
            "setAddress"
          ],
          "line": 505
        },
        "resolved": true,
        "details": {
          "function_name": "GetAccountAddresses",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "477-486",
          "snippet": "void GetAccountAddresses(string strAccount, set<CTxDestination>& setAddress)\n{\n    BOOST_FOREACH(const PAIRTYPE(CTxDestination, string)& item, pwalletMain->mapAddressBook)\n    {\n        const CTxDestination& address = item.first;\n        const string& strName = item.second;\n        if (strName == strAccount)\n            setAddress.insert(address);\n    }\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nvoid GetAccountAddresses(string strAccount, set<CTxDestination>& setAddress)\n{\n    BOOST_FOREACH(const PAIRTYPE(CTxDestination, string)& item, pwalletMain->mapAddressBook)\n    {\n        const CTxDestination& address = item.first;\n        const string& strName = item.second;\n        if (strName == strAccount)\n            setAddress.insert(address);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "AccountFromValue",
          "args": [
            "params[0]"
          ],
          "line": 503
        },
        "resolved": true,
        "details": {
          "function_name": "AccountFromValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "68-74",
          "snippet": "string AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstring AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[1].get_int",
          "args": [],
          "line": 500
        },
        "resolved": true,
        "details": {
          "function_name": "get_int",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "385-390",
          "snippet": "int Value_impl< Config >::get_int() const\n    {\n        check_type(  int_type );\n\n        return static_cast< int >( get_int64() );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  int Value_impl< Config >::get_int() const\n      {\n          check_type(  int_type );\n  \n          return static_cast< int >( get_int64() );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 499
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "accountingDeprecationCheck",
          "args": [],
          "line": 495
        },
        "resolved": true,
        "details": {
          "function_name": "accountingDeprecationCheck",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "22-32",
          "snippet": "static void accountingDeprecationCheck()\n{\n    if (!GetBoolArg(\"-enableaccounts\", false))\n        throw runtime_error(\n            \"Accounting API is deprecated and will be removed in future.\\n\"\n            \"It can easily result in negative or odd balances if misused or misunderstood, which has happened in the field.\\n\"\n            \"If you still want to enable it, add to your config file enableaccounts=1\\n\");\n\n    if (GetBoolArg(\"-staking\", true))\n        throw runtime_error(\"If you want to use accounting API, staking must be disabled, add to your config file staking=0\\n\");\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstatic void accountingDeprecationCheck()\n{\n    if (!GetBoolArg(\"-enableaccounts\", false))\n        throw runtime_error(\n            \"Accounting API is deprecated and will be removed in future.\\n\"\n            \"It can easily result in negative or odd balances if misused or misunderstood, which has happened in the field.\\n\"\n            \"If you still want to enable it, add to your config file enableaccounts=1\\n\");\n\n    if (GetBoolArg(\"-staking\", true))\n        throw runtime_error(\"If you want to use accounting API, staking must be disabled, add to your config file staking=0\\n\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getreceivedbyaccount <account> [minconf=1]\\n\"\n            \"Returns the total amount received by addresses with <account> in transactions with at least [minconf] confirmations.\""
          ],
          "line": 491
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue getreceivedbyaccount(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 1 || params.size() > 2)\n        throw runtime_error(\n            \"getreceivedbyaccount <account> [minconf=1]\\n\"\n            \"Returns the total amount received by addresses with <account> in transactions with at least [minconf] confirmations.\");\n\n    accountingDeprecationCheck();\n\n    // Minimum confirmations\n    int nMinDepth = 1;\n    if (params.size() > 1)\n        nMinDepth = params[1].get_int();\n\n    // Get the set of pub keys assigned to account\n    string strAccount = AccountFromValue(params[0]);\n    set<CTxDestination> setAddress;\n    GetAccountAddresses(strAccount, setAddress);\n\n    // Tally\n    int64_t nAmount = 0;\n    for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); ++it)\n    {\n        const CWalletTx& wtx = (*it).second;\n        if (wtx.IsCoinBase() || wtx.IsCoinStake() || !wtx.IsFinal())\n            continue;\n\n        BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n        {\n            CTxDestination address;\n            if (ExtractDestination(txout.scriptPubKey, address) && IsMine(*pwalletMain, address) && setAddress.count(address))\n                if (wtx.GetDepthInMainChain() >= nMinDepth)\n                    nAmount += txout.nValue;\n        }\n    }\n\n    return (double)nAmount / (double)COIN;\n}"
  },
  {
    "function_name": "GetAccountAddresses",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "477-486",
    "snippet": "void GetAccountAddresses(string strAccount, set<CTxDestination>& setAddress)\n{\n    BOOST_FOREACH(const PAIRTYPE(CTxDestination, string)& item, pwalletMain->mapAddressBook)\n    {\n        const CTxDestination& address = item.first;\n        const string& strName = item.second;\n        if (strName == strAccount)\n            setAddress.insert(address);\n    }\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "setAddress.insert",
          "args": [
            "address"
          ],
          "line": 484
        },
        "resolved": true,
        "details": {
          "function_name": "insert",
          "container": "CBloomFilter",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bloom.cpp",
          "lines": "61-65",
          "snippet": "void CBloomFilter::insert(const uint256& hash)\n{\n    vector<unsigned char> data(BEGIN(hash), END(hash));\n    insert(data);\n}",
          "includes": [
            "#include \"hash.h\"",
            "#include \"script.h\"",
            "#include \"main.h\"",
            "#include \"bloom.h\"",
            "#include <stdlib.h>",
            "#include <math.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hash.h\"\n#include \"script.h\"\n#include \"main.h\"\n#include \"bloom.h\"\n#include <stdlib.h>\n#include <math.h>\n\nCBloomFilter {\n  void CBloomFilter::insert(const uint256& hash)\n  {\n      vector<unsigned char> data(BEGIN(hash), END(hash));\n      insert(data);\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nvoid GetAccountAddresses(string strAccount, set<CTxDestination>& setAddress)\n{\n    BOOST_FOREACH(const PAIRTYPE(CTxDestination, string)& item, pwalletMain->mapAddressBook)\n    {\n        const CTxDestination& address = item.first;\n        const string& strName = item.second;\n        if (strName == strAccount)\n            setAddress.insert(address);\n    }\n}"
  },
  {
    "function_name": "getreceivedbyaddress",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "438-474",
    "snippet": "Value getreceivedbyaddress(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 1 || params.size() > 2)\n        throw runtime_error(\n            \"getreceivedbyaddress <halcyonaddress> [minconf=1]\\n\"\n            \"Returns the total amount received by <halcyonaddress> in transactions with at least [minconf] confirmations.\");\n\n    // Bitcoin address\n    CBitcoinAddress address = CBitcoinAddress(params[0].get_str());\n    CScript scriptPubKey;\n    if (!address.IsValid())\n        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid Halcyon address\");\n    scriptPubKey.SetDestination(address.Get());\n    if (!IsMine(*pwalletMain,scriptPubKey))\n        return (double)0.0;\n\n    // Minimum confirmations\n    int nMinDepth = 1;\n    if (params.size() > 1)\n        nMinDepth = params[1].get_int();\n\n    // Tally\n    int64_t nAmount = 0;\n    for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); ++it)\n    {\n        const CWalletTx& wtx = (*it).second;\n        if (wtx.IsCoinBase() || wtx.IsCoinStake() || !wtx.IsFinal())\n            continue;\n\n        BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n            if (txout.scriptPubKey == scriptPubKey)\n                if (wtx.GetDepthInMainChain() >= nMinDepth)\n                    nAmount += txout.nValue;\n    }\n\n    return  ValueFromAmount(nAmount);\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ValueFromAmount",
          "args": [
            "nAmount"
          ],
          "line": 473
        },
        "resolved": true,
        "details": {
          "function_name": "ValueFromAmount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "113-116",
          "snippet": "Value ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nValue ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetDepthInMainChain",
          "args": [],
          "line": 469
        },
        "resolved": true,
        "details": {
          "function_name": "GetDepthInMainChain",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "765-765",
          "snippet": "int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCMerkleTx {\n  int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.IsFinal",
          "args": [],
          "line": 464
        },
        "resolved": true,
        "details": {
          "function_name": "IsFinal",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "491-506",
          "snippet": "bool IsFinal(int nBlockHeight=0, int64_t nBlockTime=0) const\n    {\n        // Time based nLockTime implemented in 0.1.6\n        if (nLockTime == 0)\n            return true;\n        if (nBlockHeight == 0)\n            nBlockHeight = nBestHeight;\n        if (nBlockTime == 0)\n            nBlockTime = GetAdjustedTime();\n        if ((int64_t)nLockTime < ((int64_t)nLockTime < LOCKTIME_THRESHOLD ? (int64_t)nBlockHeight : nBlockTime))\n            return true;\n        BOOST_FOREACH(const CTxIn& txin, vin)\n            if (!txin.IsFinal())\n                return false;\n        return true;\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  bool IsFinal(int nBlockHeight=0, int64_t nBlockTime=0) const\n      {\n          // Time based nLockTime implemented in 0.1.6\n          if (nLockTime == 0)\n              return true;\n          if (nBlockHeight == 0)\n              nBlockHeight = nBestHeight;\n          if (nBlockTime == 0)\n              nBlockTime = GetAdjustedTime();\n          if ((int64_t)nLockTime < ((int64_t)nLockTime < LOCKTIME_THRESHOLD ? (int64_t)nBlockHeight : nBlockTime))\n              return true;\n          BOOST_FOREACH(const CTxIn& txin, vin)\n              if (!txin.IsFinal())\n                  return false;\n          return true;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.IsCoinStake",
          "args": [],
          "line": 464
        },
        "resolved": true,
        "details": {
          "function_name": "IsCoinStake",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "542-546",
          "snippet": "bool IsCoinStake() const\n    {\n        // ppcoin: the coin stake transaction is marked with the first output empty\n        return (vin.size() > 0 && (!vin[0].prevout.IsNull()) && vout.size() >= 2 && vout[0].IsEmpty());\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  bool IsCoinStake() const\n      {\n          // ppcoin: the coin stake transaction is marked with the first output empty\n          return (vin.size() > 0 && (!vin[0].prevout.IsNull()) && vout.size() >= 2 && vout[0].IsEmpty());\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.IsCoinBase",
          "args": [],
          "line": 464
        },
        "resolved": true,
        "details": {
          "function_name": "IsCoinBase",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "537-540",
          "snippet": "bool IsCoinBase() const\n    {\n        return (vin.size() == 1 && vin[0].prevout.IsNull() && vout.size() >= 1);\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  bool IsCoinBase() const\n      {\n          return (vin.size() == 1 && vin[0].prevout.IsNull() && vout.size() >= 1);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapWallet.end",
          "args": [],
          "line": 461
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapWallet.begin",
          "args": [],
          "line": 461
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[1].get_int",
          "args": [],
          "line": 457
        },
        "resolved": true,
        "details": {
          "function_name": "get_int",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "385-390",
          "snippet": "int Value_impl< Config >::get_int() const\n    {\n        check_type(  int_type );\n\n        return static_cast< int >( get_int64() );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  int Value_impl< Config >::get_int() const\n      {\n          check_type(  int_type );\n  \n          return static_cast< int >( get_int64() );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 456
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "IsMine",
          "args": [
            "*pwalletMain",
            "scriptPubKey"
          ],
          "line": 451
        },
        "resolved": true,
        "details": {
          "function_name": "IsMine",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/script.cpp",
          "lines": "1551-1588",
          "snippet": "bool IsMine(const CKeyStore &keystore, const CScript& scriptPubKey)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    CKeyID keyID;\n    switch (whichType)\n    {\n    case TX_NONSTANDARD:\n        return false;\n    case TX_PUBKEY:\n        keyID = CPubKey(vSolutions[0]).GetID();\n        return keystore.HaveKey(keyID);\n    case TX_PUBKEYHASH:\n        keyID = CKeyID(uint160(vSolutions[0]));\n        return keystore.HaveKey(keyID);\n    case TX_SCRIPTHASH:\n    {\n        CScript subscript;\n        if (!keystore.GetCScript(CScriptID(uint160(vSolutions[0])), subscript))\n            return false;\n        return IsMine(keystore, subscript);\n    }\n    case TX_MULTISIG:\n    {\n        // Only consider transactions \"mine\" if we own ALL the\n        // keys involved. multi-signature transactions that are\n        // partially owned (somebody else has a key that can spend\n        // them) enable spend-out-from-under-you attacks, especially\n        // in shared-wallet situations.\n        vector<valtype> keys(vSolutions.begin()+1, vSolutions.begin()+vSolutions.size()-1);\n        return HaveKeys(keys, keystore) == keys.size();\n    }\n    }\n    return false;\n}",
          "includes": [
            "#include \"util.h\"",
            "#include \"sync.h\"",
            "#include \"main.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include \"keystore.h\"",
            "#include \"script.h\"",
            "#include <boost/tuple/tuple_comparison.hpp>",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/foreach.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"sync.h\"\n#include \"main.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include \"keystore.h\"\n#include \"script.h\"\n#include <boost/tuple/tuple_comparison.hpp>\n#include <boost/tuple/tuple.hpp>\n#include <boost/foreach.hpp>\n\nbool IsMine(const CKeyStore &keystore, const CScript& scriptPubKey)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    CKeyID keyID;\n    switch (whichType)\n    {\n    case TX_NONSTANDARD:\n        return false;\n    case TX_PUBKEY:\n        keyID = CPubKey(vSolutions[0]).GetID();\n        return keystore.HaveKey(keyID);\n    case TX_PUBKEYHASH:\n        keyID = CKeyID(uint160(vSolutions[0]));\n        return keystore.HaveKey(keyID);\n    case TX_SCRIPTHASH:\n    {\n        CScript subscript;\n        if (!keystore.GetCScript(CScriptID(uint160(vSolutions[0])), subscript))\n            return false;\n        return IsMine(keystore, subscript);\n    }\n    case TX_MULTISIG:\n    {\n        // Only consider transactions \"mine\" if we own ALL the\n        // keys involved. multi-signature transactions that are\n        // partially owned (somebody else has a key that can spend\n        // them) enable spend-out-from-under-you attacks, especially\n        // in shared-wallet situations.\n        vector<valtype> keys(vSolutions.begin()+1, vSolutions.begin()+vSolutions.size()-1);\n        return HaveKeys(keys, keystore) == keys.size();\n    }\n    }\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "scriptPubKey.SetDestination",
          "args": [
            "address.Get()"
          ],
          "line": 450
        },
        "resolved": true,
        "details": {
          "function_name": "SetDestination",
          "container": "CScript",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/script.cpp",
          "lines": "2011-2014",
          "snippet": "void CScript::SetDestination(const CTxDestination& dest)\n{\n    boost::apply_visitor(CScriptVisitor(this), dest);\n}",
          "includes": [
            "#include \"util.h\"",
            "#include \"sync.h\"",
            "#include \"main.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include \"keystore.h\"",
            "#include \"script.h\"",
            "#include <boost/tuple/tuple_comparison.hpp>",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/foreach.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"sync.h\"\n#include \"main.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include \"keystore.h\"\n#include \"script.h\"\n#include <boost/tuple/tuple_comparison.hpp>\n#include <boost/tuple/tuple.hpp>\n#include <boost/foreach.hpp>\n\nCScript {\n  void CScript::SetDestination(const CTxDestination& dest)\n  {\n      boost::apply_visitor(CScriptVisitor(this), dest);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "address.Get",
          "args": [],
          "line": 450
        },
        "resolved": true,
        "details": {
          "function_name": "Get",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "349-367",
          "snippet": "CTxDestination Get() const {\n        if (!IsValid())\n            return CNoDestination();\n        switch (nVersion) {\n        case PUBKEY_ADDRESS:\n        case PUBKEY_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            return CKeyID(id);\n        }\n        case SCRIPT_ADDRESS:\n        case SCRIPT_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            return CScriptID(id);\n        }\n        }\n        return CNoDestination();\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  CTxDestination Get() const {\n          if (!IsValid())\n              return CNoDestination();\n          switch (nVersion) {\n          case PUBKEY_ADDRESS:\n          case PUBKEY_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              return CKeyID(id);\n          }\n          case SCRIPT_ADDRESS:\n          case SCRIPT_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              return CScriptID(id);\n          }\n          }\n          return CNoDestination();\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_INVALID_ADDRESS_OR_KEY",
            "\"Invalid Halcyon address\""
          ],
          "line": 449
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "address.IsValid",
          "args": [],
          "line": 448
        },
        "resolved": true,
        "details": {
          "function_name": "IsValid",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "725-759",
          "snippet": "bool CNetAddr::IsValid() const\n{\n    // Cleanup 3-byte shifted addresses caused by garbage in size field\n    // of addr messages from versions before 0.2.9 checksum.\n    // Two consecutive addr messages look like this:\n    // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n    // so if the first length field is garbled, it reads the second batch\n    // of addr misaligned by 3 bytes.\n    if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n        return false;\n\n    // unspecified IPv6 address (::/128)\n    unsigned char ipNone[16] = {};\n    if (memcmp(ip, ipNone, 16) == 0)\n        return false;\n\n    // documentation IPv6 address\n    if (IsRFC3849())\n        return false;\n\n    if (IsIPv4())\n    {\n        // INADDR_NONE\n        uint32_t ipNone = INADDR_NONE;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n\n        // 0\n        ipNone = 0;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n    }\n\n    return true;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nstatic const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };\n\nCNetAddr {\n  bool CNetAddr::IsValid() const\n  {\n      // Cleanup 3-byte shifted addresses caused by garbage in size field\n      // of addr messages from versions before 0.2.9 checksum.\n      // Two consecutive addr messages look like this:\n      // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n      // so if the first length field is garbled, it reads the second batch\n      // of addr misaligned by 3 bytes.\n      if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n          return false;\n  \n      // unspecified IPv6 address (::/128)\n      unsigned char ipNone[16] = {};\n      if (memcmp(ip, ipNone, 16) == 0)\n          return false;\n  \n      // documentation IPv6 address\n      if (IsRFC3849())\n          return false;\n  \n      if (IsIPv4())\n      {\n          // INADDR_NONE\n          uint32_t ipNone = INADDR_NONE;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n  \n          // 0\n          ipNone = 0;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n      }\n  \n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "CBitcoinAddress",
          "args": [
            "params[0].get_str()"
          ],
          "line": 446
        },
        "resolved": true,
        "details": {
          "function_name": "operator()",
          "container": "CBitcoinAddressVisitor",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "399-399",
          "snippet": "bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddressVisitor {\n  bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 446
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getreceivedbyaddress <halcyonaddress> [minconf=1]\\n\"\n            \"Returns the total amount received by <halcyonaddress> in transactions with at least [minconf] confirmations.\""
          ],
          "line": 441
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue getreceivedbyaddress(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 1 || params.size() > 2)\n        throw runtime_error(\n            \"getreceivedbyaddress <halcyonaddress> [minconf=1]\\n\"\n            \"Returns the total amount received by <halcyonaddress> in transactions with at least [minconf] confirmations.\");\n\n    // Bitcoin address\n    CBitcoinAddress address = CBitcoinAddress(params[0].get_str());\n    CScript scriptPubKey;\n    if (!address.IsValid())\n        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid Halcyon address\");\n    scriptPubKey.SetDestination(address.Get());\n    if (!IsMine(*pwalletMain,scriptPubKey))\n        return (double)0.0;\n\n    // Minimum confirmations\n    int nMinDepth = 1;\n    if (params.size() > 1)\n        nMinDepth = params[1].get_int();\n\n    // Tally\n    int64_t nAmount = 0;\n    for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin(); it != pwalletMain->mapWallet.end(); ++it)\n    {\n        const CWalletTx& wtx = (*it).second;\n        if (wtx.IsCoinBase() || wtx.IsCoinStake() || !wtx.IsFinal())\n            continue;\n\n        BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n            if (txout.scriptPubKey == scriptPubKey)\n                if (wtx.GetDepthInMainChain() >= nMinDepth)\n                    nAmount += txout.nValue;\n    }\n\n    return  ValueFromAmount(nAmount);\n}"
  },
  {
    "function_name": "verifymessage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "401-435",
    "snippet": "Value verifymessage(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 3)\n        throw runtime_error(\n            \"verifymessage <halcyonaddress> <signature> <message>\\n\"\n            \"Verify a signed message\");\n\n    string strAddress  = params[0].get_str();\n    string strSign     = params[1].get_str();\n    string strMessage  = params[2].get_str();\n\n    CBitcoinAddress addr(strAddress);\n    if (!addr.IsValid())\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid address\");\n\n    CKeyID keyID;\n    if (!addr.GetKeyID(keyID))\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Address does not refer to key\");\n\n    bool fInvalid = false;\n    vector<unsigned char> vchSig = DecodeBase64(strSign.c_str(), &fInvalid);\n\n    if (fInvalid)\n        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Malformed base64 encoding\");\n\n    CDataStream ss(SER_GETHASH, 0);\n    ss << strMessageMagic;\n    ss << strMessage;\n\n    CKey key;\n    if (!key.SetCompactSignature(Hash(ss.begin(), ss.end()), vchSig))\n        return false;\n\n    return (key.GetPubKey().GetID() == keyID);\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "key.GetPubKey",
          "args": [],
          "line": 434
        },
        "resolved": true,
        "details": {
          "function_name": "GetPubKey",
          "container": "CKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.cpp",
          "lines": "274-284",
          "snippet": "CPubKey CKey::GetPubKey() const\n{\n    int nSize = i2o_ECPublicKey(pkey, NULL);\n    if (!nSize)\n        throw key_error(\"CKey::GetPubKey() : i2o_ECPublicKey failed\");\n    std::vector<unsigned char> vchPubKey(nSize, 0);\n    unsigned char* pbegin = &vchPubKey[0];\n    if (i2o_ECPublicKey(pkey, &pbegin) != nSize)\n        throw key_error(\"CKey::GetPubKey() : i2o_ECPublicKey returned unexpected size\");\n    return CPubKey(vchPubKey);\n}",
          "includes": [
            "#include \"key.h\"",
            "#include <openssl/obj_mac.h>",
            "#include <openssl/ecdsa.h>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"key.h\"\n#include <openssl/obj_mac.h>\n#include <openssl/ecdsa.h>\n#include <map>\n\nCKey {\n  CPubKey CKey::GetPubKey() const\n  {\n      int nSize = i2o_ECPublicKey(pkey, NULL);\n      if (!nSize)\n          throw key_error(\"CKey::GetPubKey() : i2o_ECPublicKey failed\");\n      std::vector<unsigned char> vchPubKey(nSize, 0);\n      unsigned char* pbegin = &vchPubKey[0];\n      if (i2o_ECPublicKey(pkey, &pbegin) != nSize)\n          throw key_error(\"CKey::GetPubKey() : i2o_ECPublicKey returned unexpected size\");\n      return CPubKey(vchPubKey);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "key.SetCompactSignature",
          "args": [
            "Hash(ss.begin(), ss.end())",
            "vchSig"
          ],
          "line": 431
        },
        "resolved": true,
        "details": {
          "function_name": "SetCompactSignature",
          "container": "CKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.cpp",
          "lines": "364-390",
          "snippet": "bool CKey::SetCompactSignature(uint256 hash, const std::vector<unsigned char>& vchSig)\n{\n    if (vchSig.size() != 65)\n        return false;\n    int nV = vchSig[0];\n    if (nV<27 || nV>=35)\n        return false;\n    ECDSA_SIG *sig = ECDSA_SIG_new();\n    BN_bin2bn(&vchSig[1],32,sig->r);\n    BN_bin2bn(&vchSig[33],32,sig->s);\n\n    EC_KEY_free(pkey);\n    pkey = EC_KEY_new_by_curve_name(NID_secp256k1);\n    if (nV >= 31)\n    {\n        SetCompressedPubKey();\n        nV -= 4;\n    }\n    if (ECDSA_SIG_recover_key_GFp(pkey, sig, (unsigned char*)&hash, sizeof(hash), nV - 27, 0) == 1)\n    {\n        fSet = true;\n        ECDSA_SIG_free(sig);\n        return true;\n    }\n    ECDSA_SIG_free(sig);\n    return false;\n}",
          "includes": [
            "#include \"key.h\"",
            "#include <openssl/obj_mac.h>",
            "#include <openssl/ecdsa.h>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"key.h\"\n#include <openssl/obj_mac.h>\n#include <openssl/ecdsa.h>\n#include <map>\n\nCKey {\n  bool CKey::SetCompactSignature(uint256 hash, const std::vector<unsigned char>& vchSig)\n  {\n      if (vchSig.size() != 65)\n          return false;\n      int nV = vchSig[0];\n      if (nV<27 || nV>=35)\n          return false;\n      ECDSA_SIG *sig = ECDSA_SIG_new();\n      BN_bin2bn(&vchSig[1],32,sig->r);\n      BN_bin2bn(&vchSig[33],32,sig->s);\n  \n      EC_KEY_free(pkey);\n      pkey = EC_KEY_new_by_curve_name(NID_secp256k1);\n      if (nV >= 31)\n      {\n          SetCompressedPubKey();\n          nV -= 4;\n      }\n      if (ECDSA_SIG_recover_key_GFp(pkey, sig, (unsigned char*)&hash, sizeof(hash), nV - 27, 0) == 1)\n      {\n          fSet = true;\n          ECDSA_SIG_free(sig);\n          return true;\n      }\n      ECDSA_SIG_free(sig);\n      return false;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "Hash",
          "args": [
            "ss.begin()",
            "ss.end()"
          ],
          "line": 431
        },
        "resolved": true,
        "details": {
          "function_name": "Hash",
          "container": "CBloomFilter",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bloom.cpp",
          "lines": "34-38",
          "snippet": "inline unsigned int CBloomFilter::Hash(unsigned int nHashNum, const std::vector<unsigned char>& vDataToHash) const\n{\n    // 0xFBA4C795 chosen as it guarantees a reasonable bit difference between nHashNum values.\n    return MurmurHash3(nHashNum * 0xFBA4C795 + nTweak, vDataToHash) % (vData.size() * 8);\n}",
          "includes": [
            "#include \"hash.h\"",
            "#include \"script.h\"",
            "#include \"main.h\"",
            "#include \"bloom.h\"",
            "#include <stdlib.h>",
            "#include <math.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hash.h\"\n#include \"script.h\"\n#include \"main.h\"\n#include \"bloom.h\"\n#include <stdlib.h>\n#include <math.h>\n\nCBloomFilter {\n  inline unsigned int CBloomFilter::Hash(unsigned int nHashNum, const std::vector<unsigned char>& vDataToHash) const\n  {\n      // 0xFBA4C795 chosen as it guarantees a reasonable bit difference between nHashNum values.\n      return MurmurHash3(nHashNum * 0xFBA4C795 + nTweak, vDataToHash) % (vData.size() * 8);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ss.end",
          "args": [],
          "line": 431
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ss.begin",
          "args": [],
          "line": 431
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_INVALID_ADDRESS_OR_KEY",
            "\"Malformed base64 encoding\""
          ],
          "line": 424
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "DecodeBase64",
          "args": [
            "strSign.c_str()",
            "&fInvalid"
          ],
          "line": 421
        },
        "resolved": true,
        "details": {
          "function_name": "DecodeBase64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "648-729",
          "snippet": "vector<unsigned char> DecodeBase64(const char* p, bool* pfInvalid)\n{\n    static const int decode64_table[256] =\n    {\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n        -1, -1, -1, 62, -1, -1, -1, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1,\n        -1, -1, -1, -1, -1,  0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14,\n        15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1, -1, 26, 27, 28,\n        29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48,\n        49, 50, 51, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1\n    };\n\n    if (pfInvalid)\n        *pfInvalid = false;\n\n    vector<unsigned char> vchRet;\n    vchRet.reserve(strlen(p)*3/4);\n\n    int mode = 0;\n    int left = 0;\n\n    while (1)\n    {\n         int dec = decode64_table[(unsigned char)*p];\n         if (dec == -1) break;\n         p++;\n         switch (mode)\n         {\n             case 0: // we have no bits and get 6\n                 left = dec;\n                 mode = 1;\n                 break;\n\n              case 1: // we have 6 bits and keep 4\n                  vchRet.push_back((left<<2) | (dec>>4));\n                  left = dec & 15;\n                  mode = 2;\n                  break;\n\n             case 2: // we have 4 bits and get 6, we keep 2\n                 vchRet.push_back((left<<4) | (dec>>2));\n                 left = dec & 3;\n                 mode = 3;\n                 break;\n\n             case 3: // we have 2 bits and get 6\n                 vchRet.push_back((left<<6) | dec);\n                 mode = 0;\n                 break;\n         }\n    }\n\n    if (pfInvalid)\n        switch (mode)\n        {\n            case 0: // 4n base64 characters processed: ok\n                break;\n\n            case 1: // 4n+1 base64 character processed: impossible\n                *pfInvalid = true;\n                break;\n\n            case 2: // 4n+2 base64 characters processed: require '=='\n                if (left || p[0] != '=' || p[1] != '=' || decode64_table[(unsigned char)p[2]] != -1)\n                    *pfInvalid = true;\n                break;\n\n            case 3: // 4n+3 base64 characters processed: require '='\n                if (left || p[0] != '=' || decode64_table[(unsigned char)p[1]] != -1)\n                    *pfInvalid = true;\n                break;\n        }\n\n    return vchRet;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nvector<unsigned char> DecodeBase64(const char* p, bool* pfInvalid)\n{\n    static const int decode64_table[256] =\n    {\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n        -1, -1, -1, 62, -1, -1, -1, 63, 52, 53, 54, 55, 56, 57, 58, 59, 60, 61, -1, -1,\n        -1, -1, -1, -1, -1,  0,  1,  2,  3,  4,  5,  6,  7,  8,  9, 10, 11, 12, 13, 14,\n        15, 16, 17, 18, 19, 20, 21, 22, 23, 24, 25, -1, -1, -1, -1, -1, -1, 26, 27, 28,\n        29, 30, 31, 32, 33, 34, 35, 36, 37, 38, 39, 40, 41, 42, 43, 44, 45, 46, 47, 48,\n        49, 50, 51, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1,\n        -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1, -1\n    };\n\n    if (pfInvalid)\n        *pfInvalid = false;\n\n    vector<unsigned char> vchRet;\n    vchRet.reserve(strlen(p)*3/4);\n\n    int mode = 0;\n    int left = 0;\n\n    while (1)\n    {\n         int dec = decode64_table[(unsigned char)*p];\n         if (dec == -1) break;\n         p++;\n         switch (mode)\n         {\n             case 0: // we have no bits and get 6\n                 left = dec;\n                 mode = 1;\n                 break;\n\n              case 1: // we have 6 bits and keep 4\n                  vchRet.push_back((left<<2) | (dec>>4));\n                  left = dec & 15;\n                  mode = 2;\n                  break;\n\n             case 2: // we have 4 bits and get 6, we keep 2\n                 vchRet.push_back((left<<4) | (dec>>2));\n                 left = dec & 3;\n                 mode = 3;\n                 break;\n\n             case 3: // we have 2 bits and get 6\n                 vchRet.push_back((left<<6) | dec);\n                 mode = 0;\n                 break;\n         }\n    }\n\n    if (pfInvalid)\n        switch (mode)\n        {\n            case 0: // 4n base64 characters processed: ok\n                break;\n\n            case 1: // 4n+1 base64 character processed: impossible\n                *pfInvalid = true;\n                break;\n\n            case 2: // 4n+2 base64 characters processed: require '=='\n                if (left || p[0] != '=' || p[1] != '=' || decode64_table[(unsigned char)p[2]] != -1)\n                    *pfInvalid = true;\n                break;\n\n            case 3: // 4n+3 base64 characters processed: require '='\n                if (left || p[0] != '=' || decode64_table[(unsigned char)p[1]] != -1)\n                    *pfInvalid = true;\n                break;\n        }\n\n    return vchRet;\n}"
        }
      },
      {
        "call_info": {
          "callee": "strSign.c_str",
          "args": [],
          "line": 421
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "addr.GetKeyID",
          "args": [
            "keyID"
          ],
          "line": 417
        },
        "resolved": true,
        "details": {
          "function_name": "GetKeyID",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "369-382",
          "snippet": "bool GetKeyID(CKeyID &keyID) const {\n        if (!IsValid())\n            return false;\n        switch (nVersion) {\n        case PUBKEY_ADDRESS:\n        case PUBKEY_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            keyID = CKeyID(id);\n            return true;\n        }\n        default: return false;\n        }\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  bool GetKeyID(CKeyID &keyID) const {\n          if (!IsValid())\n              return false;\n          switch (nVersion) {\n          case PUBKEY_ADDRESS:\n          case PUBKEY_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              keyID = CKeyID(id);\n              return true;\n          }\n          default: return false;\n          }\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "addr.IsValid",
          "args": [],
          "line": 413
        },
        "resolved": true,
        "details": {
          "function_name": "IsValid",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "725-759",
          "snippet": "bool CNetAddr::IsValid() const\n{\n    // Cleanup 3-byte shifted addresses caused by garbage in size field\n    // of addr messages from versions before 0.2.9 checksum.\n    // Two consecutive addr messages look like this:\n    // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n    // so if the first length field is garbled, it reads the second batch\n    // of addr misaligned by 3 bytes.\n    if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n        return false;\n\n    // unspecified IPv6 address (::/128)\n    unsigned char ipNone[16] = {};\n    if (memcmp(ip, ipNone, 16) == 0)\n        return false;\n\n    // documentation IPv6 address\n    if (IsRFC3849())\n        return false;\n\n    if (IsIPv4())\n    {\n        // INADDR_NONE\n        uint32_t ipNone = INADDR_NONE;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n\n        // 0\n        ipNone = 0;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n    }\n\n    return true;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nstatic const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };\n\nCNetAddr {\n  bool CNetAddr::IsValid() const\n  {\n      // Cleanup 3-byte shifted addresses caused by garbage in size field\n      // of addr messages from versions before 0.2.9 checksum.\n      // Two consecutive addr messages look like this:\n      // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n      // so if the first length field is garbled, it reads the second batch\n      // of addr misaligned by 3 bytes.\n      if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n          return false;\n  \n      // unspecified IPv6 address (::/128)\n      unsigned char ipNone[16] = {};\n      if (memcmp(ip, ipNone, 16) == 0)\n          return false;\n  \n      // documentation IPv6 address\n      if (IsRFC3849())\n          return false;\n  \n      if (IsIPv4())\n      {\n          // INADDR_NONE\n          uint32_t ipNone = INADDR_NONE;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n  \n          // 0\n          ipNone = 0;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n      }\n  \n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[2].get_str",
          "args": [],
          "line": 410
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[1].get_str",
          "args": [],
          "line": 409
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 408
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"verifymessage <halcyonaddress> <signature> <message>\\n\"\n            \"Verify a signed message\""
          ],
          "line": 404
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 403
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue verifymessage(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 3)\n        throw runtime_error(\n            \"verifymessage <halcyonaddress> <signature> <message>\\n\"\n            \"Verify a signed message\");\n\n    string strAddress  = params[0].get_str();\n    string strSign     = params[1].get_str();\n    string strMessage  = params[2].get_str();\n\n    CBitcoinAddress addr(strAddress);\n    if (!addr.IsValid())\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid address\");\n\n    CKeyID keyID;\n    if (!addr.GetKeyID(keyID))\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Address does not refer to key\");\n\n    bool fInvalid = false;\n    vector<unsigned char> vchSig = DecodeBase64(strSign.c_str(), &fInvalid);\n\n    if (fInvalid)\n        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Malformed base64 encoding\");\n\n    CDataStream ss(SER_GETHASH, 0);\n    ss << strMessageMagic;\n    ss << strMessage;\n\n    CKey key;\n    if (!key.SetCompactSignature(Hash(ss.begin(), ss.end()), vchSig))\n        return false;\n\n    return (key.GetPubKey().GetID() == keyID);\n}"
  },
  {
    "function_name": "signmessage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "366-399",
    "snippet": "Value signmessage(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 2)\n        throw runtime_error(\n            \"signmessage <halcyonaddress> <message>\\n\"\n            \"Sign a message with the private key of an address\");\n\n    EnsureWalletIsUnlocked();\n\n    string strAddress = params[0].get_str();\n    string strMessage = params[1].get_str();\n\n    CBitcoinAddress addr(strAddress);\n    if (!addr.IsValid())\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid address\");\n\n    CKeyID keyID;\n    if (!addr.GetKeyID(keyID))\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Address does not refer to key\");\n\n    CKey key;\n    if (!pwalletMain->GetKey(keyID, key))\n        throw JSONRPCError(RPC_WALLET_ERROR, \"Private key not available\");\n\n    CDataStream ss(SER_GETHASH, 0);\n    ss << strMessageMagic;\n    ss << strMessage;\n\n    vector<unsigned char> vchSig;\n    if (!key.SignCompact(Hash(ss.begin(), ss.end()), vchSig))\n        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Sign failed\");\n\n    return EncodeBase64(&vchSig[0], vchSig.size());\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "EncodeBase64",
          "args": [
            "&vchSig[0]",
            "vchSig.size()"
          ],
          "line": 398
        },
        "resolved": true,
        "details": {
          "function_name": "EncodeBase64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "597-641",
          "snippet": "string EncodeBase64(const unsigned char* pch, size_t len)\n{\n    static const char *pbase64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n\n    string strRet=\"\";\n    strRet.reserve((len+2)/3*4);\n\n    int mode=0, left=0;\n    const unsigned char *pchEnd = pch+len;\n\n    while (pch<pchEnd)\n    {\n        int enc = *(pch++);\n        switch (mode)\n        {\n            case 0: // we have no bits\n                strRet += pbase64[enc >> 2];\n                left = (enc & 3) << 4;\n                mode = 1;\n                break;\n\n            case 1: // we have two bits\n                strRet += pbase64[left | (enc >> 4)];\n                left = (enc & 15) << 2;\n                mode = 2;\n                break;\n\n            case 2: // we have four bits\n                strRet += pbase64[left | (enc >> 6)];\n                strRet += pbase64[enc & 63];\n                mode = 0;\n                break;\n        }\n    }\n\n    if (mode)\n    {\n        strRet += pbase64[left];\n        strRet += '=';\n        if (mode == 1)\n            strRet += '=';\n    }\n\n    return strRet;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nstring EncodeBase64(const unsigned char* pch, size_t len)\n{\n    static const char *pbase64 = \"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/\";\n\n    string strRet=\"\";\n    strRet.reserve((len+2)/3*4);\n\n    int mode=0, left=0;\n    const unsigned char *pchEnd = pch+len;\n\n    while (pch<pchEnd)\n    {\n        int enc = *(pch++);\n        switch (mode)\n        {\n            case 0: // we have no bits\n                strRet += pbase64[enc >> 2];\n                left = (enc & 3) << 4;\n                mode = 1;\n                break;\n\n            case 1: // we have two bits\n                strRet += pbase64[left | (enc >> 4)];\n                left = (enc & 15) << 2;\n                mode = 2;\n                break;\n\n            case 2: // we have four bits\n                strRet += pbase64[left | (enc >> 6)];\n                strRet += pbase64[enc & 63];\n                mode = 0;\n                break;\n        }\n    }\n\n    if (mode)\n    {\n        strRet += pbase64[left];\n        strRet += '=';\n        if (mode == 1)\n            strRet += '=';\n    }\n\n    return strRet;\n}"
        }
      },
      {
        "call_info": {
          "callee": "vchSig.size",
          "args": [],
          "line": 398
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_INVALID_ADDRESS_OR_KEY",
            "\"Sign failed\""
          ],
          "line": 396
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "key.SignCompact",
          "args": [
            "Hash(ss.begin(), ss.end())",
            "vchSig"
          ],
          "line": 395
        },
        "resolved": true,
        "details": {
          "function_name": "SignCompact",
          "container": "CKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.cpp",
          "lines": "318-358",
          "snippet": "bool CKey::SignCompact(uint256 hash, std::vector<unsigned char>& vchSig)\n{\n    bool fOk = false;\n    ECDSA_SIG *sig = ECDSA_do_sign((unsigned char*)&hash, sizeof(hash), pkey);\n    if (sig==NULL)\n        return false;\n    vchSig.clear();\n    vchSig.resize(65,0);\n    int nBitsR = BN_num_bits(sig->r);\n    int nBitsS = BN_num_bits(sig->s);\n    if (nBitsR <= 256 && nBitsS <= 256)\n    {\n        int nRecId = -1;\n        for (int i=0; i<4; i++)\n        {\n            CKey keyRec;\n            keyRec.fSet = true;\n            if (fCompressedPubKey)\n                keyRec.SetCompressedPubKey();\n            if (ECDSA_SIG_recover_key_GFp(keyRec.pkey, sig, (unsigned char*)&hash, sizeof(hash), i, 1) == 1)\n                if (keyRec.GetPubKey() == this->GetPubKey())\n                {\n                    nRecId = i;\n                    break;\n                }\n        }\n\n        if (nRecId == -1)\n        {\n            ECDSA_SIG_free(sig);\n            throw key_error(\"CKey::SignCompact() : unable to construct recoverable key\");\n        }\n\n        vchSig[0] = nRecId+27+(fCompressedPubKey ? 4 : 0);\n        BN_bn2bin(sig->r,&vchSig[33-(nBitsR+7)/8]);\n        BN_bn2bin(sig->s,&vchSig[65-(nBitsS+7)/8]);\n        fOk = true;\n    }\n    ECDSA_SIG_free(sig);\n    return fOk;\n}",
          "includes": [
            "#include \"key.h\"",
            "#include <openssl/obj_mac.h>",
            "#include <openssl/ecdsa.h>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"key.h\"\n#include <openssl/obj_mac.h>\n#include <openssl/ecdsa.h>\n#include <map>\n\nCKey {\n  bool CKey::SignCompact(uint256 hash, std::vector<unsigned char>& vchSig)\n  {\n      bool fOk = false;\n      ECDSA_SIG *sig = ECDSA_do_sign((unsigned char*)&hash, sizeof(hash), pkey);\n      if (sig==NULL)\n          return false;\n      vchSig.clear();\n      vchSig.resize(65,0);\n      int nBitsR = BN_num_bits(sig->r);\n      int nBitsS = BN_num_bits(sig->s);\n      if (nBitsR <= 256 && nBitsS <= 256)\n      {\n          int nRecId = -1;\n          for (int i=0; i<4; i++)\n          {\n              CKey keyRec;\n              keyRec.fSet = true;\n              if (fCompressedPubKey)\n                  keyRec.SetCompressedPubKey();\n              if (ECDSA_SIG_recover_key_GFp(keyRec.pkey, sig, (unsigned char*)&hash, sizeof(hash), i, 1) == 1)\n                  if (keyRec.GetPubKey() == this->GetPubKey())\n                  {\n                      nRecId = i;\n                      break;\n                  }\n          }\n  \n          if (nRecId == -1)\n          {\n              ECDSA_SIG_free(sig);\n              throw key_error(\"CKey::SignCompact() : unable to construct recoverable key\");\n          }\n  \n          vchSig[0] = nRecId+27+(fCompressedPubKey ? 4 : 0);\n          BN_bn2bin(sig->r,&vchSig[33-(nBitsR+7)/8]);\n          BN_bn2bin(sig->s,&vchSig[65-(nBitsS+7)/8]);\n          fOk = true;\n      }\n      ECDSA_SIG_free(sig);\n      return fOk;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "Hash",
          "args": [
            "ss.begin()",
            "ss.end()"
          ],
          "line": 395
        },
        "resolved": true,
        "details": {
          "function_name": "Hash",
          "container": "CBloomFilter",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bloom.cpp",
          "lines": "34-38",
          "snippet": "inline unsigned int CBloomFilter::Hash(unsigned int nHashNum, const std::vector<unsigned char>& vDataToHash) const\n{\n    // 0xFBA4C795 chosen as it guarantees a reasonable bit difference between nHashNum values.\n    return MurmurHash3(nHashNum * 0xFBA4C795 + nTweak, vDataToHash) % (vData.size() * 8);\n}",
          "includes": [
            "#include \"hash.h\"",
            "#include \"script.h\"",
            "#include \"main.h\"",
            "#include \"bloom.h\"",
            "#include <stdlib.h>",
            "#include <math.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hash.h\"\n#include \"script.h\"\n#include \"main.h\"\n#include \"bloom.h\"\n#include <stdlib.h>\n#include <math.h>\n\nCBloomFilter {\n  inline unsigned int CBloomFilter::Hash(unsigned int nHashNum, const std::vector<unsigned char>& vDataToHash) const\n  {\n      // 0xFBA4C795 chosen as it guarantees a reasonable bit difference between nHashNum values.\n      return MurmurHash3(nHashNum * 0xFBA4C795 + nTweak, vDataToHash) % (vData.size() * 8);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ss.end",
          "args": [],
          "line": 395
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ss.begin",
          "args": [],
          "line": 395
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->GetKey",
          "args": [
            "keyID",
            "key"
          ],
          "line": 387
        },
        "resolved": true,
        "details": {
          "function_name": "GetKey",
          "container": "CBasicKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "81-94",
          "snippet": "bool GetKey(const CKeyID &address, CKey &keyOut) const\n    {\n        {\n            LOCK(cs_KeyStore);\n            KeyMap::const_iterator mi = mapKeys.find(address);\n            if (mi != mapKeys.end())\n            {\n                keyOut.Reset();\n                keyOut.SetSecret((*mi).second.first, (*mi).second.second);\n                return true;\n            }\n        }\n        return false;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCBasicKeyStore {\n  bool GetKey(const CKeyID &address, CKey &keyOut) const\n      {\n          {\n              LOCK(cs_KeyStore);\n              KeyMap::const_iterator mi = mapKeys.find(address);\n              if (mi != mapKeys.end())\n              {\n                  keyOut.Reset();\n                  keyOut.SetSecret((*mi).second.first, (*mi).second.second);\n                  return true;\n              }\n          }\n          return false;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "addr.GetKeyID",
          "args": [
            "keyID"
          ],
          "line": 383
        },
        "resolved": true,
        "details": {
          "function_name": "GetKeyID",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "369-382",
          "snippet": "bool GetKeyID(CKeyID &keyID) const {\n        if (!IsValid())\n            return false;\n        switch (nVersion) {\n        case PUBKEY_ADDRESS:\n        case PUBKEY_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            keyID = CKeyID(id);\n            return true;\n        }\n        default: return false;\n        }\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  bool GetKeyID(CKeyID &keyID) const {\n          if (!IsValid())\n              return false;\n          switch (nVersion) {\n          case PUBKEY_ADDRESS:\n          case PUBKEY_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              keyID = CKeyID(id);\n              return true;\n          }\n          default: return false;\n          }\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "addr.IsValid",
          "args": [],
          "line": 379
        },
        "resolved": true,
        "details": {
          "function_name": "IsValid",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "725-759",
          "snippet": "bool CNetAddr::IsValid() const\n{\n    // Cleanup 3-byte shifted addresses caused by garbage in size field\n    // of addr messages from versions before 0.2.9 checksum.\n    // Two consecutive addr messages look like this:\n    // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n    // so if the first length field is garbled, it reads the second batch\n    // of addr misaligned by 3 bytes.\n    if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n        return false;\n\n    // unspecified IPv6 address (::/128)\n    unsigned char ipNone[16] = {};\n    if (memcmp(ip, ipNone, 16) == 0)\n        return false;\n\n    // documentation IPv6 address\n    if (IsRFC3849())\n        return false;\n\n    if (IsIPv4())\n    {\n        // INADDR_NONE\n        uint32_t ipNone = INADDR_NONE;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n\n        // 0\n        ipNone = 0;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n    }\n\n    return true;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nstatic const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };\n\nCNetAddr {\n  bool CNetAddr::IsValid() const\n  {\n      // Cleanup 3-byte shifted addresses caused by garbage in size field\n      // of addr messages from versions before 0.2.9 checksum.\n      // Two consecutive addr messages look like this:\n      // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n      // so if the first length field is garbled, it reads the second batch\n      // of addr misaligned by 3 bytes.\n      if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n          return false;\n  \n      // unspecified IPv6 address (::/128)\n      unsigned char ipNone[16] = {};\n      if (memcmp(ip, ipNone, 16) == 0)\n          return false;\n  \n      // documentation IPv6 address\n      if (IsRFC3849())\n          return false;\n  \n      if (IsIPv4())\n      {\n          // INADDR_NONE\n          uint32_t ipNone = INADDR_NONE;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n  \n          // 0\n          ipNone = 0;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n      }\n  \n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[1].get_str",
          "args": [],
          "line": 376
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 375
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EnsureWalletIsUnlocked",
          "args": [],
          "line": 373
        },
        "resolved": true,
        "details": {
          "function_name": "EnsureWalletIsUnlocked",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "41-47",
          "snippet": "void EnsureWalletIsUnlocked()\n{\n    if (pwalletMain->IsLocked())\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Please enter the wallet passphrase with walletpassphrase first.\");\n    if (fWalletUnlockStakingOnly)\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Wallet is unlocked for staking only.\");\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nvoid EnsureWalletIsUnlocked()\n{\n    if (pwalletMain->IsLocked())\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Please enter the wallet passphrase with walletpassphrase first.\");\n    if (fWalletUnlockStakingOnly)\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Wallet is unlocked for staking only.\");\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"signmessage <halcyonaddress> <message>\\n\"\n            \"Sign a message with the private key of an address\""
          ],
          "line": 369
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue signmessage(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 2)\n        throw runtime_error(\n            \"signmessage <halcyonaddress> <message>\\n\"\n            \"Sign a message with the private key of an address\");\n\n    EnsureWalletIsUnlocked();\n\n    string strAddress = params[0].get_str();\n    string strMessage = params[1].get_str();\n\n    CBitcoinAddress addr(strAddress);\n    if (!addr.IsValid())\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid address\");\n\n    CKeyID keyID;\n    if (!addr.GetKeyID(keyID))\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Address does not refer to key\");\n\n    CKey key;\n    if (!pwalletMain->GetKey(keyID, key))\n        throw JSONRPCError(RPC_WALLET_ERROR, \"Private key not available\");\n\n    CDataStream ss(SER_GETHASH, 0);\n    ss << strMessageMagic;\n    ss << strMessage;\n\n    vector<unsigned char> vchSig;\n    if (!key.SignCompact(Hash(ss.begin(), ss.end()), vchSig))\n        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Sign failed\");\n\n    return EncodeBase64(&vchSig[0], vchSig.size());\n}"
  },
  {
    "function_name": "listaddressgroupings",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "335-364",
    "snippet": "Value listaddressgroupings(const Array& params, bool fHelp)\n{\n    if (fHelp)\n        throw runtime_error(\n            \"listaddressgroupings\\n\"\n            \"Lists groups of addresses which have had their common ownership\\n\"\n            \"made public by common use as inputs or as the resulting change\\n\"\n            \"in past transactions\");\n\n    Array jsonGroupings;\n    map<CTxDestination, int64_t> balances = pwalletMain->GetAddressBalances();\n    BOOST_FOREACH(set<CTxDestination> grouping, pwalletMain->GetAddressGroupings())\n    {\n        Array jsonGrouping;\n        BOOST_FOREACH(CTxDestination address, grouping)\n        {\n            Array addressInfo;\n            addressInfo.push_back(CBitcoinAddress(address).ToString());\n            addressInfo.push_back(ValueFromAmount(balances[address]));\n            {\n                LOCK(pwalletMain->cs_wallet);\n                if (pwalletMain->mapAddressBook.find(CBitcoinAddress(address).Get()) != pwalletMain->mapAddressBook.end())\n                    addressInfo.push_back(pwalletMain->mapAddressBook.find(CBitcoinAddress(address).Get())->second);\n            }\n            jsonGrouping.push_back(addressInfo);\n        }\n        jsonGroupings.push_back(jsonGrouping);\n    }\n    return jsonGroupings;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "jsonGroupings.push_back",
          "args": [
            "jsonGrouping"
          ],
          "line": 361
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "jsonGrouping.push_back",
          "args": [
            "addressInfo"
          ],
          "line": 359
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "addressInfo.push_back",
          "args": [
            "pwalletMain->mapAddressBook.find(CBitcoinAddress(address).Get())->second"
          ],
          "line": 357
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapAddressBook.find",
          "args": [
            "CBitcoinAddress(address).Get()"
          ],
          "line": 357
        },
        "resolved": true,
        "details": {
          "function_name": "find",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "33-33",
          "snippet": "const_iterator find(const key_type& k) const { return map.find(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator find(const key_type& k) const { return map.find(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "CBitcoinAddress",
          "args": [],
          "line": 357
        },
        "resolved": true,
        "details": {
          "function_name": "IsScript",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "384-394",
          "snippet": "bool IsScript() const {\n        if (!IsValid())\n            return false;\n        switch (nVersion) {\n        case SCRIPT_ADDRESS:\n        case SCRIPT_ADDRESS_TEST: {\n            return true;\n        }\n        default: return false;\n        }\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  bool IsScript() const {\n          if (!IsValid())\n              return false;\n          switch (nVersion) {\n          case SCRIPT_ADDRESS:\n          case SCRIPT_ADDRESS_TEST: {\n              return true;\n          }\n          default: return false;\n          }\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "CBitcoinAddress",
          "args": [
            "address"
          ],
          "line": 357
        },
        "resolved": true,
        "details": {
          "function_name": "operator()",
          "container": "CBitcoinAddressVisitor",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "399-399",
          "snippet": "bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddressVisitor {\n  bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapAddressBook.end",
          "args": [],
          "line": 356
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "pwalletMain->cs_wallet"
          ],
          "line": 355
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "addressInfo.push_back",
          "args": [
            "ValueFromAmount(balances[address])"
          ],
          "line": 353
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ValueFromAmount",
          "args": [
            "balances[address]"
          ],
          "line": 353
        },
        "resolved": true,
        "details": {
          "function_name": "ValueFromAmount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "113-116",
          "snippet": "Value ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nValue ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}"
        }
      },
      {
        "call_info": {
          "callee": "addressInfo.push_back",
          "args": [
            "CBitcoinAddress(address).ToString()"
          ],
          "line": 352
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BOOST_FOREACH",
          "args": [
            "set<CTxDestination> grouping",
            "pwalletMain->GetAddressGroupings()"
          ],
          "line": 346
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->GetAddressGroupings",
          "args": [],
          "line": 346
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->GetAddressBalances",
          "args": [],
          "line": 345
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"listaddressgroupings\\n\"\n            \"Lists groups of addresses which have had their common ownership\\n\"\n            \"made public by common use as inputs or as the resulting change\\n\"\n            \"in past transactions\""
          ],
          "line": 338
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue listaddressgroupings(const Array& params, bool fHelp)\n{\n    if (fHelp)\n        throw runtime_error(\n            \"listaddressgroupings\\n\"\n            \"Lists groups of addresses which have had their common ownership\\n\"\n            \"made public by common use as inputs or as the resulting change\\n\"\n            \"in past transactions\");\n\n    Array jsonGroupings;\n    map<CTxDestination, int64_t> balances = pwalletMain->GetAddressBalances();\n    BOOST_FOREACH(set<CTxDestination> grouping, pwalletMain->GetAddressGroupings())\n    {\n        Array jsonGrouping;\n        BOOST_FOREACH(CTxDestination address, grouping)\n        {\n            Array addressInfo;\n            addressInfo.push_back(CBitcoinAddress(address).ToString());\n            addressInfo.push_back(ValueFromAmount(balances[address]));\n            {\n                LOCK(pwalletMain->cs_wallet);\n                if (pwalletMain->mapAddressBook.find(CBitcoinAddress(address).Get()) != pwalletMain->mapAddressBook.end())\n                    addressInfo.push_back(pwalletMain->mapAddressBook.find(CBitcoinAddress(address).Get())->second);\n            }\n            jsonGrouping.push_back(addressInfo);\n        }\n        jsonGroupings.push_back(jsonGrouping);\n    }\n    return jsonGroupings;\n}"
  },
  {
    "function_name": "sendtoaddress",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "303-333",
    "snippet": "Value sendtoaddress(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 2 || params.size() > 4)\n        throw runtime_error(\n            \"sendtoaddress <halcyonaddress> <amount> [comment] [comment-to]\\n\"\n            \"<amount> is a real and is rounded to the nearest 0.000001\"\n            + HelpRequiringPassphrase());\n\n    CBitcoinAddress address(params[0].get_str());\n    if (!address.IsValid())\n        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid Halcyon address\");\n\n    // Amount\n    int64_t nAmount = AmountFromValue(params[1]);\n\n    // Wallet comments\n    CWalletTx wtx;\n    if (params.size() > 2 && params[2].type() != null_type && !params[2].get_str().empty())\n        wtx.mapValue[\"comment\"] = params[2].get_str();\n    if (params.size() > 3 && params[3].type() != null_type && !params[3].get_str().empty())\n        wtx.mapValue[\"to\"]      = params[3].get_str();\n\n    if (pwalletMain->IsLocked())\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Please enter the wallet passphrase with walletpassphrase first.\");\n\n    string strError = pwalletMain->SendMoneyToDestination(address.Get(), nAmount, wtx);\n    if (strError != \"\")\n        throw JSONRPCError(RPC_WALLET_ERROR, strError);\n\n    return wtx.GetHash().GetHex();\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wtx.GetHash",
          "args": [],
          "line": 332
        },
        "resolved": true,
        "details": {
          "function_name": "GetHash",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "922-928",
          "snippet": "uint64_t CNetAddr::GetHash() const\n{\n    uint256 hash = Hash(&ip[0], &ip[16]);\n    uint64_t nRet;\n    memcpy(&nRet, &hash, sizeof(nRet));\n    return nRet;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCNetAddr {\n  uint64_t CNetAddr::GetHash() const\n  {\n      uint256 hash = Hash(&ip[0], &ip[16]);\n      uint64_t nRet;\n      memcpy(&nRet, &hash, sizeof(nRet));\n      return nRet;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_WALLET_ERROR",
            "strError"
          ],
          "line": 330
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->SendMoneyToDestination",
          "args": [
            "address.Get()",
            "nAmount",
            "wtx"
          ],
          "line": 328
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "address.Get",
          "args": [],
          "line": 328
        },
        "resolved": true,
        "details": {
          "function_name": "Get",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "349-367",
          "snippet": "CTxDestination Get() const {\n        if (!IsValid())\n            return CNoDestination();\n        switch (nVersion) {\n        case PUBKEY_ADDRESS:\n        case PUBKEY_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            return CKeyID(id);\n        }\n        case SCRIPT_ADDRESS:\n        case SCRIPT_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            return CScriptID(id);\n        }\n        }\n        return CNoDestination();\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  CTxDestination Get() const {\n          if (!IsValid())\n              return CNoDestination();\n          switch (nVersion) {\n          case PUBKEY_ADDRESS:\n          case PUBKEY_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              return CKeyID(id);\n          }\n          case SCRIPT_ADDRESS:\n          case SCRIPT_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              return CScriptID(id);\n          }\n          }\n          return CNoDestination();\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->IsLocked",
          "args": [],
          "line": 325
        },
        "resolved": true,
        "details": {
          "function_name": "IsLocked",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "134-144",
          "snippet": "bool IsLocked() const\n    {\n        if (!IsCrypted())\n            return false;\n        bool result;\n        {\n            LOCK(cs_KeyStore);\n            result = vMasterKey.empty();\n        }\n        return result;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool IsLocked() const\n      {\n          if (!IsCrypted())\n              return false;\n          bool result;\n          {\n              LOCK(cs_KeyStore);\n              result = vMasterKey.empty();\n          }\n          return result;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[3].get_str",
          "args": [],
          "line": 323
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[3].get_str",
          "args": [],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[3].get_str",
          "args": [],
          "line": 322
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[3].type",
          "args": [],
          "line": 322
        },
        "resolved": true,
        "details": {
          "function_name": "type",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "321-324",
          "snippet": "Value_type Value_impl< Config >::type() const\n    {\n        return type_;\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  Value_type Value_impl< Config >::type() const\n      {\n          return type_;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 322
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[2].get_str",
          "args": [],
          "line": 321
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[2].get_str",
          "args": [],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[2].get_str",
          "args": [],
          "line": 320
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "AmountFromValue",
          "args": [
            "params[1]"
          ],
          "line": 316
        },
        "resolved": true,
        "details": {
          "function_name": "AmountFromValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "102-111",
          "snippet": "int64_t AmountFromValue(const Value& value)\n{\n    double dAmount = value.get_real();\n    if (dAmount <= 0.0 || dAmount > MAX_MONEY)\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    int64_t nAmount = roundint64(dAmount * COIN);\n    if (!MoneyRange(nAmount))\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    return nAmount;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nint64_t AmountFromValue(const Value& value)\n{\n    double dAmount = value.get_real();\n    if (dAmount <= 0.0 || dAmount > MAX_MONEY)\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    int64_t nAmount = roundint64(dAmount * COIN);\n    if (!MoneyRange(nAmount))\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    return nAmount;\n}"
        }
      },
      {
        "call_info": {
          "callee": "address.IsValid",
          "args": [],
          "line": 312
        },
        "resolved": true,
        "details": {
          "function_name": "IsValid",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "725-759",
          "snippet": "bool CNetAddr::IsValid() const\n{\n    // Cleanup 3-byte shifted addresses caused by garbage in size field\n    // of addr messages from versions before 0.2.9 checksum.\n    // Two consecutive addr messages look like this:\n    // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n    // so if the first length field is garbled, it reads the second batch\n    // of addr misaligned by 3 bytes.\n    if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n        return false;\n\n    // unspecified IPv6 address (::/128)\n    unsigned char ipNone[16] = {};\n    if (memcmp(ip, ipNone, 16) == 0)\n        return false;\n\n    // documentation IPv6 address\n    if (IsRFC3849())\n        return false;\n\n    if (IsIPv4())\n    {\n        // INADDR_NONE\n        uint32_t ipNone = INADDR_NONE;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n\n        // 0\n        ipNone = 0;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n    }\n\n    return true;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nstatic const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };\n\nCNetAddr {\n  bool CNetAddr::IsValid() const\n  {\n      // Cleanup 3-byte shifted addresses caused by garbage in size field\n      // of addr messages from versions before 0.2.9 checksum.\n      // Two consecutive addr messages look like this:\n      // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n      // so if the first length field is garbled, it reads the second batch\n      // of addr misaligned by 3 bytes.\n      if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n          return false;\n  \n      // unspecified IPv6 address (::/128)\n      unsigned char ipNone[16] = {};\n      if (memcmp(ip, ipNone, 16) == 0)\n          return false;\n  \n      // documentation IPv6 address\n      if (IsRFC3849())\n          return false;\n  \n      if (IsIPv4())\n      {\n          // INADDR_NONE\n          uint32_t ipNone = INADDR_NONE;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n  \n          // 0\n          ipNone = 0;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n      }\n  \n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 311
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"sendtoaddress <halcyonaddress> <amount> [comment] [comment-to]\\n\"\n            \"<amount> is a real and is rounded to the nearest 0.000001\"\n            + HelpRequiringPassphrase()"
          ],
          "line": 306
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HelpRequiringPassphrase",
          "args": [],
          "line": 309
        },
        "resolved": true,
        "details": {
          "function_name": "HelpRequiringPassphrase",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "34-39",
          "snippet": "std::string HelpRequiringPassphrase()\n{\n    return pwalletMain->IsCrypted()\n        ? \"\\nrequires wallet passphrase to be set with walletpassphrase first\"\n        : \"\";\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstd::string HelpRequiringPassphrase()\n{\n    return pwalletMain->IsCrypted()\n        ? \"\\nrequires wallet passphrase to be set with walletpassphrase first\"\n        : \"\";\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue sendtoaddress(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 2 || params.size() > 4)\n        throw runtime_error(\n            \"sendtoaddress <halcyonaddress> <amount> [comment] [comment-to]\\n\"\n            \"<amount> is a real and is rounded to the nearest 0.000001\"\n            + HelpRequiringPassphrase());\n\n    CBitcoinAddress address(params[0].get_str());\n    if (!address.IsValid())\n        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid Halcyon address\");\n\n    // Amount\n    int64_t nAmount = AmountFromValue(params[1]);\n\n    // Wallet comments\n    CWalletTx wtx;\n    if (params.size() > 2 && params[2].type() != null_type && !params[2].get_str().empty())\n        wtx.mapValue[\"comment\"] = params[2].get_str();\n    if (params.size() > 3 && params[3].type() != null_type && !params[3].get_str().empty())\n        wtx.mapValue[\"to\"]      = params[3].get_str();\n\n    if (pwalletMain->IsLocked())\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Please enter the wallet passphrase with walletpassphrase first.\");\n\n    string strError = pwalletMain->SendMoneyToDestination(address.Get(), nAmount, wtx);\n    if (strError != \"\")\n        throw JSONRPCError(RPC_WALLET_ERROR, strError);\n\n    return wtx.GetHash().GetHex();\n}"
  },
  {
    "function_name": "getaddressesbyaccount",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "282-301",
    "snippet": "Value getaddressesbyaccount(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 1)\n        throw runtime_error(\n            \"getaddressesbyaccount <account>\\n\"\n            \"Returns the list of addresses for the given account.\");\n\n    string strAccount = AccountFromValue(params[0]);\n\n    // Find all addresses that have the given account\n    Array ret;\n    BOOST_FOREACH(const PAIRTYPE(CBitcoinAddress, string)& item, pwalletMain->mapAddressBook)\n    {\n        const CBitcoinAddress& address = item.first;\n        const string& strName = item.second;\n        if (strName == strAccount)\n            ret.push_back(address.ToString());\n    }\n    return ret;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "address.ToString()"
          ],
          "line": 298
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "address.ToString",
          "args": [],
          "line": 298
        },
        "resolved": true,
        "details": {
          "function_name": "ToString",
          "container": "CService",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "1172-1175",
          "snippet": "std::string CService::ToString() const\n{\n    return ToStringIPPort();\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCService {\n  std::string CService::ToString() const\n  {\n      return ToStringIPPort();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "AccountFromValue",
          "args": [
            "params[0]"
          ],
          "line": 289
        },
        "resolved": true,
        "details": {
          "function_name": "AccountFromValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "68-74",
          "snippet": "string AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstring AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getaddressesbyaccount <account>\\n\"\n            \"Returns the list of addresses for the given account.\""
          ],
          "line": 285
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 284
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue getaddressesbyaccount(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 1)\n        throw runtime_error(\n            \"getaddressesbyaccount <account>\\n\"\n            \"Returns the list of addresses for the given account.\");\n\n    string strAccount = AccountFromValue(params[0]);\n\n    // Find all addresses that have the given account\n    Array ret;\n    BOOST_FOREACH(const PAIRTYPE(CBitcoinAddress, string)& item, pwalletMain->mapAddressBook)\n    {\n        const CBitcoinAddress& address = item.first;\n        const string& strName = item.second;\n        if (strName == strAccount)\n            ret.push_back(address.ToString());\n    }\n    return ret;\n}"
  },
  {
    "function_name": "getaccount",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "263-279",
    "snippet": "Value getaccount(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 1)\n        throw runtime_error(\n            \"getaccount <halcyonaddress>\\n\"\n            \"Returns the account associated with the given address.\");\n\n    CBitcoinAddress address(params[0].get_str());\n    if (!address.IsValid())\n        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid Halcyon address\");\n\n    string strAccount;\n    map<CTxDestination, string>::iterator mi = pwalletMain->mapAddressBook.find(address.Get());\n    if (mi != pwalletMain->mapAddressBook.end() && !(*mi).second.empty())\n        strAccount = (*mi).second;\n    return strAccount;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "",
          "args": [],
          "line": 276
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapAddressBook.end",
          "args": [],
          "line": 276
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapAddressBook.find",
          "args": [
            "address.Get()"
          ],
          "line": 275
        },
        "resolved": true,
        "details": {
          "function_name": "find",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "33-33",
          "snippet": "const_iterator find(const key_type& k) const { return map.find(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator find(const key_type& k) const { return map.find(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "address.Get",
          "args": [],
          "line": 275
        },
        "resolved": true,
        "details": {
          "function_name": "Get",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "349-367",
          "snippet": "CTxDestination Get() const {\n        if (!IsValid())\n            return CNoDestination();\n        switch (nVersion) {\n        case PUBKEY_ADDRESS:\n        case PUBKEY_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            return CKeyID(id);\n        }\n        case SCRIPT_ADDRESS:\n        case SCRIPT_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            return CScriptID(id);\n        }\n        }\n        return CNoDestination();\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  CTxDestination Get() const {\n          if (!IsValid())\n              return CNoDestination();\n          switch (nVersion) {\n          case PUBKEY_ADDRESS:\n          case PUBKEY_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              return CKeyID(id);\n          }\n          case SCRIPT_ADDRESS:\n          case SCRIPT_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              return CScriptID(id);\n          }\n          }\n          return CNoDestination();\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_INVALID_ADDRESS_OR_KEY",
            "\"Invalid Halcyon address\""
          ],
          "line": 272
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "address.IsValid",
          "args": [],
          "line": 271
        },
        "resolved": true,
        "details": {
          "function_name": "IsValid",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "725-759",
          "snippet": "bool CNetAddr::IsValid() const\n{\n    // Cleanup 3-byte shifted addresses caused by garbage in size field\n    // of addr messages from versions before 0.2.9 checksum.\n    // Two consecutive addr messages look like this:\n    // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n    // so if the first length field is garbled, it reads the second batch\n    // of addr misaligned by 3 bytes.\n    if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n        return false;\n\n    // unspecified IPv6 address (::/128)\n    unsigned char ipNone[16] = {};\n    if (memcmp(ip, ipNone, 16) == 0)\n        return false;\n\n    // documentation IPv6 address\n    if (IsRFC3849())\n        return false;\n\n    if (IsIPv4())\n    {\n        // INADDR_NONE\n        uint32_t ipNone = INADDR_NONE;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n\n        // 0\n        ipNone = 0;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n    }\n\n    return true;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nstatic const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };\n\nCNetAddr {\n  bool CNetAddr::IsValid() const\n  {\n      // Cleanup 3-byte shifted addresses caused by garbage in size field\n      // of addr messages from versions before 0.2.9 checksum.\n      // Two consecutive addr messages look like this:\n      // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n      // so if the first length field is garbled, it reads the second batch\n      // of addr misaligned by 3 bytes.\n      if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n          return false;\n  \n      // unspecified IPv6 address (::/128)\n      unsigned char ipNone[16] = {};\n      if (memcmp(ip, ipNone, 16) == 0)\n          return false;\n  \n      // documentation IPv6 address\n      if (IsRFC3849())\n          return false;\n  \n      if (IsIPv4())\n      {\n          // INADDR_NONE\n          uint32_t ipNone = INADDR_NONE;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n  \n          // 0\n          ipNone = 0;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n      }\n  \n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 270
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getaccount <halcyonaddress>\\n\"\n            \"Returns the account associated with the given address.\""
          ],
          "line": 266
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 265
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue getaccount(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 1)\n        throw runtime_error(\n            \"getaccount <halcyonaddress>\\n\"\n            \"Returns the account associated with the given address.\");\n\n    CBitcoinAddress address(params[0].get_str());\n    if (!address.IsValid())\n        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid Halcyon address\");\n\n    string strAccount;\n    map<CTxDestination, string>::iterator mi = pwalletMain->mapAddressBook.find(address.Get());\n    if (mi != pwalletMain->mapAddressBook.end() && !(*mi).second.empty())\n        strAccount = (*mi).second;\n    return strAccount;\n}"
  },
  {
    "function_name": "setaccount",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "233-260",
    "snippet": "Value setaccount(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 1 || params.size() > 2)\n        throw runtime_error(\n            \"setaccount <halcyonaddress> <account>\\n\"\n            \"Sets the account associated with the given address.\");\n\n    CBitcoinAddress address(params[0].get_str());\n    if (!address.IsValid())\n        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid Halcyon address\");\n\n\n    string strAccount;\n    if (params.size() > 1)\n        strAccount = AccountFromValue(params[1]);\n\n    // Detect when changing the account of an address that is the 'unused current key' of another account:\n    if (pwalletMain->mapAddressBook.count(address.Get()))\n    {\n        string strOldAccount = pwalletMain->mapAddressBook[address.Get()];\n        if (address == GetAccountAddress(strOldAccount))\n            GetAccountAddress(strOldAccount, true);\n    }\n\n    pwalletMain->SetAddressBookName(address.Get(), strAccount);\n\n    return Value::null;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pwalletMain->SetAddressBookName",
          "args": [
            "address.Get()",
            "strAccount"
          ],
          "line": 257
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "address.Get",
          "args": [],
          "line": 257
        },
        "resolved": true,
        "details": {
          "function_name": "Get",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "349-367",
          "snippet": "CTxDestination Get() const {\n        if (!IsValid())\n            return CNoDestination();\n        switch (nVersion) {\n        case PUBKEY_ADDRESS:\n        case PUBKEY_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            return CKeyID(id);\n        }\n        case SCRIPT_ADDRESS:\n        case SCRIPT_ADDRESS_TEST: {\n            uint160 id;\n            memcpy(&id, &vchData[0], 20);\n            return CScriptID(id);\n        }\n        }\n        return CNoDestination();\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  CTxDestination Get() const {\n          if (!IsValid())\n              return CNoDestination();\n          switch (nVersion) {\n          case PUBKEY_ADDRESS:\n          case PUBKEY_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              return CKeyID(id);\n          }\n          case SCRIPT_ADDRESS:\n          case SCRIPT_ADDRESS_TEST: {\n              uint160 id;\n              memcpy(&id, &vchData[0], 20);\n              return CScriptID(id);\n          }\n          }\n          return CNoDestination();\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "GetAccountAddress",
          "args": [
            "strOldAccount",
            "true"
          ],
          "line": 254
        },
        "resolved": true,
        "details": {
          "function_name": "GetAccountAddresses",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "477-486",
          "snippet": "void GetAccountAddresses(string strAccount, set<CTxDestination>& setAddress)\n{\n    BOOST_FOREACH(const PAIRTYPE(CTxDestination, string)& item, pwalletMain->mapAddressBook)\n    {\n        const CTxDestination& address = item.first;\n        const string& strName = item.second;\n        if (strName == strAccount)\n            setAddress.insert(address);\n    }\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nvoid GetAccountAddresses(string strAccount, set<CTxDestination>& setAddress)\n{\n    BOOST_FOREACH(const PAIRTYPE(CTxDestination, string)& item, pwalletMain->mapAddressBook)\n    {\n        const CTxDestination& address = item.first;\n        const string& strName = item.second;\n        if (strName == strAccount)\n            setAddress.insert(address);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "GetAccountAddress",
          "args": [
            "strOldAccount"
          ],
          "line": 253
        },
        "resolved": true,
        "details": {
          "function_name": "GetAccountAddress",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "176-212",
          "snippet": "CBitcoinAddress GetAccountAddress(string strAccount, bool bForceNew=false)\n{\n    CWalletDB walletdb(pwalletMain->strWalletFile);\n\n    CAccount account;\n    walletdb.ReadAccount(strAccount, account);\n\n    bool bKeyUsed = false;\n\n    // Check if the current key has been used\n    if (account.vchPubKey.IsValid())\n    {\n        CScript scriptPubKey;\n        scriptPubKey.SetDestination(account.vchPubKey.GetID());\n        for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin();\n             it != pwalletMain->mapWallet.end() && account.vchPubKey.IsValid();\n             ++it)\n        {\n            const CWalletTx& wtx = (*it).second;\n            BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n                if (txout.scriptPubKey == scriptPubKey)\n                    bKeyUsed = true;\n        }\n    }\n\n    // Generate a new key\n    if (!account.vchPubKey.IsValid() || bForceNew || bKeyUsed)\n    {\n        if (!pwalletMain->GetKeyFromPool(account.vchPubKey, false))\n            throw JSONRPCError(RPC_WALLET_KEYPOOL_RAN_OUT, \"Error: Keypool ran out, please call keypoolrefill first\");\n\n        pwalletMain->SetAddressBookName(account.vchPubKey.GetID(), strAccount);\n        walletdb.WriteAccount(strAccount, account);\n    }\n\n    return CBitcoinAddress(account.vchPubKey.GetID());\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nCBitcoinAddress GetAccountAddress(string strAccount, bool bForceNew=false)\n{\n    CWalletDB walletdb(pwalletMain->strWalletFile);\n\n    CAccount account;\n    walletdb.ReadAccount(strAccount, account);\n\n    bool bKeyUsed = false;\n\n    // Check if the current key has been used\n    if (account.vchPubKey.IsValid())\n    {\n        CScript scriptPubKey;\n        scriptPubKey.SetDestination(account.vchPubKey.GetID());\n        for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin();\n             it != pwalletMain->mapWallet.end() && account.vchPubKey.IsValid();\n             ++it)\n        {\n            const CWalletTx& wtx = (*it).second;\n            BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n                if (txout.scriptPubKey == scriptPubKey)\n                    bKeyUsed = true;\n        }\n    }\n\n    // Generate a new key\n    if (!account.vchPubKey.IsValid() || bForceNew || bKeyUsed)\n    {\n        if (!pwalletMain->GetKeyFromPool(account.vchPubKey, false))\n            throw JSONRPCError(RPC_WALLET_KEYPOOL_RAN_OUT, \"Error: Keypool ran out, please call keypoolrefill first\");\n\n        pwalletMain->SetAddressBookName(account.vchPubKey.GetID(), strAccount);\n        walletdb.WriteAccount(strAccount, account);\n    }\n\n    return CBitcoinAddress(account.vchPubKey.GetID());\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapAddressBook.count",
          "args": [
            "address.Get()"
          ],
          "line": 250
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "AccountFromValue",
          "args": [
            "params[1]"
          ],
          "line": 247
        },
        "resolved": true,
        "details": {
          "function_name": "AccountFromValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "68-74",
          "snippet": "string AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstring AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}"
        }
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 246
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_INVALID_ADDRESS_OR_KEY",
            "\"Invalid Halcyon address\""
          ],
          "line": 242
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "address.IsValid",
          "args": [],
          "line": 241
        },
        "resolved": true,
        "details": {
          "function_name": "IsValid",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "725-759",
          "snippet": "bool CNetAddr::IsValid() const\n{\n    // Cleanup 3-byte shifted addresses caused by garbage in size field\n    // of addr messages from versions before 0.2.9 checksum.\n    // Two consecutive addr messages look like this:\n    // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n    // so if the first length field is garbled, it reads the second batch\n    // of addr misaligned by 3 bytes.\n    if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n        return false;\n\n    // unspecified IPv6 address (::/128)\n    unsigned char ipNone[16] = {};\n    if (memcmp(ip, ipNone, 16) == 0)\n        return false;\n\n    // documentation IPv6 address\n    if (IsRFC3849())\n        return false;\n\n    if (IsIPv4())\n    {\n        // INADDR_NONE\n        uint32_t ipNone = INADDR_NONE;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n\n        // 0\n        ipNone = 0;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n    }\n\n    return true;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nstatic const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };\n\nCNetAddr {\n  bool CNetAddr::IsValid() const\n  {\n      // Cleanup 3-byte shifted addresses caused by garbage in size field\n      // of addr messages from versions before 0.2.9 checksum.\n      // Two consecutive addr messages look like this:\n      // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n      // so if the first length field is garbled, it reads the second batch\n      // of addr misaligned by 3 bytes.\n      if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n          return false;\n  \n      // unspecified IPv6 address (::/128)\n      unsigned char ipNone[16] = {};\n      if (memcmp(ip, ipNone, 16) == 0)\n          return false;\n  \n      // documentation IPv6 address\n      if (IsRFC3849())\n          return false;\n  \n      if (IsIPv4())\n      {\n          // INADDR_NONE\n          uint32_t ipNone = INADDR_NONE;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n  \n          // 0\n          ipNone = 0;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n      }\n  \n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"setaccount <halcyonaddress> <account>\\n\"\n            \"Sets the account associated with the given address.\""
          ],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue setaccount(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 1 || params.size() > 2)\n        throw runtime_error(\n            \"setaccount <halcyonaddress> <account>\\n\"\n            \"Sets the account associated with the given address.\");\n\n    CBitcoinAddress address(params[0].get_str());\n    if (!address.IsValid())\n        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Invalid Halcyon address\");\n\n\n    string strAccount;\n    if (params.size() > 1)\n        strAccount = AccountFromValue(params[1]);\n\n    // Detect when changing the account of an address that is the 'unused current key' of another account:\n    if (pwalletMain->mapAddressBook.count(address.Get()))\n    {\n        string strOldAccount = pwalletMain->mapAddressBook[address.Get()];\n        if (address == GetAccountAddress(strOldAccount))\n            GetAccountAddress(strOldAccount, true);\n    }\n\n    pwalletMain->SetAddressBookName(address.Get(), strAccount);\n\n    return Value::null;\n}"
  },
  {
    "function_name": "getaccountaddress",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "214-229",
    "snippet": "Value getaccountaddress(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 1)\n        throw runtime_error(\n            \"getaccountaddress <account>\\n\"\n            \"Returns the current Halcyon address for receiving payments to this account.\");\n\n    // Parse the account first so we don't generate a key if there's an error\n    string strAccount = AccountFromValue(params[0]);\n\n    Value ret;\n\n    ret = GetAccountAddress(strAccount).ToString();\n\n    return ret;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "GetAccountAddress",
          "args": [],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetAccountAddress",
          "args": [
            "strAccount"
          ],
          "line": 226
        },
        "resolved": true,
        "details": {
          "function_name": "GetAccountAddress",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "176-212",
          "snippet": "CBitcoinAddress GetAccountAddress(string strAccount, bool bForceNew=false)\n{\n    CWalletDB walletdb(pwalletMain->strWalletFile);\n\n    CAccount account;\n    walletdb.ReadAccount(strAccount, account);\n\n    bool bKeyUsed = false;\n\n    // Check if the current key has been used\n    if (account.vchPubKey.IsValid())\n    {\n        CScript scriptPubKey;\n        scriptPubKey.SetDestination(account.vchPubKey.GetID());\n        for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin();\n             it != pwalletMain->mapWallet.end() && account.vchPubKey.IsValid();\n             ++it)\n        {\n            const CWalletTx& wtx = (*it).second;\n            BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n                if (txout.scriptPubKey == scriptPubKey)\n                    bKeyUsed = true;\n        }\n    }\n\n    // Generate a new key\n    if (!account.vchPubKey.IsValid() || bForceNew || bKeyUsed)\n    {\n        if (!pwalletMain->GetKeyFromPool(account.vchPubKey, false))\n            throw JSONRPCError(RPC_WALLET_KEYPOOL_RAN_OUT, \"Error: Keypool ran out, please call keypoolrefill first\");\n\n        pwalletMain->SetAddressBookName(account.vchPubKey.GetID(), strAccount);\n        walletdb.WriteAccount(strAccount, account);\n    }\n\n    return CBitcoinAddress(account.vchPubKey.GetID());\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nCBitcoinAddress GetAccountAddress(string strAccount, bool bForceNew=false)\n{\n    CWalletDB walletdb(pwalletMain->strWalletFile);\n\n    CAccount account;\n    walletdb.ReadAccount(strAccount, account);\n\n    bool bKeyUsed = false;\n\n    // Check if the current key has been used\n    if (account.vchPubKey.IsValid())\n    {\n        CScript scriptPubKey;\n        scriptPubKey.SetDestination(account.vchPubKey.GetID());\n        for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin();\n             it != pwalletMain->mapWallet.end() && account.vchPubKey.IsValid();\n             ++it)\n        {\n            const CWalletTx& wtx = (*it).second;\n            BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n                if (txout.scriptPubKey == scriptPubKey)\n                    bKeyUsed = true;\n        }\n    }\n\n    // Generate a new key\n    if (!account.vchPubKey.IsValid() || bForceNew || bKeyUsed)\n    {\n        if (!pwalletMain->GetKeyFromPool(account.vchPubKey, false))\n            throw JSONRPCError(RPC_WALLET_KEYPOOL_RAN_OUT, \"Error: Keypool ran out, please call keypoolrefill first\");\n\n        pwalletMain->SetAddressBookName(account.vchPubKey.GetID(), strAccount);\n        walletdb.WriteAccount(strAccount, account);\n    }\n\n    return CBitcoinAddress(account.vchPubKey.GetID());\n}"
        }
      },
      {
        "call_info": {
          "callee": "AccountFromValue",
          "args": [
            "params[0]"
          ],
          "line": 222
        },
        "resolved": true,
        "details": {
          "function_name": "AccountFromValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "68-74",
          "snippet": "string AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstring AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getaccountaddress <account>\\n\"\n            \"Returns the current Halcyon address for receiving payments to this account.\""
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 216
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue getaccountaddress(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 1)\n        throw runtime_error(\n            \"getaccountaddress <account>\\n\"\n            \"Returns the current Halcyon address for receiving payments to this account.\");\n\n    // Parse the account first so we don't generate a key if there's an error\n    string strAccount = AccountFromValue(params[0]);\n\n    Value ret;\n\n    ret = GetAccountAddress(strAccount).ToString();\n\n    return ret;\n}"
  },
  {
    "function_name": "GetAccountAddress",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "176-212",
    "snippet": "CBitcoinAddress GetAccountAddress(string strAccount, bool bForceNew=false)\n{\n    CWalletDB walletdb(pwalletMain->strWalletFile);\n\n    CAccount account;\n    walletdb.ReadAccount(strAccount, account);\n\n    bool bKeyUsed = false;\n\n    // Check if the current key has been used\n    if (account.vchPubKey.IsValid())\n    {\n        CScript scriptPubKey;\n        scriptPubKey.SetDestination(account.vchPubKey.GetID());\n        for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin();\n             it != pwalletMain->mapWallet.end() && account.vchPubKey.IsValid();\n             ++it)\n        {\n            const CWalletTx& wtx = (*it).second;\n            BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n                if (txout.scriptPubKey == scriptPubKey)\n                    bKeyUsed = true;\n        }\n    }\n\n    // Generate a new key\n    if (!account.vchPubKey.IsValid() || bForceNew || bKeyUsed)\n    {\n        if (!pwalletMain->GetKeyFromPool(account.vchPubKey, false))\n            throw JSONRPCError(RPC_WALLET_KEYPOOL_RAN_OUT, \"Error: Keypool ran out, please call keypoolrefill first\");\n\n        pwalletMain->SetAddressBookName(account.vchPubKey.GetID(), strAccount);\n        walletdb.WriteAccount(strAccount, account);\n    }\n\n    return CBitcoinAddress(account.vchPubKey.GetID());\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "CBitcoinAddress",
          "args": [
            "account.vchPubKey.GetID()"
          ],
          "line": 211
        },
        "resolved": true,
        "details": {
          "function_name": "operator()",
          "container": "CBitcoinAddressVisitor",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "399-399",
          "snippet": "bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddressVisitor {\n  bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "account.vchPubKey.GetID",
          "args": [],
          "line": 211
        },
        "resolved": true,
        "details": {
          "function_name": "GetID",
          "container": "CPubKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.h",
          "lines": "80-82",
          "snippet": "CKeyID GetID() const {\n        return CKeyID(Hash160(vchPubKey));\n    }",
          "includes": [
            "#include <openssl/ec.h> // for EC_KEY definition",
            "#include \"util.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\"",
            "#include \"allocators.h\"",
            "#include <vector>",
            "#include <stdexcept>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <openssl/ec.h> // for EC_KEY definition\n#include \"util.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n#include \"allocators.h\"\n#include <vector>\n#include <stdexcept>\n\nCPubKey {\n  CKeyID GetID() const {\n          return CKeyID(Hash160(vchPubKey));\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "walletdb.WriteAccount",
          "args": [
            "strAccount",
            "account"
          ],
          "line": 208
        },
        "resolved": true,
        "details": {
          "function_name": "WriteAccount",
          "container": "CWalletDB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/walletdb.cpp",
          "lines": "42-45",
          "snippet": "bool CWalletDB::WriteAccount(const string& strAccount, const CAccount& account)\n{\n    return Write(make_pair(string(\"acc\"), strAccount), account);\n}",
          "includes": [
            "#include <boost/filesystem.hpp>",
            "#include <boost/version.hpp>",
            "#include \"wallet.h\"",
            "#include \"walletdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem.hpp>\n#include <boost/version.hpp>\n#include \"wallet.h\"\n#include \"walletdb.h\"\n\nCWalletDB {\n  bool CWalletDB::WriteAccount(const string& strAccount, const CAccount& account)\n  {\n      return Write(make_pair(string(\"acc\"), strAccount), account);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->SetAddressBookName",
          "args": [
            "account.vchPubKey.GetID()",
            "strAccount"
          ],
          "line": 207
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_WALLET_KEYPOOL_RAN_OUT",
            "\"Error: Keypool ran out, please call keypoolrefill first\""
          ],
          "line": 205
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->GetKeyFromPool",
          "args": [
            "account.vchPubKey",
            "false"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "account.vchPubKey.IsValid",
          "args": [],
          "line": 202
        },
        "resolved": true,
        "details": {
          "function_name": "IsValid",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "725-759",
          "snippet": "bool CNetAddr::IsValid() const\n{\n    // Cleanup 3-byte shifted addresses caused by garbage in size field\n    // of addr messages from versions before 0.2.9 checksum.\n    // Two consecutive addr messages look like this:\n    // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n    // so if the first length field is garbled, it reads the second batch\n    // of addr misaligned by 3 bytes.\n    if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n        return false;\n\n    // unspecified IPv6 address (::/128)\n    unsigned char ipNone[16] = {};\n    if (memcmp(ip, ipNone, 16) == 0)\n        return false;\n\n    // documentation IPv6 address\n    if (IsRFC3849())\n        return false;\n\n    if (IsIPv4())\n    {\n        // INADDR_NONE\n        uint32_t ipNone = INADDR_NONE;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n\n        // 0\n        ipNone = 0;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n    }\n\n    return true;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nstatic const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };\n\nCNetAddr {\n  bool CNetAddr::IsValid() const\n  {\n      // Cleanup 3-byte shifted addresses caused by garbage in size field\n      // of addr messages from versions before 0.2.9 checksum.\n      // Two consecutive addr messages look like this:\n      // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n      // so if the first length field is garbled, it reads the second batch\n      // of addr misaligned by 3 bytes.\n      if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n          return false;\n  \n      // unspecified IPv6 address (::/128)\n      unsigned char ipNone[16] = {};\n      if (memcmp(ip, ipNone, 16) == 0)\n          return false;\n  \n      // documentation IPv6 address\n      if (IsRFC3849())\n          return false;\n  \n      if (IsIPv4())\n      {\n          // INADDR_NONE\n          uint32_t ipNone = INADDR_NONE;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n  \n          // 0\n          ipNone = 0;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n      }\n  \n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapWallet.end",
          "args": [],
          "line": 191
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->mapWallet.begin",
          "args": [],
          "line": 190
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "scriptPubKey.SetDestination",
          "args": [
            "account.vchPubKey.GetID()"
          ],
          "line": 189
        },
        "resolved": true,
        "details": {
          "function_name": "SetDestination",
          "container": "CScript",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/script.cpp",
          "lines": "2011-2014",
          "snippet": "void CScript::SetDestination(const CTxDestination& dest)\n{\n    boost::apply_visitor(CScriptVisitor(this), dest);\n}",
          "includes": [
            "#include \"util.h\"",
            "#include \"sync.h\"",
            "#include \"main.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include \"keystore.h\"",
            "#include \"script.h\"",
            "#include <boost/tuple/tuple_comparison.hpp>",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/foreach.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"sync.h\"\n#include \"main.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include \"keystore.h\"\n#include \"script.h\"\n#include <boost/tuple/tuple_comparison.hpp>\n#include <boost/tuple/tuple.hpp>\n#include <boost/foreach.hpp>\n\nCScript {\n  void CScript::SetDestination(const CTxDestination& dest)\n  {\n      boost::apply_visitor(CScriptVisitor(this), dest);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "walletdb.ReadAccount",
          "args": [
            "strAccount",
            "account"
          ],
          "line": 181
        },
        "resolved": true,
        "details": {
          "function_name": "ReadAccount",
          "container": "CWalletDB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/walletdb.cpp",
          "lines": "36-40",
          "snippet": "bool CWalletDB::ReadAccount(const string& strAccount, CAccount& account)\n{\n    account.SetNull();\n    return Read(make_pair(string(\"acc\"), strAccount), account);\n}",
          "includes": [
            "#include <boost/filesystem.hpp>",
            "#include <boost/version.hpp>",
            "#include \"wallet.h\"",
            "#include \"walletdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem.hpp>\n#include <boost/version.hpp>\n#include \"wallet.h\"\n#include \"walletdb.h\"\n\nCWalletDB {\n  bool CWalletDB::ReadAccount(const string& strAccount, CAccount& account)\n  {\n      account.SetNull();\n      return Read(make_pair(string(\"acc\"), strAccount), account);\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nCBitcoinAddress GetAccountAddress(string strAccount, bool bForceNew=false)\n{\n    CWalletDB walletdb(pwalletMain->strWalletFile);\n\n    CAccount account;\n    walletdb.ReadAccount(strAccount, account);\n\n    bool bKeyUsed = false;\n\n    // Check if the current key has been used\n    if (account.vchPubKey.IsValid())\n    {\n        CScript scriptPubKey;\n        scriptPubKey.SetDestination(account.vchPubKey.GetID());\n        for (map<uint256, CWalletTx>::iterator it = pwalletMain->mapWallet.begin();\n             it != pwalletMain->mapWallet.end() && account.vchPubKey.IsValid();\n             ++it)\n        {\n            const CWalletTx& wtx = (*it).second;\n            BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n                if (txout.scriptPubKey == scriptPubKey)\n                    bKeyUsed = true;\n        }\n    }\n\n    // Generate a new key\n    if (!account.vchPubKey.IsValid() || bForceNew || bKeyUsed)\n    {\n        if (!pwalletMain->GetKeyFromPool(account.vchPubKey, false))\n            throw JSONRPCError(RPC_WALLET_KEYPOOL_RAN_OUT, \"Error: Keypool ran out, please call keypoolrefill first\");\n\n        pwalletMain->SetAddressBookName(account.vchPubKey.GetID(), strAccount);\n        walletdb.WriteAccount(strAccount, account);\n    }\n\n    return CBitcoinAddress(account.vchPubKey.GetID());\n}"
  },
  {
    "function_name": "getnewaddress",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "147-173",
    "snippet": "Value getnewaddress(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 1)\n        throw runtime_error(\n            \"getnewaddress [account]\\n\"\n            \"Returns a new Halcyon address for receiving payments.  \"\n            \"If [account] is specified (recommended), it is added to the address book \"\n            \"so payments received with the address will be credited to [account].\");\n\n    // Parse the account first so we don't generate a key if there's an error\n    string strAccount;\n    if (params.size() > 0)\n        strAccount = AccountFromValue(params[0]);\n\n    if (!pwalletMain->IsLocked())\n        pwalletMain->TopUpKeyPool();\n\n    // Generate a new key that is added to wallet\n    CPubKey newKey;\n    if (!pwalletMain->GetKeyFromPool(newKey, false))\n        throw JSONRPCError(RPC_WALLET_KEYPOOL_RAN_OUT, \"Error: Keypool ran out, please call keypoolrefill first\");\n    CKeyID keyID = newKey.GetID();\n\n    pwalletMain->SetAddressBookName(keyID, strAccount);\n\n    return CBitcoinAddress(keyID).ToString();\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "CBitcoinAddress",
          "args": [],
          "line": 172
        },
        "resolved": true,
        "details": {
          "function_name": "IsScript",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "384-394",
          "snippet": "bool IsScript() const {\n        if (!IsValid())\n            return false;\n        switch (nVersion) {\n        case SCRIPT_ADDRESS:\n        case SCRIPT_ADDRESS_TEST: {\n            return true;\n        }\n        default: return false;\n        }\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  bool IsScript() const {\n          if (!IsValid())\n              return false;\n          switch (nVersion) {\n          case SCRIPT_ADDRESS:\n          case SCRIPT_ADDRESS_TEST: {\n              return true;\n          }\n          default: return false;\n          }\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "CBitcoinAddress",
          "args": [
            "keyID"
          ],
          "line": 172
        },
        "resolved": true,
        "details": {
          "function_name": "operator()",
          "container": "CBitcoinAddressVisitor",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "399-399",
          "snippet": "bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddressVisitor {\n  bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->SetAddressBookName",
          "args": [
            "keyID",
            "strAccount"
          ],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "newKey.GetID",
          "args": [],
          "line": 168
        },
        "resolved": true,
        "details": {
          "function_name": "GetID",
          "container": "CPubKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.h",
          "lines": "80-82",
          "snippet": "CKeyID GetID() const {\n        return CKeyID(Hash160(vchPubKey));\n    }",
          "includes": [
            "#include <openssl/ec.h> // for EC_KEY definition",
            "#include \"util.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\"",
            "#include \"allocators.h\"",
            "#include <vector>",
            "#include <stdexcept>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <openssl/ec.h> // for EC_KEY definition\n#include \"util.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n#include \"allocators.h\"\n#include <vector>\n#include <stdexcept>\n\nCPubKey {\n  CKeyID GetID() const {\n          return CKeyID(Hash160(vchPubKey));\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_WALLET_KEYPOOL_RAN_OUT",
            "\"Error: Keypool ran out, please call keypoolrefill first\""
          ],
          "line": 167
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->GetKeyFromPool",
          "args": [
            "newKey",
            "false"
          ],
          "line": 166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->TopUpKeyPool",
          "args": [],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->IsLocked",
          "args": [],
          "line": 161
        },
        "resolved": true,
        "details": {
          "function_name": "IsLocked",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "134-144",
          "snippet": "bool IsLocked() const\n    {\n        if (!IsCrypted())\n            return false;\n        bool result;\n        {\n            LOCK(cs_KeyStore);\n            result = vMasterKey.empty();\n        }\n        return result;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool IsLocked() const\n      {\n          if (!IsCrypted())\n              return false;\n          bool result;\n          {\n              LOCK(cs_KeyStore);\n              result = vMasterKey.empty();\n          }\n          return result;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "AccountFromValue",
          "args": [
            "params[0]"
          ],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "AccountFromValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "68-74",
          "snippet": "string AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstring AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}"
        }
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 158
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getnewaddress [account]\\n\"\n            \"Returns a new Halcyon address for receiving payments.  \"\n            \"If [account] is specified (recommended), it is added to the address book \"\n            \"so payments received with the address will be credited to [account].\""
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue getnewaddress(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 1)\n        throw runtime_error(\n            \"getnewaddress [account]\\n\"\n            \"Returns a new Halcyon address for receiving payments.  \"\n            \"If [account] is specified (recommended), it is added to the address book \"\n            \"so payments received with the address will be credited to [account].\");\n\n    // Parse the account first so we don't generate a key if there's an error\n    string strAccount;\n    if (params.size() > 0)\n        strAccount = AccountFromValue(params[0]);\n\n    if (!pwalletMain->IsLocked())\n        pwalletMain->TopUpKeyPool();\n\n    // Generate a new key that is added to wallet\n    CPubKey newKey;\n    if (!pwalletMain->GetKeyFromPool(newKey, false))\n        throw JSONRPCError(RPC_WALLET_KEYPOOL_RAN_OUT, \"Error: Keypool ran out, please call keypoolrefill first\");\n    CKeyID keyID = newKey.GetID();\n\n    pwalletMain->SetAddressBookName(keyID, strAccount);\n\n    return CBitcoinAddress(keyID).ToString();\n}"
  },
  {
    "function_name": "getnewpubkey",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "119-144",
    "snippet": "Value getnewpubkey(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 1)\n        throw runtime_error(\n            \"getnewpubkey [account]\\n\"\n            \"Returns new public key for coinbase generation.\");\n\n    // Parse the account first so we don't generate a key if there's an error\n    string strAccount;\n    if (params.size() > 0)\n        strAccount = AccountFromValue(params[0]);\n\n    if (!pwalletMain->IsLocked())\n        pwalletMain->TopUpKeyPool();\n\n    // Generate a new key that is added to wallet\n    CPubKey newKey;\n    if (!pwalletMain->GetKeyFromPool(newKey, false))\n        throw JSONRPCError(RPC_WALLET_KEYPOOL_RAN_OUT, \"Error: Keypool ran out, please call keypoolrefill first\");\n    CKeyID keyID = newKey.GetID();\n\n    pwalletMain->SetAddressBookName(keyID, strAccount);\n    vector<unsigned char> vchPubKey = newKey.Raw();\n\n    return HexStr(vchPubKey.begin(), vchPubKey.end());\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "HexStr",
          "args": [
            "vchPubKey.begin()",
            "vchPubKey.end()"
          ],
          "line": 143
        },
        "resolved": true,
        "details": {
          "function_name": "HexStr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.h",
          "lines": "323-339",
          "snippet": "std::string HexStr(const T itbegin, const T itend, bool fSpaces=false)\n{\n    std::string rv;\n    static const char hexmap[16] = { '0', '1', '2', '3', '4', '5', '6', '7',\n                                     '8', '9', 'a', 'b', 'c', 'd', 'e', 'f' };\n    rv.reserve((itend-itbegin)*3);\n    for(T it = itbegin; it < itend; ++it)\n    {\n        unsigned char val = (unsigned char)(*it);\n        if(fSpaces && it != itbegin)\n            rv.push_back(' ');\n        rv.push_back(hexmap[val>>4]);\n        rv.push_back(hexmap[val&15]);\n    }\n\n    return rv;\n}",
          "includes": [
            "#include <inttypes.h>",
            "#include <stdint.h>",
            "#include \"netbase.h\" // for AddTimeData",
            "#include <openssl/ripemd.h>",
            "#include <openssl/sha.h>",
            "#include <boost/date_time/posix_time/posix_time_types.hpp>",
            "#include <boost/date_time/gregorian/gregorian_types.hpp>",
            "#include <boost/filesystem/path.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/thread.hpp>",
            "#include <string>",
            "#include <vector>",
            "#include <map>",
            "#include <sys/resource.h>",
            "#include <sys/time.h>",
            "#include <sys/types.h>",
            "#include \"uint256.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <inttypes.h>\n#include <stdint.h>\n#include \"netbase.h\" // for AddTimeData\n#include <openssl/ripemd.h>\n#include <openssl/sha.h>\n#include <boost/date_time/posix_time/posix_time_types.hpp>\n#include <boost/date_time/gregorian/gregorian_types.hpp>\n#include <boost/filesystem/path.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/thread.hpp>\n#include <string>\n#include <vector>\n#include <map>\n#include <sys/resource.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include \"uint256.h\"\n\nstd::string HexStr(const T itbegin, const T itend, bool fSpaces=false)\n{\n    std::string rv;\n    static const char hexmap[16] = { '0', '1', '2', '3', '4', '5', '6', '7',\n                                     '8', '9', 'a', 'b', 'c', 'd', 'e', 'f' };\n    rv.reserve((itend-itbegin)*3);\n    for(T it = itbegin; it < itend; ++it)\n    {\n        unsigned char val = (unsigned char)(*it);\n        if(fSpaces && it != itbegin)\n            rv.push_back(' ');\n        rv.push_back(hexmap[val>>4]);\n        rv.push_back(hexmap[val&15]);\n    }\n\n    return rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "vchPubKey.end",
          "args": [],
          "line": 143
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "vchPubKey.begin",
          "args": [],
          "line": 143
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "newKey.Raw",
          "args": [],
          "line": 141
        },
        "resolved": true,
        "details": {
          "function_name": "Raw",
          "container": "CPubKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.h",
          "lines": "96-98",
          "snippet": "std::vector<unsigned char> Raw() const {\n        return vchPubKey;\n    }",
          "includes": [
            "#include <openssl/ec.h> // for EC_KEY definition",
            "#include \"util.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\"",
            "#include \"allocators.h\"",
            "#include <vector>",
            "#include <stdexcept>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <openssl/ec.h> // for EC_KEY definition\n#include \"util.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n#include \"allocators.h\"\n#include <vector>\n#include <stdexcept>\n\nCPubKey {\n  std::vector<unsigned char> Raw() const {\n          return vchPubKey;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->SetAddressBookName",
          "args": [
            "keyID",
            "strAccount"
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "newKey.GetID",
          "args": [],
          "line": 138
        },
        "resolved": true,
        "details": {
          "function_name": "GetID",
          "container": "CPubKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.h",
          "lines": "80-82",
          "snippet": "CKeyID GetID() const {\n        return CKeyID(Hash160(vchPubKey));\n    }",
          "includes": [
            "#include <openssl/ec.h> // for EC_KEY definition",
            "#include \"util.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\"",
            "#include \"allocators.h\"",
            "#include <vector>",
            "#include <stdexcept>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <openssl/ec.h> // for EC_KEY definition\n#include \"util.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n#include \"allocators.h\"\n#include <vector>\n#include <stdexcept>\n\nCPubKey {\n  CKeyID GetID() const {\n          return CKeyID(Hash160(vchPubKey));\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_WALLET_KEYPOOL_RAN_OUT",
            "\"Error: Keypool ran out, please call keypoolrefill first\""
          ],
          "line": 137
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->GetKeyFromPool",
          "args": [
            "newKey",
            "false"
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->TopUpKeyPool",
          "args": [],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->IsLocked",
          "args": [],
          "line": 131
        },
        "resolved": true,
        "details": {
          "function_name": "IsLocked",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "134-144",
          "snippet": "bool IsLocked() const\n    {\n        if (!IsCrypted())\n            return false;\n        bool result;\n        {\n            LOCK(cs_KeyStore);\n            result = vMasterKey.empty();\n        }\n        return result;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool IsLocked() const\n      {\n          if (!IsCrypted())\n              return false;\n          bool result;\n          {\n              LOCK(cs_KeyStore);\n              result = vMasterKey.empty();\n          }\n          return result;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "AccountFromValue",
          "args": [
            "params[0]"
          ],
          "line": 129
        },
        "resolved": true,
        "details": {
          "function_name": "AccountFromValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
          "lines": "68-74",
          "snippet": "string AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ntp.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstring AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}"
        }
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 128
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getnewpubkey [account]\\n\"\n            \"Returns new public key for coinbase generation.\""
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nValue getnewpubkey(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() > 1)\n        throw runtime_error(\n            \"getnewpubkey [account]\\n\"\n            \"Returns new public key for coinbase generation.\");\n\n    // Parse the account first so we don't generate a key if there's an error\n    string strAccount;\n    if (params.size() > 0)\n        strAccount = AccountFromValue(params[0]);\n\n    if (!pwalletMain->IsLocked())\n        pwalletMain->TopUpKeyPool();\n\n    // Generate a new key that is added to wallet\n    CPubKey newKey;\n    if (!pwalletMain->GetKeyFromPool(newKey, false))\n        throw JSONRPCError(RPC_WALLET_KEYPOOL_RAN_OUT, \"Error: Keypool ran out, please call keypoolrefill first\");\n    CKeyID keyID = newKey.GetID();\n\n    pwalletMain->SetAddressBookName(keyID, strAccount);\n    vector<unsigned char> vchPubKey = newKey.Raw();\n\n    return HexStr(vchPubKey.begin(), vchPubKey.end());\n}"
  },
  {
    "function_name": "getinfo",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "76-116",
    "snippet": "Value getinfo(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 0)\n        throw runtime_error(\n            \"getinfo\\n\"\n            \"Returns an object containing various state info.\");\n\n    proxyType proxy;\n    GetProxy(NET_IPV4, proxy);\n\n    Object obj, diff;\n    obj.push_back(Pair(\"version\",       FormatFullVersion()));\n    obj.push_back(Pair(\"protocolversion\",(int)PROTOCOL_VERSION));\n    obj.push_back(Pair(\"walletversion\", pwalletMain->GetVersion()));\n    obj.push_back(Pair(\"balance\",       ValueFromAmount(pwalletMain->GetBalance())));\n    obj.push_back(Pair(\"newmint\",       ValueFromAmount(pwalletMain->GetNewMint())));\n    obj.push_back(Pair(\"stake\",         ValueFromAmount(pwalletMain->GetStake())));\n    obj.push_back(Pair(\"blocks\",        (int)nBestHeight));\n    obj.push_back(Pair(\"moneysupply\",   ValueFromAmount(pindexBest->nMoneySupply)));\n    obj.push_back(Pair(\"connections\",   (int)vNodes.size()));\n    obj.push_back(Pair(\"proxy\",         (proxy.first.IsValid() ? proxy.first.ToStringIPPort() : string())));\n    obj.push_back(Pair(\"ip\",            addrSeenByPeer.ToStringIP()));\n    obj.push_back(Pair(\"systemtime\",    (boost::int64_t)GetTime()));\n    obj.push_back(Pair(\"adjustedtime\",  (boost::int64_t)GetAdjustedTime()));\n    obj.push_back(Pair(\"ntpoffset\",     (boost::int64_t)nNtpOffset != INT64_MAX ? (boost::int64_t)nNtpOffset : Value::null));\n    obj.push_back(Pair(\"p2poffset\",     (boost::int64_t)nPeersOffset != INT64_MAX ? (boost::int64_t)nPeersOffset : Value::null));\n\n    diff.push_back(Pair(\"proof-of-work\",  GetDifficulty()));\n    diff.push_back(Pair(\"proof-of-stake\", GetDifficulty(GetLastBlockIndex(pindexBest, true))));\n    obj.push_back(Pair(\"difficulty\",    diff));\n\n    obj.push_back(Pair(\"testnet\",       fTestNet));\n    obj.push_back(Pair(\"keypoololdest\", (boost::int64_t)pwalletMain->GetOldestKeyPoolTime()));\n    obj.push_back(Pair(\"keypoolsize\",   (int)pwalletMain->GetKeyPoolSize()));\n    obj.push_back(Pair(\"paytxfee\",      ValueFromAmount(nTransactionFee)));\n    obj.push_back(Pair(\"mininput\",      ValueFromAmount(nMinimumInputValue)));\n    if (pwalletMain->IsCrypted())\n        obj.push_back(Pair(\"unlocked_until\", (boost::int64_t)nWalletUnlockTime / 1000));\n    obj.push_back(Pair(\"errors\",        GetWarnings(\"statusbar\")));\n    return obj;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "int64_t nWalletUnlockTime;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"errors\",        GetWarnings(\"statusbar\"))"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"errors\"",
            "GetWarnings(\"statusbar\")"
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "GetWarnings",
          "args": [
            "\"statusbar\""
          ],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "GetWarnings",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
          "lines": "2956-3001",
          "snippet": "string GetWarnings(string strFor)\n{\n    int nPriority = 0;\n    string strStatusBar;\n    string strRPC;\n\n    if (GetBoolArg(\"-testsafemode\"))\n        strRPC = \"test\";\n\n    // Misc warnings like out of disk space and clock is wrong\n    if (strMiscWarning != \"\")\n    {\n        nPriority = 1000;\n        strStatusBar = strMiscWarning;\n    }\n\n    // if detected invalid checkpoint enter safe mode\n    if (Checkpoints::hashInvalidCheckpoint != 0)\n    {\n        nPriority = 3000;\n        strStatusBar = strRPC = _(\"WARNING: Invalid checkpoint found! Displayed transactions may not be correct! You may need to upgrade, or notify developers.\");\n    }\n\n    // Alerts\n    {\n        LOCK(cs_mapAlerts);\n        BOOST_FOREACH(PAIRTYPE(const uint256, CAlert)& item, mapAlerts)\n        {\n            const CAlert& alert = item.second;\n            if (alert.AppliesToMe() && alert.nPriority > nPriority)\n            {\n                nPriority = alert.nPriority;\n                strStatusBar = alert.strStatusBar;\n                if (nPriority > 1000)\n                    strRPC = strStatusBar;\n            }\n        }\n    }\n\n    if (strFor == \"statusbar\")\n        return strStatusBar;\n    else if (strFor == \"rpc\")\n        return strRPC;\n    assert(!\"GetWarnings() : invalid parameter\");\n    return \"error\";\n}",
          "includes": [
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"kernel.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"txdb.h\"",
            "#include \"db.h\"",
            "#include \"checkpoints.h\"",
            "#include \"alert.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "CBigNum bnProofOfWorkLimit(~uint256(0) >> 20);",
            "CBigNum bnProofOfStakeLimit(~uint256(0) >> 20);",
            "const CBigNum bnNeoScryptSwitch(~uint256(0) >> 30);",
            "CBigNum bnProofOfWorkLimitTestNet(~uint256(0) >> 16);",
            "CBigNum bnProofOfStakeLimitTestNet(~uint256(0) >> 16);",
            "extern map<uint256, CAlert> mapAlerts;",
            "extern CCriticalSection cs_mapAlerts;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/algorithm/string/replace.hpp>\n#include \"kernel.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"txdb.h\"\n#include \"db.h\"\n#include \"checkpoints.h\"\n#include \"alert.h\"\n\nCBigNum bnProofOfWorkLimit(~uint256(0) >> 20);\nCBigNum bnProofOfStakeLimit(~uint256(0) >> 20);\nconst CBigNum bnNeoScryptSwitch(~uint256(0) >> 30);\nCBigNum bnProofOfWorkLimitTestNet(~uint256(0) >> 16);\nCBigNum bnProofOfStakeLimitTestNet(~uint256(0) >> 16);\nextern map<uint256, CAlert> mapAlerts;\nextern CCriticalSection cs_mapAlerts;\n\nstring GetWarnings(string strFor)\n{\n    int nPriority = 0;\n    string strStatusBar;\n    string strRPC;\n\n    if (GetBoolArg(\"-testsafemode\"))\n        strRPC = \"test\";\n\n    // Misc warnings like out of disk space and clock is wrong\n    if (strMiscWarning != \"\")\n    {\n        nPriority = 1000;\n        strStatusBar = strMiscWarning;\n    }\n\n    // if detected invalid checkpoint enter safe mode\n    if (Checkpoints::hashInvalidCheckpoint != 0)\n    {\n        nPriority = 3000;\n        strStatusBar = strRPC = _(\"WARNING: Invalid checkpoint found! Displayed transactions may not be correct! You may need to upgrade, or notify developers.\");\n    }\n\n    // Alerts\n    {\n        LOCK(cs_mapAlerts);\n        BOOST_FOREACH(PAIRTYPE(const uint256, CAlert)& item, mapAlerts)\n        {\n            const CAlert& alert = item.second;\n            if (alert.AppliesToMe() && alert.nPriority > nPriority)\n            {\n                nPriority = alert.nPriority;\n                strStatusBar = alert.strStatusBar;\n                if (nPriority > 1000)\n                    strRPC = strStatusBar;\n            }\n        }\n    }\n\n    if (strFor == \"statusbar\")\n        return strStatusBar;\n    else if (strFor == \"rpc\")\n        return strRPC;\n    assert(!\"GetWarnings() : invalid parameter\");\n    return \"error\";\n}"
        }
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"unlocked_until\", (boost::int64_t)nWalletUnlockTime / 1000)"
          ],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->IsCrypted",
          "args": [],
          "line": 112
        },
        "resolved": true,
        "details": {
          "function_name": "IsCrypted",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "129-132",
          "snippet": "bool IsCrypted() const\n    {\n        return fUseCrypto;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool IsCrypted() const\n      {\n          return fUseCrypto;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"mininput\",      ValueFromAmount(nMinimumInputValue))"
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ValueFromAmount",
          "args": [
            "nMinimumInputValue"
          ],
          "line": 111
        },
        "resolved": true,
        "details": {
          "function_name": "ValueFromAmount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "113-116",
          "snippet": "Value ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nValue ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}"
        }
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"paytxfee\",      ValueFromAmount(nTransactionFee))"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"keypoolsize\",   (int)pwalletMain->GetKeyPoolSize())"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->GetKeyPoolSize",
          "args": [],
          "line": 109
        },
        "resolved": true,
        "details": {
          "function_name": "GetKeyPoolSize",
          "container": "CWallet",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.h",
          "lines": "296-299",
          "snippet": "unsigned int GetKeyPoolSize()\n    {\n        return setKeyPool.size();\n    }",
          "includes": [
            "#include \"walletdb.h\"",
            "#include \"util.h\"",
            "#include \"ui_interface.h\"",
            "#include \"script.h\"",
            "#include \"keystore.h\"",
            "#include \"key.h\"",
            "#include \"main.h\"",
            "#include <stdlib.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"walletdb.h\"\n#include \"util.h\"\n#include \"ui_interface.h\"\n#include \"script.h\"\n#include \"keystore.h\"\n#include \"key.h\"\n#include \"main.h\"\n#include <stdlib.h>\n#include <vector>\n#include <string>\n\nCWallet {\n  unsigned int GetKeyPoolSize()\n      {\n          return setKeyPool.size();\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"keypoololdest\", (boost::int64_t)pwalletMain->GetOldestKeyPoolTime())"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->GetOldestKeyPoolTime",
          "args": [],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"testnet\",       fTestNet)"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"difficulty\",    diff)"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "diff.push_back",
          "args": [
            "Pair(\"proof-of-stake\", GetDifficulty(GetLastBlockIndex(pindexBest, true)))"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetDifficulty",
          "args": [
            "GetLastBlockIndex(pindexBest, true)"
          ],
          "line": 104
        },
        "resolved": true,
        "details": {
          "function_name": "GetDifficulty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
          "lines": "15-44",
          "snippet": "double GetDifficulty(const CBlockIndex* blockindex)\n{\n    // Floating point number that is a multiple of the minimum difficulty,\n    // minimum difficulty = 1.0.\n    if (blockindex == NULL)\n    {\n        if (pindexBest == NULL)\n            return 1.0;\n        else\n            blockindex = GetLastBlockIndex(pindexBest, false);\n    }\n\n    int nShift = (blockindex->nBits >> 24) & 0xff;\n\n    double dDiff =\n        (double)0x0000ffff / (double)(blockindex->nBits & 0x00ffffff);\n\n    while (nShift < 29)\n    {\n        dDiff *= 256.0;\n        nShift++;\n    }\n    while (nShift > 29)\n    {\n        dDiff /= 256.0;\n        nShift--;\n    }\n\n    return dDiff;\n}",
          "includes": [
            "#include \"bitcoinrpc.h\"",
            "#include \"main.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\ndouble GetDifficulty(const CBlockIndex* blockindex)\n{\n    // Floating point number that is a multiple of the minimum difficulty,\n    // minimum difficulty = 1.0.\n    if (blockindex == NULL)\n    {\n        if (pindexBest == NULL)\n            return 1.0;\n        else\n            blockindex = GetLastBlockIndex(pindexBest, false);\n    }\n\n    int nShift = (blockindex->nBits >> 24) & 0xff;\n\n    double dDiff =\n        (double)0x0000ffff / (double)(blockindex->nBits & 0x00ffffff);\n\n    while (nShift < 29)\n    {\n        dDiff *= 256.0;\n        nShift++;\n    }\n    while (nShift > 29)\n    {\n        dDiff /= 256.0;\n        nShift--;\n    }\n\n    return dDiff;\n}"
        }
      },
      {
        "call_info": {
          "callee": "GetLastBlockIndex",
          "args": [
            "pindexBest",
            "true"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "diff.push_back",
          "args": [
            "Pair(\"proof-of-work\",  GetDifficulty())"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetDifficulty",
          "args": [],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"p2poffset\",     (boost::int64_t)nPeersOffset != INT64_MAX ? (boost::int64_t)nPeersOffset : Value::null)"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"ntpoffset\",     (boost::int64_t)nNtpOffset != INT64_MAX ? (boost::int64_t)nNtpOffset : Value::null)"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"adjustedtime\",  (boost::int64_t)GetAdjustedTime())"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetAdjustedTime",
          "args": [],
          "line": 99
        },
        "resolved": true,
        "details": {
          "function_name": "GetAdjustedTime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "1201-1214",
          "snippet": "int64_t GetAdjustedTime() {\n\n    int64 nTime = GetTime();\n\n     /* If the NTP and system time are within half an hour, follow the former */\n    if(abs64(nNtpOffset) < 30 * 60)\n      return(nTime + nNtpOffset);\n\n     /* If the median peer time and system time are within 1 hour, follow the former */\n    if(abs64(nPeersOffset) < 60 * 60)\n      return(nTime + nPeersOffset);\n\n     return(nTime);\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "extern int64 nNtpOffset;",
            "int64 nPeersOffset = INT64_MAX;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nextern int64 nNtpOffset;\nint64 nPeersOffset = INT64_MAX;\n\nint64_t GetAdjustedTime() {\n\n    int64 nTime = GetTime();\n\n     /* If the NTP and system time are within half an hour, follow the former */\n    if(abs64(nNtpOffset) < 30 * 60)\n      return(nTime + nNtpOffset);\n\n     /* If the median peer time and system time are within 1 hour, follow the former */\n    if(abs64(nPeersOffset) < 60 * 60)\n      return(nTime + nPeersOffset);\n\n     return(nTime);\n}"
        }
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"systemtime\",    (boost::int64_t)GetTime())"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetTime",
          "args": [],
          "line": 98
        },
        "resolved": true,
        "details": {
          "function_name": "GetTimeMillis",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.h",
          "lines": "370-374",
          "snippet": "inline int64_t GetTimeMillis()\n{\n    return (boost::posix_time::ptime(boost::posix_time::microsec_clock::universal_time()) -\n            boost::posix_time::ptime(boost::gregorian::date(1970,1,1))).total_milliseconds();\n}",
          "includes": [
            "#include <inttypes.h>",
            "#include <stdint.h>",
            "#include \"netbase.h\" // for AddTimeData",
            "#include <openssl/ripemd.h>",
            "#include <openssl/sha.h>",
            "#include <boost/date_time/posix_time/posix_time_types.hpp>",
            "#include <boost/date_time/gregorian/gregorian_types.hpp>",
            "#include <boost/filesystem/path.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/thread.hpp>",
            "#include <string>",
            "#include <vector>",
            "#include <map>",
            "#include <sys/resource.h>",
            "#include <sys/time.h>",
            "#include <sys/types.h>",
            "#include \"uint256.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <inttypes.h>\n#include <stdint.h>\n#include \"netbase.h\" // for AddTimeData\n#include <openssl/ripemd.h>\n#include <openssl/sha.h>\n#include <boost/date_time/posix_time/posix_time_types.hpp>\n#include <boost/date_time/gregorian/gregorian_types.hpp>\n#include <boost/filesystem/path.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/thread.hpp>\n#include <string>\n#include <vector>\n#include <map>\n#include <sys/resource.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include \"uint256.h\"\n\ninline int64_t GetTimeMillis()\n{\n    return (boost::posix_time::ptime(boost::posix_time::microsec_clock::universal_time()) -\n            boost::posix_time::ptime(boost::gregorian::date(1970,1,1))).total_milliseconds();\n}"
        }
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"ip\",            addrSeenByPeer.ToStringIP())"
          ],
          "line": 97
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "addrSeenByPeer.ToStringIP",
          "args": [],
          "line": 97
        },
        "resolved": true,
        "details": {
          "function_name": "ToStringIP",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "783-809",
          "snippet": "std::string CNetAddr::ToStringIP() const\n{\n    if (IsTor())\n        return EncodeBase32(&ip[6], 10) + \".onion\";\n    if (IsI2P())\n        return EncodeBase32(&ip[6], 10) + \".oc.b32.i2p\";\n    CService serv(*this, 0);\n#ifdef USE_IPV6\n    struct sockaddr_storage sockaddr;\n#else\n    struct sockaddr sockaddr;\n#endif\n    socklen_t socklen = sizeof(sockaddr);\n    if (serv.GetSockAddr((struct sockaddr*)&sockaddr, &socklen)) {\n        char name[1025] = \"\";\n        if (!getnameinfo((const struct sockaddr*)&sockaddr, socklen, name, sizeof(name), NULL, 0, NI_NUMERICHOST))\n            return std::string(name);\n    }\n    if (IsIPv4())\n        return strprintf(\"%u.%u.%u.%u\", GetByte(3), GetByte(2), GetByte(1), GetByte(0));\n    else\n        return strprintf(\"%x:%x:%x:%x:%x:%x:%x:%x\",\n                         GetByte(15) << 8 | GetByte(14), GetByte(13) << 8 | GetByte(12),\n                         GetByte(11) << 8 | GetByte(10), GetByte(9) << 8 | GetByte(8),\n                         GetByte(7) << 8 | GetByte(6), GetByte(5) << 8 | GetByte(4),\n                         GetByte(3) << 8 | GetByte(2), GetByte(1) << 8 | GetByte(0));\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCNetAddr {\n  std::string CNetAddr::ToStringIP() const\n  {\n      if (IsTor())\n          return EncodeBase32(&ip[6], 10) + \".onion\";\n      if (IsI2P())\n          return EncodeBase32(&ip[6], 10) + \".oc.b32.i2p\";\n      CService serv(*this, 0);\n  #ifdef USE_IPV6\n      struct sockaddr_storage sockaddr;\n  #else\n      struct sockaddr sockaddr;\n  #endif\n      socklen_t socklen = sizeof(sockaddr);\n      if (serv.GetSockAddr((struct sockaddr*)&sockaddr, &socklen)) {\n          char name[1025] = \"\";\n          if (!getnameinfo((const struct sockaddr*)&sockaddr, socklen, name, sizeof(name), NULL, 0, NI_NUMERICHOST))\n              return std::string(name);\n      }\n      if (IsIPv4())\n          return strprintf(\"%u.%u.%u.%u\", GetByte(3), GetByte(2), GetByte(1), GetByte(0));\n      else\n          return strprintf(\"%x:%x:%x:%x:%x:%x:%x:%x\",\n                           GetByte(15) << 8 | GetByte(14), GetByte(13) << 8 | GetByte(12),\n                           GetByte(11) << 8 | GetByte(10), GetByte(9) << 8 | GetByte(8),\n                           GetByte(7) << 8 | GetByte(6), GetByte(5) << 8 | GetByte(4),\n                           GetByte(3) << 8 | GetByte(2), GetByte(1) << 8 | GetByte(0));\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"proxy\",         (proxy.first.IsValid() ? proxy.first.ToStringIPPort() : string()))"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "string",
          "args": [],
          "line": 96
        },
        "resolved": true,
        "details": {
          "function_name": "peer_address_to_string",
          "container": "AcceptedConnectionImpl",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "659-662",
          "snippet": "virtual std::string peer_address_to_string() const\n    {\n        return peer.address().to_string();\n    }",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nAcceptedConnectionImpl {\n  virtual std::string peer_address_to_string() const\n      {\n          return peer.address().to_string();\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "proxy.first.ToStringIPPort",
          "args": [],
          "line": 96
        },
        "resolved": true,
        "details": {
          "function_name": "ToStringIPPort",
          "container": "CService",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "1163-1170",
          "snippet": "std::string CService::ToStringIPPort() const\n{\n    if (IsIPv4() || IsTor() || IsI2P()) {\n        return ToStringIP() + \":\" + ToStringPort();\n    } else {\n        return \"[\" + ToStringIP() + \"]:\" + ToStringPort();\n    }\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCService {\n  std::string CService::ToStringIPPort() const\n  {\n      if (IsIPv4() || IsTor() || IsI2P()) {\n          return ToStringIP() + \":\" + ToStringPort();\n      } else {\n          return \"[\" + ToStringIP() + \"]:\" + ToStringPort();\n      }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "proxy.first.IsValid",
          "args": [],
          "line": 96
        },
        "resolved": true,
        "details": {
          "function_name": "IsValid",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "725-759",
          "snippet": "bool CNetAddr::IsValid() const\n{\n    // Cleanup 3-byte shifted addresses caused by garbage in size field\n    // of addr messages from versions before 0.2.9 checksum.\n    // Two consecutive addr messages look like this:\n    // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n    // so if the first length field is garbled, it reads the second batch\n    // of addr misaligned by 3 bytes.\n    if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n        return false;\n\n    // unspecified IPv6 address (::/128)\n    unsigned char ipNone[16] = {};\n    if (memcmp(ip, ipNone, 16) == 0)\n        return false;\n\n    // documentation IPv6 address\n    if (IsRFC3849())\n        return false;\n\n    if (IsIPv4())\n    {\n        // INADDR_NONE\n        uint32_t ipNone = INADDR_NONE;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n\n        // 0\n        ipNone = 0;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n    }\n\n    return true;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nstatic const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };\n\nCNetAddr {\n  bool CNetAddr::IsValid() const\n  {\n      // Cleanup 3-byte shifted addresses caused by garbage in size field\n      // of addr messages from versions before 0.2.9 checksum.\n      // Two consecutive addr messages look like this:\n      // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n      // so if the first length field is garbled, it reads the second batch\n      // of addr misaligned by 3 bytes.\n      if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n          return false;\n  \n      // unspecified IPv6 address (::/128)\n      unsigned char ipNone[16] = {};\n      if (memcmp(ip, ipNone, 16) == 0)\n          return false;\n  \n      // documentation IPv6 address\n      if (IsRFC3849())\n          return false;\n  \n      if (IsIPv4())\n      {\n          // INADDR_NONE\n          uint32_t ipNone = INADDR_NONE;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n  \n          // 0\n          ipNone = 0;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n      }\n  \n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"connections\",   (int)vNodes.size())"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vNodes.size",
          "args": [],
          "line": 95
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"moneysupply\",   ValueFromAmount(pindexBest->nMoneySupply))"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"blocks\",        (int)nBestHeight)"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"stake\",         ValueFromAmount(pwalletMain->GetStake()))"
          ],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->GetStake",
          "args": [],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"newmint\",       ValueFromAmount(pwalletMain->GetNewMint()))"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->GetNewMint",
          "args": [],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"balance\",       ValueFromAmount(pwalletMain->GetBalance()))"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->GetBalance",
          "args": [],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"walletversion\", pwalletMain->GetVersion())"
          ],
          "line": 89
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pwalletMain->GetVersion",
          "args": [],
          "line": 89
        },
        "resolved": true,
        "details": {
          "function_name": "GetVersion",
          "container": "CWallet",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.h",
          "lines": "312-312",
          "snippet": "int GetVersion() { return nWalletVersion; }",
          "includes": [
            "#include \"walletdb.h\"",
            "#include \"util.h\"",
            "#include \"ui_interface.h\"",
            "#include \"script.h\"",
            "#include \"keystore.h\"",
            "#include \"key.h\"",
            "#include \"main.h\"",
            "#include <stdlib.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"walletdb.h\"\n#include \"util.h\"\n#include \"ui_interface.h\"\n#include \"script.h\"\n#include \"keystore.h\"\n#include \"key.h\"\n#include \"main.h\"\n#include <stdlib.h>\n#include <vector>\n#include <string>\n\nCWallet {\n  int GetVersion() { return nWalletVersion; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"protocolversion\",(int)PROTOCOL_VERSION)"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"version\",       FormatFullVersion())"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FormatFullVersion",
          "args": [],
          "line": 87
        },
        "resolved": true,
        "details": {
          "function_name": "FormatFullVersion",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "1288-1291",
          "snippet": "string FormatFullVersion()\n{\n    return CLIENT_BUILD;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nstring FormatFullVersion()\n{\n    return CLIENT_BUILD;\n}"
        }
      },
      {
        "call_info": {
          "callee": "GetProxy",
          "args": [
            "NET_IPV4",
            "proxy"
          ],
          "line": 84
        },
        "resolved": true,
        "details": {
          "function_name": "GetProxy",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "443-450",
          "snippet": "bool GetProxy(enum Network net, proxyType &proxyInfoOut) {\n    assert(net >= 0 && net < NET_MAX);\n    LOCK(cs_proxyInfos);\n    if (!proxyInfo[net].second)\n        return false;\n    proxyInfoOut = proxyInfo[net];\n    return true;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static proxyType proxyInfo[NET_MAX];",
            "static CCriticalSection cs_proxyInfos;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nstatic proxyType proxyInfo[NET_MAX];\nstatic CCriticalSection cs_proxyInfos;\n\nbool GetProxy(enum Network net, proxyType &proxyInfoOut) {\n    assert(net >= 0 && net < NET_MAX);\n    LOCK(cs_proxyInfos);\n    if (!proxyInfo[net].second)\n        return false;\n    proxyInfoOut = proxyInfo[net];\n    return true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getinfo\\n\"\n            \"Returns an object containing various state info.\""
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nint64_t nWalletUnlockTime;\n\nValue getinfo(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 0)\n        throw runtime_error(\n            \"getinfo\\n\"\n            \"Returns an object containing various state info.\");\n\n    proxyType proxy;\n    GetProxy(NET_IPV4, proxy);\n\n    Object obj, diff;\n    obj.push_back(Pair(\"version\",       FormatFullVersion()));\n    obj.push_back(Pair(\"protocolversion\",(int)PROTOCOL_VERSION));\n    obj.push_back(Pair(\"walletversion\", pwalletMain->GetVersion()));\n    obj.push_back(Pair(\"balance\",       ValueFromAmount(pwalletMain->GetBalance())));\n    obj.push_back(Pair(\"newmint\",       ValueFromAmount(pwalletMain->GetNewMint())));\n    obj.push_back(Pair(\"stake\",         ValueFromAmount(pwalletMain->GetStake())));\n    obj.push_back(Pair(\"blocks\",        (int)nBestHeight));\n    obj.push_back(Pair(\"moneysupply\",   ValueFromAmount(pindexBest->nMoneySupply)));\n    obj.push_back(Pair(\"connections\",   (int)vNodes.size()));\n    obj.push_back(Pair(\"proxy\",         (proxy.first.IsValid() ? proxy.first.ToStringIPPort() : string())));\n    obj.push_back(Pair(\"ip\",            addrSeenByPeer.ToStringIP()));\n    obj.push_back(Pair(\"systemtime\",    (boost::int64_t)GetTime()));\n    obj.push_back(Pair(\"adjustedtime\",  (boost::int64_t)GetAdjustedTime()));\n    obj.push_back(Pair(\"ntpoffset\",     (boost::int64_t)nNtpOffset != INT64_MAX ? (boost::int64_t)nNtpOffset : Value::null));\n    obj.push_back(Pair(\"p2poffset\",     (boost::int64_t)nPeersOffset != INT64_MAX ? (boost::int64_t)nPeersOffset : Value::null));\n\n    diff.push_back(Pair(\"proof-of-work\",  GetDifficulty()));\n    diff.push_back(Pair(\"proof-of-stake\", GetDifficulty(GetLastBlockIndex(pindexBest, true))));\n    obj.push_back(Pair(\"difficulty\",    diff));\n\n    obj.push_back(Pair(\"testnet\",       fTestNet));\n    obj.push_back(Pair(\"keypoololdest\", (boost::int64_t)pwalletMain->GetOldestKeyPoolTime()));\n    obj.push_back(Pair(\"keypoolsize\",   (int)pwalletMain->GetKeyPoolSize()));\n    obj.push_back(Pair(\"paytxfee\",      ValueFromAmount(nTransactionFee)));\n    obj.push_back(Pair(\"mininput\",      ValueFromAmount(nMinimumInputValue)));\n    if (pwalletMain->IsCrypted())\n        obj.push_back(Pair(\"unlocked_until\", (boost::int64_t)nWalletUnlockTime / 1000));\n    obj.push_back(Pair(\"errors\",        GetWarnings(\"statusbar\")));\n    return obj;\n}"
  },
  {
    "function_name": "AccountFromValue",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "68-74",
    "snippet": "string AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_WALLET_INVALID_ACCOUNT_NAME",
            "\"Invalid account name\""
          ],
          "line": 72
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "value.get_str",
          "args": [],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstring AccountFromValue(const Value& value)\n{\n    string strAccount = value.get_str();\n    if (strAccount == \"*\")\n        throw JSONRPCError(RPC_WALLET_INVALID_ACCOUNT_NAME, \"Invalid account name\");\n    return strAccount;\n}"
  },
  {
    "function_name": "WalletTxToJSON",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "49-66",
    "snippet": "void WalletTxToJSON(const CWalletTx& wtx, Object& entry)\n{\n    int confirms = wtx.GetDepthInMainChain();\n    entry.push_back(Pair(\"confirmations\", confirms));\n    if (wtx.IsCoinBase() || wtx.IsCoinStake())\n        entry.push_back(Pair(\"generated\", true));\n    if (confirms > 0)\n    {\n        entry.push_back(Pair(\"blockhash\", wtx.hashBlock.GetHex()));\n        entry.push_back(Pair(\"blockindex\", wtx.nIndex));\n        entry.push_back(Pair(\"blocktime\", (boost::int64_t)(mapBlockIndex[wtx.hashBlock]->nTime)));\n    }\n    entry.push_back(Pair(\"txid\", wtx.GetHash().GetHex()));\n    entry.push_back(Pair(\"time\", (boost::int64_t)wtx.GetTxTime()));\n    entry.push_back(Pair(\"timereceived\", (boost::int64_t)wtx.nTimeReceived));\n    BOOST_FOREACH(const PAIRTYPE(string,string)& item, wtx.mapValue)\n        entry.push_back(Pair(item.first, item.second));\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "extern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(item.first, item.second)"
          ],
          "line": 65
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "item.first",
            "item.second"
          ],
          "line": 65
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"timereceived\", (boost::int64_t)wtx.nTimeReceived)"
          ],
          "line": 63
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"time\", (boost::int64_t)wtx.GetTxTime())"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wtx.GetTxTime",
          "args": [],
          "line": 62
        },
        "resolved": true,
        "details": {
          "function_name": "GetTxTime",
          "container": "CWalletTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.cpp",
          "lines": "633-637",
          "snippet": "int64_t CWalletTx::GetTxTime() const\n{\n    int64_t n = nTimeSmart;\n    return n ? n : nTimeReceived;\n}",
          "includes": [
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"coincontrol.h\"",
            "#include \"kernel.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"crypter.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\"",
            "#include \"txdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/replace.hpp>\n#include \"coincontrol.h\"\n#include \"kernel.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"crypter.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n#include \"txdb.h\"\n\nCWalletTx {\n  int64_t CWalletTx::GetTxTime() const\n  {\n      int64_t n = nTimeSmart;\n      return n ? n : nTimeReceived;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"txid\", wtx.GetHash().GetHex())"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wtx.GetHash",
          "args": [],
          "line": 61
        },
        "resolved": true,
        "details": {
          "function_name": "GetHash",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "922-928",
          "snippet": "uint64_t CNetAddr::GetHash() const\n{\n    uint256 hash = Hash(&ip[0], &ip[16]);\n    uint64_t nRet;\n    memcpy(&nRet, &hash, sizeof(nRet));\n    return nRet;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCNetAddr {\n  uint64_t CNetAddr::GetHash() const\n  {\n      uint256 hash = Hash(&ip[0], &ip[16]);\n      uint64_t nRet;\n      memcpy(&nRet, &hash, sizeof(nRet));\n      return nRet;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"blocktime\", (boost::int64_t)(mapBlockIndex[wtx.hashBlock]->nTime))"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"blockindex\", wtx.nIndex)"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"blockhash\", wtx.hashBlock.GetHex())"
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wtx.hashBlock.GetHex",
          "args": [],
          "line": 57
        },
        "resolved": true,
        "details": {
          "function_name": "GetHex",
          "container": "CBigNum",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bignum.h",
          "lines": "402-405",
          "snippet": "std::string GetHex() const\n    {\n        return ToString(16);\n    }",
          "includes": [
            "#include <stdint.h>",
            "#include <vector>",
            "#include <stdexcept>",
            "#include <openssl/bn.h>",
            "#include \"version.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdint.h>\n#include <vector>\n#include <stdexcept>\n#include <openssl/bn.h>\n#include \"version.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n\nCBigNum {\n  std::string GetHex() const\n      {\n          return ToString(16);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"generated\", true)"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wtx.IsCoinStake",
          "args": [],
          "line": 53
        },
        "resolved": true,
        "details": {
          "function_name": "IsCoinStake",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "542-546",
          "snippet": "bool IsCoinStake() const\n    {\n        // ppcoin: the coin stake transaction is marked with the first output empty\n        return (vin.size() > 0 && (!vin[0].prevout.IsNull()) && vout.size() >= 2 && vout[0].IsEmpty());\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  bool IsCoinStake() const\n      {\n          // ppcoin: the coin stake transaction is marked with the first output empty\n          return (vin.size() > 0 && (!vin[0].prevout.IsNull()) && vout.size() >= 2 && vout[0].IsEmpty());\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.IsCoinBase",
          "args": [],
          "line": 53
        },
        "resolved": true,
        "details": {
          "function_name": "IsCoinBase",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "537-540",
          "snippet": "bool IsCoinBase() const\n    {\n        return (vin.size() == 1 && vin[0].prevout.IsNull() && vout.size() >= 1);\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  bool IsCoinBase() const\n      {\n          return (vin.size() == 1 && vin[0].prevout.IsNull() && vout.size() >= 1);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"confirmations\", confirms)"
          ],
          "line": 52
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wtx.GetDepthInMainChain",
          "args": [],
          "line": 51
        },
        "resolved": true,
        "details": {
          "function_name": "GetDepthInMainChain",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "765-765",
          "snippet": "int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCMerkleTx {\n  int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nextern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);\n\nvoid WalletTxToJSON(const CWalletTx& wtx, Object& entry)\n{\n    int confirms = wtx.GetDepthInMainChain();\n    entry.push_back(Pair(\"confirmations\", confirms));\n    if (wtx.IsCoinBase() || wtx.IsCoinStake())\n        entry.push_back(Pair(\"generated\", true));\n    if (confirms > 0)\n    {\n        entry.push_back(Pair(\"blockhash\", wtx.hashBlock.GetHex()));\n        entry.push_back(Pair(\"blockindex\", wtx.nIndex));\n        entry.push_back(Pair(\"blocktime\", (boost::int64_t)(mapBlockIndex[wtx.hashBlock]->nTime)));\n    }\n    entry.push_back(Pair(\"txid\", wtx.GetHash().GetHex()));\n    entry.push_back(Pair(\"time\", (boost::int64_t)wtx.GetTxTime()));\n    entry.push_back(Pair(\"timereceived\", (boost::int64_t)wtx.nTimeReceived));\n    BOOST_FOREACH(const PAIRTYPE(string,string)& item, wtx.mapValue)\n        entry.push_back(Pair(item.first, item.second));\n}"
  },
  {
    "function_name": "EnsureWalletIsUnlocked",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "41-47",
    "snippet": "void EnsureWalletIsUnlocked()\n{\n    if (pwalletMain->IsLocked())\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Please enter the wallet passphrase with walletpassphrase first.\");\n    if (fWalletUnlockStakingOnly)\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Wallet is unlocked for staking only.\");\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_WALLET_UNLOCK_NEEDED",
            "\"Error: Wallet is unlocked for staking only.\""
          ],
          "line": 46
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pwalletMain->IsLocked",
          "args": [],
          "line": 43
        },
        "resolved": true,
        "details": {
          "function_name": "IsLocked",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "134-144",
          "snippet": "bool IsLocked() const\n    {\n        if (!IsCrypted())\n            return false;\n        bool result;\n        {\n            LOCK(cs_KeyStore);\n            result = vMasterKey.empty();\n        }\n        return result;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool IsLocked() const\n      {\n          if (!IsCrypted())\n              return false;\n          bool result;\n          {\n              LOCK(cs_KeyStore);\n              result = vMasterKey.empty();\n          }\n          return result;\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nvoid EnsureWalletIsUnlocked()\n{\n    if (pwalletMain->IsLocked())\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Please enter the wallet passphrase with walletpassphrase first.\");\n    if (fWalletUnlockStakingOnly)\n        throw JSONRPCError(RPC_WALLET_UNLOCK_NEEDED, \"Error: Wallet is unlocked for staking only.\");\n}"
  },
  {
    "function_name": "HelpRequiringPassphrase",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "34-39",
    "snippet": "std::string HelpRequiringPassphrase()\n{\n    return pwalletMain->IsCrypted()\n        ? \"\\nrequires wallet passphrase to be set with walletpassphrase first\"\n        : \"\";\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pwalletMain->IsCrypted",
          "args": [],
          "line": 36
        },
        "resolved": true,
        "details": {
          "function_name": "IsCrypted",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "129-132",
          "snippet": "bool IsCrypted() const\n    {\n        return fUseCrypto;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool IsCrypted() const\n      {\n          return fUseCrypto;\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstd::string HelpRequiringPassphrase()\n{\n    return pwalletMain->IsCrypted()\n        ? \"\\nrequires wallet passphrase to be set with walletpassphrase first\"\n        : \"\";\n}"
  },
  {
    "function_name": "accountingDeprecationCheck",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcwallet.cpp",
    "lines": "22-32",
    "snippet": "static void accountingDeprecationCheck()\n{\n    if (!GetBoolArg(\"-enableaccounts\", false))\n        throw runtime_error(\n            \"Accounting API is deprecated and will be removed in future.\\n\"\n            \"It can easily result in negative or odd balances if misused or misunderstood, which has happened in the field.\\n\"\n            \"If you still want to enable it, add to your config file enableaccounts=1\\n\");\n\n    if (GetBoolArg(\"-staking\", true))\n        throw runtime_error(\"If you want to use accounting API, staking must be disabled, add to your config file staking=0\\n\");\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ntp.h\"",
      "#include \"util.h\"",
      "#include \"init.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"walletdb.h\"",
      "#include \"wallet.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"If you want to use accounting API, staking must be disabled, add to your config file staking=0\\n\""
          ],
          "line": 31
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetBoolArg",
          "args": [
            "\"-staking\"",
            "true"
          ],
          "line": 30
        },
        "resolved": true,
        "details": {
          "function_name": "GetBoolArg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "569-578",
          "snippet": "bool GetBoolArg(const std::string& strArg, bool fDefault)\n{\n    if (mapArgs.count(strArg))\n    {\n        if (mapArgs[strArg].empty())\n            return true;\n        return (atoi(mapArgs[strArg]) != 0);\n    }\n    return fDefault;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "map<string, string> mapArgs;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nmap<string, string> mapArgs;\n\nbool GetBoolArg(const std::string& strArg, bool fDefault)\n{\n    if (mapArgs.count(strArg))\n    {\n        if (mapArgs[strArg].empty())\n            return true;\n        return (atoi(mapArgs[strArg]) != 0);\n    }\n    return fDefault;\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"Accounting API is deprecated and will be removed in future.\\n\"\n            \"It can easily result in negative or odd balances if misused or misunderstood, which has happened in the field.\\n\"\n            \"If you still want to enable it, add to your config file enableaccounts=1\\n\""
          ],
          "line": 25
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ntp.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n\nstatic void accountingDeprecationCheck()\n{\n    if (!GetBoolArg(\"-enableaccounts\", false))\n        throw runtime_error(\n            \"Accounting API is deprecated and will be removed in future.\\n\"\n            \"It can easily result in negative or odd balances if misused or misunderstood, which has happened in the field.\\n\"\n            \"If you still want to enable it, add to your config file enableaccounts=1\\n\");\n\n    if (GetBoolArg(\"-staking\", true))\n        throw runtime_error(\"If you want to use accounting API, staking must be disabled, add to your config file staking=0\\n\");\n}"
  }
]