[
  {
    "function_name": "ntptime",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcnet.cpp",
    "lines": "174-223",
    "snippet": "Value ntptime(const Array &params, bool fHelp) {\n    int64 nTime;\n    CNetAddr ip;\n\n     if(fHelp || (params.size() > 1))\n      throw(runtime_error(\n        \"ntptime [server]\\n\"\n        \"Returns current time from a specific or random NTP server.\"));\n\n     if(params.size() > 0) {\n        nTime = NtpGetTime(params[0].get_str());\n    } else {\n        nTime = NtpGetTime(ip);\n    }\n\n    Object obj;\n    switch(nTime) {\n\n         case(-1):\n            throw(runtime_error(\"Socket init error\"));\n\n         case(-2):\n            throw(runtime_error(\"Non-blocking socket mode failed\"));\n\n         case(-3):\n            throw(runtime_error(\"Unable to send data\"));\n\n         case(-4):\n            throw(runtime_error(\"Receive timed out\"));\n\n         default:\n            if((nTime > 0) && (nTime != 2085978496)) {\n                /* Update the offset */\n                nNtpOffset = nTime - GetTime();\n                /* Remove the warning if back to normal */\n                if(fNtpWarning && (abs64(nNtpOffset) <= 5 * 60)) {\n                    strMiscWarning.clear();\n                    fNtpWarning = false;\n                }\n                /* Push data into the object */\n                if(ip.IsValid()) obj.push_back(Pair(\"server\", ip.ToStringIP().c_str()));\n                obj.push_back(Pair(\"time\", DateTimeStrFormat(nTime)));\n                obj.push_back(Pair(\"sample\", (boost::int64_t)nTime));\n                obj.push_back(Pair(\"offset\", (boost::int64_t)nNtpOffset));\n        } else throw(runtime_error(\"Unknown response\"));\n\n     }\n\n     return(obj);\n}",
    "includes": [
      "#include \"walletdb.h\"",
      "#include \"db.h\"",
      "#include \"wallet.h\"",
      "#include \"alert.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"ntp.h\"",
      "#include \"net.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"Unknown response\""
          ],
          "line": 218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"offset\", (boost::int64_t)nNtpOffset)"
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"offset\"",
            "(boost::int64_t)nNtpOffset"
          ],
          "line": 217
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"sample\", (boost::int64_t)nTime)"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"time\", DateTimeStrFormat(nTime))"
          ],
          "line": 215
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DateTimeStrFormat",
          "args": [
            "nTime"
          ],
          "line": 215
        },
        "resolved": true,
        "details": {
          "function_name": "DateTimeStrFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.h",
          "lines": "386-389",
          "snippet": "inline std::string DateTimeStrFormat(int64_t nTime)\n{\n    return DateTimeStrFormat(strTimestampFormat.c_str(), nTime);\n}",
          "includes": [
            "#include <inttypes.h>",
            "#include <stdint.h>",
            "#include \"netbase.h\" // for AddTimeData",
            "#include <openssl/ripemd.h>",
            "#include <openssl/sha.h>",
            "#include <boost/date_time/posix_time/posix_time_types.hpp>",
            "#include <boost/date_time/gregorian/gregorian_types.hpp>",
            "#include <boost/filesystem/path.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/thread.hpp>",
            "#include <string>",
            "#include <vector>",
            "#include <map>",
            "#include <sys/resource.h>",
            "#include <sys/time.h>",
            "#include <sys/types.h>",
            "#include \"uint256.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <inttypes.h>\n#include <stdint.h>\n#include \"netbase.h\" // for AddTimeData\n#include <openssl/ripemd.h>\n#include <openssl/sha.h>\n#include <boost/date_time/posix_time/posix_time_types.hpp>\n#include <boost/date_time/gregorian/gregorian_types.hpp>\n#include <boost/filesystem/path.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/thread.hpp>\n#include <string>\n#include <vector>\n#include <map>\n#include <sys/resource.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include \"uint256.h\"\n\ninline std::string DateTimeStrFormat(int64_t nTime)\n{\n    return DateTimeStrFormat(strTimestampFormat.c_str(), nTime);\n}"
        }
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"server\", ip.ToStringIP().c_str())"
          ],
          "line": 214
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ip.ToStringIP",
          "args": [],
          "line": 214
        },
        "resolved": true,
        "details": {
          "function_name": "ToStringIP",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "783-809",
          "snippet": "std::string CNetAddr::ToStringIP() const\n{\n    if (IsTor())\n        return EncodeBase32(&ip[6], 10) + \".onion\";\n    if (IsI2P())\n        return EncodeBase32(&ip[6], 10) + \".oc.b32.i2p\";\n    CService serv(*this, 0);\n#ifdef USE_IPV6\n    struct sockaddr_storage sockaddr;\n#else\n    struct sockaddr sockaddr;\n#endif\n    socklen_t socklen = sizeof(sockaddr);\n    if (serv.GetSockAddr((struct sockaddr*)&sockaddr, &socklen)) {\n        char name[1025] = \"\";\n        if (!getnameinfo((const struct sockaddr*)&sockaddr, socklen, name, sizeof(name), NULL, 0, NI_NUMERICHOST))\n            return std::string(name);\n    }\n    if (IsIPv4())\n        return strprintf(\"%u.%u.%u.%u\", GetByte(3), GetByte(2), GetByte(1), GetByte(0));\n    else\n        return strprintf(\"%x:%x:%x:%x:%x:%x:%x:%x\",\n                         GetByte(15) << 8 | GetByte(14), GetByte(13) << 8 | GetByte(12),\n                         GetByte(11) << 8 | GetByte(10), GetByte(9) << 8 | GetByte(8),\n                         GetByte(7) << 8 | GetByte(6), GetByte(5) << 8 | GetByte(4),\n                         GetByte(3) << 8 | GetByte(2), GetByte(1) << 8 | GetByte(0));\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCNetAddr {\n  std::string CNetAddr::ToStringIP() const\n  {\n      if (IsTor())\n          return EncodeBase32(&ip[6], 10) + \".onion\";\n      if (IsI2P())\n          return EncodeBase32(&ip[6], 10) + \".oc.b32.i2p\";\n      CService serv(*this, 0);\n  #ifdef USE_IPV6\n      struct sockaddr_storage sockaddr;\n  #else\n      struct sockaddr sockaddr;\n  #endif\n      socklen_t socklen = sizeof(sockaddr);\n      if (serv.GetSockAddr((struct sockaddr*)&sockaddr, &socklen)) {\n          char name[1025] = \"\";\n          if (!getnameinfo((const struct sockaddr*)&sockaddr, socklen, name, sizeof(name), NULL, 0, NI_NUMERICHOST))\n              return std::string(name);\n      }\n      if (IsIPv4())\n          return strprintf(\"%u.%u.%u.%u\", GetByte(3), GetByte(2), GetByte(1), GetByte(0));\n      else\n          return strprintf(\"%x:%x:%x:%x:%x:%x:%x:%x\",\n                           GetByte(15) << 8 | GetByte(14), GetByte(13) << 8 | GetByte(12),\n                           GetByte(11) << 8 | GetByte(10), GetByte(9) << 8 | GetByte(8),\n                           GetByte(7) << 8 | GetByte(6), GetByte(5) << 8 | GetByte(4),\n                           GetByte(3) << 8 | GetByte(2), GetByte(1) << 8 | GetByte(0));\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ip.IsValid",
          "args": [],
          "line": 214
        },
        "resolved": true,
        "details": {
          "function_name": "IsValid",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "725-759",
          "snippet": "bool CNetAddr::IsValid() const\n{\n    // Cleanup 3-byte shifted addresses caused by garbage in size field\n    // of addr messages from versions before 0.2.9 checksum.\n    // Two consecutive addr messages look like this:\n    // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n    // so if the first length field is garbled, it reads the second batch\n    // of addr misaligned by 3 bytes.\n    if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n        return false;\n\n    // unspecified IPv6 address (::/128)\n    unsigned char ipNone[16] = {};\n    if (memcmp(ip, ipNone, 16) == 0)\n        return false;\n\n    // documentation IPv6 address\n    if (IsRFC3849())\n        return false;\n\n    if (IsIPv4())\n    {\n        // INADDR_NONE\n        uint32_t ipNone = INADDR_NONE;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n\n        // 0\n        ipNone = 0;\n        if (memcmp(ip+12, &ipNone, 4) == 0)\n            return false;\n    }\n\n    return true;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "static const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nstatic const unsigned char pchIPv4[12] = { 0, 0, 0, 0, 0, 0, 0, 0, 0, 0, 0xff, 0xff };\n\nCNetAddr {\n  bool CNetAddr::IsValid() const\n  {\n      // Cleanup 3-byte shifted addresses caused by garbage in size field\n      // of addr messages from versions before 0.2.9 checksum.\n      // Two consecutive addr messages look like this:\n      // header20 vectorlen3 addr26 addr26 addr26 header20 vectorlen3 addr26 addr26 addr26...\n      // so if the first length field is garbled, it reads the second batch\n      // of addr misaligned by 3 bytes.\n      if (memcmp(ip, pchIPv4+3, sizeof(pchIPv4)-3) == 0)\n          return false;\n  \n      // unspecified IPv6 address (::/128)\n      unsigned char ipNone[16] = {};\n      if (memcmp(ip, ipNone, 16) == 0)\n          return false;\n  \n      // documentation IPv6 address\n      if (IsRFC3849())\n          return false;\n  \n      if (IsIPv4())\n      {\n          // INADDR_NONE\n          uint32_t ipNone = INADDR_NONE;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n  \n          // 0\n          ipNone = 0;\n          if (memcmp(ip+12, &ipNone, 4) == 0)\n              return false;\n      }\n  \n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "strMiscWarning.clear",
          "args": [],
          "line": 210
        },
        "resolved": true,
        "details": {
          "function_name": "clear",
          "container": "CTxMemPool",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
          "lines": "768-774",
          "snippet": "void CTxMemPool::clear()\n{\n    LOCK(cs);\n    mapTx.clear();\n    mapNextTx.clear();\n    ++nTransactionsUpdated;\n}",
          "includes": [
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"kernel.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"txdb.h\"",
            "#include \"db.h\"",
            "#include \"checkpoints.h\"",
            "#include \"alert.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "unsigned int nTransactionsUpdated = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/algorithm/string/replace.hpp>\n#include \"kernel.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"txdb.h\"\n#include \"db.h\"\n#include \"checkpoints.h\"\n#include \"alert.h\"\n\nunsigned int nTransactionsUpdated = 0;\n\nCTxMemPool {\n  void CTxMemPool::clear()\n  {\n      LOCK(cs);\n      mapTx.clear();\n      mapNextTx.clear();\n      ++nTransactionsUpdated;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "abs64",
          "args": [
            "nNtpOffset"
          ],
          "line": 209
        },
        "resolved": true,
        "details": {
          "function_name": "abs64",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.h",
          "lines": "307-310",
          "snippet": "inline int64_t abs64(int64_t n)\n{\n    return (n >= 0 ? n : -n);\n}",
          "includes": [
            "#include <inttypes.h>",
            "#include <stdint.h>",
            "#include \"netbase.h\" // for AddTimeData",
            "#include <openssl/ripemd.h>",
            "#include <openssl/sha.h>",
            "#include <boost/date_time/posix_time/posix_time_types.hpp>",
            "#include <boost/date_time/gregorian/gregorian_types.hpp>",
            "#include <boost/filesystem/path.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/thread.hpp>",
            "#include <string>",
            "#include <vector>",
            "#include <map>",
            "#include <sys/resource.h>",
            "#include <sys/time.h>",
            "#include <sys/types.h>",
            "#include \"uint256.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <inttypes.h>\n#include <stdint.h>\n#include \"netbase.h\" // for AddTimeData\n#include <openssl/ripemd.h>\n#include <openssl/sha.h>\n#include <boost/date_time/posix_time/posix_time_types.hpp>\n#include <boost/date_time/gregorian/gregorian_types.hpp>\n#include <boost/filesystem/path.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/thread.hpp>\n#include <string>\n#include <vector>\n#include <map>\n#include <sys/resource.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include \"uint256.h\"\n\ninline int64_t abs64(int64_t n)\n{\n    return (n >= 0 ? n : -n);\n}"
        }
      },
      {
        "call_info": {
          "callee": "GetTime",
          "args": [],
          "line": 207
        },
        "resolved": true,
        "details": {
          "function_name": "GetTimeMillis",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.h",
          "lines": "370-374",
          "snippet": "inline int64_t GetTimeMillis()\n{\n    return (boost::posix_time::ptime(boost::posix_time::microsec_clock::universal_time()) -\n            boost::posix_time::ptime(boost::gregorian::date(1970,1,1))).total_milliseconds();\n}",
          "includes": [
            "#include <inttypes.h>",
            "#include <stdint.h>",
            "#include \"netbase.h\" // for AddTimeData",
            "#include <openssl/ripemd.h>",
            "#include <openssl/sha.h>",
            "#include <boost/date_time/posix_time/posix_time_types.hpp>",
            "#include <boost/date_time/gregorian/gregorian_types.hpp>",
            "#include <boost/filesystem/path.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/thread.hpp>",
            "#include <string>",
            "#include <vector>",
            "#include <map>",
            "#include <sys/resource.h>",
            "#include <sys/time.h>",
            "#include <sys/types.h>",
            "#include \"uint256.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <inttypes.h>\n#include <stdint.h>\n#include \"netbase.h\" // for AddTimeData\n#include <openssl/ripemd.h>\n#include <openssl/sha.h>\n#include <boost/date_time/posix_time/posix_time_types.hpp>\n#include <boost/date_time/gregorian/gregorian_types.hpp>\n#include <boost/filesystem/path.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/thread.hpp>\n#include <string>\n#include <vector>\n#include <map>\n#include <sys/resource.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include \"uint256.h\"\n\ninline int64_t GetTimeMillis()\n{\n    return (boost::posix_time::ptime(boost::posix_time::microsec_clock::universal_time()) -\n            boost::posix_time::ptime(boost::gregorian::date(1970,1,1))).total_milliseconds();\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"Receive timed out\""
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"Unable to send data\""
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"Non-blocking socket mode failed\""
          ],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"Socket init error\""
          ],
          "line": 193
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "NtpGetTime",
          "args": [
            "ip"
          ],
          "line": 186
        },
        "resolved": true,
        "details": {
          "function_name": "NtpGetTime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/ntp.cpp",
          "lines": "391-413",
          "snippet": "int64 NtpGetTime(const std::string &strHostName) {\n    int64 nTime;\n    SOCKET sockfd;\n    socklen_t servlen;\n    struct sockaddr cliaddr;\n\n    if(!InitWithHost(strHostName, sockfd, servlen, &cliaddr))\n      return(-1);\n\n    CNetAddr ip = ((sockaddr_in *) &cliaddr)->sin_addr;\n    printf(\"NtpGetTime() : querying an NTP server %s\\n\", ip.ToStringIP().c_str());\n\n    nTime = DoReq(sockfd, servlen, cliaddr);\n\n    closesocket(sockfd);\n\n    if((nTime > 0) && (nTime != 2085978496)) {\n        printf(\"NtpGetTime() : time sample %\" PRI64d \" offset %+\" PRI64d \" received from %s\\n\",\n          nTime, nTime - GetTime(), ip.ToStringIP().c_str());\n    }\n\n    return(nTime);\n}",
          "includes": [
            "#include \"ui_interface.h\"",
            "#include \"net.h\"",
            "#include \"netbase.h\"",
            "#include <unistd.h>",
            "#include <netdb.h>",
            "#include <arpa/inet.h>",
            "#include <netinet/in.h>",
            "#include <sys/time.h>",
            "#include <sys/socket.h>",
            "#include <winsock2.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ui_interface.h\"\n#include \"net.h\"\n#include \"netbase.h\"\n#include <unistd.h>\n#include <netdb.h>\n#include <arpa/inet.h>\n#include <netinet/in.h>\n#include <sys/time.h>\n#include <sys/socket.h>\n#include <winsock2.h>\n\nint64 NtpGetTime(const std::string &strHostName) {\n    int64 nTime;\n    SOCKET sockfd;\n    socklen_t servlen;\n    struct sockaddr cliaddr;\n\n    if(!InitWithHost(strHostName, sockfd, servlen, &cliaddr))\n      return(-1);\n\n    CNetAddr ip = ((sockaddr_in *) &cliaddr)->sin_addr;\n    printf(\"NtpGetTime() : querying an NTP server %s\\n\", ip.ToStringIP().c_str());\n\n    nTime = DoReq(sockfd, servlen, cliaddr);\n\n    closesocket(sockfd);\n\n    if((nTime > 0) && (nTime != 2085978496)) {\n        printf(\"NtpGetTime() : time sample %\" PRI64d \" offset %+\" PRI64d \" received from %s\\n\",\n          nTime, nTime - GetTime(), ip.ToStringIP().c_str());\n    }\n\n    return(nTime);\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 183
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"ntptime [server]\\n\"\n        \"Returns current time from a specific or random NTP server.\""
          ],
          "line": 179
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"walletdb.h\"\n#include \"db.h\"\n#include \"wallet.h\"\n#include \"alert.h\"\n#include \"bitcoinrpc.h\"\n#include \"ntp.h\"\n#include \"net.h\"\n\nValue ntptime(const Array &params, bool fHelp) {\n    int64 nTime;\n    CNetAddr ip;\n\n     if(fHelp || (params.size() > 1))\n      throw(runtime_error(\n        \"ntptime [server]\\n\"\n        \"Returns current time from a specific or random NTP server.\"));\n\n     if(params.size() > 0) {\n        nTime = NtpGetTime(params[0].get_str());\n    } else {\n        nTime = NtpGetTime(ip);\n    }\n\n    Object obj;\n    switch(nTime) {\n\n         case(-1):\n            throw(runtime_error(\"Socket init error\"));\n\n         case(-2):\n            throw(runtime_error(\"Non-blocking socket mode failed\"));\n\n         case(-3):\n            throw(runtime_error(\"Unable to send data\"));\n\n         case(-4):\n            throw(runtime_error(\"Receive timed out\"));\n\n         default:\n            if((nTime > 0) && (nTime != 2085978496)) {\n                /* Update the offset */\n                nNtpOffset = nTime - GetTime();\n                /* Remove the warning if back to normal */\n                if(fNtpWarning && (abs64(nNtpOffset) <= 5 * 60)) {\n                    strMiscWarning.clear();\n                    fNtpWarning = false;\n                }\n                /* Push data into the object */\n                if(ip.IsValid()) obj.push_back(Pair(\"server\", ip.ToStringIP().c_str()));\n                obj.push_back(Pair(\"time\", DateTimeStrFormat(nTime)));\n                obj.push_back(Pair(\"sample\", (boost::int64_t)nTime));\n                obj.push_back(Pair(\"offset\", (boost::int64_t)nNtpOffset));\n        } else throw(runtime_error(\"Unknown response\"));\n\n     }\n\n     return(obj);\n}"
  },
  {
    "function_name": "sendalert",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcnet.cpp",
    "lines": "115-172",
    "snippet": "Value sendalert(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 6)\n        throw runtime_error(\n            \"sendalert <message> <privatekey> <minver> <maxver> <priority> <id> [cancelupto]\\n\"\n            \"<message> is the alert text message\\n\"\n            \"<privatekey> is hex string of alert master private key\\n\"\n            \"<minver> is the minimum applicable internal client version\\n\"\n            \"<maxver> is the maximum applicable internal client version\\n\"\n            \"<priority> is integer priority number\\n\"\n            \"<id> is the alert id\\n\"\n            \"[cancelupto] cancels all alert id's up to this number\\n\"\n            \"Returns true or false.\");\n\n    CAlert alert;\n    CKey key;\n\n    alert.strStatusBar = params[0].get_str();\n    alert.nMinVer = params[2].get_int();\n    alert.nMaxVer = params[3].get_int();\n    alert.nPriority = params[4].get_int();\n    alert.nID = params[5].get_int();\n    if (params.size() > 6)\n        alert.nCancel = params[6].get_int();\n    alert.nVersion = PROTOCOL_VERSION;\n    alert.nRelayUntil = GetAdjustedTime() + 365*24*60*60;\n    alert.nExpiration = GetAdjustedTime() + 365*24*60*60;\n\n    CDataStream sMsg(SER_NETWORK, PROTOCOL_VERSION);\n    sMsg << (CUnsignedAlert)alert;\n    alert.vchMsg = vector<unsigned char>(sMsg.begin(), sMsg.end());\n\n    vector<unsigned char> vchPrivKey = ParseHex(params[1].get_str());\n    key.SetPrivKey(CPrivKey(vchPrivKey.begin(), vchPrivKey.end())); // if key is not correct openssl may crash\n    if (!key.Sign(Hash(alert.vchMsg.begin(), alert.vchMsg.end()), alert.vchSig))\n        throw runtime_error(\n            \"Unable to sign alert, check private key?\\n\");  \n    if(!alert.ProcessAlert()) \n        throw runtime_error(\n            \"Failed to process alert.\\n\");\n    // Relay alert\n    {\n        LOCK(cs_vNodes);\n        BOOST_FOREACH(CNode* pnode, vNodes)\n            alert.RelayTo(pnode);\n    }\n\n    Object result;\n    result.push_back(Pair(\"strStatusBar\", alert.strStatusBar));\n    result.push_back(Pair(\"nVersion\", alert.nVersion));\n    result.push_back(Pair(\"nMinVer\", alert.nMinVer));\n    result.push_back(Pair(\"nMaxVer\", alert.nMaxVer));\n    result.push_back(Pair(\"nPriority\", alert.nPriority));\n    result.push_back(Pair(\"nID\", alert.nID));\n    if (alert.nCancel > 0)\n        result.push_back(Pair(\"nCancel\", alert.nCancel));\n    return result;\n}",
    "includes": [
      "#include \"walletdb.h\"",
      "#include \"db.h\"",
      "#include \"wallet.h\"",
      "#include \"alert.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"ntp.h\"",
      "#include \"net.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"nCancel\", alert.nCancel)"
          ],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"nCancel\"",
            "alert.nCancel"
          ],
          "line": 170
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"nID\", alert.nID)"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"nPriority\", alert.nPriority)"
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"nMaxVer\", alert.nMaxVer)"
          ],
          "line": 166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"nMinVer\", alert.nMinVer)"
          ],
          "line": 165
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"nVersion\", alert.nVersion)"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"strStatusBar\", alert.strStatusBar)"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "alert.RelayTo",
          "args": [
            "pnode"
          ],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "RelayTo",
          "container": "CSyncCheckpoint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/checkpoints.h",
          "lines": "143-153",
          "snippet": "bool RelayTo(CNode* pnode) const\n    {\n        // returns true if wasn't already sent\n        if (pnode->hashCheckpointKnown != hashCheckpoint)\n        {\n            pnode->hashCheckpointKnown = hashCheckpoint;\n            pnode->PushMessage(\"checkpoint\", *this);\n            return true;\n        }\n        return false;\n    }",
          "includes": [
            "#include \"util.h\"",
            "#include \"net.h\"",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"net.h\"\n#include <map>\n\nCSyncCheckpoint {\n  bool RelayTo(CNode* pnode) const\n      {\n          // returns true if wasn't already sent\n          if (pnode->hashCheckpointKnown != hashCheckpoint)\n          {\n              pnode->hashCheckpointKnown = hashCheckpoint;\n              pnode->PushMessage(\"checkpoint\", *this);\n              return true;\n          }\n          return false;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "cs_vNodes"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"Failed to process alert.\\n\""
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "alert.ProcessAlert",
          "args": [],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"Unable to sign alert, check private key?\\n\""
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "key.Sign",
          "args": [
            "Hash(alert.vchMsg.begin(), alert.vchMsg.end())",
            "alert.vchSig"
          ],
          "line": 149
        },
        "resolved": true,
        "details": {
          "function_name": "Sign",
          "container": "CKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.cpp",
          "lines": "286-312",
          "snippet": "bool CKey::Sign(uint256 hash, std::vector<unsigned char>& vchSig)\n{\n    vchSig.clear();\n    ECDSA_SIG *sig = ECDSA_do_sign((unsigned char*)&hash, sizeof(hash), pkey);\n    if (sig == NULL)\n        return false;\n    BN_CTX *ctx = BN_CTX_new();\n    BN_CTX_start(ctx);\n    const EC_GROUP *group = EC_KEY_get0_group(pkey);\n    BIGNUM *order = BN_CTX_get(ctx);\n    BIGNUM *halforder = BN_CTX_get(ctx);\n    EC_GROUP_get_order(group, order, ctx);\n    BN_rshift1(halforder, order);\n    if (BN_cmp(sig->s, halforder) > 0) {\n        // enforce low S values, by negating the value (modulo the order) if above order/2.\n        BN_sub(sig->s, order, sig->s);\n    }\n    BN_CTX_end(ctx);\n    BN_CTX_free(ctx);\n    unsigned int nSize = ECDSA_size(pkey);\n    vchSig.resize(nSize); // Make sure it is big enough\n    unsigned char *pos = &vchSig[0];\n    nSize = i2d_ECDSA_SIG(sig, &pos);\n    ECDSA_SIG_free(sig);\n    vchSig.resize(nSize); // Shrink to fit actual size\n    return true;\n}",
          "includes": [
            "#include \"key.h\"",
            "#include <openssl/obj_mac.h>",
            "#include <openssl/ecdsa.h>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"key.h\"\n#include <openssl/obj_mac.h>\n#include <openssl/ecdsa.h>\n#include <map>\n\nCKey {\n  bool CKey::Sign(uint256 hash, std::vector<unsigned char>& vchSig)\n  {\n      vchSig.clear();\n      ECDSA_SIG *sig = ECDSA_do_sign((unsigned char*)&hash, sizeof(hash), pkey);\n      if (sig == NULL)\n          return false;\n      BN_CTX *ctx = BN_CTX_new();\n      BN_CTX_start(ctx);\n      const EC_GROUP *group = EC_KEY_get0_group(pkey);\n      BIGNUM *order = BN_CTX_get(ctx);\n      BIGNUM *halforder = BN_CTX_get(ctx);\n      EC_GROUP_get_order(group, order, ctx);\n      BN_rshift1(halforder, order);\n      if (BN_cmp(sig->s, halforder) > 0) {\n          // enforce low S values, by negating the value (modulo the order) if above order/2.\n          BN_sub(sig->s, order, sig->s);\n      }\n      BN_CTX_end(ctx);\n      BN_CTX_free(ctx);\n      unsigned int nSize = ECDSA_size(pkey);\n      vchSig.resize(nSize); // Make sure it is big enough\n      unsigned char *pos = &vchSig[0];\n      nSize = i2d_ECDSA_SIG(sig, &pos);\n      ECDSA_SIG_free(sig);\n      vchSig.resize(nSize); // Shrink to fit actual size\n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "Hash",
          "args": [
            "alert.vchMsg.begin()",
            "alert.vchMsg.end()"
          ],
          "line": 149
        },
        "resolved": true,
        "details": {
          "function_name": "Hash",
          "container": "CBloomFilter",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bloom.cpp",
          "lines": "34-38",
          "snippet": "inline unsigned int CBloomFilter::Hash(unsigned int nHashNum, const std::vector<unsigned char>& vDataToHash) const\n{\n    // 0xFBA4C795 chosen as it guarantees a reasonable bit difference between nHashNum values.\n    return MurmurHash3(nHashNum * 0xFBA4C795 + nTweak, vDataToHash) % (vData.size() * 8);\n}",
          "includes": [
            "#include \"hash.h\"",
            "#include \"script.h\"",
            "#include \"main.h\"",
            "#include \"bloom.h\"",
            "#include <stdlib.h>",
            "#include <math.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hash.h\"\n#include \"script.h\"\n#include \"main.h\"\n#include \"bloom.h\"\n#include <stdlib.h>\n#include <math.h>\n\nCBloomFilter {\n  inline unsigned int CBloomFilter::Hash(unsigned int nHashNum, const std::vector<unsigned char>& vDataToHash) const\n  {\n      // 0xFBA4C795 chosen as it guarantees a reasonable bit difference between nHashNum values.\n      return MurmurHash3(nHashNum * 0xFBA4C795 + nTweak, vDataToHash) % (vData.size() * 8);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "alert.vchMsg.end",
          "args": [],
          "line": 149
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "alert.vchMsg.begin",
          "args": [],
          "line": 149
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "key.SetPrivKey",
          "args": [
            "CPrivKey(vchPrivKey.begin(), vchPrivKey.end())"
          ],
          "line": 148
        },
        "resolved": true,
        "details": {
          "function_name": "SetPrivKey",
          "container": "CKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.cpp",
          "lines": "186-207",
          "snippet": "bool CKey::SetPrivKey(const CPrivKey& vchPrivKey)\n{\n    const unsigned char* pbegin = &vchPrivKey[0];\n    if (d2i_ECPrivateKey(&pkey, &pbegin, vchPrivKey.size()))\n    {\n        // In testing, d2i_ECPrivateKey can return true\n        // but fill in pkey with a key that fails\n        // EC_KEY_check_key, so:\n        if (EC_KEY_check_key(pkey))\n        {\n            fSet = true;\n            return true;\n        }\n    }\n    // If vchPrivKey data is bad d2i_ECPrivateKey() can\n    // leave pkey in a state where calling EC_KEY_free()\n    // crashes. To avoid that, set pkey to NULL and\n    // leak the memory (a leak is better than a crash)\n    pkey = NULL;\n    Reset();\n    return false;\n}",
          "includes": [
            "#include \"key.h\"",
            "#include <openssl/obj_mac.h>",
            "#include <openssl/ecdsa.h>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"key.h\"\n#include <openssl/obj_mac.h>\n#include <openssl/ecdsa.h>\n#include <map>\n\nCKey {\n  bool CKey::SetPrivKey(const CPrivKey& vchPrivKey)\n  {\n      const unsigned char* pbegin = &vchPrivKey[0];\n      if (d2i_ECPrivateKey(&pkey, &pbegin, vchPrivKey.size()))\n      {\n          // In testing, d2i_ECPrivateKey can return true\n          // but fill in pkey with a key that fails\n          // EC_KEY_check_key, so:\n          if (EC_KEY_check_key(pkey))\n          {\n              fSet = true;\n              return true;\n          }\n      }\n      // If vchPrivKey data is bad d2i_ECPrivateKey() can\n      // leave pkey in a state where calling EC_KEY_free()\n      // crashes. To avoid that, set pkey to NULL and\n      // leak the memory (a leak is better than a crash)\n      pkey = NULL;\n      Reset();\n      return false;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "CPrivKey",
          "args": [
            "vchPrivKey.begin()",
            "vchPrivKey.end()"
          ],
          "line": 148
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ParseHex",
          "args": [
            "params[1].get_str()"
          ],
          "line": 147
        },
        "resolved": true,
        "details": {
          "function_name": "ParseHex",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "490-493",
          "snippet": "vector<unsigned char> ParseHex(const string& str)\n{\n    return ParseHex(str.c_str());\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nvector<unsigned char> ParseHex(const string& str)\n{\n    return ParseHex(str.c_str());\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[1].get_str",
          "args": [],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vector<unsigned char>",
          "args": [
            "sMsg.begin()",
            "sMsg.end()"
          ],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetAdjustedTime",
          "args": [],
          "line": 141
        },
        "resolved": true,
        "details": {
          "function_name": "GetAdjustedTime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "1201-1214",
          "snippet": "int64_t GetAdjustedTime() {\n\n    int64 nTime = GetTime();\n\n     /* If the NTP and system time are within half an hour, follow the former */\n    if(abs64(nNtpOffset) < 30 * 60)\n      return(nTime + nNtpOffset);\n\n     /* If the median peer time and system time are within 1 hour, follow the former */\n    if(abs64(nPeersOffset) < 60 * 60)\n      return(nTime + nPeersOffset);\n\n     return(nTime);\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "extern int64 nNtpOffset;",
            "int64 nPeersOffset = INT64_MAX;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nextern int64 nNtpOffset;\nint64 nPeersOffset = INT64_MAX;\n\nint64_t GetAdjustedTime() {\n\n    int64 nTime = GetTime();\n\n     /* If the NTP and system time are within half an hour, follow the former */\n    if(abs64(nNtpOffset) < 30 * 60)\n      return(nTime + nNtpOffset);\n\n     /* If the median peer time and system time are within 1 hour, follow the former */\n    if(abs64(nPeersOffset) < 60 * 60)\n      return(nTime + nPeersOffset);\n\n     return(nTime);\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[6].get_int",
          "args": [],
          "line": 138
        },
        "resolved": true,
        "details": {
          "function_name": "get_int",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "385-390",
          "snippet": "int Value_impl< Config >::get_int() const\n    {\n        check_type(  int_type );\n\n        return static_cast< int >( get_int64() );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  int Value_impl< Config >::get_int() const\n      {\n          check_type(  int_type );\n  \n          return static_cast< int >( get_int64() );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 137
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"sendalert <message> <privatekey> <minver> <maxver> <priority> <id> [cancelupto]\\n\"\n            \"<message> is the alert text message\\n\"\n            \"<privatekey> is hex string of alert master private key\\n\"\n            \"<minver> is the minimum applicable internal client version\\n\"\n            \"<maxver> is the maximum applicable internal client version\\n\"\n            \"<priority> is integer priority number\\n\"\n            \"<id> is the alert id\\n\"\n            \"[cancelupto] cancels all alert id's up to this number\\n\"\n            \"Returns true or false.\""
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"walletdb.h\"\n#include \"db.h\"\n#include \"wallet.h\"\n#include \"alert.h\"\n#include \"bitcoinrpc.h\"\n#include \"ntp.h\"\n#include \"net.h\"\n\nValue sendalert(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 6)\n        throw runtime_error(\n            \"sendalert <message> <privatekey> <minver> <maxver> <priority> <id> [cancelupto]\\n\"\n            \"<message> is the alert text message\\n\"\n            \"<privatekey> is hex string of alert master private key\\n\"\n            \"<minver> is the minimum applicable internal client version\\n\"\n            \"<maxver> is the maximum applicable internal client version\\n\"\n            \"<priority> is integer priority number\\n\"\n            \"<id> is the alert id\\n\"\n            \"[cancelupto] cancels all alert id's up to this number\\n\"\n            \"Returns true or false.\");\n\n    CAlert alert;\n    CKey key;\n\n    alert.strStatusBar = params[0].get_str();\n    alert.nMinVer = params[2].get_int();\n    alert.nMaxVer = params[3].get_int();\n    alert.nPriority = params[4].get_int();\n    alert.nID = params[5].get_int();\n    if (params.size() > 6)\n        alert.nCancel = params[6].get_int();\n    alert.nVersion = PROTOCOL_VERSION;\n    alert.nRelayUntil = GetAdjustedTime() + 365*24*60*60;\n    alert.nExpiration = GetAdjustedTime() + 365*24*60*60;\n\n    CDataStream sMsg(SER_NETWORK, PROTOCOL_VERSION);\n    sMsg << (CUnsignedAlert)alert;\n    alert.vchMsg = vector<unsigned char>(sMsg.begin(), sMsg.end());\n\n    vector<unsigned char> vchPrivKey = ParseHex(params[1].get_str());\n    key.SetPrivKey(CPrivKey(vchPrivKey.begin(), vchPrivKey.end())); // if key is not correct openssl may crash\n    if (!key.Sign(Hash(alert.vchMsg.begin(), alert.vchMsg.end()), alert.vchSig))\n        throw runtime_error(\n            \"Unable to sign alert, check private key?\\n\");  \n    if(!alert.ProcessAlert()) \n        throw runtime_error(\n            \"Failed to process alert.\\n\");\n    // Relay alert\n    {\n        LOCK(cs_vNodes);\n        BOOST_FOREACH(CNode* pnode, vNodes)\n            alert.RelayTo(pnode);\n    }\n\n    Object result;\n    result.push_back(Pair(\"strStatusBar\", alert.strStatusBar));\n    result.push_back(Pair(\"nVersion\", alert.nVersion));\n    result.push_back(Pair(\"nMinVer\", alert.nMinVer));\n    result.push_back(Pair(\"nMaxVer\", alert.nMaxVer));\n    result.push_back(Pair(\"nPriority\", alert.nPriority));\n    result.push_back(Pair(\"nID\", alert.nID));\n    if (alert.nCancel > 0)\n        result.push_back(Pair(\"nCancel\", alert.nCancel));\n    return result;\n}"
  },
  {
    "function_name": "addnode",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcnet.cpp",
    "lines": "72-109",
    "snippet": "Value addnode(const Array &params, bool fHelp) {\n    string strCommand;\n\n    if(params.size() == 2)\n      strCommand = params[1].get_str();\n\n    if(fHelp || (params.size() != 2) ||\n      ((strCommand != \"onetry\") && (strCommand != \"add\") && (strCommand != \"remove\")))\n      throw(runtime_error(\n        \"addnode <node:port> <add|remove|onetry>\\n\"\n        \"Attempts to add or remove a node from the list or try a connection to the node once.\"));\n\n    string strNode = params[0].get_str();\n\n    if(strCommand == \"onetry\") {\n        CAddress addr;\n        ConnectNode(addr, strNode.c_str());\n        return(Value::null);\n    }\n\n    LOCK(cs_vAddedNodes);\n    vector<string>::iterator it = vAddedNodes.begin();\n    for(; it != vAddedNodes.end(); it++)\n      if(strNode == *it) break;\n\n    if(strCommand == \"add\") {\n        if(it != vAddedNodes.end())\n          throw(JSONRPCError(-23, \"Error: Node has been added already\"));\n        vAddedNodes.push_back(strNode);\n    }\n    else if(strCommand == \"remove\") {\n        if(it == vAddedNodes.end())\n          throw(JSONRPCError(-24, \"Error: Node has not been added\"));\n        vAddedNodes.erase(it);\n    }\n\n    return(Value::null);\n}",
    "includes": [
      "#include \"walletdb.h\"",
      "#include \"db.h\"",
      "#include \"wallet.h\"",
      "#include \"alert.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"ntp.h\"",
      "#include \"net.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "vAddedNodes.erase",
          "args": [
            "it"
          ],
          "line": 105
        },
        "resolved": true,
        "details": {
          "function_name": "erase",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "49-65",
          "snippet": "void erase(const key_type& k)\n    {\n        iterator itTarget = map.find(k);\n        if (itTarget == map.end())\n            return;\n        std::pair<rmap_iterator, rmap_iterator> itPair = rmap.equal_range(itTarget->second);\n        for (rmap_iterator it = itPair.first; it != itPair.second; ++it)\n            if (it->second == itTarget)\n            {\n                rmap.erase(it);\n                map.erase(itTarget);\n                return;\n            }\n        // Shouldn't ever get here\n        assert(0); //TODO remove me\n        map.erase(itTarget);\n    }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  void erase(const key_type& k)\n      {\n          iterator itTarget = map.find(k);\n          if (itTarget == map.end())\n              return;\n          std::pair<rmap_iterator, rmap_iterator> itPair = rmap.equal_range(itTarget->second);\n          for (rmap_iterator it = itPair.first; it != itPair.second; ++it)\n              if (it->second == itTarget)\n              {\n                  rmap.erase(it);\n                  map.erase(itTarget);\n                  return;\n              }\n          // Shouldn't ever get here\n          assert(0); //TODO remove me\n          map.erase(itTarget);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "-24",
            "\"Error: Node has not been added\""
          ],
          "line": 104
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "vAddedNodes.end",
          "args": [],
          "line": 103
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "vAddedNodes.push_back",
          "args": [
            "strNode"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vAddedNodes.begin",
          "args": [],
          "line": 93
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "cs_vAddedNodes"
          ],
          "line": 92
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ConnectNode",
          "args": [
            "addr",
            "strNode.c_str()"
          ],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strNode.c_str",
          "args": [],
          "line": 88
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"addnode <node:port> <add|remove|onetry>\\n\"\n        \"Attempts to add or remove a node from the list or try a connection to the node once.\""
          ],
          "line": 80
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 78
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[1].get_str",
          "args": [],
          "line": 76
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"walletdb.h\"\n#include \"db.h\"\n#include \"wallet.h\"\n#include \"alert.h\"\n#include \"bitcoinrpc.h\"\n#include \"ntp.h\"\n#include \"net.h\"\n\nValue addnode(const Array &params, bool fHelp) {\n    string strCommand;\n\n    if(params.size() == 2)\n      strCommand = params[1].get_str();\n\n    if(fHelp || (params.size() != 2) ||\n      ((strCommand != \"onetry\") && (strCommand != \"add\") && (strCommand != \"remove\")))\n      throw(runtime_error(\n        \"addnode <node:port> <add|remove|onetry>\\n\"\n        \"Attempts to add or remove a node from the list or try a connection to the node once.\"));\n\n    string strNode = params[0].get_str();\n\n    if(strCommand == \"onetry\") {\n        CAddress addr;\n        ConnectNode(addr, strNode.c_str());\n        return(Value::null);\n    }\n\n    LOCK(cs_vAddedNodes);\n    vector<string>::iterator it = vAddedNodes.begin();\n    for(; it != vAddedNodes.end(); it++)\n      if(strNode == *it) break;\n\n    if(strCommand == \"add\") {\n        if(it != vAddedNodes.end())\n          throw(JSONRPCError(-23, \"Error: Node has been added already\"));\n        vAddedNodes.push_back(strNode);\n    }\n    else if(strCommand == \"remove\") {\n        if(it == vAddedNodes.end())\n          throw(JSONRPCError(-24, \"Error: Node has not been added\"));\n        vAddedNodes.erase(it);\n    }\n\n    return(Value::null);\n}"
  },
  {
    "function_name": "getpeerinfo",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcnet.cpp",
    "lines": "40-70",
    "snippet": "Value getpeerinfo(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 0)\n        throw runtime_error(\n            \"getpeerinfo\\n\"\n            \"Returns data about each connected network node.\");\n\n    vector<CNodeStats> vstats;\n    CopyNodeStats(vstats);\n\n    Array ret;\n\n    BOOST_FOREACH(const CNodeStats& stats, vstats) {\n        Object obj;\n\n        obj.push_back(Pair(\"addr\", stats.addrName));\n        obj.push_back(Pair(\"services\", strprintf(\"%08\"PRIx64, stats.nServices)));\n        obj.push_back(Pair(\"lastsend\", (boost::int64_t)stats.nLastSend));\n        obj.push_back(Pair(\"lastrecv\", (boost::int64_t)stats.nLastRecv));\n        obj.push_back(Pair(\"conntime\", (boost::int64_t)stats.nTimeConnected));\n        obj.push_back(Pair(\"version\", stats.nVersion));\n        obj.push_back(Pair(\"subver\", stats.strSubVer));\n        obj.push_back(Pair(\"inbound\", stats.fInbound));\n        obj.push_back(Pair(\"startingheight\", stats.nStartingHeight));\n        obj.push_back(Pair(\"banscore\", stats.nMisbehavior));\n\n        ret.push_back(obj);\n    }\n\n    return ret;\n}",
    "includes": [
      "#include \"walletdb.h\"",
      "#include \"db.h\"",
      "#include \"wallet.h\"",
      "#include \"alert.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"ntp.h\"",
      "#include \"net.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ret.push_back",
          "args": [
            "obj"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"banscore\", stats.nMisbehavior)"
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"banscore\"",
            "stats.nMisbehavior"
          ],
          "line": 64
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"startingheight\", stats.nStartingHeight)"
          ],
          "line": 63
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"inbound\", stats.fInbound)"
          ],
          "line": 62
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"subver\", stats.strSubVer)"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"version\", stats.nVersion)"
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"conntime\", (boost::int64_t)stats.nTimeConnected)"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"lastrecv\", (boost::int64_t)stats.nLastRecv)"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"lastsend\", (boost::int64_t)stats.nLastSend)"
          ],
          "line": 57
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"services\", strprintf(\"%08\"PRIx64, stats.nServices))"
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strprintf",
          "args": [
            "\"%08\"PRIx64",
            "stats.nServices"
          ],
          "line": 56
        },
        "resolved": true,
        "details": {
          "function_name": "real_strprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "331-338",
          "snippet": "string real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nstring real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"addr\", stats.addrName)"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CopyNodeStats",
          "args": [
            "vstats"
          ],
          "line": 48
        },
        "resolved": true,
        "details": {
          "function_name": "CopyNodeStats",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcnet.cpp",
          "lines": "27-38",
          "snippet": "static void CopyNodeStats(std::vector<CNodeStats>& vstats)\n{\n    vstats.clear();\n\n    LOCK(cs_vNodes);\n    vstats.reserve(vNodes.size());\n    BOOST_FOREACH(CNode* pnode, vNodes) {\n        CNodeStats stats;\n        pnode->copyStats(stats);\n        vstats.push_back(stats);\n    }\n}",
          "includes": [
            "#include \"walletdb.h\"",
            "#include \"db.h\"",
            "#include \"wallet.h\"",
            "#include \"alert.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"ntp.h\"",
            "#include \"net.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"walletdb.h\"\n#include \"db.h\"\n#include \"wallet.h\"\n#include \"alert.h\"\n#include \"bitcoinrpc.h\"\n#include \"ntp.h\"\n#include \"net.h\"\n\nstatic void CopyNodeStats(std::vector<CNodeStats>& vstats)\n{\n    vstats.clear();\n\n    LOCK(cs_vNodes);\n    vstats.reserve(vNodes.size());\n    BOOST_FOREACH(CNode* pnode, vNodes) {\n        CNodeStats stats;\n        pnode->copyStats(stats);\n        vstats.push_back(stats);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getpeerinfo\\n\"\n            \"Returns data about each connected network node.\""
          ],
          "line": 43
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 42
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"walletdb.h\"\n#include \"db.h\"\n#include \"wallet.h\"\n#include \"alert.h\"\n#include \"bitcoinrpc.h\"\n#include \"ntp.h\"\n#include \"net.h\"\n\nValue getpeerinfo(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 0)\n        throw runtime_error(\n            \"getpeerinfo\\n\"\n            \"Returns data about each connected network node.\");\n\n    vector<CNodeStats> vstats;\n    CopyNodeStats(vstats);\n\n    Array ret;\n\n    BOOST_FOREACH(const CNodeStats& stats, vstats) {\n        Object obj;\n\n        obj.push_back(Pair(\"addr\", stats.addrName));\n        obj.push_back(Pair(\"services\", strprintf(\"%08\"PRIx64, stats.nServices)));\n        obj.push_back(Pair(\"lastsend\", (boost::int64_t)stats.nLastSend));\n        obj.push_back(Pair(\"lastrecv\", (boost::int64_t)stats.nLastRecv));\n        obj.push_back(Pair(\"conntime\", (boost::int64_t)stats.nTimeConnected));\n        obj.push_back(Pair(\"version\", stats.nVersion));\n        obj.push_back(Pair(\"subver\", stats.strSubVer));\n        obj.push_back(Pair(\"inbound\", stats.fInbound));\n        obj.push_back(Pair(\"startingheight\", stats.nStartingHeight));\n        obj.push_back(Pair(\"banscore\", stats.nMisbehavior));\n\n        ret.push_back(obj);\n    }\n\n    return ret;\n}"
  },
  {
    "function_name": "CopyNodeStats",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcnet.cpp",
    "lines": "27-38",
    "snippet": "static void CopyNodeStats(std::vector<CNodeStats>& vstats)\n{\n    vstats.clear();\n\n    LOCK(cs_vNodes);\n    vstats.reserve(vNodes.size());\n    BOOST_FOREACH(CNode* pnode, vNodes) {\n        CNodeStats stats;\n        pnode->copyStats(stats);\n        vstats.push_back(stats);\n    }\n}",
    "includes": [
      "#include \"walletdb.h\"",
      "#include \"db.h\"",
      "#include \"wallet.h\"",
      "#include \"alert.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"ntp.h\"",
      "#include \"net.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "vstats.push_back",
          "args": [
            "stats"
          ],
          "line": 36
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pnode->copyStats",
          "args": [
            "stats"
          ],
          "line": 35
        },
        "resolved": true,
        "details": {
          "function_name": "copyStats",
          "container": "CNode",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/net.cpp",
          "lines": "633-645",
          "snippet": "void CNode::copyStats(CNodeStats &stats)\n{\n    X(nServices);\n    X(nLastSend);\n    X(nLastRecv);\n    X(nTimeConnected);\n    X(addrName);\n    X(nVersion);\n    X(strSubVer);\n    X(fInbound);\n    X(nStartingHeight);\n    X(nMisbehavior);\n}",
          "includes": [
            "#include <miniupnpc/upnperrors.h>",
            "#include <miniupnpc/upnpcommands.h>",
            "#include <miniupnpc/miniupnpc.h>",
            "#include <miniupnpc/miniwget.h>",
            "#include <string.h>",
            "#include \"ui_interface.h\"",
            "#include \"addrman.h\"",
            "#include \"strlcpy.h\"",
            "#include \"init.h\"",
            "#include \"ntp.h\"",
            "#include \"net.h\"",
            "#include \"db.h\"",
            "#include \"irc.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <miniupnpc/upnperrors.h>\n#include <miniupnpc/upnpcommands.h>\n#include <miniupnpc/miniupnpc.h>\n#include <miniupnpc/miniwget.h>\n#include <string.h>\n#include \"ui_interface.h\"\n#include \"addrman.h\"\n#include \"strlcpy.h\"\n#include \"init.h\"\n#include \"ntp.h\"\n#include \"net.h\"\n#include \"db.h\"\n#include \"irc.h\"\n\nCNode {\n  void CNode::copyStats(CNodeStats &stats)\n  {\n      X(nServices);\n      X(nLastSend);\n      X(nLastRecv);\n      X(nTimeConnected);\n      X(addrName);\n      X(nVersion);\n      X(strSubVer);\n      X(fInbound);\n      X(nStartingHeight);\n      X(nMisbehavior);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "vstats.reserve",
          "args": [
            "vNodes.size()"
          ],
          "line": 32
        },
        "resolved": true,
        "details": {
          "function_name": "reserve",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "805-805",
          "snippet": "void reserve(size_type n)                        { vch.reserve(n + nReadPos); }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  void reserve(size_type n)                        { vch.reserve(n + nReadPos); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "vNodes.size",
          "args": [],
          "line": 32
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "cs_vNodes"
          ],
          "line": 31
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vstats.clear",
          "args": [],
          "line": 29
        },
        "resolved": true,
        "details": {
          "function_name": "clear",
          "container": "CTxMemPool",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
          "lines": "768-774",
          "snippet": "void CTxMemPool::clear()\n{\n    LOCK(cs);\n    mapTx.clear();\n    mapNextTx.clear();\n    ++nTransactionsUpdated;\n}",
          "includes": [
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"kernel.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"txdb.h\"",
            "#include \"db.h\"",
            "#include \"checkpoints.h\"",
            "#include \"alert.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "unsigned int nTransactionsUpdated = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/algorithm/string/replace.hpp>\n#include \"kernel.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"txdb.h\"\n#include \"db.h\"\n#include \"checkpoints.h\"\n#include \"alert.h\"\n\nunsigned int nTransactionsUpdated = 0;\n\nCTxMemPool {\n  void CTxMemPool::clear()\n  {\n      LOCK(cs);\n      mapTx.clear();\n      mapNextTx.clear();\n      ++nTransactionsUpdated;\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"walletdb.h\"\n#include \"db.h\"\n#include \"wallet.h\"\n#include \"alert.h\"\n#include \"bitcoinrpc.h\"\n#include \"ntp.h\"\n#include \"net.h\"\n\nstatic void CopyNodeStats(std::vector<CNodeStats>& vstats)\n{\n    vstats.clear();\n\n    LOCK(cs_vNodes);\n    vstats.reserve(vNodes.size());\n    BOOST_FOREACH(CNode* pnode, vNodes) {\n        CNodeStats stats;\n        pnode->copyStats(stats);\n        vstats.push_back(stats);\n    }\n}"
  },
  {
    "function_name": "getconnectioncount",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcnet.cpp",
    "lines": "16-25",
    "snippet": "Value getconnectioncount(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 0)\n        throw runtime_error(\n            \"getconnectioncount\\n\"\n            \"Returns the number of connections to other nodes.\");\n\n    LOCK(cs_vNodes);\n    return (int)vNodes.size();\n}",
    "includes": [
      "#include \"walletdb.h\"",
      "#include \"db.h\"",
      "#include \"wallet.h\"",
      "#include \"alert.h\"",
      "#include \"bitcoinrpc.h\"",
      "#include \"ntp.h\"",
      "#include \"net.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "vNodes.size",
          "args": [],
          "line": 24
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "cs_vNodes"
          ],
          "line": 23
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getconnectioncount\\n\"\n            \"Returns the number of connections to other nodes.\""
          ],
          "line": 19
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"walletdb.h\"\n#include \"db.h\"\n#include \"wallet.h\"\n#include \"alert.h\"\n#include \"bitcoinrpc.h\"\n#include \"ntp.h\"\n#include \"net.h\"\n\nValue getconnectioncount(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 0)\n        throw runtime_error(\n            \"getconnectioncount\\n\"\n            \"Returns the number of connections to other nodes.\");\n\n    LOCK(cs_vNodes);\n    return (int)vNodes.size();\n}"
  }
]