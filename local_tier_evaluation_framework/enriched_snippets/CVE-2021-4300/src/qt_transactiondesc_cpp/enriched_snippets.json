[
  {
    "function_name": "toHTML",
    "container": "TransactionDesc",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/transactiondesc.cpp",
    "lines": "35-277",
    "snippet": "QString TransactionDesc::toHTML(CWallet *wallet, CWalletTx &wtx)\n{\n    QString strHTML;\n\n    {\n        LOCK(wallet->cs_wallet);\n        strHTML.reserve(4000);\n        strHTML += \"<html><font face='verdana, arial, helvetica, sans-serif'>\";\n\n        int64_t nTime = wtx.GetTxTime();\n        int64_t nCredit = wtx.GetCredit();\n        int64_t nDebit = wtx.GetDebit();\n        int64_t nNet = nCredit - nDebit;\n\n        strHTML += \"<b>\" + tr(\"Status\") + \":</b> \" + FormatTxStatus(wtx);\n        int nRequests = wtx.GetRequestCount();\n        if (nRequests != -1)\n        {\n            if (nRequests == 0)\n                strHTML += tr(\", has not been successfully broadcast yet\");\n            else if (nRequests > 0)\n                strHTML += tr(\", broadcast through %n node(s)\", \"\", nRequests);\n        }\n        strHTML += \"<br>\";\n\n        strHTML += \"<b>\" + tr(\"Date\") + \":</b> \" + (nTime ? GUIUtil::dateTimeStr(nTime) : \"\") + \"<br>\";\n\n        //\n        // From\n        //\n        if (wtx.IsCoinBase() || wtx.IsCoinStake())\n        {\n            strHTML += \"<b>\" + tr(\"Source\") + \":</b> \" + tr(\"Generated\") + \"<br>\";\n        }\n        else if (wtx.mapValue.count(\"from\") && !wtx.mapValue[\"from\"].empty())\n        {\n            // Online transaction\n            strHTML += \"<b>\" + tr(\"From\") + \":</b> \" + GUIUtil::HtmlEscape(wtx.mapValue[\"from\"]) + \"<br>\";\n        }\n        else\n        {\n            // Offline transaction\n            if (nNet > 0)\n            {\n                // Credit\n                BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n                {\n                    if (wallet->IsMine(txout))\n                    {\n                        CTxDestination address;\n                        if (ExtractDestination(txout.scriptPubKey, address) && IsMine(*wallet, address))\n                        {\n                            if (wallet->mapAddressBook.count(address))\n                            {\n                                strHTML += \"<b>\" + tr(\"From\") + \":</b> \" + tr(\"unknown\") + \"<br>\";\n                                strHTML += \"<b>\" + tr(\"To\") + \":</b> \";\n                                strHTML += GUIUtil::HtmlEscape(CBitcoinAddress(address).ToString());\n                                if (!wallet->mapAddressBook[address].empty())\n                                    strHTML += \" (\" + tr(\"own address\") + \", \" + tr(\"label\") + \": \" + GUIUtil::HtmlEscape(wallet->mapAddressBook[address]) + \")\";\n                                else\n                                    strHTML += \" (\" + tr(\"own address\") + \")\";\n                                strHTML += \"<br>\";\n                            }\n                        }\n                        break;\n                    }\n                }\n            }\n        }\n\n        //\n        // To\n        //\n        if (wtx.mapValue.count(\"to\") && !wtx.mapValue[\"to\"].empty())\n        {\n            // Online transaction\n            std::string strAddress = wtx.mapValue[\"to\"];\n            strHTML += \"<b>\" + tr(\"To\") + \":</b> \";\n            CTxDestination dest = CBitcoinAddress(strAddress).Get();\n            if (wallet->mapAddressBook.count(dest) && !wallet->mapAddressBook[dest].empty())\n                strHTML += GUIUtil::HtmlEscape(wallet->mapAddressBook[dest]) + \" \";\n            strHTML += GUIUtil::HtmlEscape(strAddress) + \"<br>\";\n        }\n\n        //\n        // Amount\n        //\n        if (wtx.IsCoinBase() && nCredit == 0)\n        {\n            //\n            // Coinbase\n            //\n            int64_t nUnmatured = 0;\n            BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n                nUnmatured += wallet->GetCredit(txout);\n            strHTML += \"<b>\" + tr(\"Credit\") + \":</b> \";\n            if (wtx.IsInMainChain())\n                strHTML += BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, nUnmatured)+ \" (\" + tr(\"matures in %n more block(s)\", \"\", wtx.GetBlocksToMaturity()) + \")\";\n            else\n                strHTML += \"(\" + tr(\"not accepted\") + \")\";\n            strHTML += \"<br>\";\n        }\n        else if (nNet > 0)\n        {\n            //\n            // Credit\n            //\n            strHTML += \"<b>\" + tr(\"Credit\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, nNet) + \"<br>\";\n        }\n        else\n        {\n            bool fAllFromMe = true;\n            BOOST_FOREACH(const CTxIn& txin, wtx.vin)\n                fAllFromMe = fAllFromMe && wallet->IsMine(txin);\n\n            bool fAllToMe = true;\n            BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n                fAllToMe = fAllToMe && wallet->IsMine(txout);\n\n            if (fAllFromMe)\n            {\n                //\n                // Debit\n                //\n                BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n                {\n                    if (wallet->IsMine(txout))\n                        continue;\n\n                    if (!wtx.mapValue.count(\"to\") || wtx.mapValue[\"to\"].empty())\n                    {\n                        // Offline transaction\n                        CTxDestination address;\n                        if (ExtractDestination(txout.scriptPubKey, address))\n                        {\n                            strHTML += \"<b>\" + tr(\"To\") + \":</b> \";\n                            if (wallet->mapAddressBook.count(address) && !wallet->mapAddressBook[address].empty())\n                                strHTML += GUIUtil::HtmlEscape(wallet->mapAddressBook[address]) + \" \";\n                            strHTML += GUIUtil::HtmlEscape(CBitcoinAddress(address).ToString());\n                            strHTML += \"<br>\";\n                        }\n                    }\n\n                    strHTML += \"<b>\" + tr(\"Debit\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, -txout.nValue) + \"<br>\";\n                }\n\n                if (fAllToMe)\n                {\n                    // Payment to self\n                    int64_t nChange = wtx.GetChange();\n                    int64_t nValue = nCredit - nChange;\n                    strHTML += \"<b>\" + tr(\"Debit\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, -nValue) + \"<br>\";\n                    strHTML += \"<b>\" + tr(\"Credit\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, nValue) + \"<br>\";\n                }\n\n                int64_t nTxFee = nDebit - wtx.GetValueOut();\n                if (nTxFee > 0)\n                    strHTML += \"<b>\" + tr(\"Transaction fee\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, -nTxFee) + \"<br>\";\n            }\n            else\n            {\n                //\n                // Mixed debit transaction\n                //\n                BOOST_FOREACH(const CTxIn& txin, wtx.vin)\n                    if (wallet->IsMine(txin))\n                        strHTML += \"<b>\" + tr(\"Debit\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, -wallet->GetDebit(txin)) + \"<br>\";\n                BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n                    if (wallet->IsMine(txout))\n                        strHTML += \"<b>\" + tr(\"Credit\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, wallet->GetCredit(txout)) + \"<br>\";\n            }\n        }\n\n        strHTML += \"<b>\" + tr(\"Net amount\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, nNet, true) + \"<br>\";\n\n        //\n        // Message\n        //\n        if (wtx.mapValue.count(\"message\") && !wtx.mapValue[\"message\"].empty())\n            strHTML += \"<br><b>\" + tr(\"Message\") + \":</b><br>\" + GUIUtil::HtmlEscape(wtx.mapValue[\"message\"], true) + \"<br>\";\n        if (wtx.mapValue.count(\"comment\") && !wtx.mapValue[\"comment\"].empty())\n            strHTML += \"<br><b>\" + tr(\"Comment\") + \":</b><br>\" + GUIUtil::HtmlEscape(wtx.mapValue[\"comment\"], true) + \"<br>\";\n\n        strHTML += \"<b>\" + tr(\"Transaction ID\") + \":</b> \" + wtx.GetHash().ToString().c_str() + \"<br>\";\n\n        if (wtx.IsCoinBase() || wtx.IsCoinStake())\n            strHTML += \"<br>\" + tr(\"Generated coins must mature 60 blocks before they can be spent. When you generated this block, it was broadcast to the network to be added to the block chain. If it fails to get into the chain, its state will change to \\\"not accepted\\\" and it won't be spendable. This may occasionally happen if another node generates a block within a few seconds of yours.\") + \"<br>\";\n\n        //\n        // Debug view\n        //\n        if (fDebug)\n        {\n            strHTML += \"<hr><br>\" + tr(\"Debug information\") + \"<br><br>\";\n            BOOST_FOREACH(const CTxIn& txin, wtx.vin)\n                if(wallet->IsMine(txin))\n                    strHTML += \"<b>\" + tr(\"Debit\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, -wallet->GetDebit(txin)) + \"<br>\";\n            BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n                if(wallet->IsMine(txout))\n                    strHTML += \"<b>\" + tr(\"Credit\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, wallet->GetCredit(txout)) + \"<br>\";\n\n            strHTML += \"<br><b>\" + tr(\"Transaction\") + \":</b><br>\";\n            strHTML += GUIUtil::HtmlEscape(wtx.ToString(), true);\n\n            CTxDB txdb(\"r\"); // To fetch source txouts\n\n            strHTML += \"<br><b>\" + tr(\"Inputs\") + \":</b>\";\n            strHTML += \"<ul>\";\n\n            {\n                LOCK(wallet->cs_wallet);\n                BOOST_FOREACH(const CTxIn& txin, wtx.vin)\n                {\n                    COutPoint prevout = txin.prevout;\n\n                    CTransaction prev;\n                    if(txdb.ReadDiskTx(prevout.hash, prev))\n                    {\n                        if (prevout.n < prev.vout.size())\n                        {\n                            strHTML += \"<li>\";\n                            const CTxOut &vout = prev.vout[prevout.n];\n                            CTxDestination address;\n                            if (ExtractDestination(vout.scriptPubKey, address))\n                            {\n                                if (wallet->mapAddressBook.count(address) && !wallet->mapAddressBook[address].empty())\n                                    strHTML += GUIUtil::HtmlEscape(wallet->mapAddressBook[address]) + \" \";\n                                strHTML += QString::fromStdString(CBitcoinAddress(address).ToString());\n                            }\n                            strHTML = strHTML + \" \" + tr(\"Amount\") + \"=\" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, vout.nValue);\n                            strHTML = strHTML + \" IsMine=\" + (wallet->IsMine(vout) ? tr(\"true\") : tr(\"false\")) + \"</li>\";\n                        }\n                    }\n                }\n            }\n\n            strHTML += \"</ul>\";\n        }\n\n        strHTML += \"</font></html>\";\n    }\n    return strHTML;\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ui_interface.h\"",
      "#include \"txdb.h\"",
      "#include \"wallet.h\"",
      "#include \"main.h\"",
      "#include \"bitcoinunits.h\"",
      "#include \"guiutil.h\"",
      "#include \"transactiondesc.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tr",
          "args": [
            "\"false\""
          ],
          "line": 265
        },
        "resolved": true,
        "details": {
          "function_name": "setValue",
          "container": "SendCoinsEntry",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/sendcoinsentry.cpp",
          "lines": "150-155",
          "snippet": "void SendCoinsEntry::setValue(const SendCoinsRecipient &value)\n{\n    ui->payTo->setText(value.address);\n    ui->addAsLabel->setText(value.label);\n    ui->payAmount->setValue(value.amount);\n}",
          "includes": [
            "#include <QClipboard>",
            "#include <QApplication>",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"walletmodel.h\"",
            "#include \"addressbookpage.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"guiutil.h\"",
            "#include \"ui_sendcoinsentry.h\"",
            "#include \"sendcoinsentry.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QClipboard>\n#include <QApplication>\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"addressbookpage.h\"\n#include \"bitcoinunits.h\"\n#include \"guiutil.h\"\n#include \"ui_sendcoinsentry.h\"\n#include \"sendcoinsentry.h\"\n\nSendCoinsEntry {\n  void SendCoinsEntry::setValue(const SendCoinsRecipient &value)\n  {\n      ui->payTo->setText(value.address);\n      ui->addAsLabel->setText(value.label);\n      ui->payAmount->setValue(value.amount);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wallet->IsMine",
          "args": [
            "vout"
          ],
          "line": 265
        },
        "resolved": true,
        "details": {
          "function_name": "IsMine",
          "container": "CWallet",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.h",
          "lines": "230-236",
          "snippet": "bool IsMine(const CTransaction& tx) const\n    {\n        BOOST_FOREACH(const CTxOut& txout, tx.vout)\n            if (IsMine(txout) && txout.nValue >= nMinimumInputValue)\n                return true;\n        return false;\n    }",
          "includes": [
            "#include \"walletdb.h\"",
            "#include \"util.h\"",
            "#include \"ui_interface.h\"",
            "#include \"script.h\"",
            "#include \"keystore.h\"",
            "#include \"key.h\"",
            "#include \"main.h\"",
            "#include <stdlib.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"walletdb.h\"\n#include \"util.h\"\n#include \"ui_interface.h\"\n#include \"script.h\"\n#include \"keystore.h\"\n#include \"key.h\"\n#include \"main.h\"\n#include <stdlib.h>\n#include <vector>\n#include <string>\n\nCWallet {\n  bool IsMine(const CTransaction& tx) const\n      {\n          BOOST_FOREACH(const CTxOut& txout, tx.vout)\n              if (IsMine(txout) && txout.nValue >= nMinimumInputValue)\n                  return true;\n          return false;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "BitcoinUnits::formatWithUnit",
          "args": [
            "BitcoinUnits::BTC",
            "vout.nValue"
          ],
          "line": 264
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString::fromStdString",
          "args": [
            "CBitcoinAddress(address).ToString()"
          ],
          "line": 262
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "CBitcoinAddress",
          "args": [],
          "line": 262
        },
        "resolved": true,
        "details": {
          "function_name": "IsScript",
          "container": "CBitcoinAddress",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "384-394",
          "snippet": "bool IsScript() const {\n        if (!IsValid())\n            return false;\n        switch (nVersion) {\n        case SCRIPT_ADDRESS:\n        case SCRIPT_ADDRESS_TEST: {\n            return true;\n        }\n        default: return false;\n        }\n    }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddress {\n  bool IsScript() const {\n          if (!IsValid())\n              return false;\n          switch (nVersion) {\n          case SCRIPT_ADDRESS:\n          case SCRIPT_ADDRESS_TEST: {\n              return true;\n          }\n          default: return false;\n          }\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "CBitcoinAddress",
          "args": [
            "address"
          ],
          "line": 262
        },
        "resolved": true,
        "details": {
          "function_name": "operator()",
          "container": "CBitcoinAddressVisitor",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/base58.h",
          "lines": "399-399",
          "snippet": "bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }",
          "includes": [
            "#include \"script.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"script.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include <vector>\n#include <string>\n\nCBitcoinAddressVisitor {\n  bool inline CBitcoinAddressVisitor::operator()(const CNoDestination &id) const { return false; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "GUIUtil::HtmlEscape",
          "args": [
            "wallet->mapAddressBook[address]"
          ],
          "line": 261
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wallet->mapAddressBook[address].empty",
          "args": [],
          "line": 260
        },
        "resolved": true,
        "details": {
          "function_name": "empty",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "32-32",
          "snippet": "bool empty() const { return map.empty(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  bool empty() const { return map.empty(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wallet->mapAddressBook.count",
          "args": [
            "address"
          ],
          "line": 260
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ExtractDestination",
          "args": [
            "vout.scriptPubKey",
            "address"
          ],
          "line": 258
        },
        "resolved": true,
        "details": {
          "function_name": "ExtractDestination",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/script.cpp",
          "lines": "1590-1614",
          "snippet": "bool ExtractDestination(const CScript& scriptPubKey, CTxDestination& addressRet)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    if (whichType == TX_PUBKEY)\n    {\n        addressRet = CPubKey(vSolutions[0]).GetID();\n        return true;\n    }\n    else if (whichType == TX_PUBKEYHASH)\n    {\n        addressRet = CKeyID(uint160(vSolutions[0]));\n        return true;\n    }\n    else if (whichType == TX_SCRIPTHASH)\n    {\n        addressRet = CScriptID(uint160(vSolutions[0]));\n        return true;\n    }\n    // Multisig txns have more than one address...\n    return false;\n}",
          "includes": [
            "#include \"util.h\"",
            "#include \"sync.h\"",
            "#include \"main.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include \"keystore.h\"",
            "#include \"script.h\"",
            "#include <boost/tuple/tuple_comparison.hpp>",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/foreach.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"sync.h\"\n#include \"main.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include \"keystore.h\"\n#include \"script.h\"\n#include <boost/tuple/tuple_comparison.hpp>\n#include <boost/tuple/tuple.hpp>\n#include <boost/foreach.hpp>\n\nbool ExtractDestination(const CScript& scriptPubKey, CTxDestination& addressRet)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    if (whichType == TX_PUBKEY)\n    {\n        addressRet = CPubKey(vSolutions[0]).GetID();\n        return true;\n    }\n    else if (whichType == TX_PUBKEYHASH)\n    {\n        addressRet = CKeyID(uint160(vSolutions[0]));\n        return true;\n    }\n    else if (whichType == TX_SCRIPTHASH)\n    {\n        addressRet = CScriptID(uint160(vSolutions[0]));\n        return true;\n    }\n    // Multisig txns have more than one address...\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "prev.vout.size",
          "args": [],
          "line": 253
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "TransactionTablePriv",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/transactiontablemodel.cpp",
          "lines": "170-173",
          "snippet": "int size()\n    {\n        return cachedWallet.size();\n    }",
          "includes": [
            "#include <QtAlgorithms>",
            "#include <QDateTime>",
            "#include <QIcon>",
            "#include <QTimer>",
            "#include <QColor>",
            "#include <QList>",
            "#include <QLocale>",
            "#include \"ui_interface.h\"",
            "#include \"wallet.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"walletmodel.h\"",
            "#include \"transactiondesc.h\"",
            "#include \"guiconstants.h\"",
            "#include \"transactionrecord.h\"",
            "#include \"guiutil.h\"",
            "#include \"transactiontablemodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QtAlgorithms>\n#include <QDateTime>\n#include <QIcon>\n#include <QTimer>\n#include <QColor>\n#include <QList>\n#include <QLocale>\n#include \"ui_interface.h\"\n#include \"wallet.h\"\n#include \"bitcoinunits.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"transactiondesc.h\"\n#include \"guiconstants.h\"\n#include \"transactionrecord.h\"\n#include \"guiutil.h\"\n#include \"transactiontablemodel.h\"\n\nTransactionTablePriv {\n  int size()\n      {\n          return cachedWallet.size();\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "txdb.ReadDiskTx",
          "args": [
            "prevout.hash",
            "prev"
          ],
          "line": 251
        },
        "resolved": true,
        "details": {
          "function_name": "ReadDiskTx",
          "container": "CTxDB",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/txdb-leveldb.cpp",
          "lines": "256-260",
          "snippet": "bool CTxDB::ReadDiskTx(COutPoint outpoint, CTransaction& tx)\n{\n    CTxIndex txindex;\n    return ReadDiskTx(outpoint.hash, tx, txindex);\n}",
          "includes": [
            "#include \"main.h\"",
            "#include \"util.h\"",
            "#include \"txdb.h\"",
            "#include \"checkpoints.h\"",
            "#include \"kernel.h\"",
            "#include <memenv/memenv.h>",
            "#include <leveldb/filter_policy.h>",
            "#include <leveldb/cache.h>",
            "#include <leveldb/env.h>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/version.hpp>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"main.h\"\n#include \"util.h\"\n#include \"txdb.h\"\n#include \"checkpoints.h\"\n#include \"kernel.h\"\n#include <memenv/memenv.h>\n#include <leveldb/filter_policy.h>\n#include <leveldb/cache.h>\n#include <leveldb/env.h>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/version.hpp>\n#include <map>\n\nCTxDB {\n  bool CTxDB::ReadDiskTx(COutPoint outpoint, CTransaction& tx)\n  {\n      CTxIndex txindex;\n      return ReadDiskTx(outpoint.hash, tx, txindex);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "wallet->cs_wallet"
          ],
          "line": 245
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GUIUtil::HtmlEscape",
          "args": [
            "wtx.ToString()",
            "true"
          ],
          "line": 237
        },
        "resolved": true,
        "details": {
          "function_name": "HtmlEscape",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/guiutil.cpp",
          "lines": "148-151",
          "snippet": "QString HtmlEscape(const std::string& str, bool fMultiLine)\n{\n    return HtmlEscape(QString::fromStdString(str), fMultiLine);\n}",
          "includes": [
            "#include \"shellapi.h\"",
            "#include \"shlobj.h\"",
            "#include \"shlwapi.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <QThread>",
            "#include <QDesktopServices>",
            "#include <QFileDialog>",
            "#include <QClipboard>",
            "#include <QApplication>",
            "#include <QAbstractItemView>",
            "#include <QTextDocument> // For Qt::escape",
            "#include <QUrl>",
            "#include <QLineEdit>",
            "#include <QFont>",
            "#include <QDoubleValidator>",
            "#include <QDateTime>",
            "#include <QString>",
            "#include \"init.h\"",
            "#include \"util.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"walletmodel.h\"",
            "#include \"bitcoinaddressvalidator.h\"",
            "#include \"guiutil.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shellapi.h\"\n#include \"shlobj.h\"\n#include \"shlwapi.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <QThread>\n#include <QDesktopServices>\n#include <QFileDialog>\n#include <QClipboard>\n#include <QApplication>\n#include <QAbstractItemView>\n#include <QTextDocument> // For Qt::escape\n#include <QUrl>\n#include <QLineEdit>\n#include <QFont>\n#include <QDoubleValidator>\n#include <QDateTime>\n#include <QString>\n#include \"init.h\"\n#include \"util.h\"\n#include \"bitcoinunits.h\"\n#include \"walletmodel.h\"\n#include \"bitcoinaddressvalidator.h\"\n#include \"guiutil.h\"\n\nQString HtmlEscape(const std::string& str, bool fMultiLine)\n{\n    return HtmlEscape(QString::fromStdString(str), fMultiLine);\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.ToString",
          "args": [],
          "line": 237
        },
        "resolved": true,
        "details": {
          "function_name": "ToString",
          "container": "CService",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "1172-1175",
          "snippet": "std::string CService::ToString() const\n{\n    return ToStringIPPort();\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCService {\n  std::string CService::ToString() const\n  {\n      return ToStringIPPort();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "BitcoinUnits::formatWithUnit",
          "args": [
            "BitcoinUnits::BTC",
            "wallet->GetCredit(txout)"
          ],
          "line": 234
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wallet->GetCredit",
          "args": [
            "txout"
          ],
          "line": 234
        },
        "resolved": true,
        "details": {
          "function_name": "GetCredit",
          "container": "CWallet",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.h",
          "lines": "252-262",
          "snippet": "int64_t GetCredit(const CTransaction& tx) const\n    {\n        int64_t nCredit = 0;\n        BOOST_FOREACH(const CTxOut& txout, tx.vout)\n        {\n            nCredit += GetCredit(txout);\n            if (!MoneyRange(nCredit))\n                throw std::runtime_error(\"CWallet::GetCredit() : value out of range\");\n        }\n        return nCredit;\n    }",
          "includes": [
            "#include \"walletdb.h\"",
            "#include \"util.h\"",
            "#include \"ui_interface.h\"",
            "#include \"script.h\"",
            "#include \"keystore.h\"",
            "#include \"key.h\"",
            "#include \"main.h\"",
            "#include <stdlib.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"walletdb.h\"\n#include \"util.h\"\n#include \"ui_interface.h\"\n#include \"script.h\"\n#include \"keystore.h\"\n#include \"key.h\"\n#include \"main.h\"\n#include <stdlib.h>\n#include <vector>\n#include <string>\n\nCWallet {\n  int64_t GetCredit(const CTransaction& tx) const\n      {\n          int64_t nCredit = 0;\n          BOOST_FOREACH(const CTxOut& txout, tx.vout)\n          {\n              nCredit += GetCredit(txout);\n              if (!MoneyRange(nCredit))\n                  throw std::runtime_error(\"CWallet::GetCredit() : value out of range\");\n          }\n          return nCredit;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "BitcoinUnits::formatWithUnit",
          "args": [
            "BitcoinUnits::BTC",
            "-wallet->GetDebit(txin)"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wallet->GetDebit",
          "args": [
            "txin"
          ],
          "line": 231
        },
        "resolved": true,
        "details": {
          "function_name": "GetDebit",
          "container": "CWallet",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.h",
          "lines": "241-251",
          "snippet": "int64_t GetDebit(const CTransaction& tx) const\n    {\n        int64_t nDebit = 0;\n        BOOST_FOREACH(const CTxIn& txin, tx.vin)\n        {\n            nDebit += GetDebit(txin);\n            if (!MoneyRange(nDebit))\n                throw std::runtime_error(\"CWallet::GetDebit() : value out of range\");\n        }\n        return nDebit;\n    }",
          "includes": [
            "#include \"walletdb.h\"",
            "#include \"util.h\"",
            "#include \"ui_interface.h\"",
            "#include \"script.h\"",
            "#include \"keystore.h\"",
            "#include \"key.h\"",
            "#include \"main.h\"",
            "#include <stdlib.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"walletdb.h\"\n#include \"util.h\"\n#include \"ui_interface.h\"\n#include \"script.h\"\n#include \"keystore.h\"\n#include \"key.h\"\n#include \"main.h\"\n#include <stdlib.h>\n#include <vector>\n#include <string>\n\nCWallet {\n  int64_t GetDebit(const CTransaction& tx) const\n      {\n          int64_t nDebit = 0;\n          BOOST_FOREACH(const CTxIn& txin, tx.vin)\n          {\n              nDebit += GetDebit(txin);\n              if (!MoneyRange(nDebit))\n                  throw std::runtime_error(\"CWallet::GetDebit() : value out of range\");\n          }\n          return nDebit;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.IsCoinStake",
          "args": [],
          "line": 220
        },
        "resolved": true,
        "details": {
          "function_name": "IsCoinStake",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "542-546",
          "snippet": "bool IsCoinStake() const\n    {\n        // ppcoin: the coin stake transaction is marked with the first output empty\n        return (vin.size() > 0 && (!vin[0].prevout.IsNull()) && vout.size() >= 2 && vout[0].IsEmpty());\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  bool IsCoinStake() const\n      {\n          // ppcoin: the coin stake transaction is marked with the first output empty\n          return (vin.size() > 0 && (!vin[0].prevout.IsNull()) && vout.size() >= 2 && vout[0].IsEmpty());\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.IsCoinBase",
          "args": [],
          "line": 220
        },
        "resolved": true,
        "details": {
          "function_name": "IsCoinBase",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "537-540",
          "snippet": "bool IsCoinBase() const\n    {\n        return (vin.size() == 1 && vin[0].prevout.IsNull() && vout.size() >= 1);\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  bool IsCoinBase() const\n      {\n          return (vin.size() == 1 && vin[0].prevout.IsNull() && vout.size() >= 1);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetHash",
          "args": [],
          "line": 218
        },
        "resolved": true,
        "details": {
          "function_name": "GetHash",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "922-928",
          "snippet": "uint64_t CNetAddr::GetHash() const\n{\n    uint256 hash = Hash(&ip[0], &ip[16]);\n    uint64_t nRet;\n    memcpy(&nRet, &hash, sizeof(nRet));\n    return nRet;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCNetAddr {\n  uint64_t CNetAddr::GetHash() const\n  {\n      uint256 hash = Hash(&ip[0], &ip[16]);\n      uint64_t nRet;\n      memcpy(&nRet, &hash, sizeof(nRet));\n      return nRet;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "BitcoinUnits::formatWithUnit",
          "args": [
            "BitcoinUnits::BTC",
            "nNet",
            "true"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BitcoinUnits::formatWithUnit",
          "args": [
            "BitcoinUnits::BTC",
            "wallet->GetCredit(txout)"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BitcoinUnits::formatWithUnit",
          "args": [
            "BitcoinUnits::BTC",
            "-wallet->GetDebit(txin)"
          ],
          "line": 201
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BitcoinUnits::formatWithUnit",
          "args": [
            "BitcoinUnits::BTC",
            "-nTxFee"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wtx.GetValueOut",
          "args": [],
          "line": 190
        },
        "resolved": true,
        "details": {
          "function_name": "GetValueOut",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "577-587",
          "snippet": "int64_t GetValueOut() const\n    {\n        int64_t nValueOut = 0;\n        BOOST_FOREACH(const CTxOut& txout, vout)\n        {\n            nValueOut += txout.nValue;\n            if (!MoneyRange(txout.nValue) || !MoneyRange(nValueOut))\n                throw std::runtime_error(\"CTransaction::GetValueOut() : value out of range\");\n        }\n        return nValueOut;\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  int64_t GetValueOut() const\n      {\n          int64_t nValueOut = 0;\n          BOOST_FOREACH(const CTxOut& txout, vout)\n          {\n              nValueOut += txout.nValue;\n              if (!MoneyRange(txout.nValue) || !MoneyRange(nValueOut))\n                  throw std::runtime_error(\"CTransaction::GetValueOut() : value out of range\");\n          }\n          return nValueOut;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "BitcoinUnits::formatWithUnit",
          "args": [
            "BitcoinUnits::BTC",
            "nValue"
          ],
          "line": 187
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BitcoinUnits::formatWithUnit",
          "args": [
            "BitcoinUnits::BTC",
            "-nValue"
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wtx.GetChange",
          "args": [],
          "line": 184
        },
        "resolved": true,
        "details": {
          "function_name": "GetChange",
          "container": "CWalletTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.h",
          "lines": "626-633",
          "snippet": "int64_t GetChange() const\n    {\n        if (fChangeCached)\n            return nChangeCached;\n        nChangeCached = pwallet->GetChange(*this);\n        fChangeCached = true;\n        return nChangeCached;\n    }",
          "includes": [
            "#include \"walletdb.h\"",
            "#include \"util.h\"",
            "#include \"ui_interface.h\"",
            "#include \"script.h\"",
            "#include \"keystore.h\"",
            "#include \"key.h\"",
            "#include \"main.h\"",
            "#include <stdlib.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"walletdb.h\"\n#include \"util.h\"\n#include \"ui_interface.h\"\n#include \"script.h\"\n#include \"keystore.h\"\n#include \"key.h\"\n#include \"main.h\"\n#include <stdlib.h>\n#include <vector>\n#include <string>\n\nCWalletTx {\n  int64_t GetChange() const\n      {\n          if (fChangeCached)\n              return nChangeCached;\n          nChangeCached = pwallet->GetChange(*this);\n          fChangeCached = true;\n          return nChangeCached;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "BitcoinUnits::formatWithUnit",
          "args": [
            "BitcoinUnits::BTC",
            "-txout.nValue"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GUIUtil::HtmlEscape",
          "args": [
            "CBitcoinAddress(address).ToString()"
          ],
          "line": 173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GUIUtil::HtmlEscape",
          "args": [
            "wallet->mapAddressBook[address]"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BitcoinUnits::formatWithUnit",
          "args": [
            "BitcoinUnits::BTC",
            "nNet"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tr",
          "args": [
            "\"matures in %n more block(s)\"",
            "\"\"",
            "wtx.GetBlocksToMaturity()"
          ],
          "line": 132
        },
        "resolved": true,
        "details": {
          "function_name": "copyEntryData",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/guiutil.cpp",
          "lines": "153-164",
          "snippet": "void copyEntryData(QAbstractItemView *view, int column, int role)\n{\n    if(!view || !view->selectionModel())\n        return;\n    QModelIndexList selection = view->selectionModel()->selectedRows(column);\n\n    if(!selection.isEmpty())\n    {\n        // Copy first item\n        QApplication::clipboard()->setText(selection.at(0).data(role).toString());\n    }\n}",
          "includes": [
            "#include \"shellapi.h\"",
            "#include \"shlobj.h\"",
            "#include \"shlwapi.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <QThread>",
            "#include <QDesktopServices>",
            "#include <QFileDialog>",
            "#include <QClipboard>",
            "#include <QApplication>",
            "#include <QAbstractItemView>",
            "#include <QTextDocument> // For Qt::escape",
            "#include <QUrl>",
            "#include <QLineEdit>",
            "#include <QFont>",
            "#include <QDoubleValidator>",
            "#include <QDateTime>",
            "#include <QString>",
            "#include \"init.h\"",
            "#include \"util.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"walletmodel.h\"",
            "#include \"bitcoinaddressvalidator.h\"",
            "#include \"guiutil.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shellapi.h\"\n#include \"shlobj.h\"\n#include \"shlwapi.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <QThread>\n#include <QDesktopServices>\n#include <QFileDialog>\n#include <QClipboard>\n#include <QApplication>\n#include <QAbstractItemView>\n#include <QTextDocument> // For Qt::escape\n#include <QUrl>\n#include <QLineEdit>\n#include <QFont>\n#include <QDoubleValidator>\n#include <QDateTime>\n#include <QString>\n#include \"init.h\"\n#include \"util.h\"\n#include \"bitcoinunits.h\"\n#include \"walletmodel.h\"\n#include \"bitcoinaddressvalidator.h\"\n#include \"guiutil.h\"\n\nvoid copyEntryData(QAbstractItemView *view, int column, int role)\n{\n    if(!view || !view->selectionModel())\n        return;\n    QModelIndexList selection = view->selectionModel()->selectedRows(column);\n\n    if(!selection.isEmpty())\n    {\n        // Copy first item\n        QApplication::clipboard()->setText(selection.at(0).data(role).toString());\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetBlocksToMaturity",
          "args": [],
          "line": 132
        },
        "resolved": true,
        "details": {
          "function_name": "GetBlocksToMaturity",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
          "lines": "817-822",
          "snippet": "int CMerkleTx::GetBlocksToMaturity() const\n{\n    if (!(IsCoinBase() || IsCoinStake()))\n        return 0;\n    return max(0, (nCoinbaseMaturity+10) - GetDepthInMainChain());\n}",
          "includes": [
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"kernel.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"txdb.h\"",
            "#include \"db.h\"",
            "#include \"checkpoints.h\"",
            "#include \"alert.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "int nCoinbaseMaturity = 50;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/algorithm/string/replace.hpp>\n#include \"kernel.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"txdb.h\"\n#include \"db.h\"\n#include \"checkpoints.h\"\n#include \"alert.h\"\n\nint nCoinbaseMaturity = 50;\n\nCMerkleTx {\n  int CMerkleTx::GetBlocksToMaturity() const\n  {\n      if (!(IsCoinBase() || IsCoinStake()))\n          return 0;\n      return max(0, (nCoinbaseMaturity+10) - GetDepthInMainChain());\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "BitcoinUnits::formatWithUnit",
          "args": [
            "BitcoinUnits::BTC",
            "nUnmatured"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "wtx.IsInMainChain",
          "args": [],
          "line": 131
        },
        "resolved": true,
        "details": {
          "function_name": "IsInMainChain",
          "container": "CBlockIndex",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "1291-1294",
          "snippet": "bool IsInMainChain() const\n    {\n        return (pnext || this == pindexBest);\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCBlockIndex {\n  bool IsInMainChain() const\n      {\n          return (pnext || this == pindexBest);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "GUIUtil::HtmlEscape",
          "args": [
            "strAddress"
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GUIUtil::HtmlEscape",
          "args": [
            "wallet->mapAddressBook[dest]"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GUIUtil::HtmlEscape",
          "args": [
            "wallet->mapAddressBook[address]"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GUIUtil::HtmlEscape",
          "args": [
            "CBitcoinAddress(address).ToString()"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IsMine",
          "args": [
            "*wallet",
            "address"
          ],
          "line": 85
        },
        "resolved": true,
        "details": {
          "function_name": "IsMine",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/script.cpp",
          "lines": "1551-1588",
          "snippet": "bool IsMine(const CKeyStore &keystore, const CScript& scriptPubKey)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    CKeyID keyID;\n    switch (whichType)\n    {\n    case TX_NONSTANDARD:\n        return false;\n    case TX_PUBKEY:\n        keyID = CPubKey(vSolutions[0]).GetID();\n        return keystore.HaveKey(keyID);\n    case TX_PUBKEYHASH:\n        keyID = CKeyID(uint160(vSolutions[0]));\n        return keystore.HaveKey(keyID);\n    case TX_SCRIPTHASH:\n    {\n        CScript subscript;\n        if (!keystore.GetCScript(CScriptID(uint160(vSolutions[0])), subscript))\n            return false;\n        return IsMine(keystore, subscript);\n    }\n    case TX_MULTISIG:\n    {\n        // Only consider transactions \"mine\" if we own ALL the\n        // keys involved. multi-signature transactions that are\n        // partially owned (somebody else has a key that can spend\n        // them) enable spend-out-from-under-you attacks, especially\n        // in shared-wallet situations.\n        vector<valtype> keys(vSolutions.begin()+1, vSolutions.begin()+vSolutions.size()-1);\n        return HaveKeys(keys, keystore) == keys.size();\n    }\n    }\n    return false;\n}",
          "includes": [
            "#include \"util.h\"",
            "#include \"sync.h\"",
            "#include \"main.h\"",
            "#include \"key.h\"",
            "#include \"bignum.h\"",
            "#include \"keystore.h\"",
            "#include \"script.h\"",
            "#include <boost/tuple/tuple_comparison.hpp>",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/foreach.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"sync.h\"\n#include \"main.h\"\n#include \"key.h\"\n#include \"bignum.h\"\n#include \"keystore.h\"\n#include \"script.h\"\n#include <boost/tuple/tuple_comparison.hpp>\n#include <boost/tuple/tuple.hpp>\n#include <boost/foreach.hpp>\n\nbool IsMine(const CKeyStore &keystore, const CScript& scriptPubKey)\n{\n    vector<valtype> vSolutions;\n    txnouttype whichType;\n    if (!Solver(scriptPubKey, whichType, vSolutions))\n        return false;\n\n    CKeyID keyID;\n    switch (whichType)\n    {\n    case TX_NONSTANDARD:\n        return false;\n    case TX_PUBKEY:\n        keyID = CPubKey(vSolutions[0]).GetID();\n        return keystore.HaveKey(keyID);\n    case TX_PUBKEYHASH:\n        keyID = CKeyID(uint160(vSolutions[0]));\n        return keystore.HaveKey(keyID);\n    case TX_SCRIPTHASH:\n    {\n        CScript subscript;\n        if (!keystore.GetCScript(CScriptID(uint160(vSolutions[0])), subscript))\n            return false;\n        return IsMine(keystore, subscript);\n    }\n    case TX_MULTISIG:\n    {\n        // Only consider transactions \"mine\" if we own ALL the\n        // keys involved. multi-signature transactions that are\n        // partially owned (somebody else has a key that can spend\n        // them) enable spend-out-from-under-you attacks, especially\n        // in shared-wallet situations.\n        vector<valtype> keys(vSolutions.begin()+1, vSolutions.begin()+vSolutions.size()-1);\n        return HaveKeys(keys, keystore) == keys.size();\n    }\n    }\n    return false;\n}"
        }
      },
      {
        "call_info": {
          "callee": "GUIUtil::HtmlEscape",
          "args": [
            "wtx.mapValue[\"from\"]"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GUIUtil::dateTimeStr",
          "args": [
            "nTime"
          ],
          "line": 60
        },
        "resolved": true,
        "details": {
          "function_name": "dateTimeStr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/guiutil.cpp",
          "lines": "50-53",
          "snippet": "QString dateTimeStr(qint64 nTime)\n{\n    return dateTimeStr(QDateTime::fromTime_t((qint32)nTime));\n}",
          "includes": [
            "#include \"shellapi.h\"",
            "#include \"shlobj.h\"",
            "#include \"shlwapi.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <QThread>",
            "#include <QDesktopServices>",
            "#include <QFileDialog>",
            "#include <QClipboard>",
            "#include <QApplication>",
            "#include <QAbstractItemView>",
            "#include <QTextDocument> // For Qt::escape",
            "#include <QUrl>",
            "#include <QLineEdit>",
            "#include <QFont>",
            "#include <QDoubleValidator>",
            "#include <QDateTime>",
            "#include <QString>",
            "#include \"init.h\"",
            "#include \"util.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"walletmodel.h\"",
            "#include \"bitcoinaddressvalidator.h\"",
            "#include \"guiutil.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shellapi.h\"\n#include \"shlobj.h\"\n#include \"shlwapi.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <QThread>\n#include <QDesktopServices>\n#include <QFileDialog>\n#include <QClipboard>\n#include <QApplication>\n#include <QAbstractItemView>\n#include <QTextDocument> // For Qt::escape\n#include <QUrl>\n#include <QLineEdit>\n#include <QFont>\n#include <QDoubleValidator>\n#include <QDateTime>\n#include <QString>\n#include \"init.h\"\n#include \"util.h\"\n#include \"bitcoinunits.h\"\n#include \"walletmodel.h\"\n#include \"bitcoinaddressvalidator.h\"\n#include \"guiutil.h\"\n\nQString dateTimeStr(qint64 nTime)\n{\n    return dateTimeStr(QDateTime::fromTime_t((qint32)nTime));\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetRequestCount",
          "args": [],
          "line": 50
        },
        "resolved": true,
        "details": {
          "function_name": "GetRequestCount",
          "container": "CWalletTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.cpp",
          "lines": "639-676",
          "snippet": "int CWalletTx::GetRequestCount() const\n{\n    // Returns -1 if it wasn't being tracked\n    int nRequests = -1;\n    {\n        LOCK(pwallet->cs_wallet);\n        if (IsCoinBase() || IsCoinStake())\n        {\n            // Generated block\n            if (hashBlock != 0)\n            {\n                map<uint256, int>::const_iterator mi = pwallet->mapRequestCount.find(hashBlock);\n                if (mi != pwallet->mapRequestCount.end())\n                    nRequests = (*mi).second;\n            }\n        }\n        else\n        {\n            // Did anyone request this transaction?\n            map<uint256, int>::const_iterator mi = pwallet->mapRequestCount.find(GetHash());\n            if (mi != pwallet->mapRequestCount.end())\n            {\n                nRequests = (*mi).second;\n\n                // How about the block it's in?\n                if (nRequests == 0 && hashBlock != 0)\n                {\n                    map<uint256, int>::const_iterator mi = pwallet->mapRequestCount.find(hashBlock);\n                    if (mi != pwallet->mapRequestCount.end())\n                        nRequests = (*mi).second;\n                    else\n                        nRequests = 1; // If it's in someone else's block it must have got out\n                }\n            }\n        }\n    }\n    return nRequests;\n}",
          "includes": [
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"coincontrol.h\"",
            "#include \"kernel.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"crypter.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\"",
            "#include \"txdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/replace.hpp>\n#include \"coincontrol.h\"\n#include \"kernel.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"crypter.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n#include \"txdb.h\"\n\nCWalletTx {\n  int CWalletTx::GetRequestCount() const\n  {\n      // Returns -1 if it wasn't being tracked\n      int nRequests = -1;\n      {\n          LOCK(pwallet->cs_wallet);\n          if (IsCoinBase() || IsCoinStake())\n          {\n              // Generated block\n              if (hashBlock != 0)\n              {\n                  map<uint256, int>::const_iterator mi = pwallet->mapRequestCount.find(hashBlock);\n                  if (mi != pwallet->mapRequestCount.end())\n                      nRequests = (*mi).second;\n              }\n          }\n          else\n          {\n              // Did anyone request this transaction?\n              map<uint256, int>::const_iterator mi = pwallet->mapRequestCount.find(GetHash());\n              if (mi != pwallet->mapRequestCount.end())\n              {\n                  nRequests = (*mi).second;\n  \n                  // How about the block it's in?\n                  if (nRequests == 0 && hashBlock != 0)\n                  {\n                      map<uint256, int>::const_iterator mi = pwallet->mapRequestCount.find(hashBlock);\n                      if (mi != pwallet->mapRequestCount.end())\n                          nRequests = (*mi).second;\n                      else\n                          nRequests = 1; // If it's in someone else's block it must have got out\n                  }\n              }\n          }\n      }\n      return nRequests;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "FormatTxStatus",
          "args": [
            "wtx"
          ],
          "line": 49
        },
        "resolved": true,
        "details": {
          "function_name": "FormatTxStatus",
          "container": "TransactionDesc",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/transactiondesc.cpp",
          "lines": "12-33",
          "snippet": "QString TransactionDesc::FormatTxStatus(const CWalletTx& wtx)\n{\n    if (!wtx.IsFinal())\n    {\n        if (wtx.nLockTime < LOCKTIME_THRESHOLD)\n            return tr(\"Open for %n block(s)\", \"\", nBestHeight - wtx.nLockTime);\n        else\n            return tr(\"Open until %1\").arg(GUIUtil::dateTimeStr(wtx.nLockTime));\n    }\n    else\n    {\n        int nDepth = wtx.GetDepthInMainChain();\n        if (nDepth < 0)\n            return tr(\"conflicted\");\n        else if (GetAdjustedTime() - wtx.nTimeReceived > 2 * 60 && wtx.GetRequestCount() == 0)\n            return tr(\"%1/offline\").arg(nDepth);\n        else if (nDepth < 10)\n            return tr(\"%1/unconfirmed\").arg(nDepth);\n        else\n            return tr(\"%1 confirmations\").arg(nDepth);\n    }\n}",
          "includes": [
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"txdb.h\"",
            "#include \"wallet.h\"",
            "#include \"main.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"guiutil.h\"",
            "#include \"transactiondesc.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"txdb.h\"\n#include \"wallet.h\"\n#include \"main.h\"\n#include \"bitcoinunits.h\"\n#include \"guiutil.h\"\n#include \"transactiondesc.h\"\n\nTransactionDesc {\n  QString TransactionDesc::FormatTxStatus(const CWalletTx& wtx)\n  {\n      if (!wtx.IsFinal())\n      {\n          if (wtx.nLockTime < LOCKTIME_THRESHOLD)\n              return tr(\"Open for %n block(s)\", \"\", nBestHeight - wtx.nLockTime);\n          else\n              return tr(\"Open until %1\").arg(GUIUtil::dateTimeStr(wtx.nLockTime));\n      }\n      else\n      {\n          int nDepth = wtx.GetDepthInMainChain();\n          if (nDepth < 0)\n              return tr(\"conflicted\");\n          else if (GetAdjustedTime() - wtx.nTimeReceived > 2 * 60 && wtx.GetRequestCount() == 0)\n              return tr(\"%1/offline\").arg(nDepth);\n          else if (nDepth < 10)\n              return tr(\"%1/unconfirmed\").arg(nDepth);\n          else\n              return tr(\"%1 confirmations\").arg(nDepth);\n      }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetDebit",
          "args": [],
          "line": 46
        },
        "resolved": true,
        "details": {
          "function_name": "GetDebit",
          "container": "CWalletTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.h",
          "lines": "574-583",
          "snippet": "int64_t GetDebit() const\n    {\n        if (vin.empty())\n            return 0;\n        if (fDebitCached)\n            return nDebitCached;\n        nDebitCached = pwallet->GetDebit(*this);\n        fDebitCached = true;\n        return nDebitCached;\n    }",
          "includes": [
            "#include \"walletdb.h\"",
            "#include \"util.h\"",
            "#include \"ui_interface.h\"",
            "#include \"script.h\"",
            "#include \"keystore.h\"",
            "#include \"key.h\"",
            "#include \"main.h\"",
            "#include <stdlib.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"walletdb.h\"\n#include \"util.h\"\n#include \"ui_interface.h\"\n#include \"script.h\"\n#include \"keystore.h\"\n#include \"key.h\"\n#include \"main.h\"\n#include <stdlib.h>\n#include <vector>\n#include <string>\n\nCWalletTx {\n  int64_t GetDebit() const\n      {\n          if (vin.empty())\n              return 0;\n          if (fDebitCached)\n              return nDebitCached;\n          nDebitCached = pwallet->GetDebit(*this);\n          fDebitCached = true;\n          return nDebitCached;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetCredit",
          "args": [],
          "line": 45
        },
        "resolved": true,
        "details": {
          "function_name": "GetCredit",
          "container": "CWalletTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.h",
          "lines": "585-597",
          "snippet": "int64_t GetCredit(bool fUseCache=true) const\n    {\n        // Must wait until coinbase is safely deep enough in the chain before valuing it\n        if ((IsCoinBase() || IsCoinStake()) && GetBlocksToMaturity() > 0)\n            return 0;\n\n        // GetBalance can assume transactions in mapWallet won't change\n        if (fUseCache && fCreditCached)\n            return nCreditCached;\n        nCreditCached = pwallet->GetCredit(*this);\n        fCreditCached = true;\n        return nCreditCached;\n    }",
          "includes": [
            "#include \"walletdb.h\"",
            "#include \"util.h\"",
            "#include \"ui_interface.h\"",
            "#include \"script.h\"",
            "#include \"keystore.h\"",
            "#include \"key.h\"",
            "#include \"main.h\"",
            "#include <stdlib.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"walletdb.h\"\n#include \"util.h\"\n#include \"ui_interface.h\"\n#include \"script.h\"\n#include \"keystore.h\"\n#include \"key.h\"\n#include \"main.h\"\n#include <stdlib.h>\n#include <vector>\n#include <string>\n\nCWalletTx {\n  int64_t GetCredit(bool fUseCache=true) const\n      {\n          // Must wait until coinbase is safely deep enough in the chain before valuing it\n          if ((IsCoinBase() || IsCoinStake()) && GetBlocksToMaturity() > 0)\n              return 0;\n  \n          // GetBalance can assume transactions in mapWallet won't change\n          if (fUseCache && fCreditCached)\n              return nCreditCached;\n          nCreditCached = pwallet->GetCredit(*this);\n          fCreditCached = true;\n          return nCreditCached;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetTxTime",
          "args": [],
          "line": 44
        },
        "resolved": true,
        "details": {
          "function_name": "GetTxTime",
          "container": "CWalletTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.cpp",
          "lines": "633-637",
          "snippet": "int64_t CWalletTx::GetTxTime() const\n{\n    int64_t n = nTimeSmart;\n    return n ? n : nTimeReceived;\n}",
          "includes": [
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"coincontrol.h\"",
            "#include \"kernel.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"crypter.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\"",
            "#include \"txdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/replace.hpp>\n#include \"coincontrol.h\"\n#include \"kernel.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"crypter.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n#include \"txdb.h\"\n\nCWalletTx {\n  int64_t CWalletTx::GetTxTime() const\n  {\n      int64_t n = nTimeSmart;\n      return n ? n : nTimeReceived;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "strHTML.reserve",
          "args": [
            "4000"
          ],
          "line": 41
        },
        "resolved": true,
        "details": {
          "function_name": "reserve",
          "container": "CDataStream",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "805-805",
          "snippet": "void reserve(size_type n)                        { vch.reserve(n + nReadPos); }",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nCDataStream {\n  void reserve(size_type n)                        { vch.reserve(n + nReadPos); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "wallet->cs_wallet"
          ],
          "line": 40
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"txdb.h\"\n#include \"wallet.h\"\n#include \"main.h\"\n#include \"bitcoinunits.h\"\n#include \"guiutil.h\"\n#include \"transactiondesc.h\"\n\nTransactionDesc {\n  QString TransactionDesc::toHTML(CWallet *wallet, CWalletTx &wtx)\n  {\n      QString strHTML;\n  \n      {\n          LOCK(wallet->cs_wallet);\n          strHTML.reserve(4000);\n          strHTML += \"<html><font face='verdana, arial, helvetica, sans-serif'>\";\n  \n          int64_t nTime = wtx.GetTxTime();\n          int64_t nCredit = wtx.GetCredit();\n          int64_t nDebit = wtx.GetDebit();\n          int64_t nNet = nCredit - nDebit;\n  \n          strHTML += \"<b>\" + tr(\"Status\") + \":</b> \" + FormatTxStatus(wtx);\n          int nRequests = wtx.GetRequestCount();\n          if (nRequests != -1)\n          {\n              if (nRequests == 0)\n                  strHTML += tr(\", has not been successfully broadcast yet\");\n              else if (nRequests > 0)\n                  strHTML += tr(\", broadcast through %n node(s)\", \"\", nRequests);\n          }\n          strHTML += \"<br>\";\n  \n          strHTML += \"<b>\" + tr(\"Date\") + \":</b> \" + (nTime ? GUIUtil::dateTimeStr(nTime) : \"\") + \"<br>\";\n  \n          //\n          // From\n          //\n          if (wtx.IsCoinBase() || wtx.IsCoinStake())\n          {\n              strHTML += \"<b>\" + tr(\"Source\") + \":</b> \" + tr(\"Generated\") + \"<br>\";\n          }\n          else if (wtx.mapValue.count(\"from\") && !wtx.mapValue[\"from\"].empty())\n          {\n              // Online transaction\n              strHTML += \"<b>\" + tr(\"From\") + \":</b> \" + GUIUtil::HtmlEscape(wtx.mapValue[\"from\"]) + \"<br>\";\n          }\n          else\n          {\n              // Offline transaction\n              if (nNet > 0)\n              {\n                  // Credit\n                  BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n                  {\n                      if (wallet->IsMine(txout))\n                      {\n                          CTxDestination address;\n                          if (ExtractDestination(txout.scriptPubKey, address) && IsMine(*wallet, address))\n                          {\n                              if (wallet->mapAddressBook.count(address))\n                              {\n                                  strHTML += \"<b>\" + tr(\"From\") + \":</b> \" + tr(\"unknown\") + \"<br>\";\n                                  strHTML += \"<b>\" + tr(\"To\") + \":</b> \";\n                                  strHTML += GUIUtil::HtmlEscape(CBitcoinAddress(address).ToString());\n                                  if (!wallet->mapAddressBook[address].empty())\n                                      strHTML += \" (\" + tr(\"own address\") + \", \" + tr(\"label\") + \": \" + GUIUtil::HtmlEscape(wallet->mapAddressBook[address]) + \")\";\n                                  else\n                                      strHTML += \" (\" + tr(\"own address\") + \")\";\n                                  strHTML += \"<br>\";\n                              }\n                          }\n                          break;\n                      }\n                  }\n              }\n          }\n  \n          //\n          // To\n          //\n          if (wtx.mapValue.count(\"to\") && !wtx.mapValue[\"to\"].empty())\n          {\n              // Online transaction\n              std::string strAddress = wtx.mapValue[\"to\"];\n              strHTML += \"<b>\" + tr(\"To\") + \":</b> \";\n              CTxDestination dest = CBitcoinAddress(strAddress).Get();\n              if (wallet->mapAddressBook.count(dest) && !wallet->mapAddressBook[dest].empty())\n                  strHTML += GUIUtil::HtmlEscape(wallet->mapAddressBook[dest]) + \" \";\n              strHTML += GUIUtil::HtmlEscape(strAddress) + \"<br>\";\n          }\n  \n          //\n          // Amount\n          //\n          if (wtx.IsCoinBase() && nCredit == 0)\n          {\n              //\n              // Coinbase\n              //\n              int64_t nUnmatured = 0;\n              BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n                  nUnmatured += wallet->GetCredit(txout);\n              strHTML += \"<b>\" + tr(\"Credit\") + \":</b> \";\n              if (wtx.IsInMainChain())\n                  strHTML += BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, nUnmatured)+ \" (\" + tr(\"matures in %n more block(s)\", \"\", wtx.GetBlocksToMaturity()) + \")\";\n              else\n                  strHTML += \"(\" + tr(\"not accepted\") + \")\";\n              strHTML += \"<br>\";\n          }\n          else if (nNet > 0)\n          {\n              //\n              // Credit\n              //\n              strHTML += \"<b>\" + tr(\"Credit\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, nNet) + \"<br>\";\n          }\n          else\n          {\n              bool fAllFromMe = true;\n              BOOST_FOREACH(const CTxIn& txin, wtx.vin)\n                  fAllFromMe = fAllFromMe && wallet->IsMine(txin);\n  \n              bool fAllToMe = true;\n              BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n                  fAllToMe = fAllToMe && wallet->IsMine(txout);\n  \n              if (fAllFromMe)\n              {\n                  //\n                  // Debit\n                  //\n                  BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n                  {\n                      if (wallet->IsMine(txout))\n                          continue;\n  \n                      if (!wtx.mapValue.count(\"to\") || wtx.mapValue[\"to\"].empty())\n                      {\n                          // Offline transaction\n                          CTxDestination address;\n                          if (ExtractDestination(txout.scriptPubKey, address))\n                          {\n                              strHTML += \"<b>\" + tr(\"To\") + \":</b> \";\n                              if (wallet->mapAddressBook.count(address) && !wallet->mapAddressBook[address].empty())\n                                  strHTML += GUIUtil::HtmlEscape(wallet->mapAddressBook[address]) + \" \";\n                              strHTML += GUIUtil::HtmlEscape(CBitcoinAddress(address).ToString());\n                              strHTML += \"<br>\";\n                          }\n                      }\n  \n                      strHTML += \"<b>\" + tr(\"Debit\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, -txout.nValue) + \"<br>\";\n                  }\n  \n                  if (fAllToMe)\n                  {\n                      // Payment to self\n                      int64_t nChange = wtx.GetChange();\n                      int64_t nValue = nCredit - nChange;\n                      strHTML += \"<b>\" + tr(\"Debit\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, -nValue) + \"<br>\";\n                      strHTML += \"<b>\" + tr(\"Credit\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, nValue) + \"<br>\";\n                  }\n  \n                  int64_t nTxFee = nDebit - wtx.GetValueOut();\n                  if (nTxFee > 0)\n                      strHTML += \"<b>\" + tr(\"Transaction fee\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, -nTxFee) + \"<br>\";\n              }\n              else\n              {\n                  //\n                  // Mixed debit transaction\n                  //\n                  BOOST_FOREACH(const CTxIn& txin, wtx.vin)\n                      if (wallet->IsMine(txin))\n                          strHTML += \"<b>\" + tr(\"Debit\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, -wallet->GetDebit(txin)) + \"<br>\";\n                  BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n                      if (wallet->IsMine(txout))\n                          strHTML += \"<b>\" + tr(\"Credit\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, wallet->GetCredit(txout)) + \"<br>\";\n              }\n          }\n  \n          strHTML += \"<b>\" + tr(\"Net amount\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, nNet, true) + \"<br>\";\n  \n          //\n          // Message\n          //\n          if (wtx.mapValue.count(\"message\") && !wtx.mapValue[\"message\"].empty())\n              strHTML += \"<br><b>\" + tr(\"Message\") + \":</b><br>\" + GUIUtil::HtmlEscape(wtx.mapValue[\"message\"], true) + \"<br>\";\n          if (wtx.mapValue.count(\"comment\") && !wtx.mapValue[\"comment\"].empty())\n              strHTML += \"<br><b>\" + tr(\"Comment\") + \":</b><br>\" + GUIUtil::HtmlEscape(wtx.mapValue[\"comment\"], true) + \"<br>\";\n  \n          strHTML += \"<b>\" + tr(\"Transaction ID\") + \":</b> \" + wtx.GetHash().ToString().c_str() + \"<br>\";\n  \n          if (wtx.IsCoinBase() || wtx.IsCoinStake())\n              strHTML += \"<br>\" + tr(\"Generated coins must mature 60 blocks before they can be spent. When you generated this block, it was broadcast to the network to be added to the block chain. If it fails to get into the chain, its state will change to \\\"not accepted\\\" and it won't be spendable. This may occasionally happen if another node generates a block within a few seconds of yours.\") + \"<br>\";\n  \n          //\n          // Debug view\n          //\n          if (fDebug)\n          {\n              strHTML += \"<hr><br>\" + tr(\"Debug information\") + \"<br><br>\";\n              BOOST_FOREACH(const CTxIn& txin, wtx.vin)\n                  if(wallet->IsMine(txin))\n                      strHTML += \"<b>\" + tr(\"Debit\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, -wallet->GetDebit(txin)) + \"<br>\";\n              BOOST_FOREACH(const CTxOut& txout, wtx.vout)\n                  if(wallet->IsMine(txout))\n                      strHTML += \"<b>\" + tr(\"Credit\") + \":</b> \" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, wallet->GetCredit(txout)) + \"<br>\";\n  \n              strHTML += \"<br><b>\" + tr(\"Transaction\") + \":</b><br>\";\n              strHTML += GUIUtil::HtmlEscape(wtx.ToString(), true);\n  \n              CTxDB txdb(\"r\"); // To fetch source txouts\n  \n              strHTML += \"<br><b>\" + tr(\"Inputs\") + \":</b>\";\n              strHTML += \"<ul>\";\n  \n              {\n                  LOCK(wallet->cs_wallet);\n                  BOOST_FOREACH(const CTxIn& txin, wtx.vin)\n                  {\n                      COutPoint prevout = txin.prevout;\n  \n                      CTransaction prev;\n                      if(txdb.ReadDiskTx(prevout.hash, prev))\n                      {\n                          if (prevout.n < prev.vout.size())\n                          {\n                              strHTML += \"<li>\";\n                              const CTxOut &vout = prev.vout[prevout.n];\n                              CTxDestination address;\n                              if (ExtractDestination(vout.scriptPubKey, address))\n                              {\n                                  if (wallet->mapAddressBook.count(address) && !wallet->mapAddressBook[address].empty())\n                                      strHTML += GUIUtil::HtmlEscape(wallet->mapAddressBook[address]) + \" \";\n                                  strHTML += QString::fromStdString(CBitcoinAddress(address).ToString());\n                              }\n                              strHTML = strHTML + \" \" + tr(\"Amount\") + \"=\" + BitcoinUnits::formatWithUnit(BitcoinUnits::BTC, vout.nValue);\n                              strHTML = strHTML + \" IsMine=\" + (wallet->IsMine(vout) ? tr(\"true\") : tr(\"false\")) + \"</li>\";\n                          }\n                      }\n                  }\n              }\n  \n              strHTML += \"</ul>\";\n          }\n  \n          strHTML += \"</font></html>\";\n      }\n      return strHTML;\n  }\n}"
  },
  {
    "function_name": "FormatTxStatus",
    "container": "TransactionDesc",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/transactiondesc.cpp",
    "lines": "12-33",
    "snippet": "QString TransactionDesc::FormatTxStatus(const CWalletTx& wtx)\n{\n    if (!wtx.IsFinal())\n    {\n        if (wtx.nLockTime < LOCKTIME_THRESHOLD)\n            return tr(\"Open for %n block(s)\", \"\", nBestHeight - wtx.nLockTime);\n        else\n            return tr(\"Open until %1\").arg(GUIUtil::dateTimeStr(wtx.nLockTime));\n    }\n    else\n    {\n        int nDepth = wtx.GetDepthInMainChain();\n        if (nDepth < 0)\n            return tr(\"conflicted\");\n        else if (GetAdjustedTime() - wtx.nTimeReceived > 2 * 60 && wtx.GetRequestCount() == 0)\n            return tr(\"%1/offline\").arg(nDepth);\n        else if (nDepth < 10)\n            return tr(\"%1/unconfirmed\").arg(nDepth);\n        else\n            return tr(\"%1 confirmations\").arg(nDepth);\n    }\n}",
    "includes": [
      "#include \"base58.h\"",
      "#include \"ui_interface.h\"",
      "#include \"txdb.h\"",
      "#include \"wallet.h\"",
      "#include \"main.h\"",
      "#include \"bitcoinunits.h\"",
      "#include \"guiutil.h\"",
      "#include \"transactiondesc.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "tr",
          "args": [
            "nDepth"
          ],
          "line": 31
        },
        "resolved": true,
        "details": {
          "function_name": "setValue",
          "container": "SendCoinsEntry",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/sendcoinsentry.cpp",
          "lines": "150-155",
          "snippet": "void SendCoinsEntry::setValue(const SendCoinsRecipient &value)\n{\n    ui->payTo->setText(value.address);\n    ui->addAsLabel->setText(value.label);\n    ui->payAmount->setValue(value.amount);\n}",
          "includes": [
            "#include <QClipboard>",
            "#include <QApplication>",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"walletmodel.h\"",
            "#include \"addressbookpage.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"guiutil.h\"",
            "#include \"ui_sendcoinsentry.h\"",
            "#include \"sendcoinsentry.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QClipboard>\n#include <QApplication>\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"addressbookpage.h\"\n#include \"bitcoinunits.h\"\n#include \"guiutil.h\"\n#include \"ui_sendcoinsentry.h\"\n#include \"sendcoinsentry.h\"\n\nSendCoinsEntry {\n  void SendCoinsEntry::setValue(const SendCoinsRecipient &value)\n  {\n      ui->payTo->setText(value.address);\n      ui->addAsLabel->setText(value.label);\n      ui->payAmount->setValue(value.amount);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetRequestCount",
          "args": [],
          "line": 26
        },
        "resolved": true,
        "details": {
          "function_name": "GetRequestCount",
          "container": "CWalletTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/wallet.cpp",
          "lines": "639-676",
          "snippet": "int CWalletTx::GetRequestCount() const\n{\n    // Returns -1 if it wasn't being tracked\n    int nRequests = -1;\n    {\n        LOCK(pwallet->cs_wallet);\n        if (IsCoinBase() || IsCoinStake())\n        {\n            // Generated block\n            if (hashBlock != 0)\n            {\n                map<uint256, int>::const_iterator mi = pwallet->mapRequestCount.find(hashBlock);\n                if (mi != pwallet->mapRequestCount.end())\n                    nRequests = (*mi).second;\n            }\n        }\n        else\n        {\n            // Did anyone request this transaction?\n            map<uint256, int>::const_iterator mi = pwallet->mapRequestCount.find(GetHash());\n            if (mi != pwallet->mapRequestCount.end())\n            {\n                nRequests = (*mi).second;\n\n                // How about the block it's in?\n                if (nRequests == 0 && hashBlock != 0)\n                {\n                    map<uint256, int>::const_iterator mi = pwallet->mapRequestCount.find(hashBlock);\n                    if (mi != pwallet->mapRequestCount.end())\n                        nRequests = (*mi).second;\n                    else\n                        nRequests = 1; // If it's in someone else's block it must have got out\n                }\n            }\n        }\n    }\n    return nRequests;\n}",
          "includes": [
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"coincontrol.h\"",
            "#include \"kernel.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"crypter.h\"",
            "#include \"walletdb.h\"",
            "#include \"wallet.h\"",
            "#include \"txdb.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/replace.hpp>\n#include \"coincontrol.h\"\n#include \"kernel.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"crypter.h\"\n#include \"walletdb.h\"\n#include \"wallet.h\"\n#include \"txdb.h\"\n\nCWalletTx {\n  int CWalletTx::GetRequestCount() const\n  {\n      // Returns -1 if it wasn't being tracked\n      int nRequests = -1;\n      {\n          LOCK(pwallet->cs_wallet);\n          if (IsCoinBase() || IsCoinStake())\n          {\n              // Generated block\n              if (hashBlock != 0)\n              {\n                  map<uint256, int>::const_iterator mi = pwallet->mapRequestCount.find(hashBlock);\n                  if (mi != pwallet->mapRequestCount.end())\n                      nRequests = (*mi).second;\n              }\n          }\n          else\n          {\n              // Did anyone request this transaction?\n              map<uint256, int>::const_iterator mi = pwallet->mapRequestCount.find(GetHash());\n              if (mi != pwallet->mapRequestCount.end())\n              {\n                  nRequests = (*mi).second;\n  \n                  // How about the block it's in?\n                  if (nRequests == 0 && hashBlock != 0)\n                  {\n                      map<uint256, int>::const_iterator mi = pwallet->mapRequestCount.find(hashBlock);\n                      if (mi != pwallet->mapRequestCount.end())\n                          nRequests = (*mi).second;\n                      else\n                          nRequests = 1; // If it's in someone else's block it must have got out\n                  }\n              }\n          }\n      }\n      return nRequests;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "GetAdjustedTime",
          "args": [],
          "line": 26
        },
        "resolved": true,
        "details": {
          "function_name": "GetAdjustedTime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "1201-1214",
          "snippet": "int64_t GetAdjustedTime() {\n\n    int64 nTime = GetTime();\n\n     /* If the NTP and system time are within half an hour, follow the former */\n    if(abs64(nNtpOffset) < 30 * 60)\n      return(nTime + nNtpOffset);\n\n     /* If the median peer time and system time are within 1 hour, follow the former */\n    if(abs64(nPeersOffset) < 60 * 60)\n      return(nTime + nPeersOffset);\n\n     return(nTime);\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "extern int64 nNtpOffset;",
            "int64 nPeersOffset = INT64_MAX;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nextern int64 nNtpOffset;\nint64 nPeersOffset = INT64_MAX;\n\nint64_t GetAdjustedTime() {\n\n    int64 nTime = GetTime();\n\n     /* If the NTP and system time are within half an hour, follow the former */\n    if(abs64(nNtpOffset) < 30 * 60)\n      return(nTime + nNtpOffset);\n\n     /* If the median peer time and system time are within 1 hour, follow the former */\n    if(abs64(nPeersOffset) < 60 * 60)\n      return(nTime + nPeersOffset);\n\n     return(nTime);\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.GetDepthInMainChain",
          "args": [],
          "line": 23
        },
        "resolved": true,
        "details": {
          "function_name": "GetDepthInMainChain",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "765-765",
          "snippet": "int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCMerkleTx {\n  int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "GUIUtil::dateTimeStr",
          "args": [
            "wtx.nLockTime"
          ],
          "line": 19
        },
        "resolved": true,
        "details": {
          "function_name": "dateTimeStr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/guiutil.cpp",
          "lines": "50-53",
          "snippet": "QString dateTimeStr(qint64 nTime)\n{\n    return dateTimeStr(QDateTime::fromTime_t((qint32)nTime));\n}",
          "includes": [
            "#include \"shellapi.h\"",
            "#include \"shlobj.h\"",
            "#include \"shlwapi.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <QThread>",
            "#include <QDesktopServices>",
            "#include <QFileDialog>",
            "#include <QClipboard>",
            "#include <QApplication>",
            "#include <QAbstractItemView>",
            "#include <QTextDocument> // For Qt::escape",
            "#include <QUrl>",
            "#include <QLineEdit>",
            "#include <QFont>",
            "#include <QDoubleValidator>",
            "#include <QDateTime>",
            "#include <QString>",
            "#include \"init.h\"",
            "#include \"util.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"walletmodel.h\"",
            "#include \"bitcoinaddressvalidator.h\"",
            "#include \"guiutil.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shellapi.h\"\n#include \"shlobj.h\"\n#include \"shlwapi.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <QThread>\n#include <QDesktopServices>\n#include <QFileDialog>\n#include <QClipboard>\n#include <QApplication>\n#include <QAbstractItemView>\n#include <QTextDocument> // For Qt::escape\n#include <QUrl>\n#include <QLineEdit>\n#include <QFont>\n#include <QDoubleValidator>\n#include <QDateTime>\n#include <QString>\n#include \"init.h\"\n#include \"util.h\"\n#include \"bitcoinunits.h\"\n#include \"walletmodel.h\"\n#include \"bitcoinaddressvalidator.h\"\n#include \"guiutil.h\"\n\nQString dateTimeStr(qint64 nTime)\n{\n    return dateTimeStr(QDateTime::fromTime_t((qint32)nTime));\n}"
        }
      },
      {
        "call_info": {
          "callee": "tr",
          "args": [
            "\"Open for %n block(s)\"",
            "\"\"",
            "nBestHeight - wtx.nLockTime"
          ],
          "line": 17
        },
        "resolved": true,
        "details": {
          "function_name": "copyEntryData",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/guiutil.cpp",
          "lines": "153-164",
          "snippet": "void copyEntryData(QAbstractItemView *view, int column, int role)\n{\n    if(!view || !view->selectionModel())\n        return;\n    QModelIndexList selection = view->selectionModel()->selectedRows(column);\n\n    if(!selection.isEmpty())\n    {\n        // Copy first item\n        QApplication::clipboard()->setText(selection.at(0).data(role).toString());\n    }\n}",
          "includes": [
            "#include \"shellapi.h\"",
            "#include \"shlobj.h\"",
            "#include \"shlwapi.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <QThread>",
            "#include <QDesktopServices>",
            "#include <QFileDialog>",
            "#include <QClipboard>",
            "#include <QApplication>",
            "#include <QAbstractItemView>",
            "#include <QTextDocument> // For Qt::escape",
            "#include <QUrl>",
            "#include <QLineEdit>",
            "#include <QFont>",
            "#include <QDoubleValidator>",
            "#include <QDateTime>",
            "#include <QString>",
            "#include \"init.h\"",
            "#include \"util.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"walletmodel.h\"",
            "#include \"bitcoinaddressvalidator.h\"",
            "#include \"guiutil.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shellapi.h\"\n#include \"shlobj.h\"\n#include \"shlwapi.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <QThread>\n#include <QDesktopServices>\n#include <QFileDialog>\n#include <QClipboard>\n#include <QApplication>\n#include <QAbstractItemView>\n#include <QTextDocument> // For Qt::escape\n#include <QUrl>\n#include <QLineEdit>\n#include <QFont>\n#include <QDoubleValidator>\n#include <QDateTime>\n#include <QString>\n#include \"init.h\"\n#include \"util.h\"\n#include \"bitcoinunits.h\"\n#include \"walletmodel.h\"\n#include \"bitcoinaddressvalidator.h\"\n#include \"guiutil.h\"\n\nvoid copyEntryData(QAbstractItemView *view, int column, int role)\n{\n    if(!view || !view->selectionModel())\n        return;\n    QModelIndexList selection = view->selectionModel()->selectedRows(column);\n\n    if(!selection.isEmpty())\n    {\n        // Copy first item\n        QApplication::clipboard()->setText(selection.at(0).data(role).toString());\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "wtx.IsFinal",
          "args": [],
          "line": 14
        },
        "resolved": true,
        "details": {
          "function_name": "IsFinal",
          "container": "CTransaction",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "491-506",
          "snippet": "bool IsFinal(int nBlockHeight=0, int64_t nBlockTime=0) const\n    {\n        // Time based nLockTime implemented in 0.1.6\n        if (nLockTime == 0)\n            return true;\n        if (nBlockHeight == 0)\n            nBlockHeight = nBestHeight;\n        if (nBlockTime == 0)\n            nBlockTime = GetAdjustedTime();\n        if ((int64_t)nLockTime < ((int64_t)nLockTime < LOCKTIME_THRESHOLD ? (int64_t)nBlockHeight : nBlockTime))\n            return true;\n        BOOST_FOREACH(const CTxIn& txin, vin)\n            if (!txin.IsFinal())\n                return false;\n        return true;\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCTransaction {\n  bool IsFinal(int nBlockHeight=0, int64_t nBlockTime=0) const\n      {\n          // Time based nLockTime implemented in 0.1.6\n          if (nLockTime == 0)\n              return true;\n          if (nBlockHeight == 0)\n              nBlockHeight = nBestHeight;\n          if (nBlockTime == 0)\n              nBlockTime = GetAdjustedTime();\n          if ((int64_t)nLockTime < ((int64_t)nLockTime < LOCKTIME_THRESHOLD ? (int64_t)nBlockHeight : nBlockTime))\n              return true;\n          BOOST_FOREACH(const CTxIn& txin, vin)\n              if (!txin.IsFinal())\n                  return false;\n          return true;\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"txdb.h\"\n#include \"wallet.h\"\n#include \"main.h\"\n#include \"bitcoinunits.h\"\n#include \"guiutil.h\"\n#include \"transactiondesc.h\"\n\nTransactionDesc {\n  QString TransactionDesc::FormatTxStatus(const CWalletTx& wtx)\n  {\n      if (!wtx.IsFinal())\n      {\n          if (wtx.nLockTime < LOCKTIME_THRESHOLD)\n              return tr(\"Open for %n block(s)\", \"\", nBestHeight - wtx.nLockTime);\n          else\n              return tr(\"Open until %1\").arg(GUIUtil::dateTimeStr(wtx.nLockTime));\n      }\n      else\n      {\n          int nDepth = wtx.GetDepthInMainChain();\n          if (nDepth < 0)\n              return tr(\"conflicted\");\n          else if (GetAdjustedTime() - wtx.nTimeReceived > 2 * 60 && wtx.GetRequestCount() == 0)\n              return tr(\"%1/offline\").arg(nDepth);\n          else if (nDepth < 10)\n              return tr(\"%1/unconfirmed\").arg(nDepth);\n          else\n              return tr(\"%1 confirmations\").arg(nDepth);\n      }\n  }\n}"
  }
]