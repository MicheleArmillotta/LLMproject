[
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block_test.cc",
    "lines": "126-128",
    "snippet": "int main(int argc, char** argv) {\n  return leveldb::test::RunAllTests();\n}",
    "includes": [
      "#include \"util/testutil.h\"",
      "#include \"util/testharness.h\"",
      "#include \"util/logging.h\"",
      "#include \"util/hash.h\"",
      "#include \"util/coding.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"table/filter_block.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "leveldb::test::RunAllTests",
          "args": [],
          "line": 127
        },
        "resolved": true,
        "details": {
          "function_name": "RunAllTests",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/testharness.cc",
          "lines": "36-58",
          "snippet": "int RunAllTests() {\n  const char* matcher = getenv(\"LEVELDB_TESTS\");\n\n  int num = 0;\n  if (tests != NULL) {\n    for (size_t i = 0; i < tests->size(); i++) {\n      const Test& t = (*tests)[i];\n      if (matcher != NULL) {\n        std::string name = t.base;\n        name.push_back('.');\n        name.append(t.name);\n        if (strstr(name.c_str(), matcher) == NULL) {\n          continue;\n        }\n      }\n      fprintf(stderr, \"==== Test %s.%s\\n\", t.base, t.name);\n      (*t.func)();\n      ++num;\n    }\n  }\n  fprintf(stderr, \"==== PASSED %d tests\\n\", num);\n  return 0;\n}",
          "includes": [
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <stdlib.h>",
            "#include <string>",
            "#include \"util/testharness.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/types.h>\n#include <sys/stat.h>\n#include <stdlib.h>\n#include <string>\n#include \"util/testharness.h\"\n\nint RunAllTests() {\n  const char* matcher = getenv(\"LEVELDB_TESTS\");\n\n  int num = 0;\n  if (tests != NULL) {\n    for (size_t i = 0; i < tests->size(); i++) {\n      const Test& t = (*tests)[i];\n      if (matcher != NULL) {\n        std::string name = t.base;\n        name.push_back('.');\n        name.append(t.name);\n        if (strstr(name.c_str(), matcher) == NULL) {\n          continue;\n        }\n      }\n      fprintf(stderr, \"==== Test %s.%s\\n\", t.base, t.name);\n      (*t.func)();\n      ++num;\n    }\n  }\n  fprintf(stderr, \"==== PASSED %d tests\\n\", num);\n  return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"util/testutil.h\"\n#include \"util/testharness.h\"\n#include \"util/logging.h\"\n#include \"util/hash.h\"\n#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nint main(int argc, char** argv) {\n  return leveldb::test::RunAllTests();\n}"
  },
  {
    "function_name": "TEST",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block_test.cc",
    "lines": "76-122",
    "snippet": "TEST(FilterBlockTest, MultiChunk) {\n  FilterBlockBuilder builder(&policy_);\n\n  // First filter\n  builder.StartBlock(0);\n  builder.AddKey(\"foo\");\n  builder.StartBlock(2000);\n  builder.AddKey(\"bar\");\n\n  // Second filter\n  builder.StartBlock(3100);\n  builder.AddKey(\"box\");\n\n  // Third filter is empty\n\n  // Last filter\n  builder.StartBlock(9000);\n  builder.AddKey(\"box\");\n  builder.AddKey(\"hello\");\n\n  Slice block = builder.Finish();\n  FilterBlockReader reader(&policy_, block);\n\n  // Check first filter\n  ASSERT_TRUE(reader.KeyMayMatch(0, \"foo\"));\n  ASSERT_TRUE(reader.KeyMayMatch(2000, \"bar\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(0, \"box\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(0, \"hello\"));\n\n  // Check second filter\n  ASSERT_TRUE(reader.KeyMayMatch(3100, \"box\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(3100, \"foo\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(3100, \"bar\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(3100, \"hello\"));\n\n  // Check third filter (empty)\n  ASSERT_TRUE(! reader.KeyMayMatch(4100, \"foo\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(4100, \"bar\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(4100, \"box\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(4100, \"hello\"));\n\n  // Check last filter\n  ASSERT_TRUE(reader.KeyMayMatch(9000, \"box\"));\n  ASSERT_TRUE(reader.KeyMayMatch(9000, \"hello\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(9000, \"foo\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(9000, \"bar\"));\n}",
    "includes": [
      "#include \"util/testutil.h\"",
      "#include \"util/testharness.h\"",
      "#include \"util/logging.h\"",
      "#include \"util/hash.h\"",
      "#include \"util/coding.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"table/filter_block.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "! reader.KeyMayMatch(9000, \"bar\")"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reader.KeyMayMatch",
          "args": [
            "9000",
            "\"bar\""
          ],
          "line": 121
        },
        "resolved": true,
        "details": {
          "function_name": "KeyMayMatch",
          "container": "TestHashFilter",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block_test.cc",
          "lines": "30-38",
          "snippet": "virtual bool KeyMayMatch(const Slice& key, const Slice& filter) const {\n    uint32_t h = Hash(key.data(), key.size(), 1);\n    for (size_t i = 0; i + 4 <= filter.size(); i += 4) {\n      if (h == DecodeFixed32(filter.data() + i)) {\n        return true;\n      }\n    }\n    return false;\n  }",
          "includes": [
            "#include \"util/testutil.h\"",
            "#include \"util/testharness.h\"",
            "#include \"util/logging.h\"",
            "#include \"util/hash.h\"",
            "#include \"util/coding.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"table/filter_block.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/testutil.h\"\n#include \"util/testharness.h\"\n#include \"util/logging.h\"\n#include \"util/hash.h\"\n#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nTestHashFilter {\n  virtual bool KeyMayMatch(const Slice& key, const Slice& filter) const {\n      uint32_t h = Hash(key.data(), key.size(), 1);\n      for (size_t i = 0; i + 4 <= filter.size(); i += 4) {\n        if (h == DecodeFixed32(filter.data() + i)) {\n          return true;\n        }\n      }\n      return false;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "! reader.KeyMayMatch(9000, \"foo\")"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "reader.KeyMayMatch(9000, \"hello\")"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "reader.KeyMayMatch(9000, \"box\")"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "! reader.KeyMayMatch(4100, \"hello\")"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "! reader.KeyMayMatch(4100, \"box\")"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "! reader.KeyMayMatch(4100, \"bar\")"
          ],
          "line": 113
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "! reader.KeyMayMatch(4100, \"foo\")"
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "! reader.KeyMayMatch(3100, \"hello\")"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "! reader.KeyMayMatch(3100, \"bar\")"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "! reader.KeyMayMatch(3100, \"foo\")"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "reader.KeyMayMatch(3100, \"box\")"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "! reader.KeyMayMatch(0, \"hello\")"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "! reader.KeyMayMatch(0, \"box\")"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "reader.KeyMayMatch(2000, \"bar\")"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "reader.KeyMayMatch(0, \"foo\")"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "builder.Finish",
          "args": [],
          "line": 96
        },
        "resolved": true,
        "details": {
          "function_name": "Finish",
          "container": "FilterBlockBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block.cc",
          "lines": "36-50",
          "snippet": "Slice FilterBlockBuilder::Finish() {\n  if (!start_.empty()) {\n    GenerateFilter();\n  }\n\n  // Append array of per-filter offsets\n  const uint32_t array_offset = result_.size();\n  for (size_t i = 0; i < filter_offsets_.size(); i++) {\n    PutFixed32(&result_, filter_offsets_[i]);\n  }\n\n  PutFixed32(&result_, array_offset);\n  result_.push_back(kFilterBaseLg);  // Save encoding parameter in result\n  return Slice(result_);\n}",
          "includes": [
            "#include \"util/coding.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"table/filter_block.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nFilterBlockBuilder {\n  Slice FilterBlockBuilder::Finish() {\n    if (!start_.empty()) {\n      GenerateFilter();\n    }\n  \n    // Append array of per-filter offsets\n    const uint32_t array_offset = result_.size();\n    for (size_t i = 0; i < filter_offsets_.size(); i++) {\n      PutFixed32(&result_, filter_offsets_[i]);\n    }\n  \n    PutFixed32(&result_, array_offset);\n    result_.push_back(kFilterBaseLg);  // Save encoding parameter in result\n    return Slice(result_);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "builder.AddKey",
          "args": [
            "\"hello\""
          ],
          "line": 94
        },
        "resolved": true,
        "details": {
          "function_name": "AddKey",
          "container": "FilterBlockBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block.cc",
          "lines": "30-34",
          "snippet": "void FilterBlockBuilder::AddKey(const Slice& key) {\n  Slice k = key;\n  start_.push_back(keys_.size());\n  keys_.append(k.data(), k.size());\n}",
          "includes": [
            "#include \"util/coding.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"table/filter_block.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nFilterBlockBuilder {\n  void FilterBlockBuilder::AddKey(const Slice& key) {\n    Slice k = key;\n    start_.push_back(keys_.size());\n    keys_.append(k.data(), k.size());\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "builder.StartBlock",
          "args": [
            "9000"
          ],
          "line": 92
        },
        "resolved": true,
        "details": {
          "function_name": "StartBlock",
          "container": "FilterBlockBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block.cc",
          "lines": "22-28",
          "snippet": "void FilterBlockBuilder::StartBlock(uint64_t block_offset) {\n  uint64_t filter_index = (block_offset / kFilterBase);\n  assert(filter_index >= filter_offsets_.size());\n  while (filter_index > filter_offsets_.size()) {\n    GenerateFilter();\n  }\n}",
          "includes": [
            "#include \"util/coding.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"table/filter_block.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nFilterBlockBuilder {\n  void FilterBlockBuilder::StartBlock(uint64_t block_offset) {\n    uint64_t filter_index = (block_offset / kFilterBase);\n    assert(filter_index >= filter_offsets_.size());\n    while (filter_index > filter_offsets_.size()) {\n      GenerateFilter();\n    }\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"util/testutil.h\"\n#include \"util/testharness.h\"\n#include \"util/logging.h\"\n#include \"util/hash.h\"\n#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nTEST(FilterBlockTest, MultiChunk) {\n  FilterBlockBuilder builder(&policy_);\n\n  // First filter\n  builder.StartBlock(0);\n  builder.AddKey(\"foo\");\n  builder.StartBlock(2000);\n  builder.AddKey(\"bar\");\n\n  // Second filter\n  builder.StartBlock(3100);\n  builder.AddKey(\"box\");\n\n  // Third filter is empty\n\n  // Last filter\n  builder.StartBlock(9000);\n  builder.AddKey(\"box\");\n  builder.AddKey(\"hello\");\n\n  Slice block = builder.Finish();\n  FilterBlockReader reader(&policy_, block);\n\n  // Check first filter\n  ASSERT_TRUE(reader.KeyMayMatch(0, \"foo\"));\n  ASSERT_TRUE(reader.KeyMayMatch(2000, \"bar\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(0, \"box\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(0, \"hello\"));\n\n  // Check second filter\n  ASSERT_TRUE(reader.KeyMayMatch(3100, \"box\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(3100, \"foo\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(3100, \"bar\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(3100, \"hello\"));\n\n  // Check third filter (empty)\n  ASSERT_TRUE(! reader.KeyMayMatch(4100, \"foo\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(4100, \"bar\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(4100, \"box\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(4100, \"hello\"));\n\n  // Check last filter\n  ASSERT_TRUE(reader.KeyMayMatch(9000, \"box\"));\n  ASSERT_TRUE(reader.KeyMayMatch(9000, \"hello\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(9000, \"foo\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(9000, \"bar\"));\n}"
  },
  {
    "function_name": "TEST",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block_test.cc",
    "lines": "55-74",
    "snippet": "TEST(FilterBlockTest, SingleChunk) {\n  FilterBlockBuilder builder(&policy_);\n  builder.StartBlock(100);\n  builder.AddKey(\"foo\");\n  builder.AddKey(\"bar\");\n  builder.AddKey(\"box\");\n  builder.StartBlock(200);\n  builder.AddKey(\"box\");\n  builder.StartBlock(300);\n  builder.AddKey(\"hello\");\n  Slice block = builder.Finish();\n  FilterBlockReader reader(&policy_, block);\n  ASSERT_TRUE(reader.KeyMayMatch(100, \"foo\"));\n  ASSERT_TRUE(reader.KeyMayMatch(100, \"bar\"));\n  ASSERT_TRUE(reader.KeyMayMatch(100, \"box\"));\n  ASSERT_TRUE(reader.KeyMayMatch(100, \"hello\"));\n  ASSERT_TRUE(reader.KeyMayMatch(100, \"foo\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(100, \"missing\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(100, \"other\"));\n}",
    "includes": [
      "#include \"util/testutil.h\"",
      "#include \"util/testharness.h\"",
      "#include \"util/logging.h\"",
      "#include \"util/hash.h\"",
      "#include \"util/coding.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"table/filter_block.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "! reader.KeyMayMatch(100, \"other\")"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reader.KeyMayMatch",
          "args": [
            "100",
            "\"other\""
          ],
          "line": 73
        },
        "resolved": true,
        "details": {
          "function_name": "KeyMayMatch",
          "container": "TestHashFilter",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block_test.cc",
          "lines": "30-38",
          "snippet": "virtual bool KeyMayMatch(const Slice& key, const Slice& filter) const {\n    uint32_t h = Hash(key.data(), key.size(), 1);\n    for (size_t i = 0; i + 4 <= filter.size(); i += 4) {\n      if (h == DecodeFixed32(filter.data() + i)) {\n        return true;\n      }\n    }\n    return false;\n  }",
          "includes": [
            "#include \"util/testutil.h\"",
            "#include \"util/testharness.h\"",
            "#include \"util/logging.h\"",
            "#include \"util/hash.h\"",
            "#include \"util/coding.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"table/filter_block.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/testutil.h\"\n#include \"util/testharness.h\"\n#include \"util/logging.h\"\n#include \"util/hash.h\"\n#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nTestHashFilter {\n  virtual bool KeyMayMatch(const Slice& key, const Slice& filter) const {\n      uint32_t h = Hash(key.data(), key.size(), 1);\n      for (size_t i = 0; i + 4 <= filter.size(); i += 4) {\n        if (h == DecodeFixed32(filter.data() + i)) {\n          return true;\n        }\n      }\n      return false;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "! reader.KeyMayMatch(100, \"missing\")"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "reader.KeyMayMatch(100, \"foo\")"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "reader.KeyMayMatch(100, \"hello\")"
          ],
          "line": 70
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "reader.KeyMayMatch(100, \"box\")"
          ],
          "line": 69
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "reader.KeyMayMatch(100, \"bar\")"
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "reader.KeyMayMatch(100, \"foo\")"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "builder.Finish",
          "args": [],
          "line": 65
        },
        "resolved": true,
        "details": {
          "function_name": "Finish",
          "container": "FilterBlockBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block.cc",
          "lines": "36-50",
          "snippet": "Slice FilterBlockBuilder::Finish() {\n  if (!start_.empty()) {\n    GenerateFilter();\n  }\n\n  // Append array of per-filter offsets\n  const uint32_t array_offset = result_.size();\n  for (size_t i = 0; i < filter_offsets_.size(); i++) {\n    PutFixed32(&result_, filter_offsets_[i]);\n  }\n\n  PutFixed32(&result_, array_offset);\n  result_.push_back(kFilterBaseLg);  // Save encoding parameter in result\n  return Slice(result_);\n}",
          "includes": [
            "#include \"util/coding.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"table/filter_block.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nFilterBlockBuilder {\n  Slice FilterBlockBuilder::Finish() {\n    if (!start_.empty()) {\n      GenerateFilter();\n    }\n  \n    // Append array of per-filter offsets\n    const uint32_t array_offset = result_.size();\n    for (size_t i = 0; i < filter_offsets_.size(); i++) {\n      PutFixed32(&result_, filter_offsets_[i]);\n    }\n  \n    PutFixed32(&result_, array_offset);\n    result_.push_back(kFilterBaseLg);  // Save encoding parameter in result\n    return Slice(result_);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "builder.AddKey",
          "args": [
            "\"hello\""
          ],
          "line": 64
        },
        "resolved": true,
        "details": {
          "function_name": "AddKey",
          "container": "FilterBlockBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block.cc",
          "lines": "30-34",
          "snippet": "void FilterBlockBuilder::AddKey(const Slice& key) {\n  Slice k = key;\n  start_.push_back(keys_.size());\n  keys_.append(k.data(), k.size());\n}",
          "includes": [
            "#include \"util/coding.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"table/filter_block.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nFilterBlockBuilder {\n  void FilterBlockBuilder::AddKey(const Slice& key) {\n    Slice k = key;\n    start_.push_back(keys_.size());\n    keys_.append(k.data(), k.size());\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "builder.StartBlock",
          "args": [
            "300"
          ],
          "line": 63
        },
        "resolved": true,
        "details": {
          "function_name": "StartBlock",
          "container": "FilterBlockBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block.cc",
          "lines": "22-28",
          "snippet": "void FilterBlockBuilder::StartBlock(uint64_t block_offset) {\n  uint64_t filter_index = (block_offset / kFilterBase);\n  assert(filter_index >= filter_offsets_.size());\n  while (filter_index > filter_offsets_.size()) {\n    GenerateFilter();\n  }\n}",
          "includes": [
            "#include \"util/coding.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"table/filter_block.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nFilterBlockBuilder {\n  void FilterBlockBuilder::StartBlock(uint64_t block_offset) {\n    uint64_t filter_index = (block_offset / kFilterBase);\n    assert(filter_index >= filter_offsets_.size());\n    while (filter_index > filter_offsets_.size()) {\n      GenerateFilter();\n    }\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"util/testutil.h\"\n#include \"util/testharness.h\"\n#include \"util/logging.h\"\n#include \"util/hash.h\"\n#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nTEST(FilterBlockTest, SingleChunk) {\n  FilterBlockBuilder builder(&policy_);\n  builder.StartBlock(100);\n  builder.AddKey(\"foo\");\n  builder.AddKey(\"bar\");\n  builder.AddKey(\"box\");\n  builder.StartBlock(200);\n  builder.AddKey(\"box\");\n  builder.StartBlock(300);\n  builder.AddKey(\"hello\");\n  Slice block = builder.Finish();\n  FilterBlockReader reader(&policy_, block);\n  ASSERT_TRUE(reader.KeyMayMatch(100, \"foo\"));\n  ASSERT_TRUE(reader.KeyMayMatch(100, \"bar\"));\n  ASSERT_TRUE(reader.KeyMayMatch(100, \"box\"));\n  ASSERT_TRUE(reader.KeyMayMatch(100, \"hello\"));\n  ASSERT_TRUE(reader.KeyMayMatch(100, \"foo\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(100, \"missing\"));\n  ASSERT_TRUE(! reader.KeyMayMatch(100, \"other\"));\n}"
  },
  {
    "function_name": "TEST",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block_test.cc",
    "lines": "46-53",
    "snippet": "TEST(FilterBlockTest, EmptyBuilder) {\n  FilterBlockBuilder builder(&policy_);\n  Slice block = builder.Finish();\n  ASSERT_EQ(\"\\\\x00\\\\x00\\\\x00\\\\x00\\\\x0b\", EscapeString(block));\n  FilterBlockReader reader(&policy_, block);\n  ASSERT_TRUE(reader.KeyMayMatch(0, \"foo\"));\n  ASSERT_TRUE(reader.KeyMayMatch(100000, \"foo\"));\n}",
    "includes": [
      "#include \"util/testutil.h\"",
      "#include \"util/testharness.h\"",
      "#include \"util/logging.h\"",
      "#include \"util/hash.h\"",
      "#include \"util/coding.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"table/filter_block.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "reader.KeyMayMatch(100000, \"foo\")"
          ],
          "line": 52
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "reader.KeyMayMatch",
          "args": [
            "100000",
            "\"foo\""
          ],
          "line": 52
        },
        "resolved": true,
        "details": {
          "function_name": "KeyMayMatch",
          "container": "TestHashFilter",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block_test.cc",
          "lines": "30-38",
          "snippet": "virtual bool KeyMayMatch(const Slice& key, const Slice& filter) const {\n    uint32_t h = Hash(key.data(), key.size(), 1);\n    for (size_t i = 0; i + 4 <= filter.size(); i += 4) {\n      if (h == DecodeFixed32(filter.data() + i)) {\n        return true;\n      }\n    }\n    return false;\n  }",
          "includes": [
            "#include \"util/testutil.h\"",
            "#include \"util/testharness.h\"",
            "#include \"util/logging.h\"",
            "#include \"util/hash.h\"",
            "#include \"util/coding.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"table/filter_block.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/testutil.h\"\n#include \"util/testharness.h\"\n#include \"util/logging.h\"\n#include \"util/hash.h\"\n#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nTestHashFilter {\n  virtual bool KeyMayMatch(const Slice& key, const Slice& filter) const {\n      uint32_t h = Hash(key.data(), key.size(), 1);\n      for (size_t i = 0; i + 4 <= filter.size(); i += 4) {\n        if (h == DecodeFixed32(filter.data() + i)) {\n          return true;\n        }\n      }\n      return false;\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASSERT_TRUE",
          "args": [
            "reader.KeyMayMatch(0, \"foo\")"
          ],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ASSERT_EQ",
          "args": [
            "\"\\\\x00\\\\x00\\\\x00\\\\x00\\\\x0b\"",
            "EscapeString(block)"
          ],
          "line": 49
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "EscapeString",
          "args": [
            "block"
          ],
          "line": 49
        },
        "resolved": true,
        "details": {
          "function_name": "EscapeString",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/logging.cc",
          "lines": "42-46",
          "snippet": "std::string EscapeString(const Slice& value) {\n  std::string r;\n  AppendEscapedStringTo(&r, value);\n  return r;\n}",
          "includes": [
            "#include \"leveldb/slice.h\"",
            "#include \"leveldb/env.h\"",
            "#include <stdlib.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <errno.h>",
            "#include \"util/logging.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/slice.h\"\n#include \"leveldb/env.h\"\n#include <stdlib.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <errno.h>\n#include \"util/logging.h\"\n\nstd::string EscapeString(const Slice& value) {\n  std::string r;\n  AppendEscapedStringTo(&r, value);\n  return r;\n}"
        }
      },
      {
        "call_info": {
          "callee": "builder.Finish",
          "args": [],
          "line": 48
        },
        "resolved": true,
        "details": {
          "function_name": "Finish",
          "container": "FilterBlockBuilder",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block.cc",
          "lines": "36-50",
          "snippet": "Slice FilterBlockBuilder::Finish() {\n  if (!start_.empty()) {\n    GenerateFilter();\n  }\n\n  // Append array of per-filter offsets\n  const uint32_t array_offset = result_.size();\n  for (size_t i = 0; i < filter_offsets_.size(); i++) {\n    PutFixed32(&result_, filter_offsets_[i]);\n  }\n\n  PutFixed32(&result_, array_offset);\n  result_.push_back(kFilterBaseLg);  // Save encoding parameter in result\n  return Slice(result_);\n}",
          "includes": [
            "#include \"util/coding.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"table/filter_block.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nFilterBlockBuilder {\n  Slice FilterBlockBuilder::Finish() {\n    if (!start_.empty()) {\n      GenerateFilter();\n    }\n  \n    // Append array of per-filter offsets\n    const uint32_t array_offset = result_.size();\n    for (size_t i = 0; i < filter_offsets_.size(); i++) {\n      PutFixed32(&result_, filter_offsets_[i]);\n    }\n  \n    PutFixed32(&result_, array_offset);\n    result_.push_back(kFilterBaseLg);  // Save encoding parameter in result\n    return Slice(result_);\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"util/testutil.h\"\n#include \"util/testharness.h\"\n#include \"util/logging.h\"\n#include \"util/hash.h\"\n#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nTEST(FilterBlockTest, EmptyBuilder) {\n  FilterBlockBuilder builder(&policy_);\n  Slice block = builder.Finish();\n  ASSERT_EQ(\"\\\\x00\\\\x00\\\\x00\\\\x00\\\\x0b\", EscapeString(block));\n  FilterBlockReader reader(&policy_, block);\n  ASSERT_TRUE(reader.KeyMayMatch(0, \"foo\"));\n  ASSERT_TRUE(reader.KeyMayMatch(100000, \"foo\"));\n}"
  },
  {
    "function_name": "KeyMayMatch",
    "container": "TestHashFilter",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block_test.cc",
    "lines": "30-38",
    "snippet": "virtual bool KeyMayMatch(const Slice& key, const Slice& filter) const {\n    uint32_t h = Hash(key.data(), key.size(), 1);\n    for (size_t i = 0; i + 4 <= filter.size(); i += 4) {\n      if (h == DecodeFixed32(filter.data() + i)) {\n        return true;\n      }\n    }\n    return false;\n  }",
    "includes": [
      "#include \"util/testutil.h\"",
      "#include \"util/testharness.h\"",
      "#include \"util/logging.h\"",
      "#include \"util/hash.h\"",
      "#include \"util/coding.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"table/filter_block.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "DecodeFixed32",
          "args": [
            "filter.data() + i"
          ],
          "line": 33
        },
        "resolved": true,
        "details": {
          "function_name": "DecodeFixed32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/coding.h",
          "lines": "58-70",
          "snippet": "inline uint32_t DecodeFixed32(const char* ptr) {\n  if (port::kLittleEndian) {\n    // Load the raw bytes\n    uint32_t result;\n    memcpy(&result, ptr, sizeof(result));  // gcc optimizes this to a plain load\n    return result;\n  } else {\n    return ((static_cast<uint32_t>(static_cast<unsigned char>(ptr[0])))\n        | (static_cast<uint32_t>(static_cast<unsigned char>(ptr[1])) << 8)\n        | (static_cast<uint32_t>(static_cast<unsigned char>(ptr[2])) << 16)\n        | (static_cast<uint32_t>(static_cast<unsigned char>(ptr[3])) << 24));\n  }\n}",
          "includes": [
            "#include \"port/port.h\"",
            "#include \"leveldb/slice.h\"",
            "#include <string>",
            "#include <string.h>",
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"port/port.h\"\n#include \"leveldb/slice.h\"\n#include <string>\n#include <string.h>\n#include <stdint.h>\n\ninline uint32_t DecodeFixed32(const char* ptr) {\n  if (port::kLittleEndian) {\n    // Load the raw bytes\n    uint32_t result;\n    memcpy(&result, ptr, sizeof(result));  // gcc optimizes this to a plain load\n    return result;\n  } else {\n    return ((static_cast<uint32_t>(static_cast<unsigned char>(ptr[0])))\n        | (static_cast<uint32_t>(static_cast<unsigned char>(ptr[1])) << 8)\n        | (static_cast<uint32_t>(static_cast<unsigned char>(ptr[2])) << 16)\n        | (static_cast<uint32_t>(static_cast<unsigned char>(ptr[3])) << 24));\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "filter.data",
          "args": [],
          "line": 33
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filter.size",
          "args": [],
          "line": 32
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "BlockHandle",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/format.h",
          "lines": "31-31",
          "snippet": "uint64_t size() const { return size_; }",
          "includes": [
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/slice.h\"",
            "#include <stdint.h>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/table_builder.h\"\n#include \"leveldb/status.h\"\n#include \"leveldb/slice.h\"\n#include <stdint.h>\n#include <string>\n\nBlockHandle {\n  uint64_t size() const { return size_; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "Hash",
          "args": [
            "key.data()",
            "key.size()",
            "1"
          ],
          "line": 31
        },
        "resolved": true,
        "details": {
          "function_name": "CreateFilter",
          "container": "TestHashFilter",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block_test.cc",
          "lines": "23-28",
          "snippet": "virtual void CreateFilter(const Slice* keys, int n, std::string* dst) const {\n    for (int i = 0; i < n; i++) {\n      uint32_t h = Hash(keys[i].data(), keys[i].size(), 1);\n      PutFixed32(dst, h);\n    }\n  }",
          "includes": [
            "#include \"util/testutil.h\"",
            "#include \"util/testharness.h\"",
            "#include \"util/logging.h\"",
            "#include \"util/hash.h\"",
            "#include \"util/coding.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"table/filter_block.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/testutil.h\"\n#include \"util/testharness.h\"\n#include \"util/logging.h\"\n#include \"util/hash.h\"\n#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nTestHashFilter {\n  virtual void CreateFilter(const Slice* keys, int n, std::string* dst) const {\n      for (int i = 0; i < n; i++) {\n        uint32_t h = Hash(keys[i].data(), keys[i].size(), 1);\n        PutFixed32(dst, h);\n      }\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "key.data",
          "args": [],
          "line": 31
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"util/testutil.h\"\n#include \"util/testharness.h\"\n#include \"util/logging.h\"\n#include \"util/hash.h\"\n#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nTestHashFilter {\n  virtual bool KeyMayMatch(const Slice& key, const Slice& filter) const {\n      uint32_t h = Hash(key.data(), key.size(), 1);\n      for (size_t i = 0; i + 4 <= filter.size(); i += 4) {\n        if (h == DecodeFixed32(filter.data() + i)) {\n          return true;\n        }\n      }\n      return false;\n    }\n}"
  },
  {
    "function_name": "CreateFilter",
    "container": "TestHashFilter",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block_test.cc",
    "lines": "23-28",
    "snippet": "virtual void CreateFilter(const Slice* keys, int n, std::string* dst) const {\n    for (int i = 0; i < n; i++) {\n      uint32_t h = Hash(keys[i].data(), keys[i].size(), 1);\n      PutFixed32(dst, h);\n    }\n  }",
    "includes": [
      "#include \"util/testutil.h\"",
      "#include \"util/testharness.h\"",
      "#include \"util/logging.h\"",
      "#include \"util/hash.h\"",
      "#include \"util/coding.h\"",
      "#include \"leveldb/filter_policy.h\"",
      "#include \"table/filter_block.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "PutFixed32",
          "args": [
            "dst",
            "h"
          ],
          "line": 26
        },
        "resolved": true,
        "details": {
          "function_name": "PutFixed32",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/coding.cc",
          "lines": "35-39",
          "snippet": "void PutFixed32(std::string* dst, uint32_t value) {\n  char buf[sizeof(value)];\n  EncodeFixed32(buf, value);\n  dst->append(buf, sizeof(buf));\n}",
          "includes": [
            "#include \"util/coding.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/coding.h\"\n\nvoid PutFixed32(std::string* dst, uint32_t value) {\n  char buf[sizeof(value)];\n  EncodeFixed32(buf, value);\n  dst->append(buf, sizeof(buf));\n}"
        }
      },
      {
        "call_info": {
          "callee": "Hash",
          "args": [
            "keys[i].data()",
            "keys[i].size()",
            "1"
          ],
          "line": 25
        },
        "resolved": true,
        "details": {
          "function_name": "CreateFilter",
          "container": "TestHashFilter",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/filter_block_test.cc",
          "lines": "23-28",
          "snippet": "virtual void CreateFilter(const Slice* keys, int n, std::string* dst) const {\n    for (int i = 0; i < n; i++) {\n      uint32_t h = Hash(keys[i].data(), keys[i].size(), 1);\n      PutFixed32(dst, h);\n    }\n  }",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "keys[i].size",
          "args": [],
          "line": 25
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "BlockHandle",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/table/format.h",
          "lines": "31-31",
          "snippet": "uint64_t size() const { return size_; }",
          "includes": [
            "#include \"leveldb/table_builder.h\"",
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/slice.h\"",
            "#include <stdint.h>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/table_builder.h\"\n#include \"leveldb/status.h\"\n#include \"leveldb/slice.h\"\n#include <stdint.h>\n#include <string>\n\nBlockHandle {\n  uint64_t size() const { return size_; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "keys[i].data",
          "args": [],
          "line": 25
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"util/testutil.h\"\n#include \"util/testharness.h\"\n#include \"util/logging.h\"\n#include \"util/hash.h\"\n#include \"util/coding.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"table/filter_block.h\"\n\nTestHashFilter {\n  virtual void CreateFilter(const Slice* keys, int n, std::string* dst) const {\n      for (int i = 0; i < n; i++) {\n        uint32_t h = Hash(keys[i].data(), keys[i].size(), 1);\n        PutFixed32(dst, h);\n      }\n    }\n}"
  }
]