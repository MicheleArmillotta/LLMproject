[
  {
    "function_name": "getcheckpoint",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
    "lines": "275-304",
    "snippet": "Value getcheckpoint(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 0)\n        throw runtime_error(\n            \"getcheckpoint\\n\"\n            \"Show info of synchronized checkpoint.\\n\");\n\n    Object result;\n    CBlockIndex* pindexCheckpoint;\n\n    result.push_back(Pair(\"synccheckpoint\", Checkpoints::hashSyncCheckpoint.ToString().c_str()));\n    pindexCheckpoint = mapBlockIndex[Checkpoints::hashSyncCheckpoint];\n    result.push_back(Pair(\"height\", pindexCheckpoint->nHeight));\n    result.push_back(Pair(\"timestamp\", DateTimeStrFormat(pindexCheckpoint->GetBlockTime()).c_str()));\n\n    // Check that the block satisfies synchronized checkpoint\n    if (CheckpointsMode == Checkpoints::STRICT)\n        result.push_back(Pair(\"policy\", \"strict\"));\n\n    if (CheckpointsMode == Checkpoints::ADVISORY)\n        result.push_back(Pair(\"policy\", \"advisory\"));\n\n    if (CheckpointsMode == Checkpoints::PERMISSIVE)\n        result.push_back(Pair(\"policy\", \"permissive\"));\n\n    if (mapArgs.count(\"-checkpointkey\"))\n        result.push_back(Pair(\"checkpointmaster\", true));\n\n    return result;\n}",
    "includes": [
      "#include \"bitcoinrpc.h\"",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "extern enum Checkpoints::CPMode CheckpointsMode;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"checkpointmaster\", true)"
          ],
          "line": 301
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"checkpointmaster\"",
            "true"
          ],
          "line": 301
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "mapArgs.count",
          "args": [
            "\"-checkpointkey\""
          ],
          "line": 300
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"policy\", \"permissive\")"
          ],
          "line": 298
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"policy\", \"advisory\")"
          ],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"policy\", \"strict\")"
          ],
          "line": 292
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"timestamp\", DateTimeStrFormat(pindexCheckpoint->GetBlockTime()).c_str())"
          ],
          "line": 288
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DateTimeStrFormat",
          "args": [],
          "line": 288
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DateTimeStrFormat",
          "args": [
            "pindexCheckpoint->GetBlockTime()"
          ],
          "line": 288
        },
        "resolved": true,
        "details": {
          "function_name": "DateTimeStrFormat",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.h",
          "lines": "386-389",
          "snippet": "inline std::string DateTimeStrFormat(int64_t nTime)\n{\n    return DateTimeStrFormat(strTimestampFormat.c_str(), nTime);\n}",
          "includes": [
            "#include <inttypes.h>",
            "#include <stdint.h>",
            "#include \"netbase.h\" // for AddTimeData",
            "#include <openssl/ripemd.h>",
            "#include <openssl/sha.h>",
            "#include <boost/date_time/posix_time/posix_time_types.hpp>",
            "#include <boost/date_time/gregorian/gregorian_types.hpp>",
            "#include <boost/filesystem/path.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/thread.hpp>",
            "#include <string>",
            "#include <vector>",
            "#include <map>",
            "#include <sys/resource.h>",
            "#include <sys/time.h>",
            "#include <sys/types.h>",
            "#include \"uint256.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <inttypes.h>\n#include <stdint.h>\n#include \"netbase.h\" // for AddTimeData\n#include <openssl/ripemd.h>\n#include <openssl/sha.h>\n#include <boost/date_time/posix_time/posix_time_types.hpp>\n#include <boost/date_time/gregorian/gregorian_types.hpp>\n#include <boost/filesystem/path.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/thread.hpp>\n#include <string>\n#include <vector>\n#include <map>\n#include <sys/resource.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include \"uint256.h\"\n\ninline std::string DateTimeStrFormat(int64_t nTime)\n{\n    return DateTimeStrFormat(strTimestampFormat.c_str(), nTime);\n}"
        }
      },
      {
        "call_info": {
          "callee": "pindexCheckpoint->GetBlockTime",
          "args": [],
          "line": 288
        },
        "resolved": true,
        "details": {
          "function_name": "GetBlockTime",
          "container": "CBlockIndex",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "1284-1287",
          "snippet": "int64_t GetBlockTime() const\n    {\n        return (int64_t)nTime;\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCBlockIndex {\n  int64_t GetBlockTime() const\n      {\n          return (int64_t)nTime;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"height\", pindexCheckpoint->nHeight)"
          ],
          "line": 287
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"synccheckpoint\", Checkpoints::hashSyncCheckpoint.ToString().c_str())"
          ],
          "line": 285
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Checkpoints::hashSyncCheckpoint.ToString",
          "args": [],
          "line": 285
        },
        "resolved": true,
        "details": {
          "function_name": "ToString",
          "container": "CService",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "1172-1175",
          "snippet": "std::string CService::ToString() const\n{\n    return ToStringIPPort();\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCService {\n  std::string CService::ToString() const\n  {\n      return ToStringIPPort();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getcheckpoint\\n\"\n            \"Show info of synchronized checkpoint.\\n\""
          ],
          "line": 278
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 277
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\nextern enum Checkpoints::CPMode CheckpointsMode;\n\nValue getcheckpoint(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 0)\n        throw runtime_error(\n            \"getcheckpoint\\n\"\n            \"Show info of synchronized checkpoint.\\n\");\n\n    Object result;\n    CBlockIndex* pindexCheckpoint;\n\n    result.push_back(Pair(\"synccheckpoint\", Checkpoints::hashSyncCheckpoint.ToString().c_str()));\n    pindexCheckpoint = mapBlockIndex[Checkpoints::hashSyncCheckpoint];\n    result.push_back(Pair(\"height\", pindexCheckpoint->nHeight));\n    result.push_back(Pair(\"timestamp\", DateTimeStrFormat(pindexCheckpoint->GetBlockTime()).c_str()));\n\n    // Check that the block satisfies synchronized checkpoint\n    if (CheckpointsMode == Checkpoints::STRICT)\n        result.push_back(Pair(\"policy\", \"strict\"));\n\n    if (CheckpointsMode == Checkpoints::ADVISORY)\n        result.push_back(Pair(\"policy\", \"advisory\"));\n\n    if (CheckpointsMode == Checkpoints::PERMISSIVE)\n        result.push_back(Pair(\"policy\", \"permissive\"));\n\n    if (mapArgs.count(\"-checkpointkey\"))\n        result.push_back(Pair(\"checkpointmaster\", true));\n\n    return result;\n}"
  },
  {
    "function_name": "getblockbynumber",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
    "lines": "249-272",
    "snippet": "Value getblockbynumber(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 1 || params.size() > 2)\n        throw runtime_error(\n            \"getblock <number> [txinfo]\\n\"\n            \"txinfo optional to print more detailed tx info\\n\"\n            \"Returns details of a block with given block-number.\");\n\n    int nHeight = params[0].get_int();\n    if (nHeight < 0 || nHeight > nBestHeight)\n        throw runtime_error(\"Block number out of range.\");\n\n    CBlock block;\n    CBlockIndex* pblockindex = mapBlockIndex[hashBestChain];\n    while (pblockindex->nHeight > nHeight)\n        pblockindex = pblockindex->pprev;\n\n    uint256 hash = *pblockindex->phashBlock;\n\n    pblockindex = mapBlockIndex[hash];\n    block.ReadFromDisk(pblockindex, true);\n\n    return blockToJSON(block, pblockindex, params.size() > 1 ? params[1].get_bool() : false);\n}",
    "includes": [
      "#include \"bitcoinrpc.h\"",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "blockToJSON",
          "args": [
            "block",
            "pblockindex",
            "params.size() > 1 ? params[1].get_bool() : false"
          ],
          "line": 271
        },
        "resolved": true,
        "details": {
          "function_name": "blockToJSON",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
          "lines": "95-145",
          "snippet": "Object blockToJSON(const CBlock& block, const CBlockIndex* blockindex, bool fPrintTransactionDetail)\n{\n    Object result;\n    result.push_back(Pair(\"hash\", block.GetHash().GetHex()));\n    CMerkleTx txGen(block.vtx[0]);\n    txGen.SetMerkleBranch(&block);\n    result.push_back(Pair(\"confirmations\", (int)txGen.GetDepthInMainChain()));\n    result.push_back(Pair(\"size\", (int)::GetSerializeSize(block, SER_NETWORK, PROTOCOL_VERSION)));\n    result.push_back(Pair(\"height\", blockindex->nHeight));\n    result.push_back(Pair(\"version\", block.nVersion));\n    result.push_back(Pair(\"merkleroot\", block.hashMerkleRoot.GetHex()));\n    result.push_back(Pair(\"mint\", ValueFromAmount(blockindex->nMint)));\n    result.push_back(Pair(\"time\", (boost::int64_t)block.GetBlockTime()));\n    result.push_back(Pair(\"nonce\", (boost::uint64_t)block.nNonce));\n    result.push_back(Pair(\"bits\", HexBits(block.nBits)));\n    result.push_back(Pair(\"difficulty\", GetDifficulty(blockindex)));\n    result.push_back(Pair(\"blocktrust\", leftTrim(blockindex->GetBlockTrust().GetHex(), '0')));\n    result.push_back(Pair(\"chaintrust\", leftTrim(blockindex->nChainTrust.GetHex(), '0')));\n    if (blockindex->pprev)\n        result.push_back(Pair(\"previousblockhash\", blockindex->pprev->GetBlockHash().GetHex()));\n    if (blockindex->pnext)\n        result.push_back(Pair(\"nextblockhash\", blockindex->pnext->GetBlockHash().GetHex()));\n\n    result.push_back(Pair(\"flags\", strprintf(\"%s%s\", blockindex->IsProofOfStake()? \"proof-of-stake\" : \"proof-of-work\", blockindex->GeneratedStakeModifier()? \" stake-modifier\": \"\")));\n    result.push_back(Pair(\"proofhash\", blockindex->IsProofOfStake()? blockindex->hashProofOfStake.GetHex() : blockindex->GetBlockHash().GetHex()));\n    result.push_back(Pair(\"entropybit\", (int)blockindex->GetStakeEntropyBit()));\n    result.push_back(Pair(\"modifier\", strprintf(\"%016\"PRIx64, blockindex->nStakeModifier)));\n    result.push_back(Pair(\"modifierchecksum\", strprintf(\"%08x\", blockindex->nStakeModifierChecksum)));\n    Array txinfo;\n    BOOST_FOREACH (const CTransaction& tx, block.vtx)\n    {\n        if (fPrintTransactionDetail)\n        {\n            Object entry;\n\n            entry.push_back(Pair(\"txid\", tx.GetHash().GetHex()));\n            TxToJSON(tx, 0, entry);\n\n            txinfo.push_back(entry);\n        }\n        else\n            txinfo.push_back(tx.GetHash().GetHex());\n    }\n\n    result.push_back(Pair(\"tx\", txinfo));\n\n    if (block.IsProofOfStake())\n        result.push_back(Pair(\"signature\", HexStr(block.vchBlockSig.begin(), block.vchBlockSig.end())));\n\n    return result;\n}",
          "includes": [
            "#include \"bitcoinrpc.h\"",
            "#include \"main.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "extern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\nextern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);\n\nObject blockToJSON(const CBlock& block, const CBlockIndex* blockindex, bool fPrintTransactionDetail)\n{\n    Object result;\n    result.push_back(Pair(\"hash\", block.GetHash().GetHex()));\n    CMerkleTx txGen(block.vtx[0]);\n    txGen.SetMerkleBranch(&block);\n    result.push_back(Pair(\"confirmations\", (int)txGen.GetDepthInMainChain()));\n    result.push_back(Pair(\"size\", (int)::GetSerializeSize(block, SER_NETWORK, PROTOCOL_VERSION)));\n    result.push_back(Pair(\"height\", blockindex->nHeight));\n    result.push_back(Pair(\"version\", block.nVersion));\n    result.push_back(Pair(\"merkleroot\", block.hashMerkleRoot.GetHex()));\n    result.push_back(Pair(\"mint\", ValueFromAmount(blockindex->nMint)));\n    result.push_back(Pair(\"time\", (boost::int64_t)block.GetBlockTime()));\n    result.push_back(Pair(\"nonce\", (boost::uint64_t)block.nNonce));\n    result.push_back(Pair(\"bits\", HexBits(block.nBits)));\n    result.push_back(Pair(\"difficulty\", GetDifficulty(blockindex)));\n    result.push_back(Pair(\"blocktrust\", leftTrim(blockindex->GetBlockTrust().GetHex(), '0')));\n    result.push_back(Pair(\"chaintrust\", leftTrim(blockindex->nChainTrust.GetHex(), '0')));\n    if (blockindex->pprev)\n        result.push_back(Pair(\"previousblockhash\", blockindex->pprev->GetBlockHash().GetHex()));\n    if (blockindex->pnext)\n        result.push_back(Pair(\"nextblockhash\", blockindex->pnext->GetBlockHash().GetHex()));\n\n    result.push_back(Pair(\"flags\", strprintf(\"%s%s\", blockindex->IsProofOfStake()? \"proof-of-stake\" : \"proof-of-work\", blockindex->GeneratedStakeModifier()? \" stake-modifier\": \"\")));\n    result.push_back(Pair(\"proofhash\", blockindex->IsProofOfStake()? blockindex->hashProofOfStake.GetHex() : blockindex->GetBlockHash().GetHex()));\n    result.push_back(Pair(\"entropybit\", (int)blockindex->GetStakeEntropyBit()));\n    result.push_back(Pair(\"modifier\", strprintf(\"%016\"PRIx64, blockindex->nStakeModifier)));\n    result.push_back(Pair(\"modifierchecksum\", strprintf(\"%08x\", blockindex->nStakeModifierChecksum)));\n    Array txinfo;\n    BOOST_FOREACH (const CTransaction& tx, block.vtx)\n    {\n        if (fPrintTransactionDetail)\n        {\n            Object entry;\n\n            entry.push_back(Pair(\"txid\", tx.GetHash().GetHex()));\n            TxToJSON(tx, 0, entry);\n\n            txinfo.push_back(entry);\n        }\n        else\n            txinfo.push_back(tx.GetHash().GetHex());\n    }\n\n    result.push_back(Pair(\"tx\", txinfo));\n\n    if (block.IsProofOfStake())\n        result.push_back(Pair(\"signature\", HexStr(block.vchBlockSig.begin(), block.vchBlockSig.end())));\n\n    return result;\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[1].get_bool",
          "args": [],
          "line": 271
        },
        "resolved": true,
        "details": {
          "function_name": "get_bool",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "377-382",
          "snippet": "bool Value_impl< Config >::get_bool() const\n    {\n        check_type(  bool_type );\n\n        return boost::get< bool >( v_ );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  bool Value_impl< Config >::get_bool() const\n      {\n          check_type(  bool_type );\n  \n          return boost::get< bool >( v_ );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 271
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "block.ReadFromDisk",
          "args": [
            "pblockindex",
            "true"
          ],
          "line": 269
        },
        "resolved": true,
        "details": {
          "function_name": "ReadFromDisk",
          "container": "CBlock",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "1097-1117",
          "snippet": "bool ReadFromDisk(unsigned int nFile, unsigned int nBlockPos, bool fReadTransactions=true)\n    {\n        SetNull();\n\n        // Open history file to read\n        CAutoFile filein = CAutoFile(OpenBlockFile(nFile, nBlockPos, \"rb\"), SER_DISK, CLIENT_VERSION);\n        if (!filein)\n            return error(\"CBlock::ReadFromDisk() : OpenBlockFile failed\");\n        if (!fReadTransactions)\n            filein.nType |= SER_BLOCKHEADERONLY;\n\n        // Read block\n        try {\n            filein >> *this;\n        }\n        catch (std::exception &e) {\n            return error(\"%s() : deserialize or I/O error\", __PRETTY_FUNCTION__);\n        }\n\n        return true;\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCBlock {\n  bool ReadFromDisk(unsigned int nFile, unsigned int nBlockPos, bool fReadTransactions=true)\n      {\n          SetNull();\n  \n          // Open history file to read\n          CAutoFile filein = CAutoFile(OpenBlockFile(nFile, nBlockPos, \"rb\"), SER_DISK, CLIENT_VERSION);\n          if (!filein)\n              return error(\"CBlock::ReadFromDisk() : OpenBlockFile failed\");\n          if (!fReadTransactions)\n              filein.nType |= SER_BLOCKHEADERONLY;\n  \n          // Read block\n          try {\n              filein >> *this;\n          }\n          catch (std::exception &e) {\n              return error(\"%s() : deserialize or I/O error\", __PRETTY_FUNCTION__);\n          }\n  \n          return true;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"Block number out of range.\""
          ],
          "line": 259
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[0].get_int",
          "args": [],
          "line": 257
        },
        "resolved": true,
        "details": {
          "function_name": "get_int",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "385-390",
          "snippet": "int Value_impl< Config >::get_int() const\n    {\n        check_type(  int_type );\n\n        return static_cast< int >( get_int64() );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  int Value_impl< Config >::get_int() const\n      {\n          check_type(  int_type );\n  \n          return static_cast< int >( get_int64() );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getblock <number> [txinfo]\\n\"\n            \"txinfo optional to print more detailed tx info\\n\"\n            \"Returns details of a block with given block-number.\""
          ],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\nValue getblockbynumber(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 1 || params.size() > 2)\n        throw runtime_error(\n            \"getblock <number> [txinfo]\\n\"\n            \"txinfo optional to print more detailed tx info\\n\"\n            \"Returns details of a block with given block-number.\");\n\n    int nHeight = params[0].get_int();\n    if (nHeight < 0 || nHeight > nBestHeight)\n        throw runtime_error(\"Block number out of range.\");\n\n    CBlock block;\n    CBlockIndex* pblockindex = mapBlockIndex[hashBestChain];\n    while (pblockindex->nHeight > nHeight)\n        pblockindex = pblockindex->pprev;\n\n    uint256 hash = *pblockindex->phashBlock;\n\n    pblockindex = mapBlockIndex[hash];\n    block.ReadFromDisk(pblockindex, true);\n\n    return blockToJSON(block, pblockindex, params.size() > 1 ? params[1].get_bool() : false);\n}"
  },
  {
    "function_name": "getblock",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
    "lines": "228-247",
    "snippet": "Value getblock(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 1 || params.size() > 2)\n        throw runtime_error(\n            \"getblock <hash> [txinfo]\\n\"\n            \"txinfo optional to print more detailed tx info\\n\"\n            \"Returns details of a block with given block-hash.\");\n\n    std::string strHash = params[0].get_str();\n    uint256 hash(strHash);\n\n    if (mapBlockIndex.count(hash) == 0)\n        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block not found\");\n\n    CBlock block;\n    CBlockIndex* pblockindex = mapBlockIndex[hash];\n    block.ReadFromDisk(pblockindex, true);\n\n    return blockToJSON(block, pblockindex, params.size() > 1 ? params[1].get_bool() : false);\n}",
    "includes": [
      "#include \"bitcoinrpc.h\"",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "blockToJSON",
          "args": [
            "block",
            "pblockindex",
            "params.size() > 1 ? params[1].get_bool() : false"
          ],
          "line": 246
        },
        "resolved": true,
        "details": {
          "function_name": "blockToJSON",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
          "lines": "95-145",
          "snippet": "Object blockToJSON(const CBlock& block, const CBlockIndex* blockindex, bool fPrintTransactionDetail)\n{\n    Object result;\n    result.push_back(Pair(\"hash\", block.GetHash().GetHex()));\n    CMerkleTx txGen(block.vtx[0]);\n    txGen.SetMerkleBranch(&block);\n    result.push_back(Pair(\"confirmations\", (int)txGen.GetDepthInMainChain()));\n    result.push_back(Pair(\"size\", (int)::GetSerializeSize(block, SER_NETWORK, PROTOCOL_VERSION)));\n    result.push_back(Pair(\"height\", blockindex->nHeight));\n    result.push_back(Pair(\"version\", block.nVersion));\n    result.push_back(Pair(\"merkleroot\", block.hashMerkleRoot.GetHex()));\n    result.push_back(Pair(\"mint\", ValueFromAmount(blockindex->nMint)));\n    result.push_back(Pair(\"time\", (boost::int64_t)block.GetBlockTime()));\n    result.push_back(Pair(\"nonce\", (boost::uint64_t)block.nNonce));\n    result.push_back(Pair(\"bits\", HexBits(block.nBits)));\n    result.push_back(Pair(\"difficulty\", GetDifficulty(blockindex)));\n    result.push_back(Pair(\"blocktrust\", leftTrim(blockindex->GetBlockTrust().GetHex(), '0')));\n    result.push_back(Pair(\"chaintrust\", leftTrim(blockindex->nChainTrust.GetHex(), '0')));\n    if (blockindex->pprev)\n        result.push_back(Pair(\"previousblockhash\", blockindex->pprev->GetBlockHash().GetHex()));\n    if (blockindex->pnext)\n        result.push_back(Pair(\"nextblockhash\", blockindex->pnext->GetBlockHash().GetHex()));\n\n    result.push_back(Pair(\"flags\", strprintf(\"%s%s\", blockindex->IsProofOfStake()? \"proof-of-stake\" : \"proof-of-work\", blockindex->GeneratedStakeModifier()? \" stake-modifier\": \"\")));\n    result.push_back(Pair(\"proofhash\", blockindex->IsProofOfStake()? blockindex->hashProofOfStake.GetHex() : blockindex->GetBlockHash().GetHex()));\n    result.push_back(Pair(\"entropybit\", (int)blockindex->GetStakeEntropyBit()));\n    result.push_back(Pair(\"modifier\", strprintf(\"%016\"PRIx64, blockindex->nStakeModifier)));\n    result.push_back(Pair(\"modifierchecksum\", strprintf(\"%08x\", blockindex->nStakeModifierChecksum)));\n    Array txinfo;\n    BOOST_FOREACH (const CTransaction& tx, block.vtx)\n    {\n        if (fPrintTransactionDetail)\n        {\n            Object entry;\n\n            entry.push_back(Pair(\"txid\", tx.GetHash().GetHex()));\n            TxToJSON(tx, 0, entry);\n\n            txinfo.push_back(entry);\n        }\n        else\n            txinfo.push_back(tx.GetHash().GetHex());\n    }\n\n    result.push_back(Pair(\"tx\", txinfo));\n\n    if (block.IsProofOfStake())\n        result.push_back(Pair(\"signature\", HexStr(block.vchBlockSig.begin(), block.vchBlockSig.end())));\n\n    return result;\n}",
          "includes": [
            "#include \"bitcoinrpc.h\"",
            "#include \"main.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "extern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\nextern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);\n\nObject blockToJSON(const CBlock& block, const CBlockIndex* blockindex, bool fPrintTransactionDetail)\n{\n    Object result;\n    result.push_back(Pair(\"hash\", block.GetHash().GetHex()));\n    CMerkleTx txGen(block.vtx[0]);\n    txGen.SetMerkleBranch(&block);\n    result.push_back(Pair(\"confirmations\", (int)txGen.GetDepthInMainChain()));\n    result.push_back(Pair(\"size\", (int)::GetSerializeSize(block, SER_NETWORK, PROTOCOL_VERSION)));\n    result.push_back(Pair(\"height\", blockindex->nHeight));\n    result.push_back(Pair(\"version\", block.nVersion));\n    result.push_back(Pair(\"merkleroot\", block.hashMerkleRoot.GetHex()));\n    result.push_back(Pair(\"mint\", ValueFromAmount(blockindex->nMint)));\n    result.push_back(Pair(\"time\", (boost::int64_t)block.GetBlockTime()));\n    result.push_back(Pair(\"nonce\", (boost::uint64_t)block.nNonce));\n    result.push_back(Pair(\"bits\", HexBits(block.nBits)));\n    result.push_back(Pair(\"difficulty\", GetDifficulty(blockindex)));\n    result.push_back(Pair(\"blocktrust\", leftTrim(blockindex->GetBlockTrust().GetHex(), '0')));\n    result.push_back(Pair(\"chaintrust\", leftTrim(blockindex->nChainTrust.GetHex(), '0')));\n    if (blockindex->pprev)\n        result.push_back(Pair(\"previousblockhash\", blockindex->pprev->GetBlockHash().GetHex()));\n    if (blockindex->pnext)\n        result.push_back(Pair(\"nextblockhash\", blockindex->pnext->GetBlockHash().GetHex()));\n\n    result.push_back(Pair(\"flags\", strprintf(\"%s%s\", blockindex->IsProofOfStake()? \"proof-of-stake\" : \"proof-of-work\", blockindex->GeneratedStakeModifier()? \" stake-modifier\": \"\")));\n    result.push_back(Pair(\"proofhash\", blockindex->IsProofOfStake()? blockindex->hashProofOfStake.GetHex() : blockindex->GetBlockHash().GetHex()));\n    result.push_back(Pair(\"entropybit\", (int)blockindex->GetStakeEntropyBit()));\n    result.push_back(Pair(\"modifier\", strprintf(\"%016\"PRIx64, blockindex->nStakeModifier)));\n    result.push_back(Pair(\"modifierchecksum\", strprintf(\"%08x\", blockindex->nStakeModifierChecksum)));\n    Array txinfo;\n    BOOST_FOREACH (const CTransaction& tx, block.vtx)\n    {\n        if (fPrintTransactionDetail)\n        {\n            Object entry;\n\n            entry.push_back(Pair(\"txid\", tx.GetHash().GetHex()));\n            TxToJSON(tx, 0, entry);\n\n            txinfo.push_back(entry);\n        }\n        else\n            txinfo.push_back(tx.GetHash().GetHex());\n    }\n\n    result.push_back(Pair(\"tx\", txinfo));\n\n    if (block.IsProofOfStake())\n        result.push_back(Pair(\"signature\", HexStr(block.vchBlockSig.begin(), block.vchBlockSig.end())));\n\n    return result;\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[1].get_bool",
          "args": [],
          "line": 246
        },
        "resolved": true,
        "details": {
          "function_name": "get_bool",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "377-382",
          "snippet": "bool Value_impl< Config >::get_bool() const\n    {\n        check_type(  bool_type );\n\n        return boost::get< bool >( v_ );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  bool Value_impl< Config >::get_bool() const\n      {\n          check_type(  bool_type );\n  \n          return boost::get< bool >( v_ );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 246
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "block.ReadFromDisk",
          "args": [
            "pblockindex",
            "true"
          ],
          "line": 244
        },
        "resolved": true,
        "details": {
          "function_name": "ReadFromDisk",
          "container": "CBlock",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "1097-1117",
          "snippet": "bool ReadFromDisk(unsigned int nFile, unsigned int nBlockPos, bool fReadTransactions=true)\n    {\n        SetNull();\n\n        // Open history file to read\n        CAutoFile filein = CAutoFile(OpenBlockFile(nFile, nBlockPos, \"rb\"), SER_DISK, CLIENT_VERSION);\n        if (!filein)\n            return error(\"CBlock::ReadFromDisk() : OpenBlockFile failed\");\n        if (!fReadTransactions)\n            filein.nType |= SER_BLOCKHEADERONLY;\n\n        // Read block\n        try {\n            filein >> *this;\n        }\n        catch (std::exception &e) {\n            return error(\"%s() : deserialize or I/O error\", __PRETTY_FUNCTION__);\n        }\n\n        return true;\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCBlock {\n  bool ReadFromDisk(unsigned int nFile, unsigned int nBlockPos, bool fReadTransactions=true)\n      {\n          SetNull();\n  \n          // Open history file to read\n          CAutoFile filein = CAutoFile(OpenBlockFile(nFile, nBlockPos, \"rb\"), SER_DISK, CLIENT_VERSION);\n          if (!filein)\n              return error(\"CBlock::ReadFromDisk() : OpenBlockFile failed\");\n          if (!fReadTransactions)\n              filein.nType |= SER_BLOCKHEADERONLY;\n  \n          // Read block\n          try {\n              filein >> *this;\n          }\n          catch (std::exception &e) {\n              return error(\"%s() : deserialize or I/O error\", __PRETTY_FUNCTION__);\n          }\n  \n          return true;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "JSONRPCError",
          "args": [
            "RPC_INVALID_ADDRESS_OR_KEY",
            "\"Block not found\""
          ],
          "line": 240
        },
        "resolved": true,
        "details": {
          "function_name": "JSONRPCError",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "54-60",
          "snippet": "Object JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nObject JSONRPCError(int code, const string& message)\n{\n    Object error;\n    error.push_back(Pair(\"code\", code));\n    error.push_back(Pair(\"message\", message));\n    return error;\n}"
        }
      },
      {
        "call_info": {
          "callee": "mapBlockIndex.count",
          "args": [
            "hash"
          ],
          "line": 239
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "params[0].get_str",
          "args": [],
          "line": 236
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getblock <hash> [txinfo]\\n\"\n            \"txinfo optional to print more detailed tx info\\n\"\n            \"Returns details of a block with given block-hash.\""
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\nValue getblock(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 1 || params.size() > 2)\n        throw runtime_error(\n            \"getblock <hash> [txinfo]\\n\"\n            \"txinfo optional to print more detailed tx info\\n\"\n            \"Returns details of a block with given block-hash.\");\n\n    std::string strHash = params[0].get_str();\n    uint256 hash(strHash);\n\n    if (mapBlockIndex.count(hash) == 0)\n        throw JSONRPCError(RPC_INVALID_ADDRESS_OR_KEY, \"Block not found\");\n\n    CBlock block;\n    CBlockIndex* pblockindex = mapBlockIndex[hash];\n    block.ReadFromDisk(pblockindex, true);\n\n    return blockToJSON(block, pblockindex, params.size() > 1 ? params[1].get_bool() : false);\n}"
  },
  {
    "function_name": "getblockhash",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
    "lines": "213-226",
    "snippet": "Value getblockhash(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 1)\n        throw runtime_error(\n            \"getblockhash <index>\\n\"\n            \"Returns hash of block in best-block-chain at <index>.\");\n\n    int nHeight = params[0].get_int();\n    if (nHeight < 0 || nHeight > nBestHeight)\n        throw runtime_error(\"Block number out of range.\");\n\n    CBlockIndex* pblockindex = FindBlockByHeight(nHeight);\n    return pblockindex->phashBlock->GetHex();\n}",
    "includes": [
      "#include \"bitcoinrpc.h\"",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "pblockindex->phashBlock->GetHex",
          "args": [],
          "line": 225
        },
        "resolved": true,
        "details": {
          "function_name": "GetHex",
          "container": "CBigNum",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bignum.h",
          "lines": "402-405",
          "snippet": "std::string GetHex() const\n    {\n        return ToString(16);\n    }",
          "includes": [
            "#include <stdint.h>",
            "#include <vector>",
            "#include <stdexcept>",
            "#include <openssl/bn.h>",
            "#include \"version.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdint.h>\n#include <vector>\n#include <stdexcept>\n#include <openssl/bn.h>\n#include \"version.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n\nCBigNum {\n  std::string GetHex() const\n      {\n          return ToString(16);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "FindBlockByHeight",
          "args": [
            "nHeight"
          ],
          "line": 224
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"Block number out of range.\""
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params[0].get_int",
          "args": [],
          "line": 220
        },
        "resolved": true,
        "details": {
          "function_name": "get_int",
          "container": "Value_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "385-390",
          "snippet": "int Value_impl< Config >::get_int() const\n    {\n        check_type(  int_type );\n\n        return static_cast< int >( get_int64() );\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nValue_impl< Config > {\n  int Value_impl< Config >::get_int() const\n      {\n          check_type(  int_type );\n  \n          return static_cast< int >( get_int64() );\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getblockhash <index>\\n\"\n            \"Returns hash of block in best-block-chain at <index>.\""
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 215
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\nValue getblockhash(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 1)\n        throw runtime_error(\n            \"getblockhash <index>\\n\"\n            \"Returns hash of block in best-block-chain at <index>.\");\n\n    int nHeight = params[0].get_int();\n    if (nHeight < 0 || nHeight > nBestHeight)\n        throw runtime_error(\"Block number out of range.\");\n\n    CBlockIndex* pblockindex = FindBlockByHeight(nHeight);\n    return pblockindex->phashBlock->GetHex();\n}"
  },
  {
    "function_name": "getrawmempool",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
    "lines": "196-211",
    "snippet": "Value getrawmempool(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 0)\n        throw runtime_error(\n            \"getrawmempool\\n\"\n            \"Returns all transaction ids in memory pool.\");\n\n    vector<uint256> vtxid;\n    mempool.queryHashes(vtxid);\n\n    Array a;\n    BOOST_FOREACH(const uint256& hash, vtxid)\n        a.push_back(hash.ToString());\n\n    return a;\n}",
    "includes": [
      "#include \"bitcoinrpc.h\"",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "a.push_back",
          "args": [
            "hash.ToString()"
          ],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "hash.ToString",
          "args": [],
          "line": 208
        },
        "resolved": true,
        "details": {
          "function_name": "ToString",
          "container": "CService",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "1172-1175",
          "snippet": "std::string CService::ToString() const\n{\n    return ToStringIPPort();\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCService {\n  std::string CService::ToString() const\n  {\n      return ToStringIPPort();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "mempool.queryHashes",
          "args": [
            "vtxid"
          ],
          "line": 204
        },
        "resolved": true,
        "details": {
          "function_name": "queryHashes",
          "container": "CTxMemPool",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
          "lines": "776-784",
          "snippet": "void CTxMemPool::queryHashes(std::vector<uint256>& vtxid)\n{\n    vtxid.clear();\n\n    LOCK(cs);\n    vtxid.reserve(mapTx.size());\n    for (map<uint256, CTransaction>::iterator mi = mapTx.begin(); mi != mapTx.end(); ++mi)\n        vtxid.push_back((*mi).first);\n}",
          "includes": [
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"kernel.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"txdb.h\"",
            "#include \"db.h\"",
            "#include \"checkpoints.h\"",
            "#include \"alert.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "CBigNum bnProofOfWorkLimit(~uint256(0) >> 20);",
            "CBigNum bnProofOfStakeLimit(~uint256(0) >> 20);",
            "const CBigNum bnNeoScryptSwitch(~uint256(0) >> 30);",
            "CBigNum bnProofOfWorkLimitTestNet(~uint256(0) >> 16);",
            "CBigNum bnProofOfStakeLimitTestNet(~uint256(0) >> 16);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/algorithm/string/replace.hpp>\n#include \"kernel.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"txdb.h\"\n#include \"db.h\"\n#include \"checkpoints.h\"\n#include \"alert.h\"\n\nCBigNum bnProofOfWorkLimit(~uint256(0) >> 20);\nCBigNum bnProofOfStakeLimit(~uint256(0) >> 20);\nconst CBigNum bnNeoScryptSwitch(~uint256(0) >> 30);\nCBigNum bnProofOfWorkLimitTestNet(~uint256(0) >> 16);\nCBigNum bnProofOfStakeLimitTestNet(~uint256(0) >> 16);\n\nCTxMemPool {\n  void CTxMemPool::queryHashes(std::vector<uint256>& vtxid)\n  {\n      vtxid.clear();\n  \n      LOCK(cs);\n      vtxid.reserve(mapTx.size());\n      for (map<uint256, CTransaction>::iterator mi = mapTx.begin(); mi != mapTx.end(); ++mi)\n          vtxid.push_back((*mi).first);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getrawmempool\\n\"\n            \"Returns all transaction ids in memory pool.\""
          ],
          "line": 199
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 198
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\nValue getrawmempool(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 0)\n        throw runtime_error(\n            \"getrawmempool\\n\"\n            \"Returns all transaction ids in memory pool.\");\n\n    vector<uint256> vtxid;\n    mempool.queryHashes(vtxid);\n\n    Array a;\n    BOOST_FOREACH(const uint256& hash, vtxid)\n        a.push_back(hash.ToString());\n\n    return a;\n}"
  },
  {
    "function_name": "settxfee",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
    "lines": "183-194",
    "snippet": "Value settxfee(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 1 || params.size() > 1 || AmountFromValue(params[0]) < MIN_TX_FEE)\n        throw runtime_error(\n            \"settxfee <amount>\\n\"\n            \"<amount> is a real and is rounded to the nearest 0.01\");\n\n    nTransactionFee = AmountFromValue(params[0]);\n    nTransactionFee = (nTransactionFee / CENT) * CENT;  // round to cent\n\n    return true;\n}",
    "includes": [
      "#include \"bitcoinrpc.h\"",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "AmountFromValue",
          "args": [
            "params[0]"
          ],
          "line": 190
        },
        "resolved": true,
        "details": {
          "function_name": "AmountFromValue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "102-111",
          "snippet": "int64_t AmountFromValue(const Value& value)\n{\n    double dAmount = value.get_real();\n    if (dAmount <= 0.0 || dAmount > MAX_MONEY)\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    int64_t nAmount = roundint64(dAmount * COIN);\n    if (!MoneyRange(nAmount))\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    return nAmount;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nint64_t AmountFromValue(const Value& value)\n{\n    double dAmount = value.get_real();\n    if (dAmount <= 0.0 || dAmount > MAX_MONEY)\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    int64_t nAmount = roundint64(dAmount * COIN);\n    if (!MoneyRange(nAmount))\n        throw JSONRPCError(RPC_TYPE_ERROR, \"Invalid amount\");\n    return nAmount;\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"settxfee <amount>\\n\"\n            \"<amount> is a real and is rounded to the nearest 0.01\""
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 185
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\nValue settxfee(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() < 1 || params.size() > 1 || AmountFromValue(params[0]) < MIN_TX_FEE)\n        throw runtime_error(\n            \"settxfee <amount>\\n\"\n            \"<amount> is a real and is rounded to the nearest 0.01\");\n\n    nTransactionFee = AmountFromValue(params[0]);\n    nTransactionFee = (nTransactionFee / CENT) * CENT;  // round to cent\n\n    return true;\n}"
  },
  {
    "function_name": "getdifficulty",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
    "lines": "168-180",
    "snippet": "Value getdifficulty(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 0)\n        throw runtime_error(\n            \"getdifficulty\\n\"\n            \"Returns the difficulty as a multiple of the minimum difficulty.\");\n\n    Object obj;\n    obj.push_back(Pair(\"proof-of-work\",        GetDifficulty()));\n    obj.push_back(Pair(\"proof-of-stake\",       GetDifficulty(GetLastBlockIndex(pindexBest, true))));\n    obj.push_back(Pair(\"search-interval\",      (int)nLastCoinStakeSearchInterval));\n    return obj;\n}",
    "includes": [
      "#include \"bitcoinrpc.h\"",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"search-interval\",      (int)nLastCoinStakeSearchInterval)"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"search-interval\"",
            "(int)nLastCoinStakeSearchInterval"
          ],
          "line": 178
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"proof-of-stake\",       GetDifficulty(GetLastBlockIndex(pindexBest, true)))"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetDifficulty",
          "args": [
            "GetLastBlockIndex(pindexBest, true)"
          ],
          "line": 177
        },
        "resolved": true,
        "details": {
          "function_name": "GetDifficulty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
          "lines": "15-44",
          "snippet": "double GetDifficulty(const CBlockIndex* blockindex)\n{\n    // Floating point number that is a multiple of the minimum difficulty,\n    // minimum difficulty = 1.0.\n    if (blockindex == NULL)\n    {\n        if (pindexBest == NULL)\n            return 1.0;\n        else\n            blockindex = GetLastBlockIndex(pindexBest, false);\n    }\n\n    int nShift = (blockindex->nBits >> 24) & 0xff;\n\n    double dDiff =\n        (double)0x0000ffff / (double)(blockindex->nBits & 0x00ffffff);\n\n    while (nShift < 29)\n    {\n        dDiff *= 256.0;\n        nShift++;\n    }\n    while (nShift > 29)\n    {\n        dDiff /= 256.0;\n        nShift--;\n    }\n\n    return dDiff;\n}",
          "includes": [
            "#include \"bitcoinrpc.h\"",
            "#include \"main.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\ndouble GetDifficulty(const CBlockIndex* blockindex)\n{\n    // Floating point number that is a multiple of the minimum difficulty,\n    // minimum difficulty = 1.0.\n    if (blockindex == NULL)\n    {\n        if (pindexBest == NULL)\n            return 1.0;\n        else\n            blockindex = GetLastBlockIndex(pindexBest, false);\n    }\n\n    int nShift = (blockindex->nBits >> 24) & 0xff;\n\n    double dDiff =\n        (double)0x0000ffff / (double)(blockindex->nBits & 0x00ffffff);\n\n    while (nShift < 29)\n    {\n        dDiff *= 256.0;\n        nShift++;\n    }\n    while (nShift > 29)\n    {\n        dDiff /= 256.0;\n        nShift--;\n    }\n\n    return dDiff;\n}"
        }
      },
      {
        "call_info": {
          "callee": "GetLastBlockIndex",
          "args": [
            "pindexBest",
            "true"
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "obj.push_back",
          "args": [
            "Pair(\"proof-of-work\",        GetDifficulty())"
          ],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetDifficulty",
          "args": [],
          "line": 176
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getdifficulty\\n\"\n            \"Returns the difficulty as a multiple of the minimum difficulty.\""
          ],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 170
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\nValue getdifficulty(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 0)\n        throw runtime_error(\n            \"getdifficulty\\n\"\n            \"Returns the difficulty as a multiple of the minimum difficulty.\");\n\n    Object obj;\n    obj.push_back(Pair(\"proof-of-work\",        GetDifficulty()));\n    obj.push_back(Pair(\"proof-of-stake\",       GetDifficulty(GetLastBlockIndex(pindexBest, true))));\n    obj.push_back(Pair(\"search-interval\",      (int)nLastCoinStakeSearchInterval));\n    return obj;\n}"
  },
  {
    "function_name": "getblockcount",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
    "lines": "157-165",
    "snippet": "Value getblockcount(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 0)\n        throw runtime_error(\n            \"getblockcount\\n\"\n            \"Returns the number of blocks in the longest block chain.\");\n\n    return nBestHeight;\n}",
    "includes": [
      "#include \"bitcoinrpc.h\"",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getblockcount\\n\"\n            \"Returns the number of blocks in the longest block chain.\""
          ],
          "line": 160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 159
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\nValue getblockcount(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 0)\n        throw runtime_error(\n            \"getblockcount\\n\"\n            \"Returns the number of blocks in the longest block chain.\");\n\n    return nBestHeight;\n}"
  },
  {
    "function_name": "getbestblockhash",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
    "lines": "147-155",
    "snippet": "Value getbestblockhash(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 0)\n        throw runtime_error(\n            \"getbestblockhash\\n\"\n            \"Returns the hash of the best block in the longest block chain.\");\n\n    return hashBestChain.GetHex();\n}",
    "includes": [
      "#include \"bitcoinrpc.h\"",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "hashBestChain.GetHex",
          "args": [],
          "line": 154
        },
        "resolved": true,
        "details": {
          "function_name": "GetHex",
          "container": "CBigNum",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bignum.h",
          "lines": "402-405",
          "snippet": "std::string GetHex() const\n    {\n        return ToString(16);\n    }",
          "includes": [
            "#include <stdint.h>",
            "#include <vector>",
            "#include <stdexcept>",
            "#include <openssl/bn.h>",
            "#include \"version.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdint.h>\n#include <vector>\n#include <stdexcept>\n#include <openssl/bn.h>\n#include \"version.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n\nCBigNum {\n  std::string GetHex() const\n      {\n          return ToString(16);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "runtime_error",
          "args": [
            "\"getbestblockhash\\n\"\n            \"Returns the hash of the best block in the longest block chain.\""
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "params.size",
          "args": [],
          "line": 149
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\nValue getbestblockhash(const Array& params, bool fHelp)\n{\n    if (fHelp || params.size() != 0)\n        throw runtime_error(\n            \"getbestblockhash\\n\"\n            \"Returns the hash of the best block in the longest block chain.\");\n\n    return hashBestChain.GetHex();\n}"
  },
  {
    "function_name": "blockToJSON",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
    "lines": "95-145",
    "snippet": "Object blockToJSON(const CBlock& block, const CBlockIndex* blockindex, bool fPrintTransactionDetail)\n{\n    Object result;\n    result.push_back(Pair(\"hash\", block.GetHash().GetHex()));\n    CMerkleTx txGen(block.vtx[0]);\n    txGen.SetMerkleBranch(&block);\n    result.push_back(Pair(\"confirmations\", (int)txGen.GetDepthInMainChain()));\n    result.push_back(Pair(\"size\", (int)::GetSerializeSize(block, SER_NETWORK, PROTOCOL_VERSION)));\n    result.push_back(Pair(\"height\", blockindex->nHeight));\n    result.push_back(Pair(\"version\", block.nVersion));\n    result.push_back(Pair(\"merkleroot\", block.hashMerkleRoot.GetHex()));\n    result.push_back(Pair(\"mint\", ValueFromAmount(blockindex->nMint)));\n    result.push_back(Pair(\"time\", (boost::int64_t)block.GetBlockTime()));\n    result.push_back(Pair(\"nonce\", (boost::uint64_t)block.nNonce));\n    result.push_back(Pair(\"bits\", HexBits(block.nBits)));\n    result.push_back(Pair(\"difficulty\", GetDifficulty(blockindex)));\n    result.push_back(Pair(\"blocktrust\", leftTrim(blockindex->GetBlockTrust().GetHex(), '0')));\n    result.push_back(Pair(\"chaintrust\", leftTrim(blockindex->nChainTrust.GetHex(), '0')));\n    if (blockindex->pprev)\n        result.push_back(Pair(\"previousblockhash\", blockindex->pprev->GetBlockHash().GetHex()));\n    if (blockindex->pnext)\n        result.push_back(Pair(\"nextblockhash\", blockindex->pnext->GetBlockHash().GetHex()));\n\n    result.push_back(Pair(\"flags\", strprintf(\"%s%s\", blockindex->IsProofOfStake()? \"proof-of-stake\" : \"proof-of-work\", blockindex->GeneratedStakeModifier()? \" stake-modifier\": \"\")));\n    result.push_back(Pair(\"proofhash\", blockindex->IsProofOfStake()? blockindex->hashProofOfStake.GetHex() : blockindex->GetBlockHash().GetHex()));\n    result.push_back(Pair(\"entropybit\", (int)blockindex->GetStakeEntropyBit()));\n    result.push_back(Pair(\"modifier\", strprintf(\"%016\"PRIx64, blockindex->nStakeModifier)));\n    result.push_back(Pair(\"modifierchecksum\", strprintf(\"%08x\", blockindex->nStakeModifierChecksum)));\n    Array txinfo;\n    BOOST_FOREACH (const CTransaction& tx, block.vtx)\n    {\n        if (fPrintTransactionDetail)\n        {\n            Object entry;\n\n            entry.push_back(Pair(\"txid\", tx.GetHash().GetHex()));\n            TxToJSON(tx, 0, entry);\n\n            txinfo.push_back(entry);\n        }\n        else\n            txinfo.push_back(tx.GetHash().GetHex());\n    }\n\n    result.push_back(Pair(\"tx\", txinfo));\n\n    if (block.IsProofOfStake())\n        result.push_back(Pair(\"signature\", HexStr(block.vchBlockSig.begin(), block.vchBlockSig.end())));\n\n    return result;\n}",
    "includes": [
      "#include \"bitcoinrpc.h\"",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "extern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"signature\", HexStr(block.vchBlockSig.begin(), block.vchBlockSig.end()))"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Pair",
          "args": [
            "\"signature\"",
            "HexStr(block.vchBlockSig.begin(), block.vchBlockSig.end())"
          ],
          "line": 142
        },
        "resolved": true,
        "details": {
          "function_name": "Pair_impl",
          "container": "Pair_impl< Config >",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/json/json_spirit_value.h",
          "lines": "439-443",
          "snippet": "Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n    :   name_( name )\n    ,   value_( value )\n    {\n    }",
          "includes": [
            "#include <boost/variant.hpp>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/cstdint.hpp>",
            "#include <boost/config.hpp>",
            "#include <stdexcept>",
            "#include <sstream>",
            "#include <cassert>",
            "#include <string>",
            "#include <map>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/variant.hpp>\n#include <boost/shared_ptr.hpp>\n#include <boost/cstdint.hpp>\n#include <boost/config.hpp>\n#include <stdexcept>\n#include <sstream>\n#include <cassert>\n#include <string>\n#include <map>\n#include <vector>\n\nPair_impl< Config > {\n  Pair_impl< Config >::Pair_impl( const String_type& name, const Value_type& value )\n      :   name_( name )\n      ,   value_( value )\n      {\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "HexStr",
          "args": [
            "block.vchBlockSig.begin()",
            "block.vchBlockSig.end()"
          ],
          "line": 142
        },
        "resolved": true,
        "details": {
          "function_name": "HexStr",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.h",
          "lines": "323-339",
          "snippet": "std::string HexStr(const T itbegin, const T itend, bool fSpaces=false)\n{\n    std::string rv;\n    static const char hexmap[16] = { '0', '1', '2', '3', '4', '5', '6', '7',\n                                     '8', '9', 'a', 'b', 'c', 'd', 'e', 'f' };\n    rv.reserve((itend-itbegin)*3);\n    for(T it = itbegin; it < itend; ++it)\n    {\n        unsigned char val = (unsigned char)(*it);\n        if(fSpaces && it != itbegin)\n            rv.push_back(' ');\n        rv.push_back(hexmap[val>>4]);\n        rv.push_back(hexmap[val&15]);\n    }\n\n    return rv;\n}",
          "includes": [
            "#include <inttypes.h>",
            "#include <stdint.h>",
            "#include \"netbase.h\" // for AddTimeData",
            "#include <openssl/ripemd.h>",
            "#include <openssl/sha.h>",
            "#include <boost/date_time/posix_time/posix_time_types.hpp>",
            "#include <boost/date_time/gregorian/gregorian_types.hpp>",
            "#include <boost/filesystem/path.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/thread.hpp>",
            "#include <string>",
            "#include <vector>",
            "#include <map>",
            "#include <sys/resource.h>",
            "#include <sys/time.h>",
            "#include <sys/types.h>",
            "#include \"uint256.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <inttypes.h>\n#include <stdint.h>\n#include \"netbase.h\" // for AddTimeData\n#include <openssl/ripemd.h>\n#include <openssl/sha.h>\n#include <boost/date_time/posix_time/posix_time_types.hpp>\n#include <boost/date_time/gregorian/gregorian_types.hpp>\n#include <boost/filesystem/path.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/thread.hpp>\n#include <string>\n#include <vector>\n#include <map>\n#include <sys/resource.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include \"uint256.h\"\n\nstd::string HexStr(const T itbegin, const T itend, bool fSpaces=false)\n{\n    std::string rv;\n    static const char hexmap[16] = { '0', '1', '2', '3', '4', '5', '6', '7',\n                                     '8', '9', 'a', 'b', 'c', 'd', 'e', 'f' };\n    rv.reserve((itend-itbegin)*3);\n    for(T it = itbegin; it < itend; ++it)\n    {\n        unsigned char val = (unsigned char)(*it);\n        if(fSpaces && it != itbegin)\n            rv.push_back(' ');\n        rv.push_back(hexmap[val>>4]);\n        rv.push_back(hexmap[val&15]);\n    }\n\n    return rv;\n}"
        }
      },
      {
        "call_info": {
          "callee": "block.vchBlockSig.end",
          "args": [],
          "line": 142
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "block.vchBlockSig.begin",
          "args": [],
          "line": 142
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "block.IsProofOfStake",
          "args": [],
          "line": 141
        },
        "resolved": true,
        "details": {
          "function_name": "IsProofOfStake",
          "container": "CBlockIndex",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "1384-1387",
          "snippet": "bool IsProofOfStake() const\n    {\n        return (nFlags & BLOCK_PROOF_OF_STAKE);\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCBlockIndex {\n  bool IsProofOfStake() const\n      {\n          return (nFlags & BLOCK_PROOF_OF_STAKE);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"tx\", txinfo)"
          ],
          "line": 139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "txinfo.push_back",
          "args": [
            "tx.GetHash().GetHex()"
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "tx.GetHash",
          "args": [],
          "line": 136
        },
        "resolved": true,
        "details": {
          "function_name": "GetHash",
          "container": "CNetAddr",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/netbase.cpp",
          "lines": "922-928",
          "snippet": "uint64_t CNetAddr::GetHash() const\n{\n    uint256 hash = Hash(&ip[0], &ip[16]);\n    uint64_t nRet;\n    memcpy(&nRet, &hash, sizeof(nRet));\n    return nRet;\n}",
          "includes": [
            "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()",
            "#include \"strlcpy.h\"",
            "#include <sys/fcntl.h>",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"netbase.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/algorithm/string/case_conv.hpp> // for to_lower()\n#include \"strlcpy.h\"\n#include <sys/fcntl.h>\n#include \"sync.h\"\n#include \"util.h\"\n#include \"netbase.h\"\n\nCNetAddr {\n  uint64_t CNetAddr::GetHash() const\n  {\n      uint256 hash = Hash(&ip[0], &ip[16]);\n      uint64_t nRet;\n      memcpy(&nRet, &hash, sizeof(nRet));\n      return nRet;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "txinfo.push_back",
          "args": [
            "entry"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "TxToJSON",
          "args": [
            "tx",
            "0",
            "entry"
          ],
          "line": 131
        },
        "resolved": true,
        "details": {
          "function_name": "TxToJSON",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcrawtransaction.cpp",
          "lines": "47-103",
          "snippet": "void TxToJSON(const CTransaction& tx, const uint256 hashBlock, Object& entry)\n{\n    entry.push_back(Pair(\"txid\", tx.GetHash().GetHex()));\n    entry.push_back(Pair(\"version\", tx.nVersion));\n    entry.push_back(Pair(\"time\", (boost::int64_t)tx.nTime));\n    entry.push_back(Pair(\"locktime\", (boost::int64_t)tx.nLockTime));\n    Array vin;\n    BOOST_FOREACH(const CTxIn& txin, tx.vin)\n    {\n        Object in;\n        if (tx.IsCoinBase())\n            in.push_back(Pair(\"coinbase\", HexStr(txin.scriptSig.begin(), txin.scriptSig.end())));\n        else\n        {\n            in.push_back(Pair(\"txid\", txin.prevout.hash.GetHex()));\n            in.push_back(Pair(\"vout\", (boost::int64_t)txin.prevout.n));\n            Object o;\n            o.push_back(Pair(\"asm\", txin.scriptSig.ToString()));\n            o.push_back(Pair(\"hex\", HexStr(txin.scriptSig.begin(), txin.scriptSig.end())));\n            in.push_back(Pair(\"scriptSig\", o));\n        }\n        in.push_back(Pair(\"sequence\", (boost::int64_t)txin.nSequence));\n        vin.push_back(in);\n    }\n    entry.push_back(Pair(\"vin\", vin));\n    Array vout;\n    for (unsigned int i = 0; i < tx.vout.size(); i++)\n    {\n        const CTxOut& txout = tx.vout[i];\n        Object out;\n        out.push_back(Pair(\"value\", ValueFromAmount(txout.nValue)));\n        out.push_back(Pair(\"n\", (boost::int64_t)i));\n        Object o;\n        ScriptPubKeyToJSON(txout.scriptPubKey, o, false);\n        out.push_back(Pair(\"scriptPubKey\", o));\n        vout.push_back(out);\n    }\n    entry.push_back(Pair(\"vout\", vout));\n\n    if (hashBlock != 0)\n    {\n        entry.push_back(Pair(\"blockhash\", hashBlock.GetHex()));\n        map<uint256, CBlockIndex*>::iterator mi = mapBlockIndex.find(hashBlock);\n        if (mi != mapBlockIndex.end() && (*mi).second)\n        {\n            CBlockIndex* pindex = (*mi).second;\n            if (pindex->IsInMainChain())\n            {\n                entry.push_back(Pair(\"confirmations\", 1 + nBestHeight - pindex->nHeight));\n                entry.push_back(Pair(\"time\", (boost::int64_t)pindex->nTime));\n                entry.push_back(Pair(\"blocktime\", (boost::int64_t)pindex->nTime));\n            }\n            else\n                entry.push_back(Pair(\"confirmations\", 0));\n        }\n    }\n}",
          "includes": [
            "#include \"wallet.h\"",
            "#include \"net.h\"",
            "#include \"main.h\"",
            "#include \"init.h\"",
            "#include \"txdb.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include <boost/assign/list_of.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"wallet.h\"\n#include \"net.h\"\n#include \"main.h\"\n#include \"init.h\"\n#include \"txdb.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include <boost/assign/list_of.hpp>\n\nvoid TxToJSON(const CTransaction& tx, const uint256 hashBlock, Object& entry)\n{\n    entry.push_back(Pair(\"txid\", tx.GetHash().GetHex()));\n    entry.push_back(Pair(\"version\", tx.nVersion));\n    entry.push_back(Pair(\"time\", (boost::int64_t)tx.nTime));\n    entry.push_back(Pair(\"locktime\", (boost::int64_t)tx.nLockTime));\n    Array vin;\n    BOOST_FOREACH(const CTxIn& txin, tx.vin)\n    {\n        Object in;\n        if (tx.IsCoinBase())\n            in.push_back(Pair(\"coinbase\", HexStr(txin.scriptSig.begin(), txin.scriptSig.end())));\n        else\n        {\n            in.push_back(Pair(\"txid\", txin.prevout.hash.GetHex()));\n            in.push_back(Pair(\"vout\", (boost::int64_t)txin.prevout.n));\n            Object o;\n            o.push_back(Pair(\"asm\", txin.scriptSig.ToString()));\n            o.push_back(Pair(\"hex\", HexStr(txin.scriptSig.begin(), txin.scriptSig.end())));\n            in.push_back(Pair(\"scriptSig\", o));\n        }\n        in.push_back(Pair(\"sequence\", (boost::int64_t)txin.nSequence));\n        vin.push_back(in);\n    }\n    entry.push_back(Pair(\"vin\", vin));\n    Array vout;\n    for (unsigned int i = 0; i < tx.vout.size(); i++)\n    {\n        const CTxOut& txout = tx.vout[i];\n        Object out;\n        out.push_back(Pair(\"value\", ValueFromAmount(txout.nValue)));\n        out.push_back(Pair(\"n\", (boost::int64_t)i));\n        Object o;\n        ScriptPubKeyToJSON(txout.scriptPubKey, o, false);\n        out.push_back(Pair(\"scriptPubKey\", o));\n        vout.push_back(out);\n    }\n    entry.push_back(Pair(\"vout\", vout));\n\n    if (hashBlock != 0)\n    {\n        entry.push_back(Pair(\"blockhash\", hashBlock.GetHex()));\n        map<uint256, CBlockIndex*>::iterator mi = mapBlockIndex.find(hashBlock);\n        if (mi != mapBlockIndex.end() && (*mi).second)\n        {\n            CBlockIndex* pindex = (*mi).second;\n            if (pindex->IsInMainChain())\n            {\n                entry.push_back(Pair(\"confirmations\", 1 + nBestHeight - pindex->nHeight));\n                entry.push_back(Pair(\"time\", (boost::int64_t)pindex->nTime));\n                entry.push_back(Pair(\"blocktime\", (boost::int64_t)pindex->nTime));\n            }\n            else\n                entry.push_back(Pair(\"confirmations\", 0));\n        }\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "entry.push_back",
          "args": [
            "Pair(\"txid\", tx.GetHash().GetHex())"
          ],
          "line": 130
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"modifierchecksum\", strprintf(\"%08x\", blockindex->nStakeModifierChecksum))"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strprintf",
          "args": [
            "\"%08x\"",
            "blockindex->nStakeModifierChecksum"
          ],
          "line": 122
        },
        "resolved": true,
        "details": {
          "function_name": "real_strprintf",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "331-338",
          "snippet": "string real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nstring real_strprintf(const std::string &format, int dummy, ...)\n{\n    va_list arg_ptr;\n    va_start(arg_ptr, dummy);\n    string str = vstrprintf(format.c_str(), arg_ptr);\n    va_end(arg_ptr);\n    return str;\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"modifier\", strprintf(\"%016\"PRIx64, blockindex->nStakeModifier))"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"entropybit\", (int)blockindex->GetStakeEntropyBit())"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "blockindex->GetStakeEntropyBit",
          "args": [],
          "line": 120
        },
        "resolved": true,
        "details": {
          "function_name": "GetStakeEntropyBit",
          "container": "CBlockIndex",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "1394-1397",
          "snippet": "unsigned int GetStakeEntropyBit() const\n    {\n        return ((nFlags & BLOCK_STAKE_ENTROPY) >> 1);\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCBlockIndex {\n  unsigned int GetStakeEntropyBit() const\n      {\n          return ((nFlags & BLOCK_STAKE_ENTROPY) >> 1);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"proofhash\", blockindex->IsProofOfStake()? blockindex->hashProofOfStake.GetHex() : blockindex->GetBlockHash().GetHex())"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "blockindex->GetBlockHash",
          "args": [],
          "line": 119
        },
        "resolved": true,
        "details": {
          "function_name": "GetBlockHash",
          "container": "CBlockLocator",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "1644-1658",
          "snippet": "uint256 GetBlockHash()\n    {\n        // Find the first block the caller has in the main chain\n        BOOST_FOREACH(const uint256& hash, vHave)\n        {\n            std::map<uint256, CBlockIndex*>::iterator mi = mapBlockIndex.find(hash);\n            if (mi != mapBlockIndex.end())\n            {\n                CBlockIndex* pindex = (*mi).second;\n                if (pindex->IsInMainChain())\n                    return hash;\n            }\n        }\n        return (!fTestNet ? hashGenesisBlock : hashGenesisBlockTestNet);\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCBlockLocator {\n  uint256 GetBlockHash()\n      {\n          // Find the first block the caller has in the main chain\n          BOOST_FOREACH(const uint256& hash, vHave)\n          {\n              std::map<uint256, CBlockIndex*>::iterator mi = mapBlockIndex.find(hash);\n              if (mi != mapBlockIndex.end())\n              {\n                  CBlockIndex* pindex = (*mi).second;\n                  if (pindex->IsInMainChain())\n                      return hash;\n              }\n          }\n          return (!fTestNet ? hashGenesisBlock : hashGenesisBlockTestNet);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "blockindex->hashProofOfStake.GetHex",
          "args": [],
          "line": 119
        },
        "resolved": true,
        "details": {
          "function_name": "GetHex",
          "container": "CBigNum",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bignum.h",
          "lines": "402-405",
          "snippet": "std::string GetHex() const\n    {\n        return ToString(16);\n    }",
          "includes": [
            "#include <stdint.h>",
            "#include <vector>",
            "#include <stdexcept>",
            "#include <openssl/bn.h>",
            "#include \"version.h\"",
            "#include \"uint256.h\"",
            "#include \"serialize.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdint.h>\n#include <vector>\n#include <stdexcept>\n#include <openssl/bn.h>\n#include \"version.h\"\n#include \"uint256.h\"\n#include \"serialize.h\"\n\nCBigNum {\n  std::string GetHex() const\n      {\n          return ToString(16);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"flags\", strprintf(\"%s%s\", blockindex->IsProofOfStake()? \"proof-of-stake\" : \"proof-of-work\", blockindex->GeneratedStakeModifier()? \" stake-modifier\": \"\"))"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strprintf",
          "args": [
            "\"%s%s\"",
            "blockindex->IsProofOfStake()? \"proof-of-stake\" : \"proof-of-work\"",
            "blockindex->GeneratedStakeModifier()? \" stake-modifier\": \"\""
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "blockindex->GeneratedStakeModifier",
          "args": [],
          "line": 118
        },
        "resolved": true,
        "details": {
          "function_name": "GeneratedStakeModifier",
          "container": "CBlockIndex",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "1407-1410",
          "snippet": "bool GeneratedStakeModifier() const\n    {\n        return (nFlags & BLOCK_STAKE_MODIFIER);\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCBlockIndex {\n  bool GeneratedStakeModifier() const\n      {\n          return (nFlags & BLOCK_STAKE_MODIFIER);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"nextblockhash\", blockindex->pnext->GetBlockHash().GetHex())"
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"previousblockhash\", blockindex->pprev->GetBlockHash().GetHex())"
          ],
          "line": 114
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"chaintrust\", leftTrim(blockindex->nChainTrust.GetHex(), '0'))"
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "leftTrim",
          "args": [
            "blockindex->nChainTrust.GetHex()",
            "'0'"
          ],
          "line": 112
        },
        "resolved": true,
        "details": {
          "function_name": "leftTrim",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.h",
          "lines": "312-320",
          "snippet": "inline std::string leftTrim(std::string src, char chr)\n{\n    std::string::size_type pos = src.find_first_not_of(chr, 0);\n\n    if(pos > 0)\n        src.erase(0, pos);\n\n    return src;\n}",
          "includes": [
            "#include <inttypes.h>",
            "#include <stdint.h>",
            "#include \"netbase.h\" // for AddTimeData",
            "#include <openssl/ripemd.h>",
            "#include <openssl/sha.h>",
            "#include <boost/date_time/posix_time/posix_time_types.hpp>",
            "#include <boost/date_time/gregorian/gregorian_types.hpp>",
            "#include <boost/filesystem/path.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/thread.hpp>",
            "#include <string>",
            "#include <vector>",
            "#include <map>",
            "#include <sys/resource.h>",
            "#include <sys/time.h>",
            "#include <sys/types.h>",
            "#include \"uint256.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <inttypes.h>\n#include <stdint.h>\n#include \"netbase.h\" // for AddTimeData\n#include <openssl/ripemd.h>\n#include <openssl/sha.h>\n#include <boost/date_time/posix_time/posix_time_types.hpp>\n#include <boost/date_time/gregorian/gregorian_types.hpp>\n#include <boost/filesystem/path.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/thread.hpp>\n#include <string>\n#include <vector>\n#include <map>\n#include <sys/resource.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include \"uint256.h\"\n\ninline std::string leftTrim(std::string src, char chr)\n{\n    std::string::size_type pos = src.find_first_not_of(chr, 0);\n\n    if(pos > 0)\n        src.erase(0, pos);\n\n    return src;\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"blocktrust\", leftTrim(blockindex->GetBlockTrust().GetHex(), '0'))"
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "blockindex->GetBlockTrust",
          "args": [],
          "line": 111
        },
        "resolved": true,
        "details": {
          "function_name": "GetBlockTrust",
          "container": "CBlockIndex",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
          "lines": "2317-2414",
          "snippet": "uint256 CBlockIndex::GetBlockTrust() const {\n    CBigNum bnTarget;\n    bnTarget.SetCompact(nBits);\n\n    if(bnTarget <= 0) return(0);\n\n    /* Old protocol */\n\n    if(!fTestNet && (nHeight < nForkOne))\n      return(((CBigNum(1) << 256) / (bnTarget + 1)).getuint256());\n\n    /* New protocol: 80% PoS, 20% PoW */\n\n    uint256 nBlockTrust = 1;\n\n    if(IsProofOfWork()) {\n\n        uint256 nPoWBase  = uint256(\"0x00000000FFFF0000000000000000000000000000000000000000000000000000\");\n        uint256 nPoWTrust = (CBigNum(nPoWBase) / (bnTarget + 1)).getuint256();\n\n        /* The minimal PoW trust score prior to correction */\n        if(nPoWTrust < 4) nPoWTrust = 4;\n\n        /* Fixed trust for the first 10 blocks */\n        if((pprev == NULL) || (pprev->nHeight < 10))\n          return(nPoWTrust);\n\n        const CBlockIndex* pindexP1 = pprev;\n        const CBlockIndex* pindexP2 = pindexP1->pprev;\n\n        if(pindexP1->IsProofOfStake()) {\n            /* 100% trust for PoW following PoS */\n            nBlockTrust = nPoWTrust;\n        } else {\n            if(pindexP2->IsProofOfStake()) {\n                /* 50% trust for PoS->PoW->PoW */\n                nBlockTrust = (nPoWTrust >> 1);\n            } else {\n                /* 25% trust for PoW->PoW->PoW */\n                nBlockTrust = (nPoWTrust >> 2);\n            }\n        }\n\n    } else {\n\n        const CBlockIndex* pindexP1 = pprev;\n        const CBlockIndex* pindexP2 = pindexP1->pprev;\n        const CBlockIndex* pindexP3 = pindexP2->pprev;\n\n        /* PoS difficulty is very low and of little use for trust scoring;\n         * use full trust of the previous PoW block as a basis instead */\n        uint256 nPrevTrust = pindexP1->nChainTrust - pindexP2->nChainTrust;\n\n        if(pindexP1->IsProofOfWork()) {\n            /* 200% trust for PoS following PoW */\n            if(pindexP2->IsProofOfStake()) {\n                /* PoS->PoW->PoS: 100% to 200% */\n                nBlockTrust = (nPrevTrust << 1);\n            } else {\n                if(pindexP3->IsProofOfStake()) {\n                    /* PoS->PoW->PoW->PoS: 50% to 200% */\n                    nBlockTrust = (nPrevTrust << 2);\n                } else {\n                    /* PoW->PoW->PoW->PoS: 25% to 200% */\n                    nBlockTrust = (nPrevTrust << 3);\n                }\n            }\n        } else {\n            if(pindexP2->IsProofOfWork()) {\n                /* 150% of trust for PoW->PoS->PoS */\n                nBlockTrust = (CBigNum(nPrevTrust) * 3 / 4).getuint256();\n            } else {\n                if(pindexP3->IsProofOfWork()) {\n                    /* 120% of trust for PoW->PoS->PoS->PoS */\n                    nBlockTrust = (CBigNum(nPrevTrust) * 4 / 5).getuint256();\n                } else {\n                    const CBlockIndex* pindexP4 = pindexP3->pprev;\n                    if(pindexP4->IsProofOfWork()) {\n                        /* 100% of trust for PoW->PoS->PoS->PoS->PoS */\n                        nBlockTrust = (CBigNum(nPrevTrust) * 5 / 6).getuint256();\n                    } else {\n                        const CBlockIndex* pindexP5 = pindexP4->pprev;\n                        if(pindexP5->IsProofOfWork()) {\n                            /* 50% of trust for PoW->PoS->PoS->PoS->PoS->PoS */\n                            nBlockTrust = (nPrevTrust >> 1);\n                        } else {\n                            /* 50% of trust for PoS->PoS->PoS->PoS->PoS->PoS */\n                            nBlockTrust = nPrevTrust;\n                        }\n                    }\n                }\n            }\n        }\n\n    }\n\n    return(nBlockTrust);\n}",
          "includes": [
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"kernel.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"txdb.h\"",
            "#include \"db.h\"",
            "#include \"checkpoints.h\"",
            "#include \"alert.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "CBigNum bnProofOfWorkLimit(~uint256(0) >> 20);",
            "CBigNum bnProofOfStakeLimit(~uint256(0) >> 20);",
            "const CBigNum bnNeoScryptSwitch(~uint256(0) >> 30);",
            "CBigNum bnProofOfWorkLimitTestNet(~uint256(0) >> 16);",
            "CBigNum bnProofOfStakeLimitTestNet(~uint256(0) >> 16);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/algorithm/string/replace.hpp>\n#include \"kernel.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"txdb.h\"\n#include \"db.h\"\n#include \"checkpoints.h\"\n#include \"alert.h\"\n\nCBigNum bnProofOfWorkLimit(~uint256(0) >> 20);\nCBigNum bnProofOfStakeLimit(~uint256(0) >> 20);\nconst CBigNum bnNeoScryptSwitch(~uint256(0) >> 30);\nCBigNum bnProofOfWorkLimitTestNet(~uint256(0) >> 16);\nCBigNum bnProofOfStakeLimitTestNet(~uint256(0) >> 16);\n\nCBlockIndex {\n  uint256 CBlockIndex::GetBlockTrust() const {\n      CBigNum bnTarget;\n      bnTarget.SetCompact(nBits);\n  \n      if(bnTarget <= 0) return(0);\n  \n      /* Old protocol */\n  \n      if(!fTestNet && (nHeight < nForkOne))\n        return(((CBigNum(1) << 256) / (bnTarget + 1)).getuint256());\n  \n      /* New protocol: 80% PoS, 20% PoW */\n  \n      uint256 nBlockTrust = 1;\n  \n      if(IsProofOfWork()) {\n  \n          uint256 nPoWBase  = uint256(\"0x00000000FFFF0000000000000000000000000000000000000000000000000000\");\n          uint256 nPoWTrust = (CBigNum(nPoWBase) / (bnTarget + 1)).getuint256();\n  \n          /* The minimal PoW trust score prior to correction */\n          if(nPoWTrust < 4) nPoWTrust = 4;\n  \n          /* Fixed trust for the first 10 blocks */\n          if((pprev == NULL) || (pprev->nHeight < 10))\n            return(nPoWTrust);\n  \n          const CBlockIndex* pindexP1 = pprev;\n          const CBlockIndex* pindexP2 = pindexP1->pprev;\n  \n          if(pindexP1->IsProofOfStake()) {\n              /* 100% trust for PoW following PoS */\n              nBlockTrust = nPoWTrust;\n          } else {\n              if(pindexP2->IsProofOfStake()) {\n                  /* 50% trust for PoS->PoW->PoW */\n                  nBlockTrust = (nPoWTrust >> 1);\n              } else {\n                  /* 25% trust for PoW->PoW->PoW */\n                  nBlockTrust = (nPoWTrust >> 2);\n              }\n          }\n  \n      } else {\n  \n          const CBlockIndex* pindexP1 = pprev;\n          const CBlockIndex* pindexP2 = pindexP1->pprev;\n          const CBlockIndex* pindexP3 = pindexP2->pprev;\n  \n          /* PoS difficulty is very low and of little use for trust scoring;\n           * use full trust of the previous PoW block as a basis instead */\n          uint256 nPrevTrust = pindexP1->nChainTrust - pindexP2->nChainTrust;\n  \n          if(pindexP1->IsProofOfWork()) {\n              /* 200% trust for PoS following PoW */\n              if(pindexP2->IsProofOfStake()) {\n                  /* PoS->PoW->PoS: 100% to 200% */\n                  nBlockTrust = (nPrevTrust << 1);\n              } else {\n                  if(pindexP3->IsProofOfStake()) {\n                      /* PoS->PoW->PoW->PoS: 50% to 200% */\n                      nBlockTrust = (nPrevTrust << 2);\n                  } else {\n                      /* PoW->PoW->PoW->PoS: 25% to 200% */\n                      nBlockTrust = (nPrevTrust << 3);\n                  }\n              }\n          } else {\n              if(pindexP2->IsProofOfWork()) {\n                  /* 150% of trust for PoW->PoS->PoS */\n                  nBlockTrust = (CBigNum(nPrevTrust) * 3 / 4).getuint256();\n              } else {\n                  if(pindexP3->IsProofOfWork()) {\n                      /* 120% of trust for PoW->PoS->PoS->PoS */\n                      nBlockTrust = (CBigNum(nPrevTrust) * 4 / 5).getuint256();\n                  } else {\n                      const CBlockIndex* pindexP4 = pindexP3->pprev;\n                      if(pindexP4->IsProofOfWork()) {\n                          /* 100% of trust for PoW->PoS->PoS->PoS->PoS */\n                          nBlockTrust = (CBigNum(nPrevTrust) * 5 / 6).getuint256();\n                      } else {\n                          const CBlockIndex* pindexP5 = pindexP4->pprev;\n                          if(pindexP5->IsProofOfWork()) {\n                              /* 50% of trust for PoW->PoS->PoS->PoS->PoS->PoS */\n                              nBlockTrust = (nPrevTrust >> 1);\n                          } else {\n                              /* 50% of trust for PoS->PoS->PoS->PoS->PoS->PoS */\n                              nBlockTrust = nPrevTrust;\n                          }\n                      }\n                  }\n              }\n          }\n  \n      }\n  \n      return(nBlockTrust);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"difficulty\", GetDifficulty(blockindex))"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetDifficulty",
          "args": [
            "blockindex"
          ],
          "line": 110
        },
        "resolved": true,
        "details": {
          "function_name": "GetDifficulty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
          "lines": "15-44",
          "snippet": "double GetDifficulty(const CBlockIndex* blockindex)\n{\n    // Floating point number that is a multiple of the minimum difficulty,\n    // minimum difficulty = 1.0.\n    if (blockindex == NULL)\n    {\n        if (pindexBest == NULL)\n            return 1.0;\n        else\n            blockindex = GetLastBlockIndex(pindexBest, false);\n    }\n\n    int nShift = (blockindex->nBits >> 24) & 0xff;\n\n    double dDiff =\n        (double)0x0000ffff / (double)(blockindex->nBits & 0x00ffffff);\n\n    while (nShift < 29)\n    {\n        dDiff *= 256.0;\n        nShift++;\n    }\n    while (nShift > 29)\n    {\n        dDiff /= 256.0;\n        nShift--;\n    }\n\n    return dDiff;\n}",
          "includes": [
            "#include \"bitcoinrpc.h\"",
            "#include \"main.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\ndouble GetDifficulty(const CBlockIndex* blockindex)\n{\n    // Floating point number that is a multiple of the minimum difficulty,\n    // minimum difficulty = 1.0.\n    if (blockindex == NULL)\n    {\n        if (pindexBest == NULL)\n            return 1.0;\n        else\n            blockindex = GetLastBlockIndex(pindexBest, false);\n    }\n\n    int nShift = (blockindex->nBits >> 24) & 0xff;\n\n    double dDiff =\n        (double)0x0000ffff / (double)(blockindex->nBits & 0x00ffffff);\n\n    while (nShift < 29)\n    {\n        dDiff *= 256.0;\n        nShift++;\n    }\n    while (nShift > 29)\n    {\n        dDiff /= 256.0;\n        nShift--;\n    }\n\n    return dDiff;\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"bits\", HexBits(block.nBits))"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "HexBits",
          "args": [
            "block.nBits"
          ],
          "line": 109
        },
        "resolved": true,
        "details": {
          "function_name": "HexBits",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "118-126",
          "snippet": "std::string HexBits(unsigned int nBits)\n{\n    union {\n        int32_t nBits;\n        char cBits[4];\n    } uBits;\n    uBits.nBits = htonl((int32_t)nBits);\n    return HexStr(BEGIN(uBits.cBits), END(uBits.cBits));\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nstd::string HexBits(unsigned int nBits)\n{\n    union {\n        int32_t nBits;\n        char cBits[4];\n    } uBits;\n    uBits.nBits = htonl((int32_t)nBits);\n    return HexStr(BEGIN(uBits.cBits), END(uBits.cBits));\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"nonce\", (boost::uint64_t)block.nNonce)"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"time\", (boost::int64_t)block.GetBlockTime())"
          ],
          "line": 107
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "block.GetBlockTime",
          "args": [],
          "line": 107
        },
        "resolved": true,
        "details": {
          "function_name": "GetBlockTime",
          "container": "CBlockIndex",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "1284-1287",
          "snippet": "int64_t GetBlockTime() const\n    {\n        return (int64_t)nTime;\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCBlockIndex {\n  int64_t GetBlockTime() const\n      {\n          return (int64_t)nTime;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"mint\", ValueFromAmount(blockindex->nMint))"
          ],
          "line": 106
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ValueFromAmount",
          "args": [
            "blockindex->nMint"
          ],
          "line": 106
        },
        "resolved": true,
        "details": {
          "function_name": "ValueFromAmount",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bitcoinrpc.cpp",
          "lines": "113-116",
          "snippet": "Value ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}",
          "includes": [
            "#include <list>",
            "#include <boost/shared_ptr.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/asio/ssl.hpp>",
            "#include <boost/algorithm/string.hpp>",
            "#include <boost/iostreams/stream.hpp>",
            "#include <boost/iostreams/concepts.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/bind.hpp>",
            "#include <boost/bind/bind.hpp>",
            "#include <boost/asio/ip/v6_only.hpp>",
            "#include <boost/asio.hpp>",
            "#include \"db.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"base58.h\"",
            "#include \"ui_interface.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\"",
            "#include \"init.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <boost/shared_ptr.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/asio/ssl.hpp>\n#include <boost/algorithm/string.hpp>\n#include <boost/iostreams/stream.hpp>\n#include <boost/iostreams/concepts.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/bind.hpp>\n#include <boost/bind/bind.hpp>\n#include <boost/asio/ip/v6_only.hpp>\n#include <boost/asio.hpp>\n#include \"db.h\"\n#include \"bitcoinrpc.h\"\n#include \"base58.h\"\n#include \"ui_interface.h\"\n#include \"sync.h\"\n#include \"util.h\"\n#include \"init.h\"\n\nValue ValueFromAmount(int64_t amount)\n{\n    return (double)amount / (double)COIN;\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"merkleroot\", block.hashMerkleRoot.GetHex())"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"version\", block.nVersion)"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"height\", blockindex->nHeight)"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"size\", (int)::GetSerializeSize(block, SER_NETWORK, PROTOCOL_VERSION))"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "::GetSerializeSize",
          "args": [
            "block",
            "SER_NETWORK",
            "PROTOCOL_VERSION"
          ],
          "line": 102
        },
        "resolved": true,
        "details": {
          "function_name": "GetSerializeSize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/serialize.h",
          "lines": "632-638",
          "snippet": "unsigned int GetSerializeSize(const std::set<K, Pred, A>& m, int nType, int nVersion)\n{\n    unsigned int nSize = GetSizeOfCompactSize(m.size());\n    for (typename std::set<K, Pred, A>::const_iterator it = m.begin(); it != m.end(); ++it)\n        nSize += GetSerializeSize((*it), nType, nVersion);\n    return nSize;\n}",
          "includes": [
            "#include \"version.h\"",
            "#include \"allocators.h\"",
            "#include <boost/tuple/tuple.hpp>",
            "#include <boost/type_traits/is_fundamental.hpp>",
            "#include <cstdio>",
            "#include <cstring>",
            "#include <stdint.h>",
            "#include <limits>",
            "#include <cassert>",
            "#include <set>",
            "#include <map>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"version.h\"\n#include \"allocators.h\"\n#include <boost/tuple/tuple.hpp>\n#include <boost/type_traits/is_fundamental.hpp>\n#include <cstdio>\n#include <cstring>\n#include <stdint.h>\n#include <limits>\n#include <cassert>\n#include <set>\n#include <map>\n#include <vector>\n#include <string>\n\nunsigned int GetSerializeSize(const std::set<K, Pred, A>& m, int nType, int nVersion)\n{\n    unsigned int nSize = GetSizeOfCompactSize(m.size());\n    for (typename std::set<K, Pred, A>::const_iterator it = m.begin(); it != m.end(); ++it)\n        nSize += GetSerializeSize((*it), nType, nVersion);\n    return nSize;\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"confirmations\", (int)txGen.GetDepthInMainChain())"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "txGen.GetDepthInMainChain",
          "args": [],
          "line": 101
        },
        "resolved": true,
        "details": {
          "function_name": "GetDepthInMainChain",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "765-765",
          "snippet": "int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCMerkleTx {\n  int GetDepthInMainChain() const { CBlockIndex *pindexRet; return GetDepthInMainChain(pindexRet); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "txGen.SetMerkleBranch",
          "args": [
            "&block"
          ],
          "line": 100
        },
        "resolved": true,
        "details": {
          "function_name": "SetMerkleBranch",
          "container": "CMerkleTx",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
          "lines": "421-470",
          "snippet": "int CMerkleTx::SetMerkleBranch(const CBlock* pblock)\n{\n    if (fClient)\n    {\n        if (hashBlock == 0)\n            return 0;\n    }\n    else\n    {\n        CBlock blockTmp;\n        if (pblock == NULL)\n        {\n            // Load the block this tx is in\n            CTxIndex txindex;\n            if (!CTxDB(\"r\").ReadTxIndex(GetHash(), txindex))\n                return 0;\n            if (!blockTmp.ReadFromDisk(txindex.pos.nFile, txindex.pos.nBlockPos))\n                return 0;\n            pblock = &blockTmp;\n        }\n\n        // Update the tx's hashBlock\n        hashBlock = pblock->GetHash();\n\n        // Locate the transaction\n        for (nIndex = 0; nIndex < (int)pblock->vtx.size(); nIndex++)\n            if (pblock->vtx[nIndex] == *(CTransaction*)this)\n                break;\n        if (nIndex == (int)pblock->vtx.size())\n        {\n            vMerkleBranch.clear();\n            nIndex = -1;\n            printf(\"ERROR: SetMerkleBranch() : couldn't find tx in block\\n\");\n            return 0;\n        }\n\n        // Fill in merkle branch\n        vMerkleBranch = pblock->GetMerkleBranch(nIndex);\n    }\n\n    // Is the tx in a block that's in the main chain\n    map<uint256, CBlockIndex*>::iterator mi = mapBlockIndex.find(hashBlock);\n    if (mi == mapBlockIndex.end())\n        return 0;\n    CBlockIndex* pindex = (*mi).second;\n    if (!pindex || !pindex->IsInMainChain())\n        return 0;\n\n    return pindexBest->nHeight - pindex->nHeight + 1;\n}",
          "includes": [
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"kernel.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"txdb.h\"",
            "#include \"db.h\"",
            "#include \"checkpoints.h\"",
            "#include \"alert.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "map<uint256, CBlockIndex*> mapBlockIndex;",
            "CBigNum bnProofOfWorkLimit(~uint256(0) >> 20);",
            "CBigNum bnProofOfStakeLimit(~uint256(0) >> 20);",
            "const CBigNum bnNeoScryptSwitch(~uint256(0) >> 30);",
            "CBigNum bnProofOfWorkLimitTestNet(~uint256(0) >> 16);",
            "CBigNum bnProofOfStakeLimitTestNet(~uint256(0) >> 16);",
            "CBlockIndex* pindexBest = NULL;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/algorithm/string/replace.hpp>\n#include \"kernel.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"txdb.h\"\n#include \"db.h\"\n#include \"checkpoints.h\"\n#include \"alert.h\"\n\nmap<uint256, CBlockIndex*> mapBlockIndex;\nCBigNum bnProofOfWorkLimit(~uint256(0) >> 20);\nCBigNum bnProofOfStakeLimit(~uint256(0) >> 20);\nconst CBigNum bnNeoScryptSwitch(~uint256(0) >> 30);\nCBigNum bnProofOfWorkLimitTestNet(~uint256(0) >> 16);\nCBigNum bnProofOfStakeLimitTestNet(~uint256(0) >> 16);\nCBlockIndex* pindexBest = NULL;\n\nCMerkleTx {\n  int CMerkleTx::SetMerkleBranch(const CBlock* pblock)\n  {\n      if (fClient)\n      {\n          if (hashBlock == 0)\n              return 0;\n      }\n      else\n      {\n          CBlock blockTmp;\n          if (pblock == NULL)\n          {\n              // Load the block this tx is in\n              CTxIndex txindex;\n              if (!CTxDB(\"r\").ReadTxIndex(GetHash(), txindex))\n                  return 0;\n              if (!blockTmp.ReadFromDisk(txindex.pos.nFile, txindex.pos.nBlockPos))\n                  return 0;\n              pblock = &blockTmp;\n          }\n  \n          // Update the tx's hashBlock\n          hashBlock = pblock->GetHash();\n  \n          // Locate the transaction\n          for (nIndex = 0; nIndex < (int)pblock->vtx.size(); nIndex++)\n              if (pblock->vtx[nIndex] == *(CTransaction*)this)\n                  break;\n          if (nIndex == (int)pblock->vtx.size())\n          {\n              vMerkleBranch.clear();\n              nIndex = -1;\n              printf(\"ERROR: SetMerkleBranch() : couldn't find tx in block\\n\");\n              return 0;\n          }\n  \n          // Fill in merkle branch\n          vMerkleBranch = pblock->GetMerkleBranch(nIndex);\n      }\n  \n      // Is the tx in a block that's in the main chain\n      map<uint256, CBlockIndex*>::iterator mi = mapBlockIndex.find(hashBlock);\n      if (mi == mapBlockIndex.end())\n          return 0;\n      CBlockIndex* pindex = (*mi).second;\n      if (!pindex || !pindex->IsInMainChain())\n          return 0;\n  \n      return pindexBest->nHeight - pindex->nHeight + 1;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "result.push_back",
          "args": [
            "Pair(\"hash\", block.GetHash().GetHex())"
          ],
          "line": 98
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\nextern void TxToJSON(const CTransaction& tx, const uint256 hashBlock, json_spirit::Object& entry);\n\nObject blockToJSON(const CBlock& block, const CBlockIndex* blockindex, bool fPrintTransactionDetail)\n{\n    Object result;\n    result.push_back(Pair(\"hash\", block.GetHash().GetHex()));\n    CMerkleTx txGen(block.vtx[0]);\n    txGen.SetMerkleBranch(&block);\n    result.push_back(Pair(\"confirmations\", (int)txGen.GetDepthInMainChain()));\n    result.push_back(Pair(\"size\", (int)::GetSerializeSize(block, SER_NETWORK, PROTOCOL_VERSION)));\n    result.push_back(Pair(\"height\", blockindex->nHeight));\n    result.push_back(Pair(\"version\", block.nVersion));\n    result.push_back(Pair(\"merkleroot\", block.hashMerkleRoot.GetHex()));\n    result.push_back(Pair(\"mint\", ValueFromAmount(blockindex->nMint)));\n    result.push_back(Pair(\"time\", (boost::int64_t)block.GetBlockTime()));\n    result.push_back(Pair(\"nonce\", (boost::uint64_t)block.nNonce));\n    result.push_back(Pair(\"bits\", HexBits(block.nBits)));\n    result.push_back(Pair(\"difficulty\", GetDifficulty(blockindex)));\n    result.push_back(Pair(\"blocktrust\", leftTrim(blockindex->GetBlockTrust().GetHex(), '0')));\n    result.push_back(Pair(\"chaintrust\", leftTrim(blockindex->nChainTrust.GetHex(), '0')));\n    if (blockindex->pprev)\n        result.push_back(Pair(\"previousblockhash\", blockindex->pprev->GetBlockHash().GetHex()));\n    if (blockindex->pnext)\n        result.push_back(Pair(\"nextblockhash\", blockindex->pnext->GetBlockHash().GetHex()));\n\n    result.push_back(Pair(\"flags\", strprintf(\"%s%s\", blockindex->IsProofOfStake()? \"proof-of-stake\" : \"proof-of-work\", blockindex->GeneratedStakeModifier()? \" stake-modifier\": \"\")));\n    result.push_back(Pair(\"proofhash\", blockindex->IsProofOfStake()? blockindex->hashProofOfStake.GetHex() : blockindex->GetBlockHash().GetHex()));\n    result.push_back(Pair(\"entropybit\", (int)blockindex->GetStakeEntropyBit()));\n    result.push_back(Pair(\"modifier\", strprintf(\"%016\"PRIx64, blockindex->nStakeModifier)));\n    result.push_back(Pair(\"modifierchecksum\", strprintf(\"%08x\", blockindex->nStakeModifierChecksum)));\n    Array txinfo;\n    BOOST_FOREACH (const CTransaction& tx, block.vtx)\n    {\n        if (fPrintTransactionDetail)\n        {\n            Object entry;\n\n            entry.push_back(Pair(\"txid\", tx.GetHash().GetHex()));\n            TxToJSON(tx, 0, entry);\n\n            txinfo.push_back(entry);\n        }\n        else\n            txinfo.push_back(tx.GetHash().GetHex());\n    }\n\n    result.push_back(Pair(\"tx\", txinfo));\n\n    if (block.IsProofOfStake())\n        result.push_back(Pair(\"signature\", HexStr(block.vchBlockSig.begin(), block.vchBlockSig.end())));\n\n    return result;\n}"
  },
  {
    "function_name": "GetPoSKernelPS",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
    "lines": "70-93",
    "snippet": "double GetPoSKernelPS()\n{\n    int nPoSInterval = 72;\n    double dStakeKernelsTriedAvg = 0;\n    int nStakesHandled = 0, nStakesTime = 0;\n\n    CBlockIndex* pindex = pindexBest;;\n    CBlockIndex* pindexPrevStake = NULL;\n\n    while (pindex && nStakesHandled < nPoSInterval)\n    {\n        if (pindex->IsProofOfStake())\n        {\n            dStakeKernelsTriedAvg += GetDifficulty(pindex) * 4294967296.0;\n            nStakesTime += pindexPrevStake ? (pindexPrevStake->nTime - pindex->nTime) : 0;\n            pindexPrevStake = pindex;\n            nStakesHandled++;\n        }\n\n        pindex = pindex->pprev;\n    }\n\n    return nStakesTime ? dStakeKernelsTriedAvg / nStakesTime : 0;\n}",
    "includes": [
      "#include \"bitcoinrpc.h\"",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "GetDifficulty",
          "args": [
            "pindex"
          ],
          "line": 83
        },
        "resolved": true,
        "details": {
          "function_name": "GetDifficulty",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
          "lines": "15-44",
          "snippet": "double GetDifficulty(const CBlockIndex* blockindex)\n{\n    // Floating point number that is a multiple of the minimum difficulty,\n    // minimum difficulty = 1.0.\n    if (blockindex == NULL)\n    {\n        if (pindexBest == NULL)\n            return 1.0;\n        else\n            blockindex = GetLastBlockIndex(pindexBest, false);\n    }\n\n    int nShift = (blockindex->nBits >> 24) & 0xff;\n\n    double dDiff =\n        (double)0x0000ffff / (double)(blockindex->nBits & 0x00ffffff);\n\n    while (nShift < 29)\n    {\n        dDiff *= 256.0;\n        nShift++;\n    }\n    while (nShift > 29)\n    {\n        dDiff /= 256.0;\n        nShift--;\n    }\n\n    return dDiff;\n}",
          "includes": [
            "#include \"bitcoinrpc.h\"",
            "#include \"main.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\ndouble GetDifficulty(const CBlockIndex* blockindex)\n{\n    // Floating point number that is a multiple of the minimum difficulty,\n    // minimum difficulty = 1.0.\n    if (blockindex == NULL)\n    {\n        if (pindexBest == NULL)\n            return 1.0;\n        else\n            blockindex = GetLastBlockIndex(pindexBest, false);\n    }\n\n    int nShift = (blockindex->nBits >> 24) & 0xff;\n\n    double dDiff =\n        (double)0x0000ffff / (double)(blockindex->nBits & 0x00ffffff);\n\n    while (nShift < 29)\n    {\n        dDiff *= 256.0;\n        nShift++;\n    }\n    while (nShift > 29)\n    {\n        dDiff /= 256.0;\n        nShift--;\n    }\n\n    return dDiff;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pindex->IsProofOfStake",
          "args": [],
          "line": 81
        },
        "resolved": true,
        "details": {
          "function_name": "IsProofOfStake",
          "container": "CBlockIndex",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "1384-1387",
          "snippet": "bool IsProofOfStake() const\n    {\n        return (nFlags & BLOCK_PROOF_OF_STAKE);\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCBlockIndex {\n  bool IsProofOfStake() const\n      {\n          return (nFlags & BLOCK_PROOF_OF_STAKE);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\ndouble GetPoSKernelPS()\n{\n    int nPoSInterval = 72;\n    double dStakeKernelsTriedAvg = 0;\n    int nStakesHandled = 0, nStakesTime = 0;\n\n    CBlockIndex* pindex = pindexBest;;\n    CBlockIndex* pindexPrevStake = NULL;\n\n    while (pindex && nStakesHandled < nPoSInterval)\n    {\n        if (pindex->IsProofOfStake())\n        {\n            dStakeKernelsTriedAvg += GetDifficulty(pindex) * 4294967296.0;\n            nStakesTime += pindexPrevStake ? (pindexPrevStake->nTime - pindex->nTime) : 0;\n            pindexPrevStake = pindex;\n            nStakesHandled++;\n        }\n\n        pindex = pindex->pprev;\n    }\n\n    return nStakesTime ? dStakeKernelsTriedAvg / nStakesTime : 0;\n}"
  },
  {
    "function_name": "GetPoWMHashPS",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
    "lines": "46-68",
    "snippet": "double GetPoWMHashPS() {\n\n    int nPoWInterval = 72;\n    int64_t nTargetSpacingWorkMin = 30, nTargetSpacingWork = 30;\n\n    CBlockIndex* pindex = pindexGenesisBlock;\n    CBlockIndex* pindexPrevWork = pindexGenesisBlock;\n\n    while (pindex)\n    {\n        if (pindex->IsProofOfWork())\n        {\n            int64_t nActualSpacingWork = pindex->GetBlockTime() - pindexPrevWork->GetBlockTime();\n            nTargetSpacingWork = ((nPoWInterval - 1) * nTargetSpacingWork + nActualSpacingWork + nActualSpacingWork) / (nPoWInterval + 1);\n            nTargetSpacingWork = max(nTargetSpacingWork, nTargetSpacingWorkMin);\n            pindexPrevWork = pindex;\n        }\n\n        pindex = pindex->pnext;\n    }\n\n    return GetDifficulty() * 4294.967296 / nTargetSpacingWork;\n}",
    "includes": [
      "#include \"bitcoinrpc.h\"",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "GetDifficulty",
          "args": [],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "max",
          "args": [
            "nTargetSpacingWork",
            "nTargetSpacingWorkMin"
          ],
          "line": 60
        },
        "resolved": true,
        "details": {
          "function_name": "leveldb_options_set_max_open_files",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/db/c.cc",
          "lines": "433-435",
          "snippet": "void leveldb_options_set_max_open_files(leveldb_options_t* opt, int n) {\n  opt->rep.max_open_files = n;\n}",
          "includes": [
            "#include \"leveldb/write_batch.h\"",
            "#include \"leveldb/status.h\"",
            "#include \"leveldb/options.h\"",
            "#include \"leveldb/iterator.h\"",
            "#include \"leveldb/filter_policy.h\"",
            "#include \"leveldb/env.h\"",
            "#include \"leveldb/db.h\"",
            "#include \"leveldb/comparator.h\"",
            "#include \"leveldb/cache.h\"",
            "#include <unistd.h>",
            "#include <stdlib.h>",
            "#include \"leveldb/c.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"leveldb/write_batch.h\"\n#include \"leveldb/status.h\"\n#include \"leveldb/options.h\"\n#include \"leveldb/iterator.h\"\n#include \"leveldb/filter_policy.h\"\n#include \"leveldb/env.h\"\n#include \"leveldb/db.h\"\n#include \"leveldb/comparator.h\"\n#include \"leveldb/cache.h\"\n#include <unistd.h>\n#include <stdlib.h>\n#include \"leveldb/c.h\"\n\nvoid leveldb_options_set_max_open_files(leveldb_options_t* opt, int n) {\n  opt->rep.max_open_files = n;\n}"
        }
      },
      {
        "call_info": {
          "callee": "pindexPrevWork->GetBlockTime",
          "args": [],
          "line": 58
        },
        "resolved": true,
        "details": {
          "function_name": "GetBlockTime",
          "container": "CBlockIndex",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "1284-1287",
          "snippet": "int64_t GetBlockTime() const\n    {\n        return (int64_t)nTime;\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCBlockIndex {\n  int64_t GetBlockTime() const\n      {\n          return (int64_t)nTime;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "pindex->IsProofOfWork",
          "args": [],
          "line": 56
        },
        "resolved": true,
        "details": {
          "function_name": "IsProofOfWork",
          "container": "CBlockIndex",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.h",
          "lines": "1379-1382",
          "snippet": "bool IsProofOfWork() const\n    {\n        return !(nFlags & BLOCK_PROOF_OF_STAKE);\n    }",
          "includes": [
            "#include <list>",
            "#include \"x15hash.h\"",
            "#include \"neoscrypt.h\"",
            "#include \"script.h\"",
            "#include \"net.h\"",
            "#include \"sync.h\"",
            "#include \"bignum.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include \"x15hash.h\"\n#include \"neoscrypt.h\"\n#include \"script.h\"\n#include \"net.h\"\n#include \"sync.h\"\n#include \"bignum.h\"\n\nCBlockIndex {\n  bool IsProofOfWork() const\n      {\n          return !(nFlags & BLOCK_PROOF_OF_STAKE);\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\ndouble GetPoWMHashPS() {\n\n    int nPoWInterval = 72;\n    int64_t nTargetSpacingWorkMin = 30, nTargetSpacingWork = 30;\n\n    CBlockIndex* pindex = pindexGenesisBlock;\n    CBlockIndex* pindexPrevWork = pindexGenesisBlock;\n\n    while (pindex)\n    {\n        if (pindex->IsProofOfWork())\n        {\n            int64_t nActualSpacingWork = pindex->GetBlockTime() - pindexPrevWork->GetBlockTime();\n            nTargetSpacingWork = ((nPoWInterval - 1) * nTargetSpacingWork + nActualSpacingWork + nActualSpacingWork) / (nPoWInterval + 1);\n            nTargetSpacingWork = max(nTargetSpacingWork, nTargetSpacingWorkMin);\n            pindexPrevWork = pindex;\n        }\n\n        pindex = pindex->pnext;\n    }\n\n    return GetDifficulty() * 4294.967296 / nTargetSpacingWork;\n}"
  },
  {
    "function_name": "GetDifficulty",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/rpcblockchain.cpp",
    "lines": "15-44",
    "snippet": "double GetDifficulty(const CBlockIndex* blockindex)\n{\n    // Floating point number that is a multiple of the minimum difficulty,\n    // minimum difficulty = 1.0.\n    if (blockindex == NULL)\n    {\n        if (pindexBest == NULL)\n            return 1.0;\n        else\n            blockindex = GetLastBlockIndex(pindexBest, false);\n    }\n\n    int nShift = (blockindex->nBits >> 24) & 0xff;\n\n    double dDiff =\n        (double)0x0000ffff / (double)(blockindex->nBits & 0x00ffffff);\n\n    while (nShift < 29)\n    {\n        dDiff *= 256.0;\n        nShift++;\n    }\n    while (nShift > 29)\n    {\n        dDiff /= 256.0;\n        nShift--;\n    }\n\n    return dDiff;\n}",
    "includes": [
      "#include \"bitcoinrpc.h\"",
      "#include \"main.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "GetLastBlockIndex",
          "args": [
            "pindexBest",
            "false"
          ],
          "line": 24
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"bitcoinrpc.h\"\n#include \"main.h\"\n\ndouble GetDifficulty(const CBlockIndex* blockindex)\n{\n    // Floating point number that is a multiple of the minimum difficulty,\n    // minimum difficulty = 1.0.\n    if (blockindex == NULL)\n    {\n        if (pindexBest == NULL)\n            return 1.0;\n        else\n            blockindex = GetLastBlockIndex(pindexBest, false);\n    }\n\n    int nShift = (blockindex->nBits >> 24) & 0xff;\n\n    double dDiff =\n        (double)0x0000ffff / (double)(blockindex->nBits & 0x00ffffff);\n\n    while (nShift < 29)\n    {\n        dDiff *= 256.0;\n        nShift++;\n    }\n    while (nShift > 29)\n    {\n        dDiff /= 256.0;\n        nShift--;\n    }\n\n    return dDiff;\n}"
  }
]