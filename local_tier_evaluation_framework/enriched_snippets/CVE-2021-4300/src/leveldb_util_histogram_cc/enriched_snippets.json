[
  {
    "function_name": "ToString",
    "container": "Histogram",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/histogram.cc",
    "lines": "105-137",
    "snippet": "std::string Histogram::ToString() const {\n  std::string r;\n  char buf[200];\n  snprintf(buf, sizeof(buf),\n           \"Count: %.0f  Average: %.4f  StdDev: %.2f\\n\",\n           num_, Average(), StandardDeviation());\n  r.append(buf);\n  snprintf(buf, sizeof(buf),\n           \"Min: %.4f  Median: %.4f  Max: %.4f\\n\",\n           (num_ == 0.0 ? 0.0 : min_), Median(), max_);\n  r.append(buf);\n  r.append(\"------------------------------------------------------\\n\");\n  const double mult = 100.0 / num_;\n  double sum = 0;\n  for (int b = 0; b < kNumBuckets; b++) {\n    if (buckets_[b] <= 0.0) continue;\n    sum += buckets_[b];\n    snprintf(buf, sizeof(buf),\n             \"[ %7.0f, %7.0f ) %7.0f %7.3f%% %7.3f%% \",\n             ((b == 0) ? 0.0 : kBucketLimit[b-1]),      // left\n             kBucketLimit[b],                           // right\n             buckets_[b],                               // count\n             mult * buckets_[b],                        // percentage\n             mult * sum);                               // cumulative percentage\n    r.append(buf);\n\n    // Add hash marks based on percentage; 20 marks for 100%.\n    int marks = static_cast<int>(20*(buckets_[b] / num_) + 0.5);\n    r.append(marks, '#');\n    r.push_back('\\n');\n  }\n  return r;\n}",
    "includes": [
      "#include \"util/histogram.h\"",
      "#include \"port/port.h\"",
      "#include <stdio.h>",
      "#include <math.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "r.push_back",
          "args": [
            "'\\n'"
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r.append",
          "args": [
            "marks",
            "'#'"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "static_cast<int>",
          "args": [
            "20*(buckets_[b] / num_) + 0.5"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r.append",
          "args": [
            "buf"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "buf",
            "sizeof(buf)",
            "\"[ %7.0f, %7.0f ) %7.0f %7.3f%% %7.3f%% \"",
            "((b == 0) ? 0.0 : kBucketLimit[b-1])",
            "// leftkBucketLimit[b]",
            "// rightbuckets_[b]",
            "// countmult * buckets_[b]",
            "// percentagemult * sum"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r.append",
          "args": [
            "\"------------------------------------------------------\\n\""
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "r.append",
          "args": [
            "buf"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "buf",
            "sizeof(buf)",
            "\"Min: %.4f  Median: %.4f  Max: %.4f\\n\"",
            "(num_ == 0.0 ? 0.0 : min_)",
            "Median()",
            "max_"
          ],
          "line": 112
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Median",
          "args": [],
          "line": 114
        },
        "resolved": true,
        "details": {
          "function_name": "Median",
          "container": "Histogram",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/histogram.cc",
          "lines": "69-71",
          "snippet": "double Histogram::Median() const {\n  return Percentile(50.0);\n}",
          "includes": [
            "#include \"util/histogram.h\"",
            "#include \"port/port.h\"",
            "#include <stdio.h>",
            "#include <math.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/histogram.h\"\n#include \"port/port.h\"\n#include <stdio.h>\n#include <math.h>\n\nHistogram {\n  double Histogram::Median() const {\n    return Percentile(50.0);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "r.append",
          "args": [
            "buf"
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "snprintf",
          "args": [
            "buf",
            "sizeof(buf)",
            "\"Count: %.0f  Average: %.4f  StdDev: %.2f\\n\"",
            "num_",
            "Average()",
            "StandardDeviation()"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "StandardDeviation",
          "args": [],
          "line": 110
        },
        "resolved": true,
        "details": {
          "function_name": "StandardDeviation",
          "container": "Histogram",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/histogram.cc",
          "lines": "99-103",
          "snippet": "double Histogram::StandardDeviation() const {\n  if (num_ == 0.0) return 0;\n  double variance = (sum_squares_ * num_ - sum_ * sum_) / (num_ * num_);\n  return sqrt(variance);\n}",
          "includes": [
            "#include \"util/histogram.h\"",
            "#include \"port/port.h\"",
            "#include <stdio.h>",
            "#include <math.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/histogram.h\"\n#include \"port/port.h\"\n#include <stdio.h>\n#include <math.h>\n\nHistogram {\n  double Histogram::StandardDeviation() const {\n    if (num_ == 0.0) return 0;\n    double variance = (sum_squares_ * num_ - sum_ * sum_) / (num_ * num_);\n    return sqrt(variance);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "Average",
          "args": [],
          "line": 110
        },
        "resolved": true,
        "details": {
          "function_name": "Average",
          "container": "Histogram",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/histogram.cc",
          "lines": "94-97",
          "snippet": "double Histogram::Average() const {\n  if (num_ == 0.0) return 0;\n  return sum_ / num_;\n}",
          "includes": [
            "#include \"util/histogram.h\"",
            "#include \"port/port.h\"",
            "#include <stdio.h>",
            "#include <math.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/histogram.h\"\n#include \"port/port.h\"\n#include <stdio.h>\n#include <math.h>\n\nHistogram {\n  double Histogram::Average() const {\n    if (num_ == 0.0) return 0;\n    return sum_ / num_;\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"util/histogram.h\"\n#include \"port/port.h\"\n#include <stdio.h>\n#include <math.h>\n\nHistogram {\n  std::string Histogram::ToString() const {\n    std::string r;\n    char buf[200];\n    snprintf(buf, sizeof(buf),\n             \"Count: %.0f  Average: %.4f  StdDev: %.2f\\n\",\n             num_, Average(), StandardDeviation());\n    r.append(buf);\n    snprintf(buf, sizeof(buf),\n             \"Min: %.4f  Median: %.4f  Max: %.4f\\n\",\n             (num_ == 0.0 ? 0.0 : min_), Median(), max_);\n    r.append(buf);\n    r.append(\"------------------------------------------------------\\n\");\n    const double mult = 100.0 / num_;\n    double sum = 0;\n    for (int b = 0; b < kNumBuckets; b++) {\n      if (buckets_[b] <= 0.0) continue;\n      sum += buckets_[b];\n      snprintf(buf, sizeof(buf),\n               \"[ %7.0f, %7.0f ) %7.0f %7.3f%% %7.3f%% \",\n               ((b == 0) ? 0.0 : kBucketLimit[b-1]),      // left\n               kBucketLimit[b],                           // right\n               buckets_[b],                               // count\n               mult * buckets_[b],                        // percentage\n               mult * sum);                               // cumulative percentage\n      r.append(buf);\n  \n      // Add hash marks based on percentage; 20 marks for 100%.\n      int marks = static_cast<int>(20*(buckets_[b] / num_) + 0.5);\n      r.append(marks, '#');\n      r.push_back('\\n');\n    }\n    return r;\n  }\n}"
  },
  {
    "function_name": "StandardDeviation",
    "container": "Histogram",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/histogram.cc",
    "lines": "99-103",
    "snippet": "double Histogram::StandardDeviation() const {\n  if (num_ == 0.0) return 0;\n  double variance = (sum_squares_ * num_ - sum_ * sum_) / (num_ * num_);\n  return sqrt(variance);\n}",
    "includes": [
      "#include \"util/histogram.h\"",
      "#include \"port/port.h\"",
      "#include <stdio.h>",
      "#include <math.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "sqrt",
          "args": [
            "variance"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"util/histogram.h\"\n#include \"port/port.h\"\n#include <stdio.h>\n#include <math.h>\n\nHistogram {\n  double Histogram::StandardDeviation() const {\n    if (num_ == 0.0) return 0;\n    double variance = (sum_squares_ * num_ - sum_ * sum_) / (num_ * num_);\n    return sqrt(variance);\n  }\n}"
  },
  {
    "function_name": "Average",
    "container": "Histogram",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/histogram.cc",
    "lines": "94-97",
    "snippet": "double Histogram::Average() const {\n  if (num_ == 0.0) return 0;\n  return sum_ / num_;\n}",
    "includes": [
      "#include \"util/histogram.h\"",
      "#include \"port/port.h\"",
      "#include <stdio.h>",
      "#include <math.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"util/histogram.h\"\n#include \"port/port.h\"\n#include <stdio.h>\n#include <math.h>\n\nHistogram {\n  double Histogram::Average() const {\n    if (num_ == 0.0) return 0;\n    return sum_ / num_;\n  }\n}"
  },
  {
    "function_name": "Percentile",
    "container": "Histogram",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/histogram.cc",
    "lines": "73-92",
    "snippet": "double Histogram::Percentile(double p) const {\n  double threshold = num_ * (p / 100.0);\n  double sum = 0;\n  for (int b = 0; b < kNumBuckets; b++) {\n    sum += buckets_[b];\n    if (sum >= threshold) {\n      // Scale linearly within this bucket\n      double left_point = (b == 0) ? 0 : kBucketLimit[b-1];\n      double right_point = kBucketLimit[b];\n      double left_sum = sum - buckets_[b];\n      double right_sum = sum;\n      double pos = (threshold - left_sum) / (right_sum - left_sum);\n      double r = left_point + (right_point - left_point) * pos;\n      if (r < min_) r = min_;\n      if (r > max_) r = max_;\n      return r;\n    }\n  }\n  return max_;\n}",
    "includes": [
      "#include \"util/histogram.h\"",
      "#include \"port/port.h\"",
      "#include <stdio.h>",
      "#include <math.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"util/histogram.h\"\n#include \"port/port.h\"\n#include <stdio.h>\n#include <math.h>\n\nHistogram {\n  double Histogram::Percentile(double p) const {\n    double threshold = num_ * (p / 100.0);\n    double sum = 0;\n    for (int b = 0; b < kNumBuckets; b++) {\n      sum += buckets_[b];\n      if (sum >= threshold) {\n        // Scale linearly within this bucket\n        double left_point = (b == 0) ? 0 : kBucketLimit[b-1];\n        double right_point = kBucketLimit[b];\n        double left_sum = sum - buckets_[b];\n        double right_sum = sum;\n        double pos = (threshold - left_sum) / (right_sum - left_sum);\n        double r = left_point + (right_point - left_point) * pos;\n        if (r < min_) r = min_;\n        if (r > max_) r = max_;\n        return r;\n      }\n    }\n    return max_;\n  }\n}"
  },
  {
    "function_name": "Median",
    "container": "Histogram",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/histogram.cc",
    "lines": "69-71",
    "snippet": "double Histogram::Median() const {\n  return Percentile(50.0);\n}",
    "includes": [
      "#include \"util/histogram.h\"",
      "#include \"port/port.h\"",
      "#include <stdio.h>",
      "#include <math.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "Percentile",
          "args": [
            "50.0"
          ],
          "line": 70
        },
        "resolved": true,
        "details": {
          "function_name": "Percentile",
          "container": "Histogram",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/histogram.cc",
          "lines": "73-92",
          "snippet": "double Histogram::Percentile(double p) const {\n  double threshold = num_ * (p / 100.0);\n  double sum = 0;\n  for (int b = 0; b < kNumBuckets; b++) {\n    sum += buckets_[b];\n    if (sum >= threshold) {\n      // Scale linearly within this bucket\n      double left_point = (b == 0) ? 0 : kBucketLimit[b-1];\n      double right_point = kBucketLimit[b];\n      double left_sum = sum - buckets_[b];\n      double right_sum = sum;\n      double pos = (threshold - left_sum) / (right_sum - left_sum);\n      double r = left_point + (right_point - left_point) * pos;\n      if (r < min_) r = min_;\n      if (r > max_) r = max_;\n      return r;\n    }\n  }\n  return max_;\n}",
          "includes": [
            "#include \"util/histogram.h\"",
            "#include \"port/port.h\"",
            "#include <stdio.h>",
            "#include <math.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/histogram.h\"\n#include \"port/port.h\"\n#include <stdio.h>\n#include <math.h>\n\nHistogram {\n  double Histogram::Percentile(double p) const {\n    double threshold = num_ * (p / 100.0);\n    double sum = 0;\n    for (int b = 0; b < kNumBuckets; b++) {\n      sum += buckets_[b];\n      if (sum >= threshold) {\n        // Scale linearly within this bucket\n        double left_point = (b == 0) ? 0 : kBucketLimit[b-1];\n        double right_point = kBucketLimit[b];\n        double left_sum = sum - buckets_[b];\n        double right_sum = sum;\n        double pos = (threshold - left_sum) / (right_sum - left_sum);\n        double r = left_point + (right_point - left_point) * pos;\n        if (r < min_) r = min_;\n        if (r > max_) r = max_;\n        return r;\n      }\n    }\n    return max_;\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"util/histogram.h\"\n#include \"port/port.h\"\n#include <stdio.h>\n#include <math.h>\n\nHistogram {\n  double Histogram::Median() const {\n    return Percentile(50.0);\n  }\n}"
  },
  {
    "function_name": "Merge",
    "container": "Histogram",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/histogram.cc",
    "lines": "58-67",
    "snippet": "void Histogram::Merge(const Histogram& other) {\n  if (other.min_ < min_) min_ = other.min_;\n  if (other.max_ > max_) max_ = other.max_;\n  num_ += other.num_;\n  sum_ += other.sum_;\n  sum_squares_ += other.sum_squares_;\n  for (int b = 0; b < kNumBuckets; b++) {\n    buckets_[b] += other.buckets_[b];\n  }\n}",
    "includes": [
      "#include \"util/histogram.h\"",
      "#include \"port/port.h\"",
      "#include <stdio.h>",
      "#include <math.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"util/histogram.h\"\n#include \"port/port.h\"\n#include <stdio.h>\n#include <math.h>\n\nHistogram {\n  void Histogram::Merge(const Histogram& other) {\n    if (other.min_ < min_) min_ = other.min_;\n    if (other.max_ > max_) max_ = other.max_;\n    num_ += other.num_;\n    sum_ += other.sum_;\n    sum_squares_ += other.sum_squares_;\n    for (int b = 0; b < kNumBuckets; b++) {\n      buckets_[b] += other.buckets_[b];\n    }\n  }\n}"
  },
  {
    "function_name": "Add",
    "container": "Histogram",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/histogram.cc",
    "lines": "44-56",
    "snippet": "void Histogram::Add(double value) {\n  // Linear search is fast enough for our usage in db_bench\n  int b = 0;\n  while (b < kNumBuckets - 1 && kBucketLimit[b] <= value) {\n    b++;\n  }\n  buckets_[b] += 1.0;\n  if (min_ > value) min_ = value;\n  if (max_ < value) max_ = value;\n  num_++;\n  sum_ += value;\n  sum_squares_ += (value * value);\n}",
    "includes": [
      "#include \"util/histogram.h\"",
      "#include \"port/port.h\"",
      "#include <stdio.h>",
      "#include <math.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"util/histogram.h\"\n#include \"port/port.h\"\n#include <stdio.h>\n#include <math.h>\n\nHistogram {\n  void Histogram::Add(double value) {\n    // Linear search is fast enough for our usage in db_bench\n    int b = 0;\n    while (b < kNumBuckets - 1 && kBucketLimit[b] <= value) {\n      b++;\n    }\n    buckets_[b] += 1.0;\n    if (min_ > value) min_ = value;\n    if (max_ < value) max_ = value;\n    num_++;\n    sum_ += value;\n    sum_squares_ += (value * value);\n  }\n}"
  },
  {
    "function_name": "Clear",
    "container": "Histogram",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/histogram.cc",
    "lines": "33-42",
    "snippet": "void Histogram::Clear() {\n  min_ = kBucketLimit[kNumBuckets-1];\n  max_ = 0;\n  num_ = 0;\n  sum_ = 0;\n  sum_squares_ = 0;\n  for (int i = 0; i < kNumBuckets; i++) {\n    buckets_[i] = 0;\n  }\n}",
    "includes": [
      "#include \"util/histogram.h\"",
      "#include \"port/port.h\"",
      "#include <stdio.h>",
      "#include <math.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"util/histogram.h\"\n#include \"port/port.h\"\n#include <stdio.h>\n#include <math.h>\n\nHistogram {\n  void Histogram::Clear() {\n    min_ = kBucketLimit[kNumBuckets-1];\n    max_ = 0;\n    num_ = 0;\n    sum_ = 0;\n    sum_squares_ = 0;\n    for (int i = 0; i < kNumBuckets; i++) {\n      buckets_[i] = 0;\n    }\n  }\n}"
  }
]