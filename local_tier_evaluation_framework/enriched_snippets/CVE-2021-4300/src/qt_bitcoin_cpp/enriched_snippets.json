[
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/bitcoin.cpp",
    "lines": "114-270",
    "snippet": "int main(int argc, char *argv[])\n{\n    // Do this early as we don't want to bother initializing if we are just calling IPC\n    ipcScanRelay(argc, argv);\n\n#if QT_VERSION < 0x050000\n    // Internal string conversion is all UTF-8\n    QTextCodec::setCodecForTr(QTextCodec::codecForName(\"UTF-8\"));\n    QTextCodec::setCodecForCStrings(QTextCodec::codecForTr());\n#endif\n\n    Q_INIT_RESOURCE(bitcoin);\n    QApplication app(argc, argv);\n\n    // Install global event filter that makes sure that long tooltips can be word-wrapped\n    app.installEventFilter(new GUIUtil::ToolTipToRichTextFilter(TOOLTIP_WRAP_THRESHOLD, &app));\n\n    // Command-line options take precedence:\n    ParseParameters(argc, argv);\n\n    // ... then bitcoin.conf:\n    if (!boost::filesystem::is_directory(GetDataDir(false)))\n    {\n        // This message can not be translated, as translation is not initialized yet\n        // (which not yet possible because lang=XX can be overridden in bitcoin.conf in the data directory)\n        QMessageBox::critical(0, \"Halcyon\",\n                              QString(\"Error: Specified data directory \\\"%1\\\" does not exist.\").arg(QString::fromStdString(mapArgs[\"-datadir\"])));\n        return 1;\n    }\n    ReadConfigFile(mapArgs, mapMultiArgs);\n\n    // Application identification (must be set before OptionsModel is initialized,\n    // as it is used to locate QSettings)\n    app.setOrganizationName(\"Halcyon\");\n    //XXX app.setOrganizationDomain(\"\");\n    if(GetBoolArg(\"-testnet\")) // Separate UI settings for testnet\n        app.setApplicationName(\"Halcyon-Qt-testnet\");\n    else\n        app.setApplicationName(\"Halcyon-Qt\");\n\n    // ... then GUI settings:\n    OptionsModel optionsModel;\n\n    // Get desired locale (e.g. \"de_DE\") from command line or use system locale\n    QString lang_territory = QString::fromStdString(GetArg(\"-lang\", QLocale::system().name().toStdString()));\n    QString lang = lang_territory;\n    // Convert to \"de\" only by truncating \"_DE\"\n    lang.truncate(lang_territory.lastIndexOf('_'));\n\n    QTranslator qtTranslatorBase, qtTranslator, translatorBase, translator;\n    // Load language files for configured locale:\n    // - First load the translator for the base language, without territory\n    // - Then load the more specific locale translator\n\n    // Load e.g. qt_de.qm\n    if (qtTranslatorBase.load(\"qt_\" + lang, QLibraryInfo::location(QLibraryInfo::TranslationsPath)))\n        app.installTranslator(&qtTranslatorBase);\n\n    // Load e.g. qt_de_DE.qm\n    if (qtTranslator.load(\"qt_\" + lang_territory, QLibraryInfo::location(QLibraryInfo::TranslationsPath)))\n        app.installTranslator(&qtTranslator);\n\n    // Load e.g. bitcoin_de.qm (shortcut \"de\" needs to be defined in bitcoin.qrc)\n    if (translatorBase.load(lang, \":/translations/\"))\n        app.installTranslator(&translatorBase);\n\n    // Load e.g. bitcoin_de_DE.qm (shortcut \"de_DE\" needs to be defined in bitcoin.qrc)\n    if (translator.load(lang_territory, \":/translations/\"))\n        app.installTranslator(&translator);\n\n    // Subscribe to global signals from core\n    uiInterface.ThreadSafeMessageBox.connect(ThreadSafeMessageBox);\n    uiInterface.ThreadSafeAskFee.connect(ThreadSafeAskFee);\n    uiInterface.ThreadSafeHandleURI.connect(ThreadSafeHandleURI);\n    uiInterface.InitMessage.connect(InitMessage);\n    uiInterface.QueueShutdown.connect(QueueShutdown);\n    uiInterface.Translate.connect(Translate);\n\n    // Show help message immediately after parsing command-line options (for \"-lang\") and setting locale,\n    // but before showing splash screen.\n    if (mapArgs.count(\"-?\") || mapArgs.count(\"--help\"))\n    {\n        GUIUtil::HelpMessageBox help;\n        help.showOrPrint();\n        return 1;\n    }\n\n    QSplashScreen splash(QPixmap(\":/images/splash\"), 0);\n    if (GetBoolArg(\"-splash\", true) && !GetBoolArg(\"-min\"))\n    {\n        splash.show();\n        splashref = &splash;\n    }\n\n    app.processEvents();\n\n    app.setQuitOnLastWindowClosed(false);\n\n    try\n    {\n        // Regenerate startup link, to fix links to old versions\n        if (GUIUtil::GetStartOnSystemStartup())\n            GUIUtil::SetStartOnSystemStartup(true);\n\n        BitcoinGUI window;\n        guiref = &window;\n        if(AppInit2())\n        {\n            {\n                // Put this in a block, so that the Model objects are cleaned up before\n                // calling Shutdown().\n\n                optionsModel.Upgrade(); // Must be done after AppInit2\n\n                if (splashref)\n                    splash.finish(&window);\n\n                ClientModel clientModel(&optionsModel);\n                WalletModel walletModel(pwalletMain, &optionsModel);\n\n                window.setClientModel(&clientModel);\n                window.setWalletModel(&walletModel);\n\n                // If -min option passed, start window minimized.\n                if(GetBoolArg(\"-min\"))\n                {\n                    window.showMinimized();\n                }\n                else\n                {\n                    window.show();\n                }\n\n                // Place this here as guiref has to be defined if we don't want to lose URIs\n                ipcInit(argc, argv);\n\n                app.exec();\n\n                window.hide();\n                window.setClientModel(0);\n                window.setWalletModel(0);\n                guiref = 0;\n            }\n            // Shutdown the core and its threads, but don't exit Bitcoin-Qt here\n            Shutdown(NULL);\n        }\n        else\n        {\n            return 1;\n        }\n    } catch (std::exception& e) {\n        handleRunawayException(&e);\n    } catch (...) {\n        handleRunawayException(NULL);\n    }\n    return 0;\n}",
    "includes": [
      "#include <QtPlugin>",
      "#include <QLibraryInfo>",
      "#include <QSplashScreen>",
      "#include <QTranslator>",
      "#include <QLocale>",
      "#include <QTextCodec>",
      "#include <QMessageBox>",
      "#include <QApplication>",
      "#include \"qtipcserver.h\"",
      "#include \"ui_interface.h\"",
      "#include \"init.h\"",
      "#include \"guiconstants.h\"",
      "#include \"guiutil.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"walletmodel.h\"",
      "#include \"clientmodel.h\"",
      "#include \"bitcoingui.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static BitcoinGUI *guiref;",
      "static QSplashScreen *splashref;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "handleRunawayException",
          "args": [
            "NULL"
          ],
          "line": 267
        },
        "resolved": true,
        "details": {
          "function_name": "handleRunawayException",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/bitcoin.cpp",
          "lines": "106-111",
          "snippet": "static void handleRunawayException(std::exception *e)\n{\n    PrintExceptionContinue(e, \"Runaway exception\");\n    QMessageBox::critical(0, \"Runaway exception\", BitcoinGUI::tr(\"A fatal error occurred. Halcyon can no longer continue safely and will quit.\") + QString(\"\\n\\n\") + QString::fromStdString(strMiscWarning));\n    exit(1);\n}",
          "includes": [
            "#include <QtPlugin>",
            "#include <QLibraryInfo>",
            "#include <QSplashScreen>",
            "#include <QTranslator>",
            "#include <QLocale>",
            "#include <QTextCodec>",
            "#include <QMessageBox>",
            "#include <QApplication>",
            "#include \"qtipcserver.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"guiconstants.h\"",
            "#include \"guiutil.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"walletmodel.h\"",
            "#include \"clientmodel.h\"",
            "#include \"bitcoingui.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QtPlugin>\n#include <QLibraryInfo>\n#include <QSplashScreen>\n#include <QTranslator>\n#include <QLocale>\n#include <QTextCodec>\n#include <QMessageBox>\n#include <QApplication>\n#include \"qtipcserver.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"guiconstants.h\"\n#include \"guiutil.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"clientmodel.h\"\n#include \"bitcoingui.h\"\n\nstatic void handleRunawayException(std::exception *e)\n{\n    PrintExceptionContinue(e, \"Runaway exception\");\n    QMessageBox::critical(0, \"Runaway exception\", BitcoinGUI::tr(\"A fatal error occurred. Halcyon can no longer continue safely and will quit.\") + QString(\"\\n\\n\") + QString::fromStdString(strMiscWarning));\n    exit(1);\n}"
        }
      },
      {
        "call_info": {
          "callee": "Shutdown",
          "args": [
            "NULL"
          ],
          "line": 258
        },
        "resolved": true,
        "details": {
          "function_name": "Shutdown",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/init.cpp",
          "lines": "63-108",
          "snippet": "void Shutdown(void* parg)\n{\n    static CCriticalSection cs_Shutdown;\n    static bool fTaken;\n\n    // Make this thread recognisable as the shutdown thread\n    RenameThread(\"hal-shutdown\");\n\n    bool fFirstThread = false;\n    {\n        TRY_LOCK(cs_Shutdown, lockShutdown);\n        if (lockShutdown)\n        {\n            fFirstThread = !fTaken;\n            fTaken = true;\n        }\n    }\n    static bool fExit;\n    if (fFirstThread)\n    {\n        printf(\"Shutdown() : in progress...\\n\");\n        fShutdown = true;\n        nTransactionsUpdated++;\n        bitdb.Flush(false);\n        StopNode();\n        bitdb.Flush(true);\n        boost::filesystem::remove(GetPidFile());\n        UnregisterWallet(pwalletMain);\n        delete pwalletMain;\n        NewThread(ExitTimeout, NULL);\n        fExit = true;\n        MilliSleep(1000);\n        printf(\"Shutdown() : completed\\n\\n\");\n#ifndef QT_GUI\n        // ensure non-UI client gets exited here, but let Bitcoin-Qt reach 'return 0;' in bitcoin.cpp\n        exit(0);\n#endif\n    }\n    else\n    {\n        while (!fExit)\n            MilliSleep(500);\n        MilliSleep(100);\n        ExitThread(0);\n    }\n}",
          "includes": [
            "#include <signal.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/algorithm/string/predicate.hpp>",
            "#include <boost/interprocess/sync/file_lock.hpp>",
            "#include <boost/filesystem/convenience.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include \"checkpoints.h\"",
            "#include \"ui_interface.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"txdb.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "CWallet* pwalletMain;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <signal.h>\n#include <openssl/crypto.h>\n#include <boost/algorithm/string/predicate.hpp>\n#include <boost/interprocess/sync/file_lock.hpp>\n#include <boost/filesystem/convenience.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"checkpoints.h\"\n#include \"ui_interface.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"txdb.h\"\n\nCWallet* pwalletMain;\n\nvoid Shutdown(void* parg)\n{\n    static CCriticalSection cs_Shutdown;\n    static bool fTaken;\n\n    // Make this thread recognisable as the shutdown thread\n    RenameThread(\"hal-shutdown\");\n\n    bool fFirstThread = false;\n    {\n        TRY_LOCK(cs_Shutdown, lockShutdown);\n        if (lockShutdown)\n        {\n            fFirstThread = !fTaken;\n            fTaken = true;\n        }\n    }\n    static bool fExit;\n    if (fFirstThread)\n    {\n        printf(\"Shutdown() : in progress...\\n\");\n        fShutdown = true;\n        nTransactionsUpdated++;\n        bitdb.Flush(false);\n        StopNode();\n        bitdb.Flush(true);\n        boost::filesystem::remove(GetPidFile());\n        UnregisterWallet(pwalletMain);\n        delete pwalletMain;\n        NewThread(ExitTimeout, NULL);\n        fExit = true;\n        MilliSleep(1000);\n        printf(\"Shutdown() : completed\\n\\n\");\n#ifndef QT_GUI\n        // ensure non-UI client gets exited here, but let Bitcoin-Qt reach 'return 0;' in bitcoin.cpp\n        exit(0);\n#endif\n    }\n    else\n    {\n        while (!fExit)\n            MilliSleep(500);\n        MilliSleep(100);\n        ExitThread(0);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "window.setWalletModel",
          "args": [
            "0"
          ],
          "line": 254
        },
        "resolved": true,
        "details": {
          "function_name": "setWalletModel",
          "container": "BitcoinGUI",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/bitcoingui.cpp",
          "lines": "409-436",
          "snippet": "void BitcoinGUI::setWalletModel(WalletModel *walletModel)\n{\n    this->walletModel = walletModel;\n    if(walletModel)\n    {\n        // Report errors from wallet thread\n        connect(walletModel, SIGNAL(error(QString,QString,bool)), this, SLOT(error(QString,QString,bool)));\n\n        // Put transaction list in tabs\n        transactionView->setModel(walletModel);\n\n        overviewPage->setModel(walletModel);\n        addressBookPage->setModel(walletModel->getAddressTableModel());\n        receiveCoinsPage->setModel(walletModel->getAddressTableModel());\n        sendCoinsPage->setModel(walletModel);\n        signVerifyMessageDialog->setModel(walletModel);\n\n        setEncryptionStatus(walletModel->getEncryptionStatus());\n        connect(walletModel, SIGNAL(encryptionStatusChanged(int)), this, SLOT(setEncryptionStatus(int)));\n\n        // Balloon pop-up for new transaction\n        connect(walletModel->getTransactionTableModel(), SIGNAL(rowsInserted(QModelIndex,int,int)),\n                this, SLOT(incomingTransaction(QModelIndex,int,int)));\n\n        // Ask for passphrase if needed\n        connect(walletModel, SIGNAL(requireUnlock()), this, SLOT(unlockWallet()));\n    }\n}",
          "includes": [
            "#include <iostream>",
            "#include <QStyle>",
            "#include <QUrl>",
            "#include <QDragEnterEvent>",
            "#include <QTimer>",
            "#include <QDesktopServices>",
            "#include <QFileDialog>",
            "#include <QMovie>",
            "#include <QDateTime>",
            "#include <QStackedWidget>",
            "#include <QProgressBar>",
            "#include <QMimeData>",
            "#include <QMessageBox>",
            "#include <QLocale>",
            "#include <QPushButton>",
            "#include <QLineEdit>",
            "#include <QLabel>",
            "#include <QStatusBar>",
            "#include <QToolBar>",
            "#include <QVBoxLayout>",
            "#include <QTabWidget>",
            "#include <QIcon>",
            "#include <QMenu>",
            "#include <QMenuBar>",
            "#include <QMainWindow>",
            "#include <QApplication>",
            "#include \"macdockiconhandler.h\"",
            "#include \"blockexplorer.h\"",
            "#include \"wallet.h\"",
            "#include \"rpcconsole.h\"",
            "#include \"guiutil.h\"",
            "#include \"notificator.h\"",
            "#include \"askpassphrasedialog.h\"",
            "#include \"guiconstants.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"overviewpage.h\"",
            "#include \"transactionview.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"transactiondescdialog.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"editaddressdialog.h\"",
            "#include \"walletmodel.h\"",
            "#include \"clientmodel.h\"",
            "#include \"aboutdialog.h\"",
            "#include \"optionsdialog.h\"",
            "#include \"signverifymessagedialog.h\"",
            "#include \"sendcoinsdialog.h\"",
            "#include \"addressbookpage.h\"",
            "#include \"transactiontablemodel.h\"",
            "#include \"bitcoingui.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iostream>\n#include <QStyle>\n#include <QUrl>\n#include <QDragEnterEvent>\n#include <QTimer>\n#include <QDesktopServices>\n#include <QFileDialog>\n#include <QMovie>\n#include <QDateTime>\n#include <QStackedWidget>\n#include <QProgressBar>\n#include <QMimeData>\n#include <QMessageBox>\n#include <QLocale>\n#include <QPushButton>\n#include <QLineEdit>\n#include <QLabel>\n#include <QStatusBar>\n#include <QToolBar>\n#include <QVBoxLayout>\n#include <QTabWidget>\n#include <QIcon>\n#include <QMenu>\n#include <QMenuBar>\n#include <QMainWindow>\n#include <QApplication>\n#include \"macdockiconhandler.h\"\n#include \"blockexplorer.h\"\n#include \"wallet.h\"\n#include \"rpcconsole.h\"\n#include \"guiutil.h\"\n#include \"notificator.h\"\n#include \"askpassphrasedialog.h\"\n#include \"guiconstants.h\"\n#include \"bitcoinunits.h\"\n#include \"overviewpage.h\"\n#include \"transactionview.h\"\n#include \"addresstablemodel.h\"\n#include \"transactiondescdialog.h\"\n#include \"optionsmodel.h\"\n#include \"editaddressdialog.h\"\n#include \"walletmodel.h\"\n#include \"clientmodel.h\"\n#include \"aboutdialog.h\"\n#include \"optionsdialog.h\"\n#include \"signverifymessagedialog.h\"\n#include \"sendcoinsdialog.h\"\n#include \"addressbookpage.h\"\n#include \"transactiontablemodel.h\"\n#include \"bitcoingui.h\"\n\nBitcoinGUI {\n  void BitcoinGUI::setWalletModel(WalletModel *walletModel)\n  {\n      this->walletModel = walletModel;\n      if(walletModel)\n      {\n          // Report errors from wallet thread\n          connect(walletModel, SIGNAL(error(QString,QString,bool)), this, SLOT(error(QString,QString,bool)));\n  \n          // Put transaction list in tabs\n          transactionView->setModel(walletModel);\n  \n          overviewPage->setModel(walletModel);\n          addressBookPage->setModel(walletModel->getAddressTableModel());\n          receiveCoinsPage->setModel(walletModel->getAddressTableModel());\n          sendCoinsPage->setModel(walletModel);\n          signVerifyMessageDialog->setModel(walletModel);\n  \n          setEncryptionStatus(walletModel->getEncryptionStatus());\n          connect(walletModel, SIGNAL(encryptionStatusChanged(int)), this, SLOT(setEncryptionStatus(int)));\n  \n          // Balloon pop-up for new transaction\n          connect(walletModel->getTransactionTableModel(), SIGNAL(rowsInserted(QModelIndex,int,int)),\n                  this, SLOT(incomingTransaction(QModelIndex,int,int)));\n  \n          // Ask for passphrase if needed\n          connect(walletModel, SIGNAL(requireUnlock()), this, SLOT(unlockWallet()));\n      }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "window.setClientModel",
          "args": [
            "0"
          ],
          "line": 253
        },
        "resolved": true,
        "details": {
          "function_name": "setClientModel",
          "container": "RPCConsole",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/rpcconsole.cpp",
          "lines": "256-276",
          "snippet": "void RPCConsole::setClientModel(ClientModel *model)\n{\n    this->clientModel = model;\n    if(model)\n    {\n        // Subscribe to information, replies, messages, errors\n        connect(model, SIGNAL(numConnectionsChanged(int)), this, SLOT(setNumConnections(int)));\n        connect(model, SIGNAL(numBlocksChanged(int,int)), this, SLOT(setNumBlocks(int,int)));\n\n        // Provide initial values\n        ui->clientVersion->setText(model->formatFullVersion());\n        ui->clientName->setText(model->clientName());\n        ui->buildDate->setText(model->formatBuildDate());\n        ui->startupTime->setText(model->formatClientStartupTime());\n\n        setNumConnections(model->getNumConnections());\n        ui->isTestNet->setChecked(model->isTestNet());\n\n        setNumBlocks(model->getNumBlocks(), model->getNumBlocksOfPeers());\n    }\n}",
          "includes": [
            "#include \"rpcconsole.moc\"",
            "#include <openssl/crypto.h>",
            "#include <QScrollBar>",
            "#include <QUrl>",
            "#include <QKeyEvent>",
            "#include <QTextEdit>",
            "#include <QThread>",
            "#include <QTimer>",
            "#include <QTime>",
            "#include \"guiutil.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"clientmodel.h\"",
            "#include \"ui_rpcconsole.h\"",
            "#include \"rpcconsole.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"rpcconsole.moc\"\n#include <openssl/crypto.h>\n#include <QScrollBar>\n#include <QUrl>\n#include <QKeyEvent>\n#include <QTextEdit>\n#include <QThread>\n#include <QTimer>\n#include <QTime>\n#include \"guiutil.h\"\n#include \"bitcoinrpc.h\"\n#include \"clientmodel.h\"\n#include \"ui_rpcconsole.h\"\n#include \"rpcconsole.h\"\n\nRPCConsole {\n  void RPCConsole::setClientModel(ClientModel *model)\n  {\n      this->clientModel = model;\n      if(model)\n      {\n          // Subscribe to information, replies, messages, errors\n          connect(model, SIGNAL(numConnectionsChanged(int)), this, SLOT(setNumConnections(int)));\n          connect(model, SIGNAL(numBlocksChanged(int,int)), this, SLOT(setNumBlocks(int,int)));\n  \n          // Provide initial values\n          ui->clientVersion->setText(model->formatFullVersion());\n          ui->clientName->setText(model->clientName());\n          ui->buildDate->setText(model->formatBuildDate());\n          ui->startupTime->setText(model->formatClientStartupTime());\n  \n          setNumConnections(model->getNumConnections());\n          ui->isTestNet->setChecked(model->isTestNet());\n  \n          setNumBlocks(model->getNumBlocks(), model->getNumBlocksOfPeers());\n      }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "window.hide",
          "args": [],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "app.exec",
          "args": [],
          "line": 250
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ipcInit",
          "args": [
            "argc",
            "argv"
          ],
          "line": 248
        },
        "resolved": true,
        "details": {
          "function_name": "ipcInit",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/qtipcserver.cpp",
          "lines": "120-160",
          "snippet": "void ipcInit(int argc, char *argv[])\n{\n    message_queue* mq = NULL;\n    char buffer[MAX_URI_LENGTH + 1] = \"\";\n    size_t nSize = 0;\n    unsigned int nPriority = 0;\n\n    try {\n        mq = new message_queue(open_or_create, BITCOINURI_QUEUE_NAME, 2, MAX_URI_LENGTH);\n\n        // Make sure we don't lose any bitcoin: URIs\n        for (int i = 0; i < 2; i++)\n        {\n            ptime d = boost::posix_time::microsec_clock::universal_time() + millisec(1);\n            if (mq->timed_receive(&buffer, sizeof(buffer), nSize, nPriority, d))\n            {\n                uiInterface.ThreadSafeHandleURI(std::string(buffer, nSize));\n            }\n            else\n                break;\n        }\n\n        // Make sure only one bitcoin instance is listening\n        message_queue::remove(BITCOINURI_QUEUE_NAME);\n        delete mq;\n\n        mq = new message_queue(open_or_create, BITCOINURI_QUEUE_NAME, 2, MAX_URI_LENGTH);\n    }\n    catch (interprocess_exception &ex) {\n        printf(\"ipcInit() - boost interprocess exception #%d: %s\\n\", ex.get_error_code(), ex.what());\n        return;\n    }\n\n    if (!NewThread(ipcThread, mq))\n    {\n        delete mq;\n        return;\n    }\n\n    ipcScanCmd(argc, argv, false);\n}",
          "includes": [
            "#include <boost/version.hpp>",
            "#include <boost/interprocess/ipc/message_queue.hpp>",
            "#include <boost/date_time/posix_time/posix_time.hpp>",
            "#include <boost/algorithm/string/predicate.hpp>",
            "#include \"util.h\"",
            "#include \"ui_interface.h\"",
            "#include \"guiconstants.h\"",
            "#include \"qtipcserver.h\"",
            "#include <boost/version.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/version.hpp>\n#include <boost/interprocess/ipc/message_queue.hpp>\n#include <boost/date_time/posix_time/posix_time.hpp>\n#include <boost/algorithm/string/predicate.hpp>\n#include \"util.h\"\n#include \"ui_interface.h\"\n#include \"guiconstants.h\"\n#include \"qtipcserver.h\"\n#include <boost/version.hpp>\n\nvoid ipcInit(int argc, char *argv[])\n{\n    message_queue* mq = NULL;\n    char buffer[MAX_URI_LENGTH + 1] = \"\";\n    size_t nSize = 0;\n    unsigned int nPriority = 0;\n\n    try {\n        mq = new message_queue(open_or_create, BITCOINURI_QUEUE_NAME, 2, MAX_URI_LENGTH);\n\n        // Make sure we don't lose any bitcoin: URIs\n        for (int i = 0; i < 2; i++)\n        {\n            ptime d = boost::posix_time::microsec_clock::universal_time() + millisec(1);\n            if (mq->timed_receive(&buffer, sizeof(buffer), nSize, nPriority, d))\n            {\n                uiInterface.ThreadSafeHandleURI(std::string(buffer, nSize));\n            }\n            else\n                break;\n        }\n\n        // Make sure only one bitcoin instance is listening\n        message_queue::remove(BITCOINURI_QUEUE_NAME);\n        delete mq;\n\n        mq = new message_queue(open_or_create, BITCOINURI_QUEUE_NAME, 2, MAX_URI_LENGTH);\n    }\n    catch (interprocess_exception &ex) {\n        printf(\"ipcInit() - boost interprocess exception #%d: %s\\n\", ex.get_error_code(), ex.what());\n        return;\n    }\n\n    if (!NewThread(ipcThread, mq))\n    {\n        delete mq;\n        return;\n    }\n\n    ipcScanCmd(argc, argv, false);\n}"
        }
      },
      {
        "call_info": {
          "callee": "window.show",
          "args": [],
          "line": 244
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "window.showMinimized",
          "args": [],
          "line": 240
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetBoolArg",
          "args": [
            "\"-min\""
          ],
          "line": 238
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splash.finish",
          "args": [
            "&window"
          ],
          "line": 229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "optionsModel.Upgrade",
          "args": [],
          "line": 226
        },
        "resolved": true,
        "details": {
          "function_name": "Upgrade",
          "container": "OptionsModel",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/optionsmodel.cpp",
          "lines": "67-124",
          "snippet": "bool OptionsModel::Upgrade()\n{\n    QSettings settings;\n\n    if (settings.contains(\"bImportFinished\"))\n        return false; // Already upgraded\n\n    settings.setValue(\"bImportFinished\", true);\n\n    // Move settings from old wallet.dat (if any):\n    CWalletDB walletdb(strWalletFileName);\n\n    QList<QString> intOptions;\n    intOptions << \"nDisplayUnit\" << \"nTransactionFee\" << \"nReserveBalance\";\n    foreach(QString key, intOptions)\n    {\n        int value = 0;\n        if (walletdb.ReadSetting(key.toStdString(), value))\n        {\n            settings.setValue(key, value);\n            walletdb.EraseSetting(key.toStdString());\n        }\n    }\n    QList<QString> boolOptions;\n    boolOptions << \"bDisplayAddresses\" << \"fMinimizeToTray\" << \"fMinimizeOnClose\" << \"fUseProxy\" << \"fUseUPnP\";\n    foreach(QString key, boolOptions)\n    {\n        bool value = false;\n        if (walletdb.ReadSetting(key.toStdString(), value))\n        {\n            settings.setValue(key, value);\n            walletdb.EraseSetting(key.toStdString());\n        }\n    }\n    try\n    {\n        CAddress addrProxyAddress;\n        if (walletdb.ReadSetting(\"addrProxy\", addrProxyAddress))\n        {\n            settings.setValue(\"addrProxy\", addrProxyAddress.ToStringIPPort().c_str());\n            walletdb.EraseSetting(\"addrProxy\");\n        }\n    }\n    catch (std::ios_base::failure &e)\n    {\n        // 0.6.0rc1 saved this as a CService, which causes failure when parsing as a CAddress\n        CService addrProxy;\n        if (walletdb.ReadSetting(\"addrProxy\", addrProxy))\n        {\n            settings.setValue(\"addrProxy\", addrProxy.ToStringIPPort().c_str());\n            walletdb.EraseSetting(\"addrProxy\");\n        }\n    }\n    ApplyProxySettings();\n    Init();\n\n    return true;\n}",
          "includes": [
            "#include \"guiutil.h\"",
            "#include \"walletdb.h\"",
            "#include \"init.h\"",
            "#include <QSettings>",
            "#include \"bitcoinunits.h\"",
            "#include \"optionsmodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"guiutil.h\"\n#include \"walletdb.h\"\n#include \"init.h\"\n#include <QSettings>\n#include \"bitcoinunits.h\"\n#include \"optionsmodel.h\"\n\nOptionsModel {\n  bool OptionsModel::Upgrade()\n  {\n      QSettings settings;\n  \n      if (settings.contains(\"bImportFinished\"))\n          return false; // Already upgraded\n  \n      settings.setValue(\"bImportFinished\", true);\n  \n      // Move settings from old wallet.dat (if any):\n      CWalletDB walletdb(strWalletFileName);\n  \n      QList<QString> intOptions;\n      intOptions << \"nDisplayUnit\" << \"nTransactionFee\" << \"nReserveBalance\";\n      foreach(QString key, intOptions)\n      {\n          int value = 0;\n          if (walletdb.ReadSetting(key.toStdString(), value))\n          {\n              settings.setValue(key, value);\n              walletdb.EraseSetting(key.toStdString());\n          }\n      }\n      QList<QString> boolOptions;\n      boolOptions << \"bDisplayAddresses\" << \"fMinimizeToTray\" << \"fMinimizeOnClose\" << \"fUseProxy\" << \"fUseUPnP\";\n      foreach(QString key, boolOptions)\n      {\n          bool value = false;\n          if (walletdb.ReadSetting(key.toStdString(), value))\n          {\n              settings.setValue(key, value);\n              walletdb.EraseSetting(key.toStdString());\n          }\n      }\n      try\n      {\n          CAddress addrProxyAddress;\n          if (walletdb.ReadSetting(\"addrProxy\", addrProxyAddress))\n          {\n              settings.setValue(\"addrProxy\", addrProxyAddress.ToStringIPPort().c_str());\n              walletdb.EraseSetting(\"addrProxy\");\n          }\n      }\n      catch (std::ios_base::failure &e)\n      {\n          // 0.6.0rc1 saved this as a CService, which causes failure when parsing as a CAddress\n          CService addrProxy;\n          if (walletdb.ReadSetting(\"addrProxy\", addrProxy))\n          {\n              settings.setValue(\"addrProxy\", addrProxy.ToStringIPPort().c_str());\n              walletdb.EraseSetting(\"addrProxy\");\n          }\n      }\n      ApplyProxySettings();\n      Init();\n  \n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "AppInit2",
          "args": [],
          "line": 220
        },
        "resolved": true,
        "details": {
          "function_name": "AppInit2",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/init.cpp",
          "lines": "322-942",
          "snippet": "bool AppInit2()\n{\n    // ********************************************************* Step 1: setup\n#ifdef _MSC_VER\n    // Turn off Microsoft heap dump noise\n    _CrtSetReportMode(_CRT_WARN, _CRTDBG_MODE_FILE);\n    _CrtSetReportFile(_CRT_WARN, CreateFileA(\"NUL\", GENERIC_WRITE, 0, NULL, OPEN_EXISTING, 0, 0));\n#endif\n#if _MSC_VER >= 1400\n    // Disable confusing \"helpful\" text message on abort, Ctrl-C\n    _set_abort_behavior(0, _WRITE_ABORT_MSG | _CALL_REPORTFAULT);\n#endif\n#ifdef WIN32\n    // Enable Data Execution Prevention (DEP)\n    // Minimum supported OS versions: WinXP SP3, WinVista >= SP1, Win Server 2008\n    // A failure is non-critical and needs no further attention!\n#ifndef PROCESS_DEP_ENABLE\n// We define this here, because GCCs winbase.h limits this to _WIN32_WINNT >= 0x0601 (Windows 7),\n// which is not correct. Can be removed, when GCCs winbase.h is fixed!\n#define PROCESS_DEP_ENABLE 0x00000001\n#endif\n    typedef BOOL (WINAPI *PSETPROCDEPPOL)(DWORD);\n    PSETPROCDEPPOL setProcDEPPol = (PSETPROCDEPPOL)GetProcAddress(GetModuleHandleA(\"Kernel32.dll\"), \"SetProcessDEPPolicy\");\n    if (setProcDEPPol != NULL) setProcDEPPol(PROCESS_DEP_ENABLE);\n#endif\n#ifndef WIN32\n    umask(077);\n\n    // Clean shutdown on SIGTERM\n    struct sigaction sa;\n    sa.sa_handler = HandleSIGTERM;\n    sigemptyset(&sa.sa_mask);\n    sa.sa_flags = 0;\n    sigaction(SIGTERM, &sa, NULL);\n    sigaction(SIGINT, &sa, NULL);\n\n    // Reopen debug.log on SIGHUP\n    struct sigaction sa_hup;\n    sa_hup.sa_handler = HandleSIGHUP;\n    sigemptyset(&sa_hup.sa_mask);\n    sa_hup.sa_flags = 0;\n    sigaction(SIGHUP, &sa_hup, NULL);\n#endif\n\n    // ********************************************************* Step 2: parameter interactions\n\n    if(GetBoolArg(\"-sse2\", false)) {\n        printf(\"SSE2 assembly optimisations enabled\\n\");\n        nNeoScryptOptions |= 0x1000;\n    }\n\n    nNodeLifespan = GetArg(\"-addrlifespan\", 7);\n\n    nMinerSleep = GetArg(\"-minersleep\", 500);\n\n    CheckpointsMode = Checkpoints::STRICT;\n    std::string strCpMode = GetArg(\"-cppolicy\", \"strict\");\n\n    if(strCpMode == \"strict\")\n        CheckpointsMode = Checkpoints::STRICT;\n\n    if(strCpMode == \"advisory\")\n        CheckpointsMode = Checkpoints::ADVISORY;\n\n    if(strCpMode == \"permissive\")\n        CheckpointsMode = Checkpoints::PERMISSIVE;\n\n    nDerivationMethodIndex = 0;\n\n    fTestNet = GetBoolArg(\"-testnet\");\n    //fTestNet = true;\n    if (fTestNet) {\n        SoftSetBoolArg(\"-irc\", true);\n    }\n\n    if (mapArgs.count(\"-bind\")) {\n        // when specifying an explicit binding address, you want to listen on it\n        // even when -connect or -proxy is specified\n        SoftSetBoolArg(\"-listen\", true);\n    }\n\n    if (mapArgs.count(\"-connect\") && mapMultiArgs[\"-connect\"].size() > 0) {\n        // when only connecting to trusted nodes, do not seed via DNS, or listen by default\n        SoftSetBoolArg(\"-dnsseed\", false);\n        SoftSetBoolArg(\"-listen\", false);\n    }\n\n    if (mapArgs.count(\"-proxy\")) {\n        // to protect privacy, do not listen by default if a proxy server is specified\n        SoftSetBoolArg(\"-listen\", false);\n    }\n\n    if (!GetBoolArg(\"-listen\", true)) {\n        // do not map ports or try to retrieve public IP when not listening (pointless)\n        SoftSetBoolArg(\"-upnp\", false);\n        SoftSetBoolArg(\"-discover\", false);\n    }\n\n    if (mapArgs.count(\"-externalip\")) {\n        // if an explicit public IP is specified, do not try to find others\n        SoftSetBoolArg(\"-discover\", false);\n    }\n\n    if (GetBoolArg(\"-salvagewallet\")) {\n        // Rewrite just private keys: rescan to find transactions\n        SoftSetBoolArg(\"-rescan\", true);\n    }\n\n    // ********************************************************* Step 3: parameter-to-internal-flags\n\n    fDebug = GetBoolArg(\"-debug\");\n\n    // -debug implies fDebug*\n    if (fDebug)\n        fDebugNet = true;\n    else\n        fDebugNet = GetBoolArg(\"-debugnet\");\n\n    bitdb.SetDetach(GetBoolArg(\"-detachdb\", false));\n\n#if !defined(WIN32) && !defined(QT_GUI)\n    fDaemon = GetBoolArg(\"-daemon\");\n#else\n    fDaemon = false;\n#endif\n\n    if (fDaemon)\n        fServer = true;\n    else\n        fServer = GetBoolArg(\"-server\");\n\n    /* force fServer when running without GUI */\n#if !defined(QT_GUI)\n    fServer = true;\n#endif\n    fPrintToConsole = GetBoolArg(\"-printtoconsole\");\n    fPrintToDebugger = GetBoolArg(\"-printtodebugger\");\n    fLogTimestamps = GetBoolArg(\"-logtimestamps\");\n\n    if (mapArgs.count(\"-timeout\"))\n    {\n        int nNewTimeout = GetArg(\"-timeout\", 5000);\n        if (nNewTimeout > 0 && nNewTimeout < 600000)\n            nConnectTimeout = nNewTimeout;\n    }\n\n    if (mapArgs.count(\"-paytxfee\"))\n    {\n        if (!ParseMoney(mapArgs[\"-paytxfee\"], nTransactionFee))\n            return InitError(strprintf(_(\"Invalid amount for -paytxfee=<amount>: '%s'\"), mapArgs[\"-paytxfee\"].c_str()));\n        if (nTransactionFee > 0.25 * COIN)\n            InitWarning(_(\"Warning: -paytxfee is set very high! This is the transaction fee you will pay if you send a transaction.\"));\n    }\n\n    fConfChange = GetBoolArg(\"-confchange\", false);\n    fEnforceCanonical = GetBoolArg(\"-enforcecanonical\", true);\n\n    if (mapArgs.count(\"-mininput\"))\n    {\n        if (!ParseMoney(mapArgs[\"-mininput\"], nMinimumInputValue))\n            return InitError(strprintf(_(\"Invalid amount for -mininput=<amount>: '%s'\"), mapArgs[\"-mininput\"].c_str()));\n    }\n\n    /* Try to combine inputs while staking up to this limit */\n    if(mapArgs.count(\"-stakecombine\")) {\n        if(!ParseMoney(mapArgs[\"-stakecombine\"], nCombineThreshold))\n          return(InitError(strprintf(_(\"Invalid amount for -stakecombine=<amount>: '%s'\"),\n            mapArgs[\"-stakecombine\"].c_str())));\n        if(nCombineThreshold < 10 * COIN)\n          nCombineThreshold = 10 * COIN;\n        if(nCombineThreshold > 1000 * COIN)\n          nCombineThreshold = 1000 * COIN;\n    }\n\n    /* Don't split outputs while staking below this limit */\n    if(mapArgs.count(\"-stakesplit\")) {\n        if(!ParseMoney(mapArgs[\"-stakesplit\"], nSplitThreshold))\n          return(InitError(strprintf(_(\"Invalid amount for -stakesplit=<amount>: '%s'\"),\n            mapArgs[\"-stakesplit\"].c_str())));\n        if(nSplitThreshold < 20 * COIN)\n          nSplitThreshold = 20 * COIN;\n        if(nSplitThreshold > 2000 * COIN)\n          nSplitThreshold = 2000 * COIN;\n    }\n\n    // ********************************************************* Step 4: application initialization: dir lock, daemonize, pidfile, debug log\n\n    std::string strDataDir = GetDataDir().string();\n    std::string strWalletFileName = GetArg(\"-wallet\", \"wallet.dat\");\n\n    // strWalletFileName must be a plain filename without a directory\n    if (strWalletFileName != boost::filesystem::basename(strWalletFileName) + boost::filesystem::extension(strWalletFileName))\n        return InitError(strprintf(_(\"Wallet %s resides outside data directory %s.\"), strWalletFileName.c_str(), strDataDir.c_str()));\n\n    // Make sure only a single Bitcoin process is using the data directory.\n    boost::filesystem::path pathLockFile = GetDataDir() / \".lock\";\n    FILE* file = fopen(pathLockFile.string().c_str(), \"a\"); // empty lock file; created if it doesn't exist.\n    if (file) fclose(file);\n    static boost::interprocess::file_lock lock(pathLockFile.string().c_str());\n    if (!lock.try_lock())\n        return InitError(strprintf(_(\"Cannot obtain a lock on data directory %s.  Halcyon is probably already running.\"), strDataDir.c_str()));\n\n#if !defined(WIN32) && !defined(QT_GUI)\n    if (fDaemon)\n    {\n        // Daemonize\n        pid_t pid = fork();\n        if (pid < 0)\n        {\n            fprintf(stderr, \"Error: fork() returned %d errno %d\\n\", pid, errno);\n            return false;\n        }\n        if (pid > 0)\n        {\n            CreatePidFile(GetPidFile(), pid);\n            return true;\n        }\n\n        pid_t sid = setsid();\n        if (sid < 0)\n            fprintf(stderr, \"Error: setsid() returned %d errno %d\\n\", sid, errno);\n    }\n#endif\n\n    if (GetBoolArg(\"-shrinkdebugfile\", !fDebug))\n        ShrinkDebugFile();\n    printf(\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\");\n    printf(\"Halcyon version %s (%s)\\n\", FormatFullVersion().c_str(), CLIENT_DATE.c_str());\n    printf(\"Using OpenSSL version %s\\n\", SSLeay_version(SSLEAY_VERSION));\n    if (!fLogTimestamps)\n        printf(\"Startup time: %s\\n\", DateTimeStrFormat(\"%x %H:%M:%S\", GetTime()).c_str());\n    printf(\"Default data directory %s\\n\", GetDefaultDataDir().string().c_str());\n    printf(\"Used data directory %s\\n\", strDataDir.c_str());\n    std::ostringstream strErrors;\n\n    int64_t nStart;\n\n    // ********************************************************* Step 5: verify database integrity\n\n    uiInterface.InitMessage(_(\"Verifying database integrity...\"));\n\n    if (!bitdb.Open(GetDataDir()))\n    {\n        string msg = strprintf(_(\"Error initializing database environment %s!\"\n                                 \" To recover, BACKUP THAT DIRECTORY, then remove\"\n                                 \" everything from it except for wallet.dat.\"), strDataDir.c_str());\n        return InitError(msg);\n    }\n\n    if (GetBoolArg(\"-salvagewallet\"))\n    {\n        // Recover readable keypairs:\n        if (!CWalletDB::Recover(bitdb, strWalletFileName, true))\n            return false;\n    }\n\n    if (filesystem::exists(GetDataDir() / strWalletFileName))\n    {\n        CDBEnv::VerifyResult r = bitdb.Verify(strWalletFileName, CWalletDB::Recover);\n        if (r == CDBEnv::RECOVER_OK)\n        {\n            string msg = strprintf(_(\"Warning: wallet.dat corrupt, data salvaged!\"\n                                     \" Original wallet.dat saved as wallet.{timestamp}.bak in %s; if\"\n                                     \" your balance or transactions are incorrect you should\"\n                                     \" restore from a backup.\"), strDataDir.c_str());\n            uiInterface.ThreadSafeMessageBox(msg, _(\"Halcyon\"), CClientUIInterface::OK | CClientUIInterface::ICON_EXCLAMATION | CClientUIInterface::MODAL);\n        }\n        if (r == CDBEnv::RECOVER_FAIL)\n            return InitError(_(\"wallet.dat corrupt, salvage failed\"));\n    }\n\n    // ********************************************************* Step 6: network initialization\n\n    int nSocksVersion = GetArg(\"-socks\", 5);\n\n    if (nSocksVersion != 4 && nSocksVersion != 5)\n        return InitError(strprintf(_(\"Unknown -socks proxy version requested: %i\"), nSocksVersion));\n\n    if (mapArgs.count(\"-onlynet\")) {\n        std::set<enum Network> nets;\n        BOOST_FOREACH(std::string snet, mapMultiArgs[\"-onlynet\"]) {\n            enum Network net = ParseNetwork(snet);\n            if (net == NET_UNROUTABLE)\n                return InitError(strprintf(_(\"Unknown network specified in -onlynet: '%s'\"), snet.c_str()));\n            nets.insert(net);\n        }\n        for (int n = 0; n < NET_MAX; n++) {\n            enum Network net = (enum Network)n;\n            if (!nets.count(net))\n                SetLimited(net);\n        }\n    }\n#if defined(USE_IPV6)\n#if ! USE_IPV6\n    else\n        SetLimited(NET_IPV6);\n#endif\n#endif\n\n    CService addrProxy;\n    bool fProxy = false;\n    if (mapArgs.count(\"-proxy\")) {\n        addrProxy = CService(mapArgs[\"-proxy\"], 9050);\n        if (!addrProxy.IsValid())\n            return InitError(strprintf(_(\"Invalid -proxy address: '%s'\"), mapArgs[\"-proxy\"].c_str()));\n\n        if (!IsLimited(NET_IPV4))\n            SetProxy(NET_IPV4, addrProxy, nSocksVersion);\n        if (nSocksVersion > 4) {\n#ifdef USE_IPV6\n            if (!IsLimited(NET_IPV6))\n                SetProxy(NET_IPV6, addrProxy, nSocksVersion);\n#endif\n            SetNameProxy(addrProxy, nSocksVersion);\n        }\n        fProxy = true;\n    }\n\n    // -tor can override normal proxy, -notor disables tor entirely\n    if (!(mapArgs.count(\"-tor\") && mapArgs[\"-tor\"] == \"0\") && (fProxy || mapArgs.count(\"-tor\"))) {\n        CService addrOnion;\n        if (!mapArgs.count(\"-tor\"))\n            addrOnion = addrProxy;\n        else\n            addrOnion = CService(mapArgs[\"-tor\"], 9050);\n        if (!addrOnion.IsValid())\n            return InitError(strprintf(_(\"Invalid -tor address: '%s'\"), mapArgs[\"-tor\"].c_str()));\n        SetProxy(NET_TOR, addrOnion, 5);\n        SetReachable(NET_TOR);\n    }\n\n    // see Step 2: parameter interactions for more information about these\n    fNoListen = !GetBoolArg(\"-listen\", true);\n    fDiscover = GetBoolArg(\"-discover\", true);\n    fNameLookup = GetBoolArg(\"-dns\", true);\n#ifdef USE_UPNP\n    fUseUPnP = GetBoolArg(\"-upnp\", USE_UPNP);\n#endif\n\n    bool fBound = false;\n    if (!fNoListen)\n    {\n        std::string strError;\n        if (mapArgs.count(\"-bind\")) {\n            BOOST_FOREACH(std::string strBind, mapMultiArgs[\"-bind\"]) {\n                CService addrBind;\n                if (!Lookup(strBind.c_str(), addrBind, GetListenPort(), false))\n                    return InitError(strprintf(_(\"Cannot resolve -bind address: '%s'\"), strBind.c_str()));\n                fBound |= Bind(addrBind);\n            }\n        } else {\n            struct in_addr inaddr_any;\n            inaddr_any.s_addr = INADDR_ANY;\n#ifdef USE_IPV6\n            if (!IsLimited(NET_IPV6))\n                fBound |= Bind(CService(in6addr_any, GetListenPort()), false);\n#endif\n            if (!IsLimited(NET_IPV4))\n                fBound |= Bind(CService(inaddr_any, GetListenPort()), !fBound);\n        }\n        if (!fBound)\n            return InitError(_(\"Failed to listen on any port. Use -listen=0 if you want this.\"));\n    }\n\n    if (mapArgs.count(\"-externalip\"))\n    {\n        BOOST_FOREACH(string strAddr, mapMultiArgs[\"-externalip\"]) {\n            CService addrLocal(strAddr, GetListenPort(), fNameLookup);\n            if (!addrLocal.IsValid())\n                return InitError(strprintf(_(\"Cannot resolve -externalip address: '%s'\"), strAddr.c_str()));\n            AddLocal(CService(strAddr, GetListenPort(), fNameLookup), LOCAL_MANUAL);\n        }\n    }\n\n    if (mapArgs.count(\"-reservebalance\")) // ppcoin: reserve balance amount\n    {\n        if (!ParseMoney(mapArgs[\"-reservebalance\"], nReserveBalance))\n        {\n            InitError(_(\"Invalid amount for -reservebalance=<amount>\"));\n            return false;\n        }\n    }\n\n    if (mapArgs.count(\"-checkpointkey\")) // ppcoin: checkpoint master priv key\n    {\n        if (!Checkpoints::SetCheckpointPrivKey(GetArg(\"-checkpointkey\", \"\")))\n            InitError(_(\"Unable to sign checkpoint, wrong checkpointkey?\\n\"));\n    }\n\n    BOOST_FOREACH(string strDest, mapMultiArgs[\"-seednode\"])\n        AddOneShot(strDest);\n\n    // ********************************************************* Step 7: load blockchain\n\n    if (!bitdb.Open(GetDataDir()))\n    {\n        string msg = strprintf(_(\"Error initializing database environment %s!\"\n                                 \" To recover, BACKUP THAT DIRECTORY, then remove\"\n                                 \" everything from it except for wallet.dat.\"), strDataDir.c_str());\n        return InitError(msg);\n    }\n\n    if (GetBoolArg(\"-loadblockindextest\"))\n    {\n        CTxDB txdb(\"r\");\n        txdb.LoadBlockIndex();\n        PrintBlockTree();\n        return false;\n    }\n\n    uiInterface.InitMessage(_(\"Loading block index...\"));\n    printf(\"Loading block index...\\n\");\n    nStart = GetTimeMillis();\n    if (!LoadBlockIndex())\n        return InitError(_(\"Error loading blkindex.dat\"));\n\n\n    // as LoadBlockIndex can take several minutes, it's possible the user\n    // requested to kill bitcoin-qt during the last operation. If so, exit.\n    // As the program has not fully started yet, Shutdown() is possibly overkill.\n    if (fRequestShutdown)\n    {\n        printf(\"Shutdown requested. Exiting.\\n\");\n        return false;\n    }\n    printf(\" block index %15\"PRId64\"ms\\n\", GetTimeMillis() - nStart);\n\n    if (GetBoolArg(\"-printblockindex\") || GetBoolArg(\"-printblocktree\"))\n    {\n        PrintBlockTree();\n        return false;\n    }\n\n    if (mapArgs.count(\"-printblock\"))\n    {\n        string strMatch = mapArgs[\"-printblock\"];\n        int nFound = 0;\n        for (map<uint256, CBlockIndex*>::iterator mi = mapBlockIndex.begin(); mi != mapBlockIndex.end(); ++mi)\n        {\n            uint256 hash = (*mi).first;\n            if (strncmp(hash.ToString().c_str(), strMatch.c_str(), strMatch.size()) == 0)\n            {\n                CBlockIndex* pindex = (*mi).second;\n                CBlock block;\n                block.ReadFromDisk(pindex);\n                block.BuildMerkleTree();\n                block.print();\n                printf(\"\\n\");\n                nFound++;\n            }\n        }\n        if (nFound == 0)\n            printf(\"No blocks matching %s were found\\n\", strMatch.c_str());\n        return false;\n    }\n\n    // ********************************************************* Step 8: load wallet\n\n    uiInterface.InitMessage(_(\"Loading wallet...\"));\n    printf(\"Loading wallet...\\n\");\n    nStart = GetTimeMillis();\n    bool fFirstRun = true;\n    pwalletMain = new CWallet(strWalletFileName);\n    DBErrors nLoadWalletRet = pwalletMain->LoadWallet(fFirstRun);\n    if (nLoadWalletRet != DB_LOAD_OK)\n    {\n        if (nLoadWalletRet == DB_CORRUPT)\n            strErrors << _(\"Error loading wallet.dat: Wallet corrupted\") << \"\\n\";\n        else if (nLoadWalletRet == DB_NONCRITICAL_ERROR)\n        {\n            string msg(_(\"Warning: error reading wallet.dat! All keys read correctly, but transaction data\"\n                         \" or address book entries might be missing or incorrect.\"));\n            uiInterface.ThreadSafeMessageBox(msg, _(\"Halcyon\"), CClientUIInterface::OK | CClientUIInterface::ICON_EXCLAMATION | CClientUIInterface::MODAL);\n        }\n        else if (nLoadWalletRet == DB_TOO_NEW)\n            strErrors << _(\"Error loading wallet.dat: Wallet requires newer version of Halcyon\") << \"\\n\";\n        else if (nLoadWalletRet == DB_NEED_REWRITE)\n        {\n            strErrors << _(\"Wallet needed to be rewritten: restart Halcyon to complete\") << \"\\n\";\n            printf(\"%s\", strErrors.str().c_str());\n            return InitError(strErrors.str());\n        }\n        else\n            strErrors << _(\"Error loading wallet.dat\") << \"\\n\";\n    }\n\n    if (GetBoolArg(\"-upgradewallet\", fFirstRun))\n    {\n        int nMaxVersion = GetArg(\"-upgradewallet\", 0);\n        if (nMaxVersion == 0) // the -upgradewallet without argument case\n        {\n            printf(\"Performing wallet upgrade to %i\\n\", FEATURE_LATEST);\n            nMaxVersion = CLIENT_VERSION;\n            pwalletMain->SetMinVersion(FEATURE_LATEST); // permanently upgrade the wallet immediately\n        }\n        else\n            printf(\"Allowing wallet upgrade up to %i\\n\", nMaxVersion);\n        if (nMaxVersion < pwalletMain->GetVersion())\n            strErrors << _(\"Cannot downgrade wallet\") << \"\\n\";\n        pwalletMain->SetMaxVersion(nMaxVersion);\n    }\n\n    if (fFirstRun)\n    {\n        // Create new keyUser and set as default key\n        RandAddSeedPerfmon();\n\n        CPubKey newDefaultKey;\n        if (!pwalletMain->GetKeyFromPool(newDefaultKey, false))\n            strErrors << _(\"Cannot initialize keypool\") << \"\\n\";\n        pwalletMain->SetDefaultKey(newDefaultKey);\n        if (!pwalletMain->SetAddressBookName(pwalletMain->vchDefaultKey.GetID(), \"\"))\n            strErrors << _(\"Cannot write default address\") << \"\\n\";\n    }\n\n    printf(\"%s\", strErrors.str().c_str());\n    printf(\" wallet      %15\"PRId64\"ms\\n\", GetTimeMillis() - nStart);\n\n    RegisterWallet(pwalletMain);\n\n    CBlockIndex *pindexRescan = pindexBest;\n    if (GetBoolArg(\"-rescan\"))\n        pindexRescan = pindexGenesisBlock;\n    else\n    {\n        CWalletDB walletdb(strWalletFileName);\n        CBlockLocator locator;\n        if (walletdb.ReadBestBlock(locator))\n            pindexRescan = locator.GetBlockIndex();\n    }\n    if (pindexBest != pindexRescan && pindexBest && pindexRescan && pindexBest->nHeight > pindexRescan->nHeight)\n    {\n        uiInterface.InitMessage(_(\"Rescanning...\"));\n        printf(\"Rescanning last %i blocks (from block %i)...\\n\", pindexBest->nHeight - pindexRescan->nHeight, pindexRescan->nHeight);\n        nStart = GetTimeMillis();\n        pwalletMain->ScanForWalletTransactions(pindexRescan, true);\n        printf(\" rescan      %15\"PRId64\"ms\\n\", GetTimeMillis() - nStart);\n    }\n\n    // ********************************************************* Step 9: import blocks\n\n    if (mapArgs.count(\"-loadblock\"))\n    {\n        uiInterface.InitMessage(_(\"Importing blockchain data file.\"));\n\n        BOOST_FOREACH(string strFile, mapMultiArgs[\"-loadblock\"])\n        {\n            FILE *file = fopen(strFile.c_str(), \"rb\");\n            if (file)\n                LoadExternalBlockFile(file);\n        }\n        exit(0);\n    }\n\n    filesystem::path pathBootstrap = GetDataDir() / \"bootstrap.dat\";\n    if (filesystem::exists(pathBootstrap)) {\n        uiInterface.InitMessage(_(\"Importing bootstrap blockchain data file.\"));\n\n        FILE *file = fopen(pathBootstrap.string().c_str(), \"rb\");\n        if (file) {\n            filesystem::path pathBootstrapOld = GetDataDir() / \"bootstrap.dat.old\";\n            LoadExternalBlockFile(file);\n            RenameOver(pathBootstrap, pathBootstrapOld);\n        }\n    }\n\n    // ********************************************************* Step 10: load peers\n\n    uiInterface.InitMessage(_(\"Loading addresses...\"));\n    printf(\"Loading addresses...\\n\");\n    nStart = GetTimeMillis();\n\n    {\n        CAddrDB adb;\n        if (!adb.Read(addrman))\n            printf(\"Invalid or missing peers.dat; recreating\\n\");\n    }\n\n    printf(\"Loaded %i addresses from peers.dat  %\"PRId64\"ms\\n\",\n           addrman.size(), GetTimeMillis() - nStart);\n\n    // ********************************************************* Step 11: start node\n\n    if (!CheckDiskSpace())\n        return false;\n\n    RandAddSeedPerfmon();\n\n    //// debug print\n    printf(\"mapBlockIndex.size() = %\"PRIszu\"\\n\",   mapBlockIndex.size());\n    printf(\"nBestHeight = %d\\n\",            nBestHeight);\n    printf(\"setKeyPool.size() = %\"PRIszu\"\\n\",      pwalletMain->setKeyPool.size());\n    printf(\"mapWallet.size() = %\"PRIszu\"\\n\",       pwalletMain->mapWallet.size());\n    printf(\"mapAddressBook.size() = %\"PRIszu\"\\n\",  pwalletMain->mapAddressBook.size());\n\n    if (!NewThread(StartNode, NULL))\n        InitError(_(\"Error: could not start node\"));\n\n    if (fServer)\n        NewThread(ThreadRPCServer, NULL);\n\n    // ********************************************************* Step 12: finished\n\n    uiInterface.InitMessage(_(\"Done loading\"));\n    printf(\"Done loading\\n\");\n\n    if (!strErrors.str().empty())\n        return InitError(strErrors.str());\n\n     // Add wallet transactions that aren't already in a block to mapTransactions\n    pwalletMain->ReacceptWalletTransactions();\n\n#if !defined(QT_GUI)\n    // Loop until process is exit()ed from shutdown() function,\n    // called from ThreadRPCServer thread when a \"stop\" command is received.\n    while (1)\n        MilliSleep(5000);\n#endif\n\n    return true;\n}",
          "includes": [
            "#include <signal.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/algorithm/string/predicate.hpp>",
            "#include <boost/interprocess/sync/file_lock.hpp>",
            "#include <boost/filesystem/convenience.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include \"checkpoints.h\"",
            "#include \"ui_interface.h\"",
            "#include \"util.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"bitcoinrpc.h\"",
            "#include \"walletdb.h\"",
            "#include \"txdb.h\""
          ],
          "macros_used": [
            "#define PROCESS_DEP_ENABLE 0x00000001"
          ],
          "globals_used": [
            "CWallet* pwalletMain;",
            "CClientUIInterface uiInterface;",
            "std::string strWalletFileName;",
            "bool fConfChange;",
            "bool fEnforceCanonical;",
            "unsigned int nNodeLifespan;",
            "unsigned int nDerivationMethodIndex;",
            "unsigned int nMinerSleep;",
            "enum Checkpoints::CPMode CheckpointsMode;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <signal.h>\n#include <openssl/crypto.h>\n#include <boost/algorithm/string/predicate.hpp>\n#include <boost/interprocess/sync/file_lock.hpp>\n#include <boost/filesystem/convenience.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include \"checkpoints.h\"\n#include \"ui_interface.h\"\n#include \"util.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"bitcoinrpc.h\"\n#include \"walletdb.h\"\n#include \"txdb.h\"\n\n#define PROCESS_DEP_ENABLE 0x00000001\n\nCWallet* pwalletMain;\nCClientUIInterface uiInterface;\nstd::string strWalletFileName;\nbool fConfChange;\nbool fEnforceCanonical;\nunsigned int nNodeLifespan;\nunsigned int nDerivationMethodIndex;\nunsigned int nMinerSleep;\nenum Checkpoints::CPMode CheckpointsMode;\n\nbool AppInit2()\n{\n    // ********************************************************* Step 1: setup\n#ifdef _MSC_VER\n    // Turn off Microsoft heap dump noise\n    _CrtSetReportMode(_CRT_WARN, _CRTDBG_MODE_FILE);\n    _CrtSetReportFile(_CRT_WARN, CreateFileA(\"NUL\", GENERIC_WRITE, 0, NULL, OPEN_EXISTING, 0, 0));\n#endif\n#if _MSC_VER >= 1400\n    // Disable confusing \"helpful\" text message on abort, Ctrl-C\n    _set_abort_behavior(0, _WRITE_ABORT_MSG | _CALL_REPORTFAULT);\n#endif\n#ifdef WIN32\n    // Enable Data Execution Prevention (DEP)\n    // Minimum supported OS versions: WinXP SP3, WinVista >= SP1, Win Server 2008\n    // A failure is non-critical and needs no further attention!\n#ifndef PROCESS_DEP_ENABLE\n// We define this here, because GCCs winbase.h limits this to _WIN32_WINNT >= 0x0601 (Windows 7),\n// which is not correct. Can be removed, when GCCs winbase.h is fixed!\n#define PROCESS_DEP_ENABLE 0x00000001\n#endif\n    typedef BOOL (WINAPI *PSETPROCDEPPOL)(DWORD);\n    PSETPROCDEPPOL setProcDEPPol = (PSETPROCDEPPOL)GetProcAddress(GetModuleHandleA(\"Kernel32.dll\"), \"SetProcessDEPPolicy\");\n    if (setProcDEPPol != NULL) setProcDEPPol(PROCESS_DEP_ENABLE);\n#endif\n#ifndef WIN32\n    umask(077);\n\n    // Clean shutdown on SIGTERM\n    struct sigaction sa;\n    sa.sa_handler = HandleSIGTERM;\n    sigemptyset(&sa.sa_mask);\n    sa.sa_flags = 0;\n    sigaction(SIGTERM, &sa, NULL);\n    sigaction(SIGINT, &sa, NULL);\n\n    // Reopen debug.log on SIGHUP\n    struct sigaction sa_hup;\n    sa_hup.sa_handler = HandleSIGHUP;\n    sigemptyset(&sa_hup.sa_mask);\n    sa_hup.sa_flags = 0;\n    sigaction(SIGHUP, &sa_hup, NULL);\n#endif\n\n    // ********************************************************* Step 2: parameter interactions\n\n    if(GetBoolArg(\"-sse2\", false)) {\n        printf(\"SSE2 assembly optimisations enabled\\n\");\n        nNeoScryptOptions |= 0x1000;\n    }\n\n    nNodeLifespan = GetArg(\"-addrlifespan\", 7);\n\n    nMinerSleep = GetArg(\"-minersleep\", 500);\n\n    CheckpointsMode = Checkpoints::STRICT;\n    std::string strCpMode = GetArg(\"-cppolicy\", \"strict\");\n\n    if(strCpMode == \"strict\")\n        CheckpointsMode = Checkpoints::STRICT;\n\n    if(strCpMode == \"advisory\")\n        CheckpointsMode = Checkpoints::ADVISORY;\n\n    if(strCpMode == \"permissive\")\n        CheckpointsMode = Checkpoints::PERMISSIVE;\n\n    nDerivationMethodIndex = 0;\n\n    fTestNet = GetBoolArg(\"-testnet\");\n    //fTestNet = true;\n    if (fTestNet) {\n        SoftSetBoolArg(\"-irc\", true);\n    }\n\n    if (mapArgs.count(\"-bind\")) {\n        // when specifying an explicit binding address, you want to listen on it\n        // even when -connect or -proxy is specified\n        SoftSetBoolArg(\"-listen\", true);\n    }\n\n    if (mapArgs.count(\"-connect\") && mapMultiArgs[\"-connect\"].size() > 0) {\n        // when only connecting to trusted nodes, do not seed via DNS, or listen by default\n        SoftSetBoolArg(\"-dnsseed\", false);\n        SoftSetBoolArg(\"-listen\", false);\n    }\n\n    if (mapArgs.count(\"-proxy\")) {\n        // to protect privacy, do not listen by default if a proxy server is specified\n        SoftSetBoolArg(\"-listen\", false);\n    }\n\n    if (!GetBoolArg(\"-listen\", true)) {\n        // do not map ports or try to retrieve public IP when not listening (pointless)\n        SoftSetBoolArg(\"-upnp\", false);\n        SoftSetBoolArg(\"-discover\", false);\n    }\n\n    if (mapArgs.count(\"-externalip\")) {\n        // if an explicit public IP is specified, do not try to find others\n        SoftSetBoolArg(\"-discover\", false);\n    }\n\n    if (GetBoolArg(\"-salvagewallet\")) {\n        // Rewrite just private keys: rescan to find transactions\n        SoftSetBoolArg(\"-rescan\", true);\n    }\n\n    // ********************************************************* Step 3: parameter-to-internal-flags\n\n    fDebug = GetBoolArg(\"-debug\");\n\n    // -debug implies fDebug*\n    if (fDebug)\n        fDebugNet = true;\n    else\n        fDebugNet = GetBoolArg(\"-debugnet\");\n\n    bitdb.SetDetach(GetBoolArg(\"-detachdb\", false));\n\n#if !defined(WIN32) && !defined(QT_GUI)\n    fDaemon = GetBoolArg(\"-daemon\");\n#else\n    fDaemon = false;\n#endif\n\n    if (fDaemon)\n        fServer = true;\n    else\n        fServer = GetBoolArg(\"-server\");\n\n    /* force fServer when running without GUI */\n#if !defined(QT_GUI)\n    fServer = true;\n#endif\n    fPrintToConsole = GetBoolArg(\"-printtoconsole\");\n    fPrintToDebugger = GetBoolArg(\"-printtodebugger\");\n    fLogTimestamps = GetBoolArg(\"-logtimestamps\");\n\n    if (mapArgs.count(\"-timeout\"))\n    {\n        int nNewTimeout = GetArg(\"-timeout\", 5000);\n        if (nNewTimeout > 0 && nNewTimeout < 600000)\n            nConnectTimeout = nNewTimeout;\n    }\n\n    if (mapArgs.count(\"-paytxfee\"))\n    {\n        if (!ParseMoney(mapArgs[\"-paytxfee\"], nTransactionFee))\n            return InitError(strprintf(_(\"Invalid amount for -paytxfee=<amount>: '%s'\"), mapArgs[\"-paytxfee\"].c_str()));\n        if (nTransactionFee > 0.25 * COIN)\n            InitWarning(_(\"Warning: -paytxfee is set very high! This is the transaction fee you will pay if you send a transaction.\"));\n    }\n\n    fConfChange = GetBoolArg(\"-confchange\", false);\n    fEnforceCanonical = GetBoolArg(\"-enforcecanonical\", true);\n\n    if (mapArgs.count(\"-mininput\"))\n    {\n        if (!ParseMoney(mapArgs[\"-mininput\"], nMinimumInputValue))\n            return InitError(strprintf(_(\"Invalid amount for -mininput=<amount>: '%s'\"), mapArgs[\"-mininput\"].c_str()));\n    }\n\n    /* Try to combine inputs while staking up to this limit */\n    if(mapArgs.count(\"-stakecombine\")) {\n        if(!ParseMoney(mapArgs[\"-stakecombine\"], nCombineThreshold))\n          return(InitError(strprintf(_(\"Invalid amount for -stakecombine=<amount>: '%s'\"),\n            mapArgs[\"-stakecombine\"].c_str())));\n        if(nCombineThreshold < 10 * COIN)\n          nCombineThreshold = 10 * COIN;\n        if(nCombineThreshold > 1000 * COIN)\n          nCombineThreshold = 1000 * COIN;\n    }\n\n    /* Don't split outputs while staking below this limit */\n    if(mapArgs.count(\"-stakesplit\")) {\n        if(!ParseMoney(mapArgs[\"-stakesplit\"], nSplitThreshold))\n          return(InitError(strprintf(_(\"Invalid amount for -stakesplit=<amount>: '%s'\"),\n            mapArgs[\"-stakesplit\"].c_str())));\n        if(nSplitThreshold < 20 * COIN)\n          nSplitThreshold = 20 * COIN;\n        if(nSplitThreshold > 2000 * COIN)\n          nSplitThreshold = 2000 * COIN;\n    }\n\n    // ********************************************************* Step 4: application initialization: dir lock, daemonize, pidfile, debug log\n\n    std::string strDataDir = GetDataDir().string();\n    std::string strWalletFileName = GetArg(\"-wallet\", \"wallet.dat\");\n\n    // strWalletFileName must be a plain filename without a directory\n    if (strWalletFileName != boost::filesystem::basename(strWalletFileName) + boost::filesystem::extension(strWalletFileName))\n        return InitError(strprintf(_(\"Wallet %s resides outside data directory %s.\"), strWalletFileName.c_str(), strDataDir.c_str()));\n\n    // Make sure only a single Bitcoin process is using the data directory.\n    boost::filesystem::path pathLockFile = GetDataDir() / \".lock\";\n    FILE* file = fopen(pathLockFile.string().c_str(), \"a\"); // empty lock file; created if it doesn't exist.\n    if (file) fclose(file);\n    static boost::interprocess::file_lock lock(pathLockFile.string().c_str());\n    if (!lock.try_lock())\n        return InitError(strprintf(_(\"Cannot obtain a lock on data directory %s.  Halcyon is probably already running.\"), strDataDir.c_str()));\n\n#if !defined(WIN32) && !defined(QT_GUI)\n    if (fDaemon)\n    {\n        // Daemonize\n        pid_t pid = fork();\n        if (pid < 0)\n        {\n            fprintf(stderr, \"Error: fork() returned %d errno %d\\n\", pid, errno);\n            return false;\n        }\n        if (pid > 0)\n        {\n            CreatePidFile(GetPidFile(), pid);\n            return true;\n        }\n\n        pid_t sid = setsid();\n        if (sid < 0)\n            fprintf(stderr, \"Error: setsid() returned %d errno %d\\n\", sid, errno);\n    }\n#endif\n\n    if (GetBoolArg(\"-shrinkdebugfile\", !fDebug))\n        ShrinkDebugFile();\n    printf(\"\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\\n\");\n    printf(\"Halcyon version %s (%s)\\n\", FormatFullVersion().c_str(), CLIENT_DATE.c_str());\n    printf(\"Using OpenSSL version %s\\n\", SSLeay_version(SSLEAY_VERSION));\n    if (!fLogTimestamps)\n        printf(\"Startup time: %s\\n\", DateTimeStrFormat(\"%x %H:%M:%S\", GetTime()).c_str());\n    printf(\"Default data directory %s\\n\", GetDefaultDataDir().string().c_str());\n    printf(\"Used data directory %s\\n\", strDataDir.c_str());\n    std::ostringstream strErrors;\n\n    int64_t nStart;\n\n    // ********************************************************* Step 5: verify database integrity\n\n    uiInterface.InitMessage(_(\"Verifying database integrity...\"));\n\n    if (!bitdb.Open(GetDataDir()))\n    {\n        string msg = strprintf(_(\"Error initializing database environment %s!\"\n                                 \" To recover, BACKUP THAT DIRECTORY, then remove\"\n                                 \" everything from it except for wallet.dat.\"), strDataDir.c_str());\n        return InitError(msg);\n    }\n\n    if (GetBoolArg(\"-salvagewallet\"))\n    {\n        // Recover readable keypairs:\n        if (!CWalletDB::Recover(bitdb, strWalletFileName, true))\n            return false;\n    }\n\n    if (filesystem::exists(GetDataDir() / strWalletFileName))\n    {\n        CDBEnv::VerifyResult r = bitdb.Verify(strWalletFileName, CWalletDB::Recover);\n        if (r == CDBEnv::RECOVER_OK)\n        {\n            string msg = strprintf(_(\"Warning: wallet.dat corrupt, data salvaged!\"\n                                     \" Original wallet.dat saved as wallet.{timestamp}.bak in %s; if\"\n                                     \" your balance or transactions are incorrect you should\"\n                                     \" restore from a backup.\"), strDataDir.c_str());\n            uiInterface.ThreadSafeMessageBox(msg, _(\"Halcyon\"), CClientUIInterface::OK | CClientUIInterface::ICON_EXCLAMATION | CClientUIInterface::MODAL);\n        }\n        if (r == CDBEnv::RECOVER_FAIL)\n            return InitError(_(\"wallet.dat corrupt, salvage failed\"));\n    }\n\n    // ********************************************************* Step 6: network initialization\n\n    int nSocksVersion = GetArg(\"-socks\", 5);\n\n    if (nSocksVersion != 4 && nSocksVersion != 5)\n        return InitError(strprintf(_(\"Unknown -socks proxy version requested: %i\"), nSocksVersion));\n\n    if (mapArgs.count(\"-onlynet\")) {\n        std::set<enum Network> nets;\n        BOOST_FOREACH(std::string snet, mapMultiArgs[\"-onlynet\"]) {\n            enum Network net = ParseNetwork(snet);\n            if (net == NET_UNROUTABLE)\n                return InitError(strprintf(_(\"Unknown network specified in -onlynet: '%s'\"), snet.c_str()));\n            nets.insert(net);\n        }\n        for (int n = 0; n < NET_MAX; n++) {\n            enum Network net = (enum Network)n;\n            if (!nets.count(net))\n                SetLimited(net);\n        }\n    }\n#if defined(USE_IPV6)\n#if ! USE_IPV6\n    else\n        SetLimited(NET_IPV6);\n#endif\n#endif\n\n    CService addrProxy;\n    bool fProxy = false;\n    if (mapArgs.count(\"-proxy\")) {\n        addrProxy = CService(mapArgs[\"-proxy\"], 9050);\n        if (!addrProxy.IsValid())\n            return InitError(strprintf(_(\"Invalid -proxy address: '%s'\"), mapArgs[\"-proxy\"].c_str()));\n\n        if (!IsLimited(NET_IPV4))\n            SetProxy(NET_IPV4, addrProxy, nSocksVersion);\n        if (nSocksVersion > 4) {\n#ifdef USE_IPV6\n            if (!IsLimited(NET_IPV6))\n                SetProxy(NET_IPV6, addrProxy, nSocksVersion);\n#endif\n            SetNameProxy(addrProxy, nSocksVersion);\n        }\n        fProxy = true;\n    }\n\n    // -tor can override normal proxy, -notor disables tor entirely\n    if (!(mapArgs.count(\"-tor\") && mapArgs[\"-tor\"] == \"0\") && (fProxy || mapArgs.count(\"-tor\"))) {\n        CService addrOnion;\n        if (!mapArgs.count(\"-tor\"))\n            addrOnion = addrProxy;\n        else\n            addrOnion = CService(mapArgs[\"-tor\"], 9050);\n        if (!addrOnion.IsValid())\n            return InitError(strprintf(_(\"Invalid -tor address: '%s'\"), mapArgs[\"-tor\"].c_str()));\n        SetProxy(NET_TOR, addrOnion, 5);\n        SetReachable(NET_TOR);\n    }\n\n    // see Step 2: parameter interactions for more information about these\n    fNoListen = !GetBoolArg(\"-listen\", true);\n    fDiscover = GetBoolArg(\"-discover\", true);\n    fNameLookup = GetBoolArg(\"-dns\", true);\n#ifdef USE_UPNP\n    fUseUPnP = GetBoolArg(\"-upnp\", USE_UPNP);\n#endif\n\n    bool fBound = false;\n    if (!fNoListen)\n    {\n        std::string strError;\n        if (mapArgs.count(\"-bind\")) {\n            BOOST_FOREACH(std::string strBind, mapMultiArgs[\"-bind\"]) {\n                CService addrBind;\n                if (!Lookup(strBind.c_str(), addrBind, GetListenPort(), false))\n                    return InitError(strprintf(_(\"Cannot resolve -bind address: '%s'\"), strBind.c_str()));\n                fBound |= Bind(addrBind);\n            }\n        } else {\n            struct in_addr inaddr_any;\n            inaddr_any.s_addr = INADDR_ANY;\n#ifdef USE_IPV6\n            if (!IsLimited(NET_IPV6))\n                fBound |= Bind(CService(in6addr_any, GetListenPort()), false);\n#endif\n            if (!IsLimited(NET_IPV4))\n                fBound |= Bind(CService(inaddr_any, GetListenPort()), !fBound);\n        }\n        if (!fBound)\n            return InitError(_(\"Failed to listen on any port. Use -listen=0 if you want this.\"));\n    }\n\n    if (mapArgs.count(\"-externalip\"))\n    {\n        BOOST_FOREACH(string strAddr, mapMultiArgs[\"-externalip\"]) {\n            CService addrLocal(strAddr, GetListenPort(), fNameLookup);\n            if (!addrLocal.IsValid())\n                return InitError(strprintf(_(\"Cannot resolve -externalip address: '%s'\"), strAddr.c_str()));\n            AddLocal(CService(strAddr, GetListenPort(), fNameLookup), LOCAL_MANUAL);\n        }\n    }\n\n    if (mapArgs.count(\"-reservebalance\")) // ppcoin: reserve balance amount\n    {\n        if (!ParseMoney(mapArgs[\"-reservebalance\"], nReserveBalance))\n        {\n            InitError(_(\"Invalid amount for -reservebalance=<amount>\"));\n            return false;\n        }\n    }\n\n    if (mapArgs.count(\"-checkpointkey\")) // ppcoin: checkpoint master priv key\n    {\n        if (!Checkpoints::SetCheckpointPrivKey(GetArg(\"-checkpointkey\", \"\")))\n            InitError(_(\"Unable to sign checkpoint, wrong checkpointkey?\\n\"));\n    }\n\n    BOOST_FOREACH(string strDest, mapMultiArgs[\"-seednode\"])\n        AddOneShot(strDest);\n\n    // ********************************************************* Step 7: load blockchain\n\n    if (!bitdb.Open(GetDataDir()))\n    {\n        string msg = strprintf(_(\"Error initializing database environment %s!\"\n                                 \" To recover, BACKUP THAT DIRECTORY, then remove\"\n                                 \" everything from it except for wallet.dat.\"), strDataDir.c_str());\n        return InitError(msg);\n    }\n\n    if (GetBoolArg(\"-loadblockindextest\"))\n    {\n        CTxDB txdb(\"r\");\n        txdb.LoadBlockIndex();\n        PrintBlockTree();\n        return false;\n    }\n\n    uiInterface.InitMessage(_(\"Loading block index...\"));\n    printf(\"Loading block index...\\n\");\n    nStart = GetTimeMillis();\n    if (!LoadBlockIndex())\n        return InitError(_(\"Error loading blkindex.dat\"));\n\n\n    // as LoadBlockIndex can take several minutes, it's possible the user\n    // requested to kill bitcoin-qt during the last operation. If so, exit.\n    // As the program has not fully started yet, Shutdown() is possibly overkill.\n    if (fRequestShutdown)\n    {\n        printf(\"Shutdown requested. Exiting.\\n\");\n        return false;\n    }\n    printf(\" block index %15\"PRId64\"ms\\n\", GetTimeMillis() - nStart);\n\n    if (GetBoolArg(\"-printblockindex\") || GetBoolArg(\"-printblocktree\"))\n    {\n        PrintBlockTree();\n        return false;\n    }\n\n    if (mapArgs.count(\"-printblock\"))\n    {\n        string strMatch = mapArgs[\"-printblock\"];\n        int nFound = 0;\n        for (map<uint256, CBlockIndex*>::iterator mi = mapBlockIndex.begin(); mi != mapBlockIndex.end(); ++mi)\n        {\n            uint256 hash = (*mi).first;\n            if (strncmp(hash.ToString().c_str(), strMatch.c_str(), strMatch.size()) == 0)\n            {\n                CBlockIndex* pindex = (*mi).second;\n                CBlock block;\n                block.ReadFromDisk(pindex);\n                block.BuildMerkleTree();\n                block.print();\n                printf(\"\\n\");\n                nFound++;\n            }\n        }\n        if (nFound == 0)\n            printf(\"No blocks matching %s were found\\n\", strMatch.c_str());\n        return false;\n    }\n\n    // ********************************************************* Step 8: load wallet\n\n    uiInterface.InitMessage(_(\"Loading wallet...\"));\n    printf(\"Loading wallet...\\n\");\n    nStart = GetTimeMillis();\n    bool fFirstRun = true;\n    pwalletMain = new CWallet(strWalletFileName);\n    DBErrors nLoadWalletRet = pwalletMain->LoadWallet(fFirstRun);\n    if (nLoadWalletRet != DB_LOAD_OK)\n    {\n        if (nLoadWalletRet == DB_CORRUPT)\n            strErrors << _(\"Error loading wallet.dat: Wallet corrupted\") << \"\\n\";\n        else if (nLoadWalletRet == DB_NONCRITICAL_ERROR)\n        {\n            string msg(_(\"Warning: error reading wallet.dat! All keys read correctly, but transaction data\"\n                         \" or address book entries might be missing or incorrect.\"));\n            uiInterface.ThreadSafeMessageBox(msg, _(\"Halcyon\"), CClientUIInterface::OK | CClientUIInterface::ICON_EXCLAMATION | CClientUIInterface::MODAL);\n        }\n        else if (nLoadWalletRet == DB_TOO_NEW)\n            strErrors << _(\"Error loading wallet.dat: Wallet requires newer version of Halcyon\") << \"\\n\";\n        else if (nLoadWalletRet == DB_NEED_REWRITE)\n        {\n            strErrors << _(\"Wallet needed to be rewritten: restart Halcyon to complete\") << \"\\n\";\n            printf(\"%s\", strErrors.str().c_str());\n            return InitError(strErrors.str());\n        }\n        else\n            strErrors << _(\"Error loading wallet.dat\") << \"\\n\";\n    }\n\n    if (GetBoolArg(\"-upgradewallet\", fFirstRun))\n    {\n        int nMaxVersion = GetArg(\"-upgradewallet\", 0);\n        if (nMaxVersion == 0) // the -upgradewallet without argument case\n        {\n            printf(\"Performing wallet upgrade to %i\\n\", FEATURE_LATEST);\n            nMaxVersion = CLIENT_VERSION;\n            pwalletMain->SetMinVersion(FEATURE_LATEST); // permanently upgrade the wallet immediately\n        }\n        else\n            printf(\"Allowing wallet upgrade up to %i\\n\", nMaxVersion);\n        if (nMaxVersion < pwalletMain->GetVersion())\n            strErrors << _(\"Cannot downgrade wallet\") << \"\\n\";\n        pwalletMain->SetMaxVersion(nMaxVersion);\n    }\n\n    if (fFirstRun)\n    {\n        // Create new keyUser and set as default key\n        RandAddSeedPerfmon();\n\n        CPubKey newDefaultKey;\n        if (!pwalletMain->GetKeyFromPool(newDefaultKey, false))\n            strErrors << _(\"Cannot initialize keypool\") << \"\\n\";\n        pwalletMain->SetDefaultKey(newDefaultKey);\n        if (!pwalletMain->SetAddressBookName(pwalletMain->vchDefaultKey.GetID(), \"\"))\n            strErrors << _(\"Cannot write default address\") << \"\\n\";\n    }\n\n    printf(\"%s\", strErrors.str().c_str());\n    printf(\" wallet      %15\"PRId64\"ms\\n\", GetTimeMillis() - nStart);\n\n    RegisterWallet(pwalletMain);\n\n    CBlockIndex *pindexRescan = pindexBest;\n    if (GetBoolArg(\"-rescan\"))\n        pindexRescan = pindexGenesisBlock;\n    else\n    {\n        CWalletDB walletdb(strWalletFileName);\n        CBlockLocator locator;\n        if (walletdb.ReadBestBlock(locator))\n            pindexRescan = locator.GetBlockIndex();\n    }\n    if (pindexBest != pindexRescan && pindexBest && pindexRescan && pindexBest->nHeight > pindexRescan->nHeight)\n    {\n        uiInterface.InitMessage(_(\"Rescanning...\"));\n        printf(\"Rescanning last %i blocks (from block %i)...\\n\", pindexBest->nHeight - pindexRescan->nHeight, pindexRescan->nHeight);\n        nStart = GetTimeMillis();\n        pwalletMain->ScanForWalletTransactions(pindexRescan, true);\n        printf(\" rescan      %15\"PRId64\"ms\\n\", GetTimeMillis() - nStart);\n    }\n\n    // ********************************************************* Step 9: import blocks\n\n    if (mapArgs.count(\"-loadblock\"))\n    {\n        uiInterface.InitMessage(_(\"Importing blockchain data file.\"));\n\n        BOOST_FOREACH(string strFile, mapMultiArgs[\"-loadblock\"])\n        {\n            FILE *file = fopen(strFile.c_str(), \"rb\");\n            if (file)\n                LoadExternalBlockFile(file);\n        }\n        exit(0);\n    }\n\n    filesystem::path pathBootstrap = GetDataDir() / \"bootstrap.dat\";\n    if (filesystem::exists(pathBootstrap)) {\n        uiInterface.InitMessage(_(\"Importing bootstrap blockchain data file.\"));\n\n        FILE *file = fopen(pathBootstrap.string().c_str(), \"rb\");\n        if (file) {\n            filesystem::path pathBootstrapOld = GetDataDir() / \"bootstrap.dat.old\";\n            LoadExternalBlockFile(file);\n            RenameOver(pathBootstrap, pathBootstrapOld);\n        }\n    }\n\n    // ********************************************************* Step 10: load peers\n\n    uiInterface.InitMessage(_(\"Loading addresses...\"));\n    printf(\"Loading addresses...\\n\");\n    nStart = GetTimeMillis();\n\n    {\n        CAddrDB adb;\n        if (!adb.Read(addrman))\n            printf(\"Invalid or missing peers.dat; recreating\\n\");\n    }\n\n    printf(\"Loaded %i addresses from peers.dat  %\"PRId64\"ms\\n\",\n           addrman.size(), GetTimeMillis() - nStart);\n\n    // ********************************************************* Step 11: start node\n\n    if (!CheckDiskSpace())\n        return false;\n\n    RandAddSeedPerfmon();\n\n    //// debug print\n    printf(\"mapBlockIndex.size() = %\"PRIszu\"\\n\",   mapBlockIndex.size());\n    printf(\"nBestHeight = %d\\n\",            nBestHeight);\n    printf(\"setKeyPool.size() = %\"PRIszu\"\\n\",      pwalletMain->setKeyPool.size());\n    printf(\"mapWallet.size() = %\"PRIszu\"\\n\",       pwalletMain->mapWallet.size());\n    printf(\"mapAddressBook.size() = %\"PRIszu\"\\n\",  pwalletMain->mapAddressBook.size());\n\n    if (!NewThread(StartNode, NULL))\n        InitError(_(\"Error: could not start node\"));\n\n    if (fServer)\n        NewThread(ThreadRPCServer, NULL);\n\n    // ********************************************************* Step 12: finished\n\n    uiInterface.InitMessage(_(\"Done loading\"));\n    printf(\"Done loading\\n\");\n\n    if (!strErrors.str().empty())\n        return InitError(strErrors.str());\n\n     // Add wallet transactions that aren't already in a block to mapTransactions\n    pwalletMain->ReacceptWalletTransactions();\n\n#if !defined(QT_GUI)\n    // Loop until process is exit()ed from shutdown() function,\n    // called from ThreadRPCServer thread when a \"stop\" command is received.\n    while (1)\n        MilliSleep(5000);\n#endif\n\n    return true;\n}"
        }
      },
      {
        "call_info": {
          "callee": "GUIUtil::SetStartOnSystemStartup",
          "args": [
            "true"
          ],
          "line": 216
        },
        "resolved": true,
        "details": {
          "function_name": "SetStartOnSystemStartup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/guiutil.cpp",
          "lines": "413-413",
          "snippet": "bool SetStartOnSystemStartup(bool fAutoStart) { return false; }",
          "includes": [
            "#include \"shellapi.h\"",
            "#include \"shlobj.h\"",
            "#include \"shlwapi.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <QThread>",
            "#include <QDesktopServices>",
            "#include <QFileDialog>",
            "#include <QClipboard>",
            "#include <QApplication>",
            "#include <QAbstractItemView>",
            "#include <QTextDocument> // For Qt::escape",
            "#include <QUrl>",
            "#include <QLineEdit>",
            "#include <QFont>",
            "#include <QDoubleValidator>",
            "#include <QDateTime>",
            "#include <QString>",
            "#include \"init.h\"",
            "#include \"util.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"walletmodel.h\"",
            "#include \"bitcoinaddressvalidator.h\"",
            "#include \"guiutil.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shellapi.h\"\n#include \"shlobj.h\"\n#include \"shlwapi.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <QThread>\n#include <QDesktopServices>\n#include <QFileDialog>\n#include <QClipboard>\n#include <QApplication>\n#include <QAbstractItemView>\n#include <QTextDocument> // For Qt::escape\n#include <QUrl>\n#include <QLineEdit>\n#include <QFont>\n#include <QDoubleValidator>\n#include <QDateTime>\n#include <QString>\n#include \"init.h\"\n#include \"util.h\"\n#include \"bitcoinunits.h\"\n#include \"walletmodel.h\"\n#include \"bitcoinaddressvalidator.h\"\n#include \"guiutil.h\"\n\nbool SetStartOnSystemStartup(bool fAutoStart) { return false; }"
        }
      },
      {
        "call_info": {
          "callee": "GUIUtil::GetStartOnSystemStartup",
          "args": [],
          "line": 215
        },
        "resolved": true,
        "details": {
          "function_name": "GetStartOnSystemStartup",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/guiutil.cpp",
          "lines": "412-412",
          "snippet": "bool GetStartOnSystemStartup() { return false; }",
          "includes": [
            "#include \"shellapi.h\"",
            "#include \"shlobj.h\"",
            "#include \"shlwapi.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <QThread>",
            "#include <QDesktopServices>",
            "#include <QFileDialog>",
            "#include <QClipboard>",
            "#include <QApplication>",
            "#include <QAbstractItemView>",
            "#include <QTextDocument> // For Qt::escape",
            "#include <QUrl>",
            "#include <QLineEdit>",
            "#include <QFont>",
            "#include <QDoubleValidator>",
            "#include <QDateTime>",
            "#include <QString>",
            "#include \"init.h\"",
            "#include \"util.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"walletmodel.h\"",
            "#include \"bitcoinaddressvalidator.h\"",
            "#include \"guiutil.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shellapi.h\"\n#include \"shlobj.h\"\n#include \"shlwapi.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <QThread>\n#include <QDesktopServices>\n#include <QFileDialog>\n#include <QClipboard>\n#include <QApplication>\n#include <QAbstractItemView>\n#include <QTextDocument> // For Qt::escape\n#include <QUrl>\n#include <QLineEdit>\n#include <QFont>\n#include <QDoubleValidator>\n#include <QDateTime>\n#include <QString>\n#include \"init.h\"\n#include \"util.h\"\n#include \"bitcoinunits.h\"\n#include \"walletmodel.h\"\n#include \"bitcoinaddressvalidator.h\"\n#include \"guiutil.h\"\n\nbool GetStartOnSystemStartup() { return false; }"
        }
      },
      {
        "call_info": {
          "callee": "app.setQuitOnLastWindowClosed",
          "args": [
            "false"
          ],
          "line": 210
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "app.processEvents",
          "args": [],
          "line": 208
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splash.show",
          "args": [],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetBoolArg",
          "args": [
            "\"-min\""
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetBoolArg",
          "args": [
            "\"-splash\"",
            "true"
          ],
          "line": 202
        },
        "resolved": true,
        "details": {
          "function_name": "GetBoolArg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "569-578",
          "snippet": "bool GetBoolArg(const std::string& strArg, bool fDefault)\n{\n    if (mapArgs.count(strArg))\n    {\n        if (mapArgs[strArg].empty())\n            return true;\n        return (atoi(mapArgs[strArg]) != 0);\n    }\n    return fDefault;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "map<string, string> mapArgs;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nmap<string, string> mapArgs;\n\nbool GetBoolArg(const std::string& strArg, bool fDefault)\n{\n    if (mapArgs.count(strArg))\n    {\n        if (mapArgs[strArg].empty())\n            return true;\n        return (atoi(mapArgs[strArg]) != 0);\n    }\n    return fDefault;\n}"
        }
      },
      {
        "call_info": {
          "callee": "QPixmap",
          "args": [
            "\":/images/splash\""
          ],
          "line": 201
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "help.showOrPrint",
          "args": [],
          "line": 197
        },
        "resolved": true,
        "details": {
          "function_name": "showOrPrint",
          "container": "HelpMessageBox",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/guiutil.cpp",
          "lines": "446-455",
          "snippet": "void HelpMessageBox::showOrPrint()\n{\n#if defined(WIN32)\n        // On Windows, show a message box, as there is no stderr/stdout in windowed applications\n        exec();\n#else\n        // On other operating systems, print help text to console\n        printToConsole();\n#endif\n}",
          "includes": [
            "#include \"shellapi.h\"",
            "#include \"shlobj.h\"",
            "#include \"shlwapi.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <QThread>",
            "#include <QDesktopServices>",
            "#include <QFileDialog>",
            "#include <QClipboard>",
            "#include <QApplication>",
            "#include <QAbstractItemView>",
            "#include <QTextDocument> // For Qt::escape",
            "#include <QUrl>",
            "#include <QLineEdit>",
            "#include <QFont>",
            "#include <QDoubleValidator>",
            "#include <QDateTime>",
            "#include <QString>",
            "#include \"init.h\"",
            "#include \"util.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"walletmodel.h\"",
            "#include \"bitcoinaddressvalidator.h\"",
            "#include \"guiutil.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shellapi.h\"\n#include \"shlobj.h\"\n#include \"shlwapi.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <QThread>\n#include <QDesktopServices>\n#include <QFileDialog>\n#include <QClipboard>\n#include <QApplication>\n#include <QAbstractItemView>\n#include <QTextDocument> // For Qt::escape\n#include <QUrl>\n#include <QLineEdit>\n#include <QFont>\n#include <QDoubleValidator>\n#include <QDateTime>\n#include <QString>\n#include \"init.h\"\n#include \"util.h\"\n#include \"bitcoinunits.h\"\n#include \"walletmodel.h\"\n#include \"bitcoinaddressvalidator.h\"\n#include \"guiutil.h\"\n\nHelpMessageBox {\n  void HelpMessageBox::showOrPrint()\n  {\n  #if defined(WIN32)\n          // On Windows, show a message box, as there is no stderr/stdout in windowed applications\n          exec();\n  #else\n          // On other operating systems, print help text to console\n          printToConsole();\n  #endif\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "mapArgs.count",
          "args": [
            "\"--help\""
          ],
          "line": 194
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "uiInterface.Translate.connect",
          "args": [
            "Translate"
          ],
          "line": 190
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uiInterface.QueueShutdown.connect",
          "args": [
            "QueueShutdown"
          ],
          "line": 189
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uiInterface.InitMessage.connect",
          "args": [
            "InitMessage"
          ],
          "line": 188
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uiInterface.ThreadSafeHandleURI.connect",
          "args": [
            "ThreadSafeHandleURI"
          ],
          "line": 187
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uiInterface.ThreadSafeAskFee.connect",
          "args": [
            "ThreadSafeAskFee"
          ],
          "line": 186
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uiInterface.ThreadSafeMessageBox.connect",
          "args": [
            "ThreadSafeMessageBox"
          ],
          "line": 185
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "app.installTranslator",
          "args": [
            "&translator"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "translator.load",
          "args": [
            "lang_territory",
            "\":/translations/\""
          ],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "app.installTranslator",
          "args": [
            "&translatorBase"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "translatorBase.load",
          "args": [
            "lang",
            "\":/translations/\""
          ],
          "line": 177
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "app.installTranslator",
          "args": [
            "&qtTranslator"
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qtTranslator.load",
          "args": [
            "\"qt_\" + lang_territory",
            "QLibraryInfo::location(QLibraryInfo::TranslationsPath)"
          ],
          "line": 173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QLibraryInfo::location",
          "args": [
            "QLibraryInfo::TranslationsPath"
          ],
          "line": 173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "app.installTranslator",
          "args": [
            "&qtTranslatorBase"
          ],
          "line": 170
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "qtTranslatorBase.load",
          "args": [
            "\"qt_\" + lang",
            "QLibraryInfo::location(QLibraryInfo::TranslationsPath)"
          ],
          "line": 169
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QLibraryInfo::location",
          "args": [
            "QLibraryInfo::TranslationsPath"
          ],
          "line": 169
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lang.truncate",
          "args": [
            "lang_territory.lastIndexOf('_')"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "lang_territory.lastIndexOf",
          "args": [
            "'_'"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString::fromStdString",
          "args": [
            "GetArg(\"-lang\", QLocale::system().name().toStdString())"
          ],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetArg",
          "args": [
            "\"-lang\"",
            "QLocale::system().name().toStdString()"
          ],
          "line": 158
        },
        "resolved": true,
        "details": {
          "function_name": "GetArg",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "562-567",
          "snippet": "int64_t GetArg(const std::string& strArg, int64_t nDefault)\n{\n    if (mapArgs.count(strArg))\n        return atoi64(mapArgs[strArg]);\n    return nDefault;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "map<string, string> mapArgs;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nmap<string, string> mapArgs;\n\nint64_t GetArg(const std::string& strArg, int64_t nDefault)\n{\n    if (mapArgs.count(strArg))\n        return atoi64(mapArgs[strArg]);\n    return nDefault;\n}"
        }
      },
      {
        "call_info": {
          "callee": "QLocale::system",
          "args": [],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QLocale::system",
          "args": [],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QLocale::system",
          "args": [],
          "line": 158
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "app.setApplicationName",
          "args": [
            "\"Halcyon-Qt\""
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "app.setApplicationName",
          "args": [
            "\"Halcyon-Qt-testnet\""
          ],
          "line": 150
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetBoolArg",
          "args": [
            "\"-testnet\""
          ],
          "line": 149
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "app.setOrganizationName",
          "args": [
            "\"Halcyon\""
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ReadConfigFile",
          "args": [
            "mapArgs",
            "mapMultiArgs"
          ],
          "line": 143
        },
        "resolved": true,
        "details": {
          "function_name": "ReadConfigFile",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "1087-1109",
          "snippet": "void ReadConfigFile(map<string, string>& mapSettingsRet,\n                    map<string, vector<string> >& mapMultiSettingsRet)\n{\n    boost::filesystem::ifstream streamConfig(GetConfigFile());\n    if (!streamConfig.good())\n        return; // No bitcoin.conf file is OK\n\n    set<string> setOptions;\n    setOptions.insert(\"*\");\n\n    for (boost::program_options::detail::config_file_iterator it(streamConfig, setOptions), end; it != end; ++it)\n    {\n        // Don't overwrite existing settings so command line settings override bitcoin.conf\n        string strKey = string(\"-\") + it->string_key;\n        if (mapSettingsRet.count(strKey) == 0)\n        {\n            mapSettingsRet[strKey] = it->value[0];\n            // interpret nofoo=1 as foo=0 (and nofoo=0 as foo=1) as long as foo not set)\n            InterpretNegativeSetting(strKey, mapSettingsRet);\n        }\n        mapMultiSettingsRet[strKey].push_back(it->value[0]);\n    }\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nvoid ReadConfigFile(map<string, string>& mapSettingsRet,\n                    map<string, vector<string> >& mapMultiSettingsRet)\n{\n    boost::filesystem::ifstream streamConfig(GetConfigFile());\n    if (!streamConfig.good())\n        return; // No bitcoin.conf file is OK\n\n    set<string> setOptions;\n    setOptions.insert(\"*\");\n\n    for (boost::program_options::detail::config_file_iterator it(streamConfig, setOptions), end; it != end; ++it)\n    {\n        // Don't overwrite existing settings so command line settings override bitcoin.conf\n        string strKey = string(\"-\") + it->string_key;\n        if (mapSettingsRet.count(strKey) == 0)\n        {\n            mapSettingsRet[strKey] = it->value[0];\n            // interpret nofoo=1 as foo=0 (and nofoo=0 as foo=1) as long as foo not set)\n            InterpretNegativeSetting(strKey, mapSettingsRet);\n        }\n        mapMultiSettingsRet[strKey].push_back(it->value[0]);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "QMessageBox::critical",
          "args": [
            "0",
            "\"Halcyon\"",
            "QString(\"Error: Specified data directory \\\"%1\\\" does not exist.\").arg(QString::fromStdString(mapArgs[\"-datadir\"]))"
          ],
          "line": 139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString",
          "args": [
            "QString::fromStdString(mapArgs[\"-datadir\"])"
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString::fromStdString",
          "args": [
            "mapArgs[\"-datadir\"]"
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString",
          "args": [
            "\"Error: Specified data directory \\\"%1\\\" does not exist.\""
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "boost::filesystem::is_directory",
          "args": [
            "GetDataDir(false)"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetDataDir",
          "args": [
            "false"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ParseParameters",
          "args": [
            "argc",
            "argv"
          ],
          "line": 132
        },
        "resolved": true,
        "details": {
          "function_name": "ParseParameters",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "510-553",
          "snippet": "void ParseParameters(int argc, const char* const argv[])\n{\n    mapArgs.clear();\n    mapMultiArgs.clear();\n    for (int i = 1; i < argc; i++)\n    {\n        char psz[10000];\n        strlcpy(psz, argv[i], sizeof(psz));\n        char* pszValue = (char*)\"\";\n        if (strchr(psz, '='))\n        {\n            pszValue = strchr(psz, '=');\n            *pszValue++ = '\\0';\n        }\n        #ifdef WIN32\n        _strlwr(psz);\n        if (psz[0] == '/')\n            psz[0] = '-';\n        #endif\n        if (psz[0] != '-')\n            break;\n\n        mapArgs[psz] = pszValue;\n        mapMultiArgs[psz].push_back(pszValue);\n    }\n\n    // New 0.6 features:\n    BOOST_FOREACH(const PAIRTYPE(string,string)& entry, mapArgs)\n    {\n        string name = entry.first;\n\n        //  interpret --foo as -foo (as long as both are not set)\n        if (name.find(\"--\") == 0)\n        {\n            std::string singleDash(name.begin()+1, name.end());\n            if (mapArgs.count(singleDash) == 0)\n                mapArgs[singleDash] = entry.second;\n            name = singleDash;\n        }\n\n        // interpret -nofoo as -foo=0 (and -nofoo=0 as -foo=1) as long as -foo not set\n        InterpretNegativeSetting(name, mapArgs);\n    }\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "map<string, string> mapArgs;",
            "map<string, vector<string> > mapMultiArgs;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nmap<string, string> mapArgs;\nmap<string, vector<string> > mapMultiArgs;\n\nvoid ParseParameters(int argc, const char* const argv[])\n{\n    mapArgs.clear();\n    mapMultiArgs.clear();\n    for (int i = 1; i < argc; i++)\n    {\n        char psz[10000];\n        strlcpy(psz, argv[i], sizeof(psz));\n        char* pszValue = (char*)\"\";\n        if (strchr(psz, '='))\n        {\n            pszValue = strchr(psz, '=');\n            *pszValue++ = '\\0';\n        }\n        #ifdef WIN32\n        _strlwr(psz);\n        if (psz[0] == '/')\n            psz[0] = '-';\n        #endif\n        if (psz[0] != '-')\n            break;\n\n        mapArgs[psz] = pszValue;\n        mapMultiArgs[psz].push_back(pszValue);\n    }\n\n    // New 0.6 features:\n    BOOST_FOREACH(const PAIRTYPE(string,string)& entry, mapArgs)\n    {\n        string name = entry.first;\n\n        //  interpret --foo as -foo (as long as both are not set)\n        if (name.find(\"--\") == 0)\n        {\n            std::string singleDash(name.begin()+1, name.end());\n            if (mapArgs.count(singleDash) == 0)\n                mapArgs[singleDash] = entry.second;\n            name = singleDash;\n        }\n\n        // interpret -nofoo as -foo=0 (and -nofoo=0 as -foo=1) as long as -foo not set\n        InterpretNegativeSetting(name, mapArgs);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "app.installEventFilter",
          "args": [
            "new GUIUtil::ToolTipToRichTextFilter(TOOLTIP_WRAP_THRESHOLD, &app)"
          ],
          "line": 129
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Q_INIT_RESOURCE",
          "args": [
            "bitcoin"
          ],
          "line": 125
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QTextCodec::setCodecForCStrings",
          "args": [
            "QTextCodec::codecForTr()"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QTextCodec::codecForTr",
          "args": [],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QTextCodec::setCodecForTr",
          "args": [
            "QTextCodec::codecForName(\"UTF-8\")"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QTextCodec::codecForName",
          "args": [
            "\"UTF-8\""
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ipcScanRelay",
          "args": [
            "argc",
            "argv"
          ],
          "line": 117
        },
        "resolved": true,
        "details": {
          "function_name": "ipcScanRelay",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/qtipcserver.cpp",
          "lines": "69-73",
          "snippet": "void ipcScanRelay(int argc, char *argv[])\n{\n    if (ipcScanCmd(argc, argv, true))\n        exit(0);\n}",
          "includes": [
            "#include <boost/version.hpp>",
            "#include <boost/interprocess/ipc/message_queue.hpp>",
            "#include <boost/date_time/posix_time/posix_time.hpp>",
            "#include <boost/algorithm/string/predicate.hpp>",
            "#include \"util.h\"",
            "#include \"ui_interface.h\"",
            "#include \"guiconstants.h\"",
            "#include \"qtipcserver.h\"",
            "#include <boost/version.hpp>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/version.hpp>\n#include <boost/interprocess/ipc/message_queue.hpp>\n#include <boost/date_time/posix_time/posix_time.hpp>\n#include <boost/algorithm/string/predicate.hpp>\n#include \"util.h\"\n#include \"ui_interface.h\"\n#include \"guiconstants.h\"\n#include \"qtipcserver.h\"\n#include <boost/version.hpp>\n\nvoid ipcScanRelay(int argc, char *argv[])\n{\n    if (ipcScanCmd(argc, argv, true))\n        exit(0);\n}"
        }
      }
    ],
    "contextual_snippet": "#include <QtPlugin>\n#include <QLibraryInfo>\n#include <QSplashScreen>\n#include <QTranslator>\n#include <QLocale>\n#include <QTextCodec>\n#include <QMessageBox>\n#include <QApplication>\n#include \"qtipcserver.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"guiconstants.h\"\n#include \"guiutil.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"clientmodel.h\"\n#include \"bitcoingui.h\"\n\nstatic BitcoinGUI *guiref;\nstatic QSplashScreen *splashref;\n\nint main(int argc, char *argv[])\n{\n    // Do this early as we don't want to bother initializing if we are just calling IPC\n    ipcScanRelay(argc, argv);\n\n#if QT_VERSION < 0x050000\n    // Internal string conversion is all UTF-8\n    QTextCodec::setCodecForTr(QTextCodec::codecForName(\"UTF-8\"));\n    QTextCodec::setCodecForCStrings(QTextCodec::codecForTr());\n#endif\n\n    Q_INIT_RESOURCE(bitcoin);\n    QApplication app(argc, argv);\n\n    // Install global event filter that makes sure that long tooltips can be word-wrapped\n    app.installEventFilter(new GUIUtil::ToolTipToRichTextFilter(TOOLTIP_WRAP_THRESHOLD, &app));\n\n    // Command-line options take precedence:\n    ParseParameters(argc, argv);\n\n    // ... then bitcoin.conf:\n    if (!boost::filesystem::is_directory(GetDataDir(false)))\n    {\n        // This message can not be translated, as translation is not initialized yet\n        // (which not yet possible because lang=XX can be overridden in bitcoin.conf in the data directory)\n        QMessageBox::critical(0, \"Halcyon\",\n                              QString(\"Error: Specified data directory \\\"%1\\\" does not exist.\").arg(QString::fromStdString(mapArgs[\"-datadir\"])));\n        return 1;\n    }\n    ReadConfigFile(mapArgs, mapMultiArgs);\n\n    // Application identification (must be set before OptionsModel is initialized,\n    // as it is used to locate QSettings)\n    app.setOrganizationName(\"Halcyon\");\n    //XXX app.setOrganizationDomain(\"\");\n    if(GetBoolArg(\"-testnet\")) // Separate UI settings for testnet\n        app.setApplicationName(\"Halcyon-Qt-testnet\");\n    else\n        app.setApplicationName(\"Halcyon-Qt\");\n\n    // ... then GUI settings:\n    OptionsModel optionsModel;\n\n    // Get desired locale (e.g. \"de_DE\") from command line or use system locale\n    QString lang_territory = QString::fromStdString(GetArg(\"-lang\", QLocale::system().name().toStdString()));\n    QString lang = lang_territory;\n    // Convert to \"de\" only by truncating \"_DE\"\n    lang.truncate(lang_territory.lastIndexOf('_'));\n\n    QTranslator qtTranslatorBase, qtTranslator, translatorBase, translator;\n    // Load language files for configured locale:\n    // - First load the translator for the base language, without territory\n    // - Then load the more specific locale translator\n\n    // Load e.g. qt_de.qm\n    if (qtTranslatorBase.load(\"qt_\" + lang, QLibraryInfo::location(QLibraryInfo::TranslationsPath)))\n        app.installTranslator(&qtTranslatorBase);\n\n    // Load e.g. qt_de_DE.qm\n    if (qtTranslator.load(\"qt_\" + lang_territory, QLibraryInfo::location(QLibraryInfo::TranslationsPath)))\n        app.installTranslator(&qtTranslator);\n\n    // Load e.g. bitcoin_de.qm (shortcut \"de\" needs to be defined in bitcoin.qrc)\n    if (translatorBase.load(lang, \":/translations/\"))\n        app.installTranslator(&translatorBase);\n\n    // Load e.g. bitcoin_de_DE.qm (shortcut \"de_DE\" needs to be defined in bitcoin.qrc)\n    if (translator.load(lang_territory, \":/translations/\"))\n        app.installTranslator(&translator);\n\n    // Subscribe to global signals from core\n    uiInterface.ThreadSafeMessageBox.connect(ThreadSafeMessageBox);\n    uiInterface.ThreadSafeAskFee.connect(ThreadSafeAskFee);\n    uiInterface.ThreadSafeHandleURI.connect(ThreadSafeHandleURI);\n    uiInterface.InitMessage.connect(InitMessage);\n    uiInterface.QueueShutdown.connect(QueueShutdown);\n    uiInterface.Translate.connect(Translate);\n\n    // Show help message immediately after parsing command-line options (for \"-lang\") and setting locale,\n    // but before showing splash screen.\n    if (mapArgs.count(\"-?\") || mapArgs.count(\"--help\"))\n    {\n        GUIUtil::HelpMessageBox help;\n        help.showOrPrint();\n        return 1;\n    }\n\n    QSplashScreen splash(QPixmap(\":/images/splash\"), 0);\n    if (GetBoolArg(\"-splash\", true) && !GetBoolArg(\"-min\"))\n    {\n        splash.show();\n        splashref = &splash;\n    }\n\n    app.processEvents();\n\n    app.setQuitOnLastWindowClosed(false);\n\n    try\n    {\n        // Regenerate startup link, to fix links to old versions\n        if (GUIUtil::GetStartOnSystemStartup())\n            GUIUtil::SetStartOnSystemStartup(true);\n\n        BitcoinGUI window;\n        guiref = &window;\n        if(AppInit2())\n        {\n            {\n                // Put this in a block, so that the Model objects are cleaned up before\n                // calling Shutdown().\n\n                optionsModel.Upgrade(); // Must be done after AppInit2\n\n                if (splashref)\n                    splash.finish(&window);\n\n                ClientModel clientModel(&optionsModel);\n                WalletModel walletModel(pwalletMain, &optionsModel);\n\n                window.setClientModel(&clientModel);\n                window.setWalletModel(&walletModel);\n\n                // If -min option passed, start window minimized.\n                if(GetBoolArg(\"-min\"))\n                {\n                    window.showMinimized();\n                }\n                else\n                {\n                    window.show();\n                }\n\n                // Place this here as guiref has to be defined if we don't want to lose URIs\n                ipcInit(argc, argv);\n\n                app.exec();\n\n                window.hide();\n                window.setClientModel(0);\n                window.setWalletModel(0);\n                guiref = 0;\n            }\n            // Shutdown the core and its threads, but don't exit Bitcoin-Qt here\n            Shutdown(NULL);\n        }\n        else\n        {\n            return 1;\n        }\n    } catch (std::exception& e) {\n        handleRunawayException(&e);\n    } catch (...) {\n        handleRunawayException(NULL);\n    }\n    return 0;\n}"
  },
  {
    "function_name": "handleRunawayException",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/bitcoin.cpp",
    "lines": "106-111",
    "snippet": "static void handleRunawayException(std::exception *e)\n{\n    PrintExceptionContinue(e, \"Runaway exception\");\n    QMessageBox::critical(0, \"Runaway exception\", BitcoinGUI::tr(\"A fatal error occurred. Halcyon can no longer continue safely and will quit.\") + QString(\"\\n\\n\") + QString::fromStdString(strMiscWarning));\n    exit(1);\n}",
    "includes": [
      "#include <QtPlugin>",
      "#include <QLibraryInfo>",
      "#include <QSplashScreen>",
      "#include <QTranslator>",
      "#include <QLocale>",
      "#include <QTextCodec>",
      "#include <QMessageBox>",
      "#include <QApplication>",
      "#include \"qtipcserver.h\"",
      "#include \"ui_interface.h\"",
      "#include \"init.h\"",
      "#include \"guiconstants.h\"",
      "#include \"guiutil.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"walletmodel.h\"",
      "#include \"clientmodel.h\"",
      "#include \"bitcoingui.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "1"
          ],
          "line": 110
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QMessageBox::critical",
          "args": [
            "0",
            "\"Runaway exception\"",
            "BitcoinGUI::tr(\"A fatal error occurred. Halcyon can no longer continue safely and will quit.\") + QString(\"\\n\\n\") + QString::fromStdString(strMiscWarning)"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString::fromStdString",
          "args": [
            "strMiscWarning"
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString",
          "args": [
            "\"\\n\\n\""
          ],
          "line": 109
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "BitcoinGUI::tr",
          "args": [
            "\"A fatal error occurred. Halcyon can no longer continue safely and will quit.\""
          ],
          "line": 109
        },
        "resolved": true,
        "details": {
          "function_name": "trayIconActivated",
          "container": "BitcoinGUI",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/bitcoingui.cpp",
          "lines": "477-484",
          "snippet": "void BitcoinGUI::trayIconActivated(QSystemTrayIcon::ActivationReason reason)\n{\n    if(reason == QSystemTrayIcon::Trigger)\n    {\n        // Click on system tray icon triggers show/hide of the main window\n        toggleHideAction->trigger();\n    }\n}",
          "includes": [
            "#include <iostream>",
            "#include <QStyle>",
            "#include <QUrl>",
            "#include <QDragEnterEvent>",
            "#include <QTimer>",
            "#include <QDesktopServices>",
            "#include <QFileDialog>",
            "#include <QMovie>",
            "#include <QDateTime>",
            "#include <QStackedWidget>",
            "#include <QProgressBar>",
            "#include <QMimeData>",
            "#include <QMessageBox>",
            "#include <QLocale>",
            "#include <QPushButton>",
            "#include <QLineEdit>",
            "#include <QLabel>",
            "#include <QStatusBar>",
            "#include <QToolBar>",
            "#include <QVBoxLayout>",
            "#include <QTabWidget>",
            "#include <QIcon>",
            "#include <QMenu>",
            "#include <QMenuBar>",
            "#include <QMainWindow>",
            "#include <QApplication>",
            "#include \"macdockiconhandler.h\"",
            "#include \"blockexplorer.h\"",
            "#include \"wallet.h\"",
            "#include \"rpcconsole.h\"",
            "#include \"guiutil.h\"",
            "#include \"notificator.h\"",
            "#include \"askpassphrasedialog.h\"",
            "#include \"guiconstants.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"overviewpage.h\"",
            "#include \"transactionview.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"transactiondescdialog.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"editaddressdialog.h\"",
            "#include \"walletmodel.h\"",
            "#include \"clientmodel.h\"",
            "#include \"aboutdialog.h\"",
            "#include \"optionsdialog.h\"",
            "#include \"signverifymessagedialog.h\"",
            "#include \"sendcoinsdialog.h\"",
            "#include \"addressbookpage.h\"",
            "#include \"transactiontablemodel.h\"",
            "#include \"bitcoingui.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <iostream>\n#include <QStyle>\n#include <QUrl>\n#include <QDragEnterEvent>\n#include <QTimer>\n#include <QDesktopServices>\n#include <QFileDialog>\n#include <QMovie>\n#include <QDateTime>\n#include <QStackedWidget>\n#include <QProgressBar>\n#include <QMimeData>\n#include <QMessageBox>\n#include <QLocale>\n#include <QPushButton>\n#include <QLineEdit>\n#include <QLabel>\n#include <QStatusBar>\n#include <QToolBar>\n#include <QVBoxLayout>\n#include <QTabWidget>\n#include <QIcon>\n#include <QMenu>\n#include <QMenuBar>\n#include <QMainWindow>\n#include <QApplication>\n#include \"macdockiconhandler.h\"\n#include \"blockexplorer.h\"\n#include \"wallet.h\"\n#include \"rpcconsole.h\"\n#include \"guiutil.h\"\n#include \"notificator.h\"\n#include \"askpassphrasedialog.h\"\n#include \"guiconstants.h\"\n#include \"bitcoinunits.h\"\n#include \"overviewpage.h\"\n#include \"transactionview.h\"\n#include \"addresstablemodel.h\"\n#include \"transactiondescdialog.h\"\n#include \"optionsmodel.h\"\n#include \"editaddressdialog.h\"\n#include \"walletmodel.h\"\n#include \"clientmodel.h\"\n#include \"aboutdialog.h\"\n#include \"optionsdialog.h\"\n#include \"signverifymessagedialog.h\"\n#include \"sendcoinsdialog.h\"\n#include \"addressbookpage.h\"\n#include \"transactiontablemodel.h\"\n#include \"bitcoingui.h\"\n\nBitcoinGUI {\n  void BitcoinGUI::trayIconActivated(QSystemTrayIcon::ActivationReason reason)\n  {\n      if(reason == QSystemTrayIcon::Trigger)\n      {\n          // Click on system tray icon triggers show/hide of the main window\n          toggleHideAction->trigger();\n      }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "PrintExceptionContinue",
          "args": [
            "e",
            "\"Runaway exception\""
          ],
          "line": 108
        },
        "resolved": true,
        "details": {
          "function_name": "PrintExceptionContinue",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/util.cpp",
          "lines": "1005-1011",
          "snippet": "void PrintExceptionContinue(std::exception* pex, const char* pszThread)\n{\n    std::string message = FormatException(pex, pszThread);\n    printf(\"\\n\\n************************\\n%s\\n\", message.c_str());\n    fprintf(stderr, \"\\n\\n************************\\n%s\\n\", message.c_str());\n    strMiscWarning = message;\n}",
          "includes": [
            "#include <execinfo.h>",
            "# include <sys/prctl.h>",
            "#include \"shlobj.h\"",
            "#include <io.h> /* for _commit */",
            "#include <stdarg.h>",
            "#include <openssl/rand.h>",
            "#include <openssl/crypto.h>",
            "#include <boost/thread.hpp>",
            "#include <boost/foreach.hpp>",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/program_options/parsers.hpp>",
            "#include <boost/program_options/detail/config_file.hpp>",
            "#include <boost/algorithm/string/join.hpp>",
            "#include \"ui_interface.h\"",
            "#include \"version.h\"",
            "#include \"strlcpy.h\"",
            "#include \"sync.h\"",
            "#include \"util.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "string strMiscWarning;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <execinfo.h>\n# include <sys/prctl.h>\n#include \"shlobj.h\"\n#include <io.h> /* for _commit */\n#include <stdarg.h>\n#include <openssl/rand.h>\n#include <openssl/crypto.h>\n#include <boost/thread.hpp>\n#include <boost/foreach.hpp>\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/program_options/parsers.hpp>\n#include <boost/program_options/detail/config_file.hpp>\n#include <boost/algorithm/string/join.hpp>\n#include \"ui_interface.h\"\n#include \"version.h\"\n#include \"strlcpy.h\"\n#include \"sync.h\"\n#include \"util.h\"\n\nstring strMiscWarning;\n\nvoid PrintExceptionContinue(std::exception* pex, const char* pszThread)\n{\n    std::string message = FormatException(pex, pszThread);\n    printf(\"\\n\\n************************\\n%s\\n\", message.c_str());\n    fprintf(stderr, \"\\n\\n************************\\n%s\\n\", message.c_str());\n    strMiscWarning = message;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <QtPlugin>\n#include <QLibraryInfo>\n#include <QSplashScreen>\n#include <QTranslator>\n#include <QLocale>\n#include <QTextCodec>\n#include <QMessageBox>\n#include <QApplication>\n#include \"qtipcserver.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"guiconstants.h\"\n#include \"guiutil.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"clientmodel.h\"\n#include \"bitcoingui.h\"\n\nstatic void handleRunawayException(std::exception *e)\n{\n    PrintExceptionContinue(e, \"Runaway exception\");\n    QMessageBox::critical(0, \"Runaway exception\", BitcoinGUI::tr(\"A fatal error occurred. Halcyon can no longer continue safely and will quit.\") + QString(\"\\n\\n\") + QString::fromStdString(strMiscWarning));\n    exit(1);\n}"
  },
  {
    "function_name": "Translate",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/bitcoin.cpp",
    "lines": "99-102",
    "snippet": "static std::string Translate(const char* psz)\n{\n    return QCoreApplication::translate(\"bitcoin-core\", psz).toStdString();\n}",
    "includes": [
      "#include <QtPlugin>",
      "#include <QLibraryInfo>",
      "#include <QSplashScreen>",
      "#include <QTranslator>",
      "#include <QLocale>",
      "#include <QTextCodec>",
      "#include <QMessageBox>",
      "#include <QApplication>",
      "#include \"qtipcserver.h\"",
      "#include \"ui_interface.h\"",
      "#include \"init.h\"",
      "#include \"guiconstants.h\"",
      "#include \"guiutil.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"walletmodel.h\"",
      "#include \"clientmodel.h\"",
      "#include \"bitcoingui.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "QCoreApplication::translate",
          "args": [],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QCoreApplication::translate",
          "args": [
            "\"bitcoin-core\"",
            "psz"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QtPlugin>\n#include <QLibraryInfo>\n#include <QSplashScreen>\n#include <QTranslator>\n#include <QLocale>\n#include <QTextCodec>\n#include <QMessageBox>\n#include <QApplication>\n#include \"qtipcserver.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"guiconstants.h\"\n#include \"guiutil.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"clientmodel.h\"\n#include \"bitcoingui.h\"\n\nstatic std::string Translate(const char* psz)\n{\n    return QCoreApplication::translate(\"bitcoin-core\", psz).toStdString();\n}"
  },
  {
    "function_name": "QueueShutdown",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/bitcoin.cpp",
    "lines": "91-94",
    "snippet": "static void QueueShutdown()\n{\n    QMetaObject::invokeMethod(QCoreApplication::instance(), \"quit\", Qt::QueuedConnection);\n}",
    "includes": [
      "#include <QtPlugin>",
      "#include <QLibraryInfo>",
      "#include <QSplashScreen>",
      "#include <QTranslator>",
      "#include <QLocale>",
      "#include <QTextCodec>",
      "#include <QMessageBox>",
      "#include <QApplication>",
      "#include \"qtipcserver.h\"",
      "#include \"ui_interface.h\"",
      "#include \"init.h\"",
      "#include \"guiconstants.h\"",
      "#include \"guiutil.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"walletmodel.h\"",
      "#include \"clientmodel.h\"",
      "#include \"bitcoingui.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "QMetaObject::invokeMethod",
          "args": [
            "QCoreApplication::instance()",
            "\"quit\"",
            "Qt::QueuedConnection"
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QCoreApplication::instance",
          "args": [],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QtPlugin>\n#include <QLibraryInfo>\n#include <QSplashScreen>\n#include <QTranslator>\n#include <QLocale>\n#include <QTextCodec>\n#include <QMessageBox>\n#include <QApplication>\n#include \"qtipcserver.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"guiconstants.h\"\n#include \"guiutil.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"clientmodel.h\"\n#include \"bitcoingui.h\"\n\nstatic void QueueShutdown()\n{\n    QMetaObject::invokeMethod(QCoreApplication::instance(), \"quit\", Qt::QueuedConnection);\n}"
  },
  {
    "function_name": "InitMessage",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/bitcoin.cpp",
    "lines": "82-89",
    "snippet": "static void InitMessage(const std::string &message)\n{\n    if(splashref)\n    {\n        splashref->showMessage(QString::fromStdString(message), Qt::AlignBottom|Qt::AlignHCenter, QColor(255,255,255));\n        QApplication::instance()->processEvents();\n    }\n}",
    "includes": [
      "#include <QtPlugin>",
      "#include <QLibraryInfo>",
      "#include <QSplashScreen>",
      "#include <QTranslator>",
      "#include <QLocale>",
      "#include <QTextCodec>",
      "#include <QMessageBox>",
      "#include <QApplication>",
      "#include \"qtipcserver.h\"",
      "#include \"ui_interface.h\"",
      "#include \"init.h\"",
      "#include \"guiconstants.h\"",
      "#include \"guiutil.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"walletmodel.h\"",
      "#include \"clientmodel.h\"",
      "#include \"bitcoingui.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static QSplashScreen *splashref;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "QApplication::instance",
          "args": [],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QApplication::instance",
          "args": [],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "splashref->showMessage",
          "args": [
            "QString::fromStdString(message)",
            "Qt::AlignBottom|Qt::AlignHCenter",
            "QColor(255,255,255)"
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QColor",
          "args": [
            "255",
            "255",
            "255"
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString::fromStdString",
          "args": [
            "message"
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <QtPlugin>\n#include <QLibraryInfo>\n#include <QSplashScreen>\n#include <QTranslator>\n#include <QLocale>\n#include <QTextCodec>\n#include <QMessageBox>\n#include <QApplication>\n#include \"qtipcserver.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"guiconstants.h\"\n#include \"guiutil.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"clientmodel.h\"\n#include \"bitcoingui.h\"\n\nstatic QSplashScreen *splashref;\n\nstatic void InitMessage(const std::string &message)\n{\n    if(splashref)\n    {\n        splashref->showMessage(QString::fromStdString(message), Qt::AlignBottom|Qt::AlignHCenter, QColor(255,255,255));\n        QApplication::instance()->processEvents();\n    }\n}"
  },
  {
    "function_name": "ThreadSafeHandleURI",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/bitcoin.cpp",
    "lines": "73-80",
    "snippet": "static void ThreadSafeHandleURI(const std::string& strURI)\n{\n    if(!guiref)\n        return;\n\n    QMetaObject::invokeMethod(guiref, \"handleURI\", GUIUtil::blockingGUIThreadConnection(),\n                               Q_ARG(QString, QString::fromStdString(strURI)));\n}",
    "includes": [
      "#include <QtPlugin>",
      "#include <QLibraryInfo>",
      "#include <QSplashScreen>",
      "#include <QTranslator>",
      "#include <QLocale>",
      "#include <QTextCodec>",
      "#include <QMessageBox>",
      "#include <QApplication>",
      "#include \"qtipcserver.h\"",
      "#include \"ui_interface.h\"",
      "#include \"init.h\"",
      "#include \"guiconstants.h\"",
      "#include \"guiutil.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"walletmodel.h\"",
      "#include \"clientmodel.h\"",
      "#include \"bitcoingui.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static BitcoinGUI *guiref;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "QMetaObject::invokeMethod",
          "args": [
            "guiref",
            "\"handleURI\"",
            "GUIUtil::blockingGUIThreadConnection()",
            "Q_ARG(QString, QString::fromStdString(strURI))"
          ],
          "line": 78
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Q_ARG",
          "args": [
            "QString",
            "QString::fromStdString(strURI)"
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString::fromStdString",
          "args": [
            "strURI"
          ],
          "line": 79
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GUIUtil::blockingGUIThreadConnection",
          "args": [],
          "line": 78
        },
        "resolved": true,
        "details": {
          "function_name": "blockingGUIThreadConnection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/guiutil.cpp",
          "lines": "212-222",
          "snippet": "Qt::ConnectionType blockingGUIThreadConnection()\n{\n    if(QThread::currentThread() != QCoreApplication::instance()->thread())\n    {\n        return Qt::BlockingQueuedConnection;\n    }\n    else\n    {\n        return Qt::DirectConnection;\n    }\n}",
          "includes": [
            "#include \"shellapi.h\"",
            "#include \"shlobj.h\"",
            "#include \"shlwapi.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <QThread>",
            "#include <QDesktopServices>",
            "#include <QFileDialog>",
            "#include <QClipboard>",
            "#include <QApplication>",
            "#include <QAbstractItemView>",
            "#include <QTextDocument> // For Qt::escape",
            "#include <QUrl>",
            "#include <QLineEdit>",
            "#include <QFont>",
            "#include <QDoubleValidator>",
            "#include <QDateTime>",
            "#include <QString>",
            "#include \"init.h\"",
            "#include \"util.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"walletmodel.h\"",
            "#include \"bitcoinaddressvalidator.h\"",
            "#include \"guiutil.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shellapi.h\"\n#include \"shlobj.h\"\n#include \"shlwapi.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <QThread>\n#include <QDesktopServices>\n#include <QFileDialog>\n#include <QClipboard>\n#include <QApplication>\n#include <QAbstractItemView>\n#include <QTextDocument> // For Qt::escape\n#include <QUrl>\n#include <QLineEdit>\n#include <QFont>\n#include <QDoubleValidator>\n#include <QDateTime>\n#include <QString>\n#include \"init.h\"\n#include \"util.h\"\n#include \"bitcoinunits.h\"\n#include \"walletmodel.h\"\n#include \"bitcoinaddressvalidator.h\"\n#include \"guiutil.h\"\n\nQt::ConnectionType blockingGUIThreadConnection()\n{\n    if(QThread::currentThread() != QCoreApplication::instance()->thread())\n    {\n        return Qt::BlockingQueuedConnection;\n    }\n    else\n    {\n        return Qt::DirectConnection;\n    }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <QtPlugin>\n#include <QLibraryInfo>\n#include <QSplashScreen>\n#include <QTranslator>\n#include <QLocale>\n#include <QTextCodec>\n#include <QMessageBox>\n#include <QApplication>\n#include \"qtipcserver.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"guiconstants.h\"\n#include \"guiutil.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"clientmodel.h\"\n#include \"bitcoingui.h\"\n\nstatic BitcoinGUI *guiref;\n\nstatic void ThreadSafeHandleURI(const std::string& strURI)\n{\n    if(!guiref)\n        return;\n\n    QMetaObject::invokeMethod(guiref, \"handleURI\", GUIUtil::blockingGUIThreadConnection(),\n                               Q_ARG(QString, QString::fromStdString(strURI)));\n}"
  },
  {
    "function_name": "ThreadSafeAskFee",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/bitcoin.cpp",
    "lines": "58-71",
    "snippet": "static bool ThreadSafeAskFee(int64_t nFeeRequired, const std::string& strCaption)\n{\n    if(!guiref)\n        return false;\n    if(nFeeRequired < MIN_TX_FEE || nFeeRequired <= nTransactionFee || fDaemon)\n        return true;\n    bool payFee = false;\n\n    QMetaObject::invokeMethod(guiref, \"askFee\", GUIUtil::blockingGUIThreadConnection(),\n                               Q_ARG(qint64, nFeeRequired),\n                               Q_ARG(bool*, &payFee));\n\n    return payFee;\n}",
    "includes": [
      "#include <QtPlugin>",
      "#include <QLibraryInfo>",
      "#include <QSplashScreen>",
      "#include <QTranslator>",
      "#include <QLocale>",
      "#include <QTextCodec>",
      "#include <QMessageBox>",
      "#include <QApplication>",
      "#include \"qtipcserver.h\"",
      "#include \"ui_interface.h\"",
      "#include \"init.h\"",
      "#include \"guiconstants.h\"",
      "#include \"guiutil.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"walletmodel.h\"",
      "#include \"clientmodel.h\"",
      "#include \"bitcoingui.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static BitcoinGUI *guiref;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "QMetaObject::invokeMethod",
          "args": [
            "guiref",
            "\"askFee\"",
            "GUIUtil::blockingGUIThreadConnection()",
            "Q_ARG(qint64, nFeeRequired)",
            "Q_ARG(bool*, &payFee)"
          ],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Q_ARG",
          "args": [
            "bool*,&payFee"
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Q_ARG",
          "args": [
            "qint64",
            "nFeeRequired"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GUIUtil::blockingGUIThreadConnection",
          "args": [],
          "line": 66
        },
        "resolved": true,
        "details": {
          "function_name": "blockingGUIThreadConnection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/guiutil.cpp",
          "lines": "212-222",
          "snippet": "Qt::ConnectionType blockingGUIThreadConnection()\n{\n    if(QThread::currentThread() != QCoreApplication::instance()->thread())\n    {\n        return Qt::BlockingQueuedConnection;\n    }\n    else\n    {\n        return Qt::DirectConnection;\n    }\n}",
          "includes": [
            "#include \"shellapi.h\"",
            "#include \"shlobj.h\"",
            "#include \"shlwapi.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <QThread>",
            "#include <QDesktopServices>",
            "#include <QFileDialog>",
            "#include <QClipboard>",
            "#include <QApplication>",
            "#include <QAbstractItemView>",
            "#include <QTextDocument> // For Qt::escape",
            "#include <QUrl>",
            "#include <QLineEdit>",
            "#include <QFont>",
            "#include <QDoubleValidator>",
            "#include <QDateTime>",
            "#include <QString>",
            "#include \"init.h\"",
            "#include \"util.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"walletmodel.h\"",
            "#include \"bitcoinaddressvalidator.h\"",
            "#include \"guiutil.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shellapi.h\"\n#include \"shlobj.h\"\n#include \"shlwapi.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <QThread>\n#include <QDesktopServices>\n#include <QFileDialog>\n#include <QClipboard>\n#include <QApplication>\n#include <QAbstractItemView>\n#include <QTextDocument> // For Qt::escape\n#include <QUrl>\n#include <QLineEdit>\n#include <QFont>\n#include <QDoubleValidator>\n#include <QDateTime>\n#include <QString>\n#include \"init.h\"\n#include \"util.h\"\n#include \"bitcoinunits.h\"\n#include \"walletmodel.h\"\n#include \"bitcoinaddressvalidator.h\"\n#include \"guiutil.h\"\n\nQt::ConnectionType blockingGUIThreadConnection()\n{\n    if(QThread::currentThread() != QCoreApplication::instance()->thread())\n    {\n        return Qt::BlockingQueuedConnection;\n    }\n    else\n    {\n        return Qt::DirectConnection;\n    }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <QtPlugin>\n#include <QLibraryInfo>\n#include <QSplashScreen>\n#include <QTranslator>\n#include <QLocale>\n#include <QTextCodec>\n#include <QMessageBox>\n#include <QApplication>\n#include \"qtipcserver.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"guiconstants.h\"\n#include \"guiutil.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"clientmodel.h\"\n#include \"bitcoingui.h\"\n\nstatic BitcoinGUI *guiref;\n\nstatic bool ThreadSafeAskFee(int64_t nFeeRequired, const std::string& strCaption)\n{\n    if(!guiref)\n        return false;\n    if(nFeeRequired < MIN_TX_FEE || nFeeRequired <= nTransactionFee || fDaemon)\n        return true;\n    bool payFee = false;\n\n    QMetaObject::invokeMethod(guiref, \"askFee\", GUIUtil::blockingGUIThreadConnection(),\n                               Q_ARG(qint64, nFeeRequired),\n                               Q_ARG(bool*, &payFee));\n\n    return payFee;\n}"
  },
  {
    "function_name": "ThreadSafeMessageBox",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/bitcoin.cpp",
    "lines": "38-56",
    "snippet": "static void ThreadSafeMessageBox(const std::string& message, const std::string& caption, int style)\n{\n    // Message from network thread\n    if(guiref)\n    {\n        bool modal = (style & CClientUIInterface::MODAL);\n        // in case of modal message, use blocking connection to wait for user to click OK\n        QMetaObject::invokeMethod(guiref, \"error\",\n                                   modal ? GUIUtil::blockingGUIThreadConnection() : Qt::QueuedConnection,\n                                   Q_ARG(QString, QString::fromStdString(caption)),\n                                   Q_ARG(QString, QString::fromStdString(message)),\n                                   Q_ARG(bool, modal));\n    }\n    else\n    {\n        printf(\"%s: %s\\n\", caption.c_str(), message.c_str());\n        fprintf(stderr, \"%s: %s\\n\", caption.c_str(), message.c_str());\n    }\n}",
    "includes": [
      "#include <QtPlugin>",
      "#include <QLibraryInfo>",
      "#include <QSplashScreen>",
      "#include <QTranslator>",
      "#include <QLocale>",
      "#include <QTextCodec>",
      "#include <QMessageBox>",
      "#include <QApplication>",
      "#include \"qtipcserver.h\"",
      "#include \"ui_interface.h\"",
      "#include \"init.h\"",
      "#include \"guiconstants.h\"",
      "#include \"guiutil.h\"",
      "#include \"optionsmodel.h\"",
      "#include \"walletmodel.h\"",
      "#include \"clientmodel.h\"",
      "#include \"bitcoingui.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "static BitcoinGUI *guiref;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"%s: %s\\n\"",
            "caption.c_str()",
            "message.c_str()"
          ],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "message.c_str",
          "args": [],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "caption.c_str",
          "args": [],
          "line": 54
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "printf",
          "args": [
            "\"%s: %s\\n\"",
            "caption.c_str()",
            "message.c_str()"
          ],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "message.c_str",
          "args": [],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "caption.c_str",
          "args": [],
          "line": 53
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QMetaObject::invokeMethod",
          "args": [
            "guiref",
            "\"error\"",
            "modal ? GUIUtil::blockingGUIThreadConnection() : Qt::QueuedConnection",
            "Q_ARG(QString, QString::fromStdString(caption))",
            "Q_ARG(QString, QString::fromStdString(message))",
            "Q_ARG(bool, modal)"
          ],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Q_ARG",
          "args": [
            "bool,modal"
          ],
          "line": 49
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Q_ARG",
          "args": [
            "QString",
            "QString::fromStdString(message)"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString::fromStdString",
          "args": [
            "message"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "Q_ARG",
          "args": [
            "QString",
            "QString::fromStdString(caption)"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString::fromStdString",
          "args": [
            "caption"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GUIUtil::blockingGUIThreadConnection",
          "args": [],
          "line": 46
        },
        "resolved": true,
        "details": {
          "function_name": "blockingGUIThreadConnection",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/guiutil.cpp",
          "lines": "212-222",
          "snippet": "Qt::ConnectionType blockingGUIThreadConnection()\n{\n    if(QThread::currentThread() != QCoreApplication::instance()->thread())\n    {\n        return Qt::BlockingQueuedConnection;\n    }\n    else\n    {\n        return Qt::DirectConnection;\n    }\n}",
          "includes": [
            "#include \"shellapi.h\"",
            "#include \"shlobj.h\"",
            "#include \"shlwapi.h\"",
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <QThread>",
            "#include <QDesktopServices>",
            "#include <QFileDialog>",
            "#include <QClipboard>",
            "#include <QApplication>",
            "#include <QAbstractItemView>",
            "#include <QTextDocument> // For Qt::escape",
            "#include <QUrl>",
            "#include <QLineEdit>",
            "#include <QFont>",
            "#include <QDoubleValidator>",
            "#include <QDateTime>",
            "#include <QString>",
            "#include \"init.h\"",
            "#include \"util.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"walletmodel.h\"",
            "#include \"bitcoinaddressvalidator.h\"",
            "#include \"guiutil.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"shellapi.h\"\n#include \"shlobj.h\"\n#include \"shlwapi.h\"\n#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <QThread>\n#include <QDesktopServices>\n#include <QFileDialog>\n#include <QClipboard>\n#include <QApplication>\n#include <QAbstractItemView>\n#include <QTextDocument> // For Qt::escape\n#include <QUrl>\n#include <QLineEdit>\n#include <QFont>\n#include <QDoubleValidator>\n#include <QDateTime>\n#include <QString>\n#include \"init.h\"\n#include \"util.h\"\n#include \"bitcoinunits.h\"\n#include \"walletmodel.h\"\n#include \"bitcoinaddressvalidator.h\"\n#include \"guiutil.h\"\n\nQt::ConnectionType blockingGUIThreadConnection()\n{\n    if(QThread::currentThread() != QCoreApplication::instance()->thread())\n    {\n        return Qt::BlockingQueuedConnection;\n    }\n    else\n    {\n        return Qt::DirectConnection;\n    }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <QtPlugin>\n#include <QLibraryInfo>\n#include <QSplashScreen>\n#include <QTranslator>\n#include <QLocale>\n#include <QTextCodec>\n#include <QMessageBox>\n#include <QApplication>\n#include \"qtipcserver.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"guiconstants.h\"\n#include \"guiutil.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"clientmodel.h\"\n#include \"bitcoingui.h\"\n\nstatic BitcoinGUI *guiref;\n\nstatic void ThreadSafeMessageBox(const std::string& message, const std::string& caption, int style)\n{\n    // Message from network thread\n    if(guiref)\n    {\n        bool modal = (style & CClientUIInterface::MODAL);\n        // in case of modal message, use blocking connection to wait for user to click OK\n        QMetaObject::invokeMethod(guiref, \"error\",\n                                   modal ? GUIUtil::blockingGUIThreadConnection() : Qt::QueuedConnection,\n                                   Q_ARG(QString, QString::fromStdString(caption)),\n                                   Q_ARG(QString, QString::fromStdString(message)),\n                                   Q_ARG(bool, modal));\n    }\n    else\n    {\n        printf(\"%s: %s\\n\", caption.c_str(), message.c_str());\n        fprintf(stderr, \"%s: %s\\n\", caption.c_str(), message.c_str());\n    }\n}"
  }
]