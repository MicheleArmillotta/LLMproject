[
  {
    "function_name": "GetKeys",
    "container": "CCryptoKeyStore",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
    "lines": "162-176",
    "snippet": "void GetKeys(std::set<CKeyID> &setAddress) const\n    {\n        if (!IsCrypted())\n        {\n            CBasicKeyStore::GetKeys(setAddress);\n            return;\n        }\n        setAddress.clear();\n        CryptedKeyMap::const_iterator mi = mapCryptedKeys.begin();\n        while (mi != mapCryptedKeys.end())\n        {\n            setAddress.insert((*mi).first);\n            mi++;\n        }\n    }",
    "includes": [
      "#include <boost/signals2/signal.hpp>",
      "#include \"sync.h\"",
      "#include \"crypter.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "setAddress.insert",
          "args": [
            "(*mi).first"
          ],
          "line": 173
        },
        "resolved": true,
        "details": {
          "function_name": "insert",
          "container": "CBloomFilter",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bloom.cpp",
          "lines": "61-65",
          "snippet": "void CBloomFilter::insert(const uint256& hash)\n{\n    vector<unsigned char> data(BEGIN(hash), END(hash));\n    insert(data);\n}",
          "includes": [
            "#include \"hash.h\"",
            "#include \"script.h\"",
            "#include \"main.h\"",
            "#include \"bloom.h\"",
            "#include <stdlib.h>",
            "#include <math.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hash.h\"\n#include \"script.h\"\n#include \"main.h\"\n#include \"bloom.h\"\n#include <stdlib.h>\n#include <math.h>\n\nCBloomFilter {\n  void CBloomFilter::insert(const uint256& hash)\n  {\n      vector<unsigned char> data(BEGIN(hash), END(hash));\n      insert(data);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "mapCryptedKeys.end",
          "args": [],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "mapCryptedKeys.begin",
          "args": [],
          "line": 170
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "setAddress.clear",
          "args": [],
          "line": 169
        },
        "resolved": true,
        "details": {
          "function_name": "clear",
          "container": "CTxMemPool",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
          "lines": "768-774",
          "snippet": "void CTxMemPool::clear()\n{\n    LOCK(cs);\n    mapTx.clear();\n    mapNextTx.clear();\n    ++nTransactionsUpdated;\n}",
          "includes": [
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"kernel.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"txdb.h\"",
            "#include \"db.h\"",
            "#include \"checkpoints.h\"",
            "#include \"alert.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "unsigned int nTransactionsUpdated = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/algorithm/string/replace.hpp>\n#include \"kernel.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"txdb.h\"\n#include \"db.h\"\n#include \"checkpoints.h\"\n#include \"alert.h\"\n\nunsigned int nTransactionsUpdated = 0;\n\nCTxMemPool {\n  void CTxMemPool::clear()\n  {\n      LOCK(cs);\n      mapTx.clear();\n      mapNextTx.clear();\n      ++nTransactionsUpdated;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "CBasicKeyStore::GetKeys",
          "args": [
            "setAddress"
          ],
          "line": 166
        },
        "resolved": true,
        "details": {
          "function_name": "GetKeys",
          "container": "CBasicKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "68-80",
          "snippet": "void GetKeys(std::set<CKeyID> &setAddress) const\n    {\n        setAddress.clear();\n        {\n            LOCK(cs_KeyStore);\n            KeyMap::const_iterator mi = mapKeys.begin();\n            while (mi != mapKeys.end())\n            {\n                setAddress.insert((*mi).first);\n                mi++;\n            }\n        }\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCBasicKeyStore {\n  void GetKeys(std::set<CKeyID> &setAddress) const\n      {\n          setAddress.clear();\n          {\n              LOCK(cs_KeyStore);\n              KeyMap::const_iterator mi = mapKeys.begin();\n              while (mi != mapKeys.end())\n              {\n                  setAddress.insert((*mi).first);\n                  mi++;\n              }\n          }\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "IsCrypted",
          "args": [],
          "line": 164
        },
        "resolved": true,
        "details": {
          "function_name": "IsCrypted",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "129-132",
          "snippet": "bool IsCrypted() const\n    {\n        return fUseCrypto;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool IsCrypted() const\n      {\n          return fUseCrypto;\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  void GetKeys(std::set<CKeyID> &setAddress) const\n      {\n          if (!IsCrypted())\n          {\n              CBasicKeyStore::GetKeys(setAddress);\n              return;\n          }\n          setAddress.clear();\n          CryptedKeyMap::const_iterator mi = mapCryptedKeys.begin();\n          while (mi != mapCryptedKeys.end())\n          {\n              setAddress.insert((*mi).first);\n              mi++;\n          }\n      }\n}"
  },
  {
    "function_name": "HaveKey",
    "container": "CCryptoKeyStore",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
    "lines": "150-159",
    "snippet": "bool HaveKey(const CKeyID &address) const\n    {\n        {\n            LOCK(cs_KeyStore);\n            if (!IsCrypted())\n                return CBasicKeyStore::HaveKey(address);\n            return mapCryptedKeys.count(address) > 0;\n        }\n        return false;\n    }",
    "includes": [
      "#include <boost/signals2/signal.hpp>",
      "#include \"sync.h\"",
      "#include \"crypter.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mapCryptedKeys.count",
          "args": [
            "address"
          ],
          "line": 156
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "CBasicKeyStore::HaveKey",
          "args": [
            "address"
          ],
          "line": 155
        },
        "resolved": true,
        "details": {
          "function_name": "HaveKey",
          "container": "CBasicKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "59-67",
          "snippet": "bool HaveKey(const CKeyID &address) const\n    {\n        bool result;\n        {\n            LOCK(cs_KeyStore);\n            result = (mapKeys.count(address) > 0);\n        }\n        return result;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCBasicKeyStore {\n  bool HaveKey(const CKeyID &address) const\n      {\n          bool result;\n          {\n              LOCK(cs_KeyStore);\n              result = (mapKeys.count(address) > 0);\n          }\n          return result;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "IsCrypted",
          "args": [],
          "line": 154
        },
        "resolved": true,
        "details": {
          "function_name": "IsCrypted",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "129-132",
          "snippet": "bool IsCrypted() const\n    {\n        return fUseCrypto;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool IsCrypted() const\n      {\n          return fUseCrypto;\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "cs_KeyStore"
          ],
          "line": 153
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool HaveKey(const CKeyID &address) const\n      {\n          {\n              LOCK(cs_KeyStore);\n              if (!IsCrypted())\n                  return CBasicKeyStore::HaveKey(address);\n              return mapCryptedKeys.count(address) > 0;\n          }\n          return false;\n      }\n}"
  },
  {
    "function_name": "IsLocked",
    "container": "CCryptoKeyStore",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
    "lines": "134-144",
    "snippet": "bool IsLocked() const\n    {\n        if (!IsCrypted())\n            return false;\n        bool result;\n        {\n            LOCK(cs_KeyStore);\n            result = vMasterKey.empty();\n        }\n        return result;\n    }",
    "includes": [
      "#include <boost/signals2/signal.hpp>",
      "#include \"sync.h\"",
      "#include \"crypter.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "vMasterKey.empty",
          "args": [],
          "line": 141
        },
        "resolved": true,
        "details": {
          "function_name": "empty",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "32-32",
          "snippet": "bool empty() const { return map.empty(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  bool empty() const { return map.empty(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "cs_KeyStore"
          ],
          "line": 140
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IsCrypted",
          "args": [],
          "line": 136
        },
        "resolved": true,
        "details": {
          "function_name": "IsCrypted",
          "container": "CCryptoKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "129-132",
          "snippet": "bool IsCrypted() const\n    {\n        return fUseCrypto;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool IsCrypted() const\n      {\n          return fUseCrypto;\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool IsLocked() const\n      {\n          if (!IsCrypted())\n              return false;\n          bool result;\n          {\n              LOCK(cs_KeyStore);\n              result = vMasterKey.empty();\n          }\n          return result;\n      }\n}"
  },
  {
    "function_name": "IsCrypted",
    "container": "CCryptoKeyStore",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
    "lines": "129-132",
    "snippet": "bool IsCrypted() const\n    {\n        return fUseCrypto;\n    }",
    "includes": [
      "#include <boost/signals2/signal.hpp>",
      "#include \"sync.h\"",
      "#include \"crypter.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  bool IsCrypted() const\n      {\n          return fUseCrypto;\n      }\n}"
  },
  {
    "function_name": "CCryptoKeyStore",
    "container": "CCryptoKeyStore",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
    "lines": "125-127",
    "snippet": "CCryptoKeyStore() : fUseCrypto(false)\n    {\n    }",
    "includes": [
      "#include <boost/signals2/signal.hpp>",
      "#include \"sync.h\"",
      "#include \"crypter.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCCryptoKeyStore {\n  CCryptoKeyStore() : fUseCrypto(false)\n      {\n      }\n}"
  },
  {
    "function_name": "GetKey",
    "container": "CBasicKeyStore",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
    "lines": "81-94",
    "snippet": "bool GetKey(const CKeyID &address, CKey &keyOut) const\n    {\n        {\n            LOCK(cs_KeyStore);\n            KeyMap::const_iterator mi = mapKeys.find(address);\n            if (mi != mapKeys.end())\n            {\n                keyOut.Reset();\n                keyOut.SetSecret((*mi).second.first, (*mi).second.second);\n                return true;\n            }\n        }\n        return false;\n    }",
    "includes": [
      "#include <boost/signals2/signal.hpp>",
      "#include \"sync.h\"",
      "#include \"crypter.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "keyOut.SetSecret",
          "args": [
            "(*mi).second.first",
            "(*mi).second.second"
          ],
          "line": 89
        },
        "resolved": true,
        "details": {
          "function_name": "SetSecret",
          "container": "CKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.cpp",
          "lines": "209-230",
          "snippet": "bool CKey::SetSecret(const CSecret& vchSecret, bool fCompressed)\n{\n    EC_KEY_free(pkey);\n    pkey = EC_KEY_new_by_curve_name(NID_secp256k1);\n    if (pkey == NULL)\n        throw key_error(\"CKey::SetSecret() : EC_KEY_new_by_curve_name failed\");\n    if (vchSecret.size() != 32)\n        throw key_error(\"CKey::SetSecret() : secret must be 32 bytes\");\n    BIGNUM *bn = BN_bin2bn(&vchSecret[0],32,BN_new());\n    if (bn == NULL)\n        throw key_error(\"CKey::SetSecret() : BN_bin2bn failed\");\n    if (!EC_KEY_regenerate_key(pkey,bn))\n    {\n        BN_clear_free(bn);\n        throw key_error(\"CKey::SetSecret() : EC_KEY_regenerate_key failed\");\n    }\n    BN_clear_free(bn);\n    fSet = true;\n    if (fCompressed || fCompressedPubKey)\n        SetCompressedPubKey();\n    return true;\n}",
          "includes": [
            "#include \"key.h\"",
            "#include <openssl/obj_mac.h>",
            "#include <openssl/ecdsa.h>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"key.h\"\n#include <openssl/obj_mac.h>\n#include <openssl/ecdsa.h>\n#include <map>\n\nCKey {\n  bool CKey::SetSecret(const CSecret& vchSecret, bool fCompressed)\n  {\n      EC_KEY_free(pkey);\n      pkey = EC_KEY_new_by_curve_name(NID_secp256k1);\n      if (pkey == NULL)\n          throw key_error(\"CKey::SetSecret() : EC_KEY_new_by_curve_name failed\");\n      if (vchSecret.size() != 32)\n          throw key_error(\"CKey::SetSecret() : secret must be 32 bytes\");\n      BIGNUM *bn = BN_bin2bn(&vchSecret[0],32,BN_new());\n      if (bn == NULL)\n          throw key_error(\"CKey::SetSecret() : BN_bin2bn failed\");\n      if (!EC_KEY_regenerate_key(pkey,bn))\n      {\n          BN_clear_free(bn);\n          throw key_error(\"CKey::SetSecret() : EC_KEY_regenerate_key failed\");\n      }\n      BN_clear_free(bn);\n      fSet = true;\n      if (fCompressed || fCompressedPubKey)\n          SetCompressedPubKey();\n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "keyOut.Reset",
          "args": [],
          "line": 88
        },
        "resolved": true,
        "details": {
          "function_name": "Reset",
          "container": "CKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.cpp",
          "lines": "129-138",
          "snippet": "void CKey::Reset()\n{\n    fCompressedPubKey = false;\n    if (pkey != NULL)\n        EC_KEY_free(pkey);\n    pkey = EC_KEY_new_by_curve_name(NID_secp256k1);\n    if (pkey == NULL)\n        throw key_error(\"CKey::CKey() : EC_KEY_new_by_curve_name failed\");\n    fSet = false;\n}",
          "includes": [
            "#include \"key.h\"",
            "#include <openssl/obj_mac.h>",
            "#include <openssl/ecdsa.h>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"key.h\"\n#include <openssl/obj_mac.h>\n#include <openssl/ecdsa.h>\n#include <map>\n\nCKey {\n  void CKey::Reset()\n  {\n      fCompressedPubKey = false;\n      if (pkey != NULL)\n          EC_KEY_free(pkey);\n      pkey = EC_KEY_new_by_curve_name(NID_secp256k1);\n      if (pkey == NULL)\n          throw key_error(\"CKey::CKey() : EC_KEY_new_by_curve_name failed\");\n      fSet = false;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "mapKeys.end",
          "args": [],
          "line": 86
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "mapKeys.find",
          "args": [
            "address"
          ],
          "line": 85
        },
        "resolved": true,
        "details": {
          "function_name": "find",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "33-33",
          "snippet": "const_iterator find(const key_type& k) const { return map.find(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator find(const key_type& k) const { return map.find(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "cs_KeyStore"
          ],
          "line": 84
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCBasicKeyStore {\n  bool GetKey(const CKeyID &address, CKey &keyOut) const\n      {\n          {\n              LOCK(cs_KeyStore);\n              KeyMap::const_iterator mi = mapKeys.find(address);\n              if (mi != mapKeys.end())\n              {\n                  keyOut.Reset();\n                  keyOut.SetSecret((*mi).second.first, (*mi).second.second);\n                  return true;\n              }\n          }\n          return false;\n      }\n}"
  },
  {
    "function_name": "GetKeys",
    "container": "CBasicKeyStore",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
    "lines": "68-80",
    "snippet": "void GetKeys(std::set<CKeyID> &setAddress) const\n    {\n        setAddress.clear();\n        {\n            LOCK(cs_KeyStore);\n            KeyMap::const_iterator mi = mapKeys.begin();\n            while (mi != mapKeys.end())\n            {\n                setAddress.insert((*mi).first);\n                mi++;\n            }\n        }\n    }",
    "includes": [
      "#include <boost/signals2/signal.hpp>",
      "#include \"sync.h\"",
      "#include \"crypter.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "setAddress.insert",
          "args": [
            "(*mi).first"
          ],
          "line": 76
        },
        "resolved": true,
        "details": {
          "function_name": "insert",
          "container": "CBloomFilter",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/bloom.cpp",
          "lines": "61-65",
          "snippet": "void CBloomFilter::insert(const uint256& hash)\n{\n    vector<unsigned char> data(BEGIN(hash), END(hash));\n    insert(data);\n}",
          "includes": [
            "#include \"hash.h\"",
            "#include \"script.h\"",
            "#include \"main.h\"",
            "#include \"bloom.h\"",
            "#include <stdlib.h>",
            "#include <math.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"hash.h\"\n#include \"script.h\"\n#include \"main.h\"\n#include \"bloom.h\"\n#include <stdlib.h>\n#include <math.h>\n\nCBloomFilter {\n  void CBloomFilter::insert(const uint256& hash)\n  {\n      vector<unsigned char> data(BEGIN(hash), END(hash));\n      insert(data);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "mapKeys.end",
          "args": [],
          "line": 74
        },
        "resolved": true,
        "details": {
          "function_name": "end",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "30-30",
          "snippet": "const_iterator end() const { return map.end(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator end() const { return map.end(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "mapKeys.begin",
          "args": [],
          "line": 73
        },
        "resolved": true,
        "details": {
          "function_name": "begin",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "29-29",
          "snippet": "const_iterator begin() const { return map.begin(); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  const_iterator begin() const { return map.begin(); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "cs_KeyStore"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "setAddress.clear",
          "args": [],
          "line": 70
        },
        "resolved": true,
        "details": {
          "function_name": "clear",
          "container": "CTxMemPool",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
          "lines": "768-774",
          "snippet": "void CTxMemPool::clear()\n{\n    LOCK(cs);\n    mapTx.clear();\n    mapNextTx.clear();\n    ++nTransactionsUpdated;\n}",
          "includes": [
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"kernel.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"txdb.h\"",
            "#include \"db.h\"",
            "#include \"checkpoints.h\"",
            "#include \"alert.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "unsigned int nTransactionsUpdated = 0;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/algorithm/string/replace.hpp>\n#include \"kernel.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"txdb.h\"\n#include \"db.h\"\n#include \"checkpoints.h\"\n#include \"alert.h\"\n\nunsigned int nTransactionsUpdated = 0;\n\nCTxMemPool {\n  void CTxMemPool::clear()\n  {\n      LOCK(cs);\n      mapTx.clear();\n      mapNextTx.clear();\n      ++nTransactionsUpdated;\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCBasicKeyStore {\n  void GetKeys(std::set<CKeyID> &setAddress) const\n      {\n          setAddress.clear();\n          {\n              LOCK(cs_KeyStore);\n              KeyMap::const_iterator mi = mapKeys.begin();\n              while (mi != mapKeys.end())\n              {\n                  setAddress.insert((*mi).first);\n                  mi++;\n              }\n          }\n      }\n}"
  },
  {
    "function_name": "HaveKey",
    "container": "CBasicKeyStore",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
    "lines": "59-67",
    "snippet": "bool HaveKey(const CKeyID &address) const\n    {\n        bool result;\n        {\n            LOCK(cs_KeyStore);\n            result = (mapKeys.count(address) > 0);\n        }\n        return result;\n    }",
    "includes": [
      "#include <boost/signals2/signal.hpp>",
      "#include \"sync.h\"",
      "#include \"crypter.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "mapKeys.count",
          "args": [
            "address"
          ],
          "line": 64
        },
        "resolved": true,
        "details": {
          "function_name": "count",
          "container": "limitedmap",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/limitedmap.h",
          "lines": "34-34",
          "snippet": "size_type count(const key_type& k) const { return map.count(k); }",
          "includes": [
            "#include <deque>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <deque>\n#include <map>\n\nlimitedmap {\n  size_type count(const key_type& k) const { return map.count(k); }\n}"
        }
      },
      {
        "call_info": {
          "callee": "LOCK",
          "args": [
            "cs_KeyStore"
          ],
          "line": 63
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCBasicKeyStore {\n  bool HaveKey(const CKeyID &address) const\n      {\n          bool result;\n          {\n              LOCK(cs_KeyStore);\n              result = (mapKeys.count(address) > 0);\n          }\n          return result;\n      }\n}"
  },
  {
    "function_name": "GetSecret",
    "container": "CKeyStore",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
    "lines": "37-44",
    "snippet": "virtual bool GetSecret(const CKeyID &address, CSecret& vchSecret, bool &fCompressed) const\n    {\n        CKey key;\n        if (!GetKey(address, key))\n            return false;\n        vchSecret = key.GetSecret(fCompressed);\n        return true;\n    }",
    "includes": [
      "#include <boost/signals2/signal.hpp>",
      "#include \"sync.h\"",
      "#include \"crypter.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "key.GetSecret",
          "args": [
            "fCompressed"
          ],
          "line": 42
        },
        "resolved": true,
        "details": {
          "function_name": "GetSecret",
          "container": "CKey",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/key.cpp",
          "lines": "232-245",
          "snippet": "CSecret CKey::GetSecret(bool &fCompressed) const\n{\n    CSecret vchRet;\n    vchRet.resize(32);\n    const BIGNUM *bn = EC_KEY_get0_private_key(pkey);\n    int nBytes = BN_num_bytes(bn);\n    if (bn == NULL)\n        throw key_error(\"CKey::GetSecret() : EC_KEY_get0_private_key failed\");\n    int n=BN_bn2bin(bn,&vchRet[32 - nBytes]);\n    if (n != nBytes)\n        throw key_error(\"CKey::GetSecret(): BN_bn2bin failed\");\n    fCompressed = fCompressedPubKey;\n    return vchRet;\n}",
          "includes": [
            "#include \"key.h\"",
            "#include <openssl/obj_mac.h>",
            "#include <openssl/ecdsa.h>",
            "#include <map>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"key.h\"\n#include <openssl/obj_mac.h>\n#include <openssl/ecdsa.h>\n#include <map>\n\nCKey {\n  CSecret CKey::GetSecret(bool &fCompressed) const\n  {\n      CSecret vchRet;\n      vchRet.resize(32);\n      const BIGNUM *bn = EC_KEY_get0_private_key(pkey);\n      int nBytes = BN_num_bytes(bn);\n      if (bn == NULL)\n          throw key_error(\"CKey::GetSecret() : EC_KEY_get0_private_key failed\");\n      int n=BN_bn2bin(bn,&vchRet[32 - nBytes]);\n      if (n != nBytes)\n          throw key_error(\"CKey::GetSecret(): BN_bn2bin failed\");\n      fCompressed = fCompressedPubKey;\n      return vchRet;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "GetKey",
          "args": [
            "address",
            "key"
          ],
          "line": 40
        },
        "resolved": true,
        "details": {
          "function_name": "GetKey",
          "container": "CBasicKeyStore",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/keystore.h",
          "lines": "81-94",
          "snippet": "bool GetKey(const CKeyID &address, CKey &keyOut) const\n    {\n        {\n            LOCK(cs_KeyStore);\n            KeyMap::const_iterator mi = mapKeys.find(address);\n            if (mi != mapKeys.end())\n            {\n                keyOut.Reset();\n                keyOut.SetSecret((*mi).second.first, (*mi).second.second);\n                return true;\n            }\n        }\n        return false;\n    }",
          "includes": [
            "#include <boost/signals2/signal.hpp>",
            "#include \"sync.h\"",
            "#include \"crypter.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCBasicKeyStore {\n  bool GetKey(const CKeyID &address, CKey &keyOut) const\n      {\n          {\n              LOCK(cs_KeyStore);\n              KeyMap::const_iterator mi = mapKeys.find(address);\n              if (mi != mapKeys.end())\n              {\n                  keyOut.Reset();\n                  keyOut.SetSecret((*mi).second.first, (*mi).second.second);\n                  return true;\n              }\n          }\n          return false;\n      }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <boost/signals2/signal.hpp>\n#include \"sync.h\"\n#include \"crypter.h\"\n\nCKeyStore {\n  virtual bool GetSecret(const CKeyID &address, CSecret& vchSecret, bool &fCompressed) const\n      {\n          CKey key;\n          if (!GetKey(address, key))\n              return false;\n          vchSecret = key.GetSecret(fCompressed);\n          return true;\n      }\n}"
  }
]