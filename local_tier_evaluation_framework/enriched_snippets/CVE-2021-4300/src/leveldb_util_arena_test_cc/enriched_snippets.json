[
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/arena_test.cc",
    "lines": "66-68",
    "snippet": "int main(int argc, char** argv) {\n  return leveldb::test::RunAllTests();\n}",
    "includes": [
      "#include \"util/testharness.h\"",
      "#include \"util/random.h\"",
      "#include \"util/arena.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "leveldb::test::RunAllTests",
          "args": [],
          "line": 67
        },
        "resolved": true,
        "details": {
          "function_name": "RunAllTests",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/testharness.cc",
          "lines": "36-58",
          "snippet": "int RunAllTests() {\n  const char* matcher = getenv(\"LEVELDB_TESTS\");\n\n  int num = 0;\n  if (tests != NULL) {\n    for (size_t i = 0; i < tests->size(); i++) {\n      const Test& t = (*tests)[i];\n      if (matcher != NULL) {\n        std::string name = t.base;\n        name.push_back('.');\n        name.append(t.name);\n        if (strstr(name.c_str(), matcher) == NULL) {\n          continue;\n        }\n      }\n      fprintf(stderr, \"==== Test %s.%s\\n\", t.base, t.name);\n      (*t.func)();\n      ++num;\n    }\n  }\n  fprintf(stderr, \"==== PASSED %d tests\\n\", num);\n  return 0;\n}",
          "includes": [
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <stdlib.h>",
            "#include <string>",
            "#include \"util/testharness.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <sys/types.h>\n#include <sys/stat.h>\n#include <stdlib.h>\n#include <string>\n#include \"util/testharness.h\"\n\nint RunAllTests() {\n  const char* matcher = getenv(\"LEVELDB_TESTS\");\n\n  int num = 0;\n  if (tests != NULL) {\n    for (size_t i = 0; i < tests->size(); i++) {\n      const Test& t = (*tests)[i];\n      if (matcher != NULL) {\n        std::string name = t.base;\n        name.push_back('.');\n        name.append(t.name);\n        if (strstr(name.c_str(), matcher) == NULL) {\n          continue;\n        }\n      }\n      fprintf(stderr, \"==== Test %s.%s\\n\", t.base, t.name);\n      (*t.func)();\n      ++num;\n    }\n  }\n  fprintf(stderr, \"==== PASSED %d tests\\n\", num);\n  return 0;\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"util/testharness.h\"\n#include \"util/random.h\"\n#include \"util/arena.h\"\n\nint main(int argc, char** argv) {\n  return leveldb::test::RunAllTests();\n}"
  },
  {
    "function_name": "TEST",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/arena_test.cc",
    "lines": "18-62",
    "snippet": "TEST(ArenaTest, Simple) {\n  std::vector<std::pair<size_t, char*> > allocated;\n  Arena arena;\n  const int N = 100000;\n  size_t bytes = 0;\n  Random rnd(301);\n  for (int i = 0; i < N; i++) {\n    size_t s;\n    if (i % (N / 10) == 0) {\n      s = i;\n    } else {\n      s = rnd.OneIn(4000) ? rnd.Uniform(6000) :\n          (rnd.OneIn(10) ? rnd.Uniform(100) : rnd.Uniform(20));\n    }\n    if (s == 0) {\n      // Our arena disallows size 0 allocations.\n      s = 1;\n    }\n    char* r;\n    if (rnd.OneIn(10)) {\n      r = arena.AllocateAligned(s);\n    } else {\n      r = arena.Allocate(s);\n    }\n\n    for (size_t b = 0; b < s; b++) {\n      // Fill the \"i\"th allocation with a known bit pattern\n      r[b] = i % 256;\n    }\n    bytes += s;\n    allocated.push_back(std::make_pair(s, r));\n    ASSERT_GE(arena.MemoryUsage(), bytes);\n    if (i > N/10) {\n      ASSERT_LE(arena.MemoryUsage(), bytes * 1.10);\n    }\n  }\n  for (size_t i = 0; i < allocated.size(); i++) {\n    size_t num_bytes = allocated[i].first;\n    const char* p = allocated[i].second;\n    for (size_t b = 0; b < num_bytes; b++) {\n      // Check the \"i\"th allocation for the known bit pattern\n      ASSERT_EQ(int(p[b]) & 0xff, i % 256);\n    }\n  }\n}",
    "includes": [
      "#include \"util/testharness.h\"",
      "#include \"util/random.h\"",
      "#include \"util/arena.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ASSERT_EQ",
          "args": [
            "int(p[b]) & 0xff",
            "i % 256"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "int",
          "args": [
            "p[b]"
          ],
          "line": 59
        },
        "resolved": true,
        "details": {
          "function_name": "VarintLength",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/coding.cc",
          "lines": "103-110",
          "snippet": "int VarintLength(uint64_t v) {\n  int len = 1;\n  while (v >= 128) {\n    v >>= 7;\n    len++;\n  }\n  return len;\n}",
          "includes": [
            "#include \"util/coding.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util/coding.h\"\n\nint VarintLength(uint64_t v) {\n  int len = 1;\n  while (v >= 128) {\n    v >>= 7;\n    len++;\n  }\n  return len;\n}"
        }
      },
      {
        "call_info": {
          "callee": "allocated.size",
          "args": [],
          "line": 54
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "base_uint",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/uint256.h",
          "lines": "354-357",
          "snippet": "unsigned int size()\n    {\n        return sizeof(pn);\n    }",
          "includes": [
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdint.h>",
            "#include <vector>",
            "#include <string>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string.h>\n#include <stdio.h>\n#include <stdint.h>\n#include <vector>\n#include <string>\n\nbase_uint {\n  unsigned int size()\n      {\n          return sizeof(pn);\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASSERT_LE",
          "args": [
            "arena.MemoryUsage()",
            "bytes * 1.10"
          ],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "arena.MemoryUsage",
          "args": [],
          "line": 51
        },
        "resolved": true,
        "details": {
          "function_name": "MemoryUsage",
          "container": "Arena",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/arena.h",
          "lines": "29-31",
          "snippet": "size_t MemoryUsage() const {\n    return blocks_memory_ + blocks_.capacity() * sizeof(char*);\n  }",
          "includes": [
            "#include <stdint.h>",
            "#include <stddef.h>",
            "#include <assert.h>",
            "#include <vector>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdint.h>\n#include <stddef.h>\n#include <assert.h>\n#include <vector>\n\nArena {\n  size_t MemoryUsage() const {\n      return blocks_memory_ + blocks_.capacity() * sizeof(char*);\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ASSERT_GE",
          "args": [
            "arena.MemoryUsage()",
            "bytes"
          ],
          "line": 49
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "allocated.push_back",
          "args": [
            "std::make_pair(s, r)"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::make_pair",
          "args": [
            "s",
            "r"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "arena.Allocate",
          "args": [
            "s"
          ],
          "line": 40
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "arena.AllocateAligned",
          "args": [
            "s"
          ],
          "line": 38
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "rnd.OneIn",
          "args": [
            "10"
          ],
          "line": 37
        },
        "resolved": true,
        "details": {
          "function_name": "OneIn",
          "container": "Random",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/random.h",
          "lines": "52-52",
          "snippet": "bool OneIn(int n) { return (Next() % n) == 0; }",
          "includes": [
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdint.h>\n\nRandom {\n  bool OneIn(int n) { return (Next() % n) == 0; }\n}"
        }
      },
      {
        "call_info": {
          "callee": "rnd.Uniform",
          "args": [
            "20"
          ],
          "line": 30
        },
        "resolved": true,
        "details": {
          "function_name": "Uniform",
          "container": "Random",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/random.h",
          "lines": "48-48",
          "snippet": "uint32_t Uniform(int n) { return Next() % n; }",
          "includes": [
            "#include <stdint.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <stdint.h>\n\nRandom {\n  uint32_t Uniform(int n) { return Next() % n; }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"util/testharness.h\"\n#include \"util/random.h\"\n#include \"util/arena.h\"\n\nTEST(ArenaTest, Simple) {\n  std::vector<std::pair<size_t, char*> > allocated;\n  Arena arena;\n  const int N = 100000;\n  size_t bytes = 0;\n  Random rnd(301);\n  for (int i = 0; i < N; i++) {\n    size_t s;\n    if (i % (N / 10) == 0) {\n      s = i;\n    } else {\n      s = rnd.OneIn(4000) ? rnd.Uniform(6000) :\n          (rnd.OneIn(10) ? rnd.Uniform(100) : rnd.Uniform(20));\n    }\n    if (s == 0) {\n      // Our arena disallows size 0 allocations.\n      s = 1;\n    }\n    char* r;\n    if (rnd.OneIn(10)) {\n      r = arena.AllocateAligned(s);\n    } else {\n      r = arena.Allocate(s);\n    }\n\n    for (size_t b = 0; b < s; b++) {\n      // Fill the \"i\"th allocation with a known bit pattern\n      r[b] = i % 256;\n    }\n    bytes += s;\n    allocated.push_back(std::make_pair(s, r));\n    ASSERT_GE(arena.MemoryUsage(), bytes);\n    if (i > N/10) {\n      ASSERT_LE(arena.MemoryUsage(), bytes * 1.10);\n    }\n  }\n  for (size_t i = 0; i < allocated.size(); i++) {\n    size_t num_bytes = allocated[i].first;\n    const char* p = allocated[i].second;\n    for (size_t b = 0; b < num_bytes; b++) {\n      // Check the \"i\"th allocation for the known bit pattern\n      ASSERT_EQ(int(p[b]) & 0xff, i % 256);\n    }\n  }\n}"
  },
  {
    "function_name": "TEST",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/leveldb/util/arena_test.cc",
    "lines": "14-16",
    "snippet": "TEST(ArenaTest, Empty) {\n  Arena arena;\n}",
    "includes": [
      "#include \"util/testharness.h\"",
      "#include \"util/random.h\"",
      "#include \"util/arena.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"util/testharness.h\"\n#include \"util/random.h\"\n#include \"util/arena.h\"\n\nTEST(ArenaTest, Empty) {\n  Arena arena;\n}"
  }
]