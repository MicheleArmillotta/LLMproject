[
  {
    "function_name": "validate",
    "container": "BitcoinAddressValidator",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/bitcoinaddressvalidator.cpp",
    "lines": "21-77",
    "snippet": "QValidator::State BitcoinAddressValidator::validate(QString &input, int &pos) const\n{\n    // Correction\n    for(int idx=0; idx<input.size();)\n    {\n        bool removeChar = false;\n        QChar ch = input.at(idx);\n        // Corrections made are very conservative on purpose, to avoid\n        // users unexpectedly getting away with typos that would normally\n        // be detected, and thus sending to the wrong address.\n        switch(ch.unicode())\n        {\n        // Qt categorizes these as \"Other_Format\" not \"Separator_Space\"\n        case 0x200B: // ZERO WIDTH SPACE\n        case 0xFEFF: // ZERO WIDTH NO-BREAK SPACE\n            removeChar = true;\n            break;\n        default:\n            break;\n        }\n        // Remove whitespace\n        if(ch.isSpace())\n            removeChar = true;\n        // To next character\n        if(removeChar)\n            input.remove(idx, 1);\n        else\n            ++idx;\n    }\n\n    // Validation\n    QValidator::State state = QValidator::Acceptable;\n    for(int idx=0; idx<input.size(); ++idx)\n    {\n        int ch = input.at(idx).unicode();\n\n        if(((ch >= '0' && ch<='9') ||\n           (ch >= 'a' && ch<='z') ||\n           (ch >= 'A' && ch<='Z')) &&\n           ch != 'l' && ch != 'I' && ch != '0' && ch != 'O')\n        {\n            // Alphanumeric and not a 'forbidden' character\n        }\n        else\n        {\n            state = QValidator::Invalid;\n        }\n    }\n\n    // Empty address is \"intermediate\" input\n    if(input.isEmpty())\n    {\n        state = QValidator::Intermediate;\n    }\n\n    return state;\n}",
    "includes": [
      "#include \"bitcoinaddressvalidator.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "input.isEmpty",
          "args": [],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "input.at",
          "args": [],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "input.at",
          "args": [
            "idx"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "input.size",
          "args": [],
          "line": 53
        },
        "resolved": true,
        "details": {
          "function_name": "size",
          "container": "TransactionTablePriv",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/transactiontablemodel.cpp",
          "lines": "170-173",
          "snippet": "int size()\n    {\n        return cachedWallet.size();\n    }",
          "includes": [
            "#include <QtAlgorithms>",
            "#include <QDateTime>",
            "#include <QIcon>",
            "#include <QTimer>",
            "#include <QColor>",
            "#include <QList>",
            "#include <QLocale>",
            "#include \"ui_interface.h\"",
            "#include \"wallet.h\"",
            "#include \"bitcoinunits.h\"",
            "#include \"addresstablemodel.h\"",
            "#include \"optionsmodel.h\"",
            "#include \"walletmodel.h\"",
            "#include \"transactiondesc.h\"",
            "#include \"guiconstants.h\"",
            "#include \"transactionrecord.h\"",
            "#include \"guiutil.h\"",
            "#include \"transactiontablemodel.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <QtAlgorithms>\n#include <QDateTime>\n#include <QIcon>\n#include <QTimer>\n#include <QColor>\n#include <QList>\n#include <QLocale>\n#include \"ui_interface.h\"\n#include \"wallet.h\"\n#include \"bitcoinunits.h\"\n#include \"addresstablemodel.h\"\n#include \"optionsmodel.h\"\n#include \"walletmodel.h\"\n#include \"transactiondesc.h\"\n#include \"guiconstants.h\"\n#include \"transactionrecord.h\"\n#include \"guiutil.h\"\n#include \"transactiontablemodel.h\"\n\nTransactionTablePriv {\n  int size()\n      {\n          return cachedWallet.size();\n      }\n}"
        }
      },
      {
        "call_info": {
          "callee": "input.remove",
          "args": [
            "idx",
            "1"
          ],
          "line": 46
        },
        "resolved": true,
        "details": {
          "function_name": "remove",
          "container": "CTxMemPool",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/main.cpp",
          "lines": "729-751",
          "snippet": "bool CTxMemPool::remove(const CTransaction &tx, bool fRecursive)\n{\n    // Remove transaction from memory pool\n    {\n        LOCK(cs);\n        uint256 hash = tx.GetHash();\n        if (mapTx.count(hash))\n        {\n            if (fRecursive) {\n                for (unsigned int i = 0; i < tx.vout.size(); i++) {\n                    std::map<COutPoint, CInPoint>::iterator it = mapNextTx.find(COutPoint(hash, i));\n                    if (it != mapNextTx.end())\n                        remove(*it->second.ptx, true);\n                }\n            }\n            BOOST_FOREACH(const CTxIn& txin, tx.vin)\n                mapNextTx.erase(txin.prevout);\n            mapTx.erase(hash);\n            nTransactionsUpdated++;\n        }\n    }\n    return true;\n}",
          "includes": [
            "#include <boost/filesystem/fstream.hpp>",
            "#include <boost/filesystem.hpp>",
            "#include <boost/algorithm/string/replace.hpp>",
            "#include \"kernel.h\"",
            "#include \"ui_interface.h\"",
            "#include \"init.h\"",
            "#include \"net.h\"",
            "#include \"txdb.h\"",
            "#include \"db.h\"",
            "#include \"checkpoints.h\"",
            "#include \"alert.h\""
          ],
          "macros_used": [],
          "globals_used": [
            "unsigned int nTransactionsUpdated = 0;",
            "CBigNum bnProofOfWorkLimit(~uint256(0) >> 20);",
            "CBigNum bnProofOfStakeLimit(~uint256(0) >> 20);",
            "const CBigNum bnNeoScryptSwitch(~uint256(0) >> 30);",
            "CBigNum bnProofOfWorkLimitTestNet(~uint256(0) >> 16);",
            "CBigNum bnProofOfStakeLimitTestNet(~uint256(0) >> 16);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <boost/filesystem/fstream.hpp>\n#include <boost/filesystem.hpp>\n#include <boost/algorithm/string/replace.hpp>\n#include \"kernel.h\"\n#include \"ui_interface.h\"\n#include \"init.h\"\n#include \"net.h\"\n#include \"txdb.h\"\n#include \"db.h\"\n#include \"checkpoints.h\"\n#include \"alert.h\"\n\nunsigned int nTransactionsUpdated = 0;\nCBigNum bnProofOfWorkLimit(~uint256(0) >> 20);\nCBigNum bnProofOfStakeLimit(~uint256(0) >> 20);\nconst CBigNum bnNeoScryptSwitch(~uint256(0) >> 30);\nCBigNum bnProofOfWorkLimitTestNet(~uint256(0) >> 16);\nCBigNum bnProofOfStakeLimitTestNet(~uint256(0) >> 16);\n\nCTxMemPool {\n  bool CTxMemPool::remove(const CTransaction &tx, bool fRecursive)\n  {\n      // Remove transaction from memory pool\n      {\n          LOCK(cs);\n          uint256 hash = tx.GetHash();\n          if (mapTx.count(hash))\n          {\n              if (fRecursive) {\n                  for (unsigned int i = 0; i < tx.vout.size(); i++) {\n                      std::map<COutPoint, CInPoint>::iterator it = mapNextTx.find(COutPoint(hash, i));\n                      if (it != mapNextTx.end())\n                          remove(*it->second.ptx, true);\n                  }\n              }\n              BOOST_FOREACH(const CTxIn& txin, tx.vin)\n                  mapNextTx.erase(txin.prevout);\n              mapTx.erase(hash);\n              nTransactionsUpdated++;\n          }\n      }\n      return true;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "ch.isSpace",
          "args": [],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ch.unicode",
          "args": [],
          "line": 31
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "input.at",
          "args": [
            "idx"
          ],
          "line": 27
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"bitcoinaddressvalidator.h\"\n\nBitcoinAddressValidator {\n  QValidator::State BitcoinAddressValidator::validate(QString &input, int &pos) const\n  {\n      // Correction\n      for(int idx=0; idx<input.size();)\n      {\n          bool removeChar = false;\n          QChar ch = input.at(idx);\n          // Corrections made are very conservative on purpose, to avoid\n          // users unexpectedly getting away with typos that would normally\n          // be detected, and thus sending to the wrong address.\n          switch(ch.unicode())\n          {\n          // Qt categorizes these as \"Other_Format\" not \"Separator_Space\"\n          case 0x200B: // ZERO WIDTH SPACE\n          case 0xFEFF: // ZERO WIDTH NO-BREAK SPACE\n              removeChar = true;\n              break;\n          default:\n              break;\n          }\n          // Remove whitespace\n          if(ch.isSpace())\n              removeChar = true;\n          // To next character\n          if(removeChar)\n              input.remove(idx, 1);\n          else\n              ++idx;\n      }\n  \n      // Validation\n      QValidator::State state = QValidator::Acceptable;\n      for(int idx=0; idx<input.size(); ++idx)\n      {\n          int ch = input.at(idx).unicode();\n  \n          if(((ch >= '0' && ch<='9') ||\n             (ch >= 'a' && ch<='z') ||\n             (ch >= 'A' && ch<='Z')) &&\n             ch != 'l' && ch != 'I' && ch != '0' && ch != 'O')\n          {\n              // Alphanumeric and not a 'forbidden' character\n          }\n          else\n          {\n              state = QValidator::Invalid;\n          }\n      }\n  \n      // Empty address is \"intermediate\" input\n      if(input.isEmpty())\n      {\n          state = QValidator::Intermediate;\n      }\n  \n      return state;\n  }\n}"
  },
  {
    "function_name": "BitcoinAddressValidator",
    "container": "BitcoinAddressValidator",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2021-4300/repo/src/qt/bitcoinaddressvalidator.cpp",
    "lines": "16-19",
    "snippet": "BitcoinAddressValidator::BitcoinAddressValidator(QObject *parent) :\n    QValidator(parent)\n{\n}",
    "includes": [
      "#include \"bitcoinaddressvalidator.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"bitcoinaddressvalidator.h\"\n\nBitcoinAddressValidator {\n  BitcoinAddressValidator::BitcoinAddressValidator(QObject *parent) :\n      QValidator(parent)\n  {\n  }\n}"
  }
]