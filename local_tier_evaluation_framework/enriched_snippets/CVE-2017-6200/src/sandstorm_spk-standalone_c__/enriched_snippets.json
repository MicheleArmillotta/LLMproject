[
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2017-6200/repo/src/sandstorm/spk-standalone.c++",
    "lines": "19-28",
    "snippet": "int main(int argc, char* argv[]) {\n  // A stand-alone SPK binary is not shipped in the release but is sometimes useful.\n\n  // TODO(cleanup): Couldn't use KJ_MAIN() because SpkMain is not exposed in the header; have to\n  //   call a factory function. Refactor to fix.\n\n  kj::TopLevelProcessContext context(argv[0]);\n  auto mainObject = sandstorm::getSpkMain(context);\n  return kj::runMainAndExit(context, mainObject->getMain(), argc, argv);\n}",
    "includes": [
      "#include \"spk.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "kj::runMainAndExit",
          "args": [
            "context",
            "mainObject->getMain()",
            "argc",
            "argv"
          ],
          "line": 27
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "mainObject->getMain",
          "args": [],
          "line": 27
        },
        "resolved": true,
        "details": {
          "function_name": "getMain",
          "container": "SupervisorMain",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2017-6200/repo/src/sandstorm/supervisor.c++",
          "lines": "562-595",
          "snippet": "kj::MainFunc SupervisorMain::getMain() {\n  return kj::MainBuilder(context, \"Sandstorm version \" SANDSTORM_VERSION,\n                         \"Runs a Sandstorm grain supervisor for the grain <grain-id>, which is \"\n                         \"an instance of app <app-id>.  Executes <command> inside the grain \"\n                         \"sandbox.\")\n      .addOptionWithArg({\"uid\"}, KJ_BIND_METHOD(*this, setUid), \"<uid>\",\n                        \"Use setuid sandbox rather than userns. Must start as root, but swiches \"\n                        \"to <uid> to run the app.\")\n      .addOptionWithArg({\"pkg\"}, KJ_BIND_METHOD(*this, setPkg), \"<path>\",\n                        \"Set directory containing the app package.  \"\n                        \"Defaults to '$SANDSTORM_HOME/var/sandstorm/apps/<app-name>'.\")\n      .addOptionWithArg({\"var\"}, KJ_BIND_METHOD(*this, setVar), \"<path>\",\n                        \"Set directory where grain's mutable persistent data will be stored.  \"\n                        \"Defaults to '$SANDSTORM_HOME/var/sandstorm/grains/<grain-id>'.\")\n      .addOptionWithArg({'e', \"env\"}, KJ_BIND_METHOD(*this, addEnv), \"<name>=<val>\",\n                        \"Set the environment variable <name> to <val> inside the sandbox.  Note \"\n                        \"that *no* environment variables are set by default.\")\n      .addOption({\"proc\"}, [this]() { setMountProc(true); return true; },\n                 \"Mount procfs inside the sandbox.  For security reasons, this is NOT \"\n                 \"RECOMMENDED during normal use, but it may be useful for debugging.\")\n      .addOption({\"stdio\"}, [this]() { keepStdio = true; return true; },\n                 \"Don't redirect the sandbox's stdio.  Useful for debugging.\")\n      .addOption({\"dev\"}, [this]() { devmode = true; return true; },\n                 \"Allow some system calls useful for debugging which are blocked in production.\")\n      .addOption({\"seccomp-dump-pfc\"}, [this]() { seccompDumpPfc = true; return true; },\n                 \"Dump libseccomp PFC output.\")\n      .addOption({'n', \"new\"}, [this]() { setIsNew(true); return true; },\n                 \"Initializes a new grain.  (Otherwise, runs an existing one.)\")\n      .expectArg(\"<app-name>\", KJ_BIND_METHOD(*this, setAppName))\n      .expectArg(\"<grain-id>\", KJ_BIND_METHOD(*this, setGrainId))\n      .expectOneOrMoreArgs(\"<command>\", KJ_BIND_METHOD(*this, addCommandArg))\n      .callAfterParsing(KJ_BIND_METHOD(*this, run))\n      .build();\n}",
          "includes": [
            "#include \"util.h\"",
            "#include \"send-fd.h\"",
            "#include \"version.h\"",
            "#include <sandstorm/supervisor.capnp.h>",
            "#include <sandstorm/grain.capnp.h>",
            "#include <seccomp.h>",
            "#include <sys/resource.h>",
            "#include <sys/eventfd.h>",
            "#include <linux/rtnetlink.h>",
            "#include <linux/netlink.h>",
            "#include <execinfo.h>",
            "#include <unordered_map>",
            "#include <map>",
            "#include <sys/inotify.h>",
            "#include <grp.h>",
            "#include <pwd.h>",
            "#include <dirent.h>",
            "#include <sched.h>",
            "#include <limits.h>",
            "#include <stdlib.h>",
            "#include <errno.h>",
            "#include <fcntl.h>",
            "#include <linux/netfilter/nf_nat.h>",
            "#include <sandstorm/ip_tables.h>  // created by Makefile from <linux/netfilter_ipv4/ip_tables.h>",
            "#include <linux/route.h>",
            "#include <linux/sockios.h>",
            "#include <sys/syscall.h>",
            "#include <sys/ptrace.h>",
            "#include <sys/capability.h>",
            "#include <sys/prctl.h>",
            "#include <sys/mount.h>",
            "#include <sys/un.h>",
            "#include <sys/socket.h>",
            "#include <sys/wait.h>",
            "#include <sys/time.h>",
            "#include <sys/types.h>",
            "#include <sys/stat.h>",
            "#include <netinet/in.h> // needs to be included before sys/capability.h",
            "#include <unistd.h>",
            "#include <capnp/rpc.capnp.h>",
            "#include <capnp/rpc-twoparty.h>",
            "#include <kj/io.h>",
            "#include <kj/async-unix.h>",
            "#include <kj/async-io.h>",
            "#include <kj/debug.h>",
            "#include <kj/main.h>",
            "#include \"supervisor.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"util.h\"\n#include \"send-fd.h\"\n#include \"version.h\"\n#include <sandstorm/supervisor.capnp.h>\n#include <sandstorm/grain.capnp.h>\n#include <seccomp.h>\n#include <sys/resource.h>\n#include <sys/eventfd.h>\n#include <linux/rtnetlink.h>\n#include <linux/netlink.h>\n#include <execinfo.h>\n#include <unordered_map>\n#include <map>\n#include <sys/inotify.h>\n#include <grp.h>\n#include <pwd.h>\n#include <dirent.h>\n#include <sched.h>\n#include <limits.h>\n#include <stdlib.h>\n#include <errno.h>\n#include <fcntl.h>\n#include <linux/netfilter/nf_nat.h>\n#include <sandstorm/ip_tables.h>  // created by Makefile from <linux/netfilter_ipv4/ip_tables.h>\n#include <linux/route.h>\n#include <linux/sockios.h>\n#include <sys/syscall.h>\n#include <sys/ptrace.h>\n#include <sys/capability.h>\n#include <sys/prctl.h>\n#include <sys/mount.h>\n#include <sys/un.h>\n#include <sys/socket.h>\n#include <sys/wait.h>\n#include <sys/time.h>\n#include <sys/types.h>\n#include <sys/stat.h>\n#include <netinet/in.h> // needs to be included before sys/capability.h\n#include <unistd.h>\n#include <capnp/rpc.capnp.h>\n#include <capnp/rpc-twoparty.h>\n#include <kj/io.h>\n#include <kj/async-unix.h>\n#include <kj/async-io.h>\n#include <kj/debug.h>\n#include <kj/main.h>\n#include \"supervisor.h\"\n\nSupervisorMain {\n  kj::MainFunc SupervisorMain::getMain() {\n    return kj::MainBuilder(context, \"Sandstorm version \" SANDSTORM_VERSION,\n                           \"Runs a Sandstorm grain supervisor for the grain <grain-id>, which is \"\n                           \"an instance of app <app-id>.  Executes <command> inside the grain \"\n                           \"sandbox.\")\n        .addOptionWithArg({\"uid\"}, KJ_BIND_METHOD(*this, setUid), \"<uid>\",\n                          \"Use setuid sandbox rather than userns. Must start as root, but swiches \"\n                          \"to <uid> to run the app.\")\n        .addOptionWithArg({\"pkg\"}, KJ_BIND_METHOD(*this, setPkg), \"<path>\",\n                          \"Set directory containing the app package.  \"\n                          \"Defaults to '$SANDSTORM_HOME/var/sandstorm/apps/<app-name>'.\")\n        .addOptionWithArg({\"var\"}, KJ_BIND_METHOD(*this, setVar), \"<path>\",\n                          \"Set directory where grain's mutable persistent data will be stored.  \"\n                          \"Defaults to '$SANDSTORM_HOME/var/sandstorm/grains/<grain-id>'.\")\n        .addOptionWithArg({'e', \"env\"}, KJ_BIND_METHOD(*this, addEnv), \"<name>=<val>\",\n                          \"Set the environment variable <name> to <val> inside the sandbox.  Note \"\n                          \"that *no* environment variables are set by default.\")\n        .addOption({\"proc\"}, [this]() { setMountProc(true); return true; },\n                   \"Mount procfs inside the sandbox.  For security reasons, this is NOT \"\n                   \"RECOMMENDED during normal use, but it may be useful for debugging.\")\n        .addOption({\"stdio\"}, [this]() { keepStdio = true; return true; },\n                   \"Don't redirect the sandbox's stdio.  Useful for debugging.\")\n        .addOption({\"dev\"}, [this]() { devmode = true; return true; },\n                   \"Allow some system calls useful for debugging which are blocked in production.\")\n        .addOption({\"seccomp-dump-pfc\"}, [this]() { seccompDumpPfc = true; return true; },\n                   \"Dump libseccomp PFC output.\")\n        .addOption({'n', \"new\"}, [this]() { setIsNew(true); return true; },\n                   \"Initializes a new grain.  (Otherwise, runs an existing one.)\")\n        .expectArg(\"<app-name>\", KJ_BIND_METHOD(*this, setAppName))\n        .expectArg(\"<grain-id>\", KJ_BIND_METHOD(*this, setGrainId))\n        .expectOneOrMoreArgs(\"<command>\", KJ_BIND_METHOD(*this, addCommandArg))\n        .callAfterParsing(KJ_BIND_METHOD(*this, run))\n        .build();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "sandstorm::getSpkMain",
          "args": [
            "context"
          ],
          "line": 26
        },
        "resolved": true,
        "details": {
          "function_name": "getSpkMain",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2017-6200/repo/src/sandstorm/spk.c++",
          "lines": "2432-2434",
          "snippet": "kj::Own<AbstractMain> getSpkMain(kj::ProcessContext& context) {\n  return kj::heap<SpkTool>(context);\n}",
          "includes": [
            "#include \"appid-replacements.h\"",
            "#include \"id-to-text.h\"",
            "#include \"util.h\"",
            "#include \"send-fd.h\"",
            "#include \"union-fs.h\"",
            "#include \"fuse.h\"",
            "#include \"version.h\"",
            "#include <sodium/crypto_generichash_blake2b.h>",
            "#include <sandstorm/app-index/submit.capnp.h>",
            "#include <poll.h>",
            "#include <time.h>",
            "#include <ctype.h>",
            "#include <kj/async-unix.h>",
            "#include <sys/un.h>",
            "#include <sys/socket.h>",
            "#include <capnp/dynamic.h>",
            "#include <capnp/schema-parser.h>",
            "#include <sys/xattr.h>",
            "#include <map>",
            "#include <set>",
            "#include <dirent.h>",
            "#include <stdlib.h>",
            "#include <sandstorm/appid-replacements.capnp.h>",
            "#include <sandstorm/package.capnp.h>",
            "#include <errno.h>",
            "#include <sys/mman.h>",
            "#include <sys/wait.h>",
            "#include <sys/stat.h>",
            "#include <sys/types.h>",
            "#include <stdio.h>",
            "#include <fcntl.h>",
            "#include <unistd.h>",
            "#include <sodium/crypto_hash_sha512.h>",
            "#include <sodium/crypto_hash_sha256.h>",
            "#include <sodium/crypto_sign.h>",
            "#include <capnp/compat/json.h>",
            "#include <capnp/serialize-packed.h>",
            "#include <capnp/serialize.h>",
            "#include <kj/io.h>",
            "#include <kj/debug.h>",
            "#include \"spk.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"appid-replacements.h\"\n#include \"id-to-text.h\"\n#include \"util.h\"\n#include \"send-fd.h\"\n#include \"union-fs.h\"\n#include \"fuse.h\"\n#include \"version.h\"\n#include <sodium/crypto_generichash_blake2b.h>\n#include <sandstorm/app-index/submit.capnp.h>\n#include <poll.h>\n#include <time.h>\n#include <ctype.h>\n#include <kj/async-unix.h>\n#include <sys/un.h>\n#include <sys/socket.h>\n#include <capnp/dynamic.h>\n#include <capnp/schema-parser.h>\n#include <sys/xattr.h>\n#include <map>\n#include <set>\n#include <dirent.h>\n#include <stdlib.h>\n#include <sandstorm/appid-replacements.capnp.h>\n#include <sandstorm/package.capnp.h>\n#include <errno.h>\n#include <sys/mman.h>\n#include <sys/wait.h>\n#include <sys/stat.h>\n#include <sys/types.h>\n#include <stdio.h>\n#include <fcntl.h>\n#include <unistd.h>\n#include <sodium/crypto_hash_sha512.h>\n#include <sodium/crypto_hash_sha256.h>\n#include <sodium/crypto_sign.h>\n#include <capnp/compat/json.h>\n#include <capnp/serialize-packed.h>\n#include <capnp/serialize.h>\n#include <kj/io.h>\n#include <kj/debug.h>\n#include \"spk.h\"\n\nkj::Own<AbstractMain> getSpkMain(kj::ProcessContext& context) {\n  return kj::heap<SpkTool>(context);\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"spk.h\"\n\nint main(int argc, char* argv[]) {\n  // A stand-alone SPK binary is not shipped in the release but is sometimes useful.\n\n  // TODO(cleanup): Couldn't use KJ_MAIN() because SpkMain is not exposed in the header; have to\n  //   call a factory function. Refactor to fix.\n\n  kj::TopLevelProcessContext context(argv[0]);\n  auto mainObject = sandstorm::getSpkMain(context);\n  return kj::runMainAndExit(context, mainObject->getMain(), argc, argv);\n}"
  }
]