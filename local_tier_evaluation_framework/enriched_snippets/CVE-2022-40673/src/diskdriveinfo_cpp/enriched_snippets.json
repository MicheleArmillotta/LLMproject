[
  {
    "function_name": "isEncrypted",
    "container": "DiskDriveInfo",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2022-40673/repo/src/diskdriveinfo.cpp",
    "lines": "52-69",
    "snippet": "bool DiskDriveInfo::isEncrypted(const QString &volume)\n{\n    QString device = getDeviceByVolume(volume);\n\n    if (device.indexOf(\"dm\") != 0)\n        return false;\n\n    QFile sysBlock(QString(\"/sys/block/%1/dm/uuid\").arg(device));\n\n    if (!sysBlock.open(QIODevice::ReadOnly | QIODevice::Text))\n        return false;\n\n    QString uuid = sysBlock.readAll().simplified();\n\n    sysBlock.close();\n\n    return uuid.indexOf(\"CRYPT\") == 0;\n}",
    "includes": [
      "#include <unistd.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/disk.h>",
      "#include <QFileInfo>",
      "#include <QFile>",
      "#include <QString>",
      "#include \"diskdriveinfo.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "uuid.indexOf",
          "args": [
            "\"CRYPT\""
          ],
          "line": 68
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sysBlock.close",
          "args": [],
          "line": 66
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sysBlock.readAll",
          "args": [],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sysBlock.readAll",
          "args": [],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sysBlock.open",
          "args": [
            "QIODevice::ReadOnly | QIODevice::Text"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString",
          "args": [
            "device"
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString",
          "args": [
            "\"/sys/block/%1/dm/uuid\""
          ],
          "line": 59
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device.indexOf",
          "args": [
            "\"dm\""
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getDeviceByVolume",
          "args": [
            "volume"
          ],
          "line": 54
        },
        "resolved": true,
        "details": {
          "function_name": "getDeviceByVolume",
          "container": "DiskDriveInfo",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2022-40673/repo/src/diskdriveinfo.cpp",
          "lines": "12-16",
          "snippet": "QString DiskDriveInfo::getDeviceByVolume(const QString &volume)\n{\n    QString device = QFileInfo(volume).canonicalFilePath();\n    return device.mid(device.lastIndexOf(\"/\") + 1);\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <sys/fcntl.h>",
            "#include <sys/disk.h>",
            "#include <QFileInfo>",
            "#include <QFile>",
            "#include <QString>",
            "#include \"diskdriveinfo.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <sys/fcntl.h>\n#include <sys/disk.h>\n#include <QFileInfo>\n#include <QFile>\n#include <QString>\n#include \"diskdriveinfo.h\"\n\nDiskDriveInfo {\n  QString DiskDriveInfo::getDeviceByVolume(const QString &volume)\n  {\n      QString device = QFileInfo(volume).canonicalFilePath();\n      return device.mid(device.lastIndexOf(\"/\") + 1);\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <unistd.h>\n#include <sys/fcntl.h>\n#include <sys/disk.h>\n#include <QFileInfo>\n#include <QFile>\n#include <QString>\n#include \"diskdriveinfo.h\"\n\nDiskDriveInfo {\n  bool DiskDriveInfo::isEncrypted(const QString &volume)\n  {\n      QString device = getDeviceByVolume(volume);\n  \n      if (device.indexOf(\"dm\") != 0)\n          return false;\n  \n      QFile sysBlock(QString(\"/sys/block/%1/dm/uuid\").arg(device));\n  \n      if (!sysBlock.open(QIODevice::ReadOnly | QIODevice::Text))\n          return false;\n  \n      QString uuid = sysBlock.readAll().simplified();\n  \n      sysBlock.close();\n  \n      return uuid.indexOf(\"CRYPT\") == 0;\n  }\n}"
  },
  {
    "function_name": "getModelName",
    "container": "DiskDriveInfo",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2022-40673/repo/src/diskdriveinfo.cpp",
    "lines": "18-49",
    "snippet": "QString DiskDriveInfo::getModelName(const QString &volume)\n{\n#if defined(__linux__)\n    QFileInfo sysClass(QFileInfo(QString(\"/sys/class/block/%1/..\")\n                                 .arg(getDeviceByVolume(volume)))\n                       .canonicalFilePath());\n\n    QFile sysBlock(QString(\"/sys/block/%1/device/model\").arg(sysClass.baseName()));\n\n    if (!sysBlock.open(QIODevice::ReadOnly | QIODevice::Text))\n        return QString();\n\n    QString model(sysBlock.readAll().simplified());\n\n    sysBlock.close();\n#elif defined(__FreeBSD__)\n    struct diocgattr_arg arg;\n\n    strlcpy(arg.name, \"GEOM::descr\", sizeof(arg.name));\n    arg.len = sizeof(arg.value.str);\n\n    int fd = open(volume.toStdString().c_str(), O_RDONLY);\n    if (fd == -1 || ioctl(fd, DIOCGATTR, &arg) == -1)\n        return QString();\n\n    QString model(arg.value.str);\n\n    close(fd);\n#endif\n\n    return model;\n}",
    "includes": [
      "#include <unistd.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/disk.h>",
      "#include <QFileInfo>",
      "#include <QFile>",
      "#include <QString>",
      "#include \"diskdriveinfo.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "close",
          "args": [
            "fd"
          ],
          "line": 45
        },
        "resolved": true,
        "details": {
          "function_name": "closeEvent",
          "container": "MainWindow",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2022-40673/repo/src/mainwindow.cpp",
          "lines": "214-220",
          "snippet": "void MainWindow::closeEvent(QCloseEvent *)\n{\n    if (m_benchmark->isRunning()) {\n        connect(m_benchmark, &Benchmark::finished, this, [this] () { qApp->exit(); });\n        m_benchmark->setRunning(false);\n    }\n}",
          "includes": [
            "#include \"global.h\"",
            "#include \"storageitemdelegate.h\"",
            "#include \"diskdriveinfo.h\"",
            "#include \"settings.h\"",
            "#include \"about.h\"",
            "#include \"math.h\"",
            "#include <QTimer>",
            "#include <QStyleFactory>",
            "#include <QAbstractItemView>",
            "#include <QTextStream>",
            "#include <QFileDialog>",
            "#include <QDate>",
            "#include <QClipboard>",
            "#include <QMetaEnum>",
            "#include <QStorageInfo>",
            "#include <QMessageBox>",
            "#include \"ui_mainwindow.h\"",
            "#include \"mainwindow.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"global.h\"\n#include \"storageitemdelegate.h\"\n#include \"diskdriveinfo.h\"\n#include \"settings.h\"\n#include \"about.h\"\n#include \"math.h\"\n#include <QTimer>\n#include <QStyleFactory>\n#include <QAbstractItemView>\n#include <QTextStream>\n#include <QFileDialog>\n#include <QDate>\n#include <QClipboard>\n#include <QMetaEnum>\n#include <QStorageInfo>\n#include <QMessageBox>\n#include \"ui_mainwindow.h\"\n#include \"mainwindow.h\"\n\nMainWindow {\n  void MainWindow::closeEvent(QCloseEvent *)\n  {\n      if (m_benchmark->isRunning()) {\n          connect(m_benchmark, &Benchmark::finished, this, [this] () { qApp->exit(); });\n          m_benchmark->setRunning(false);\n      }\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "QString",
          "args": [],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ioctl",
          "args": [
            "fd",
            "DIOCGATTR",
            "&arg"
          ],
          "line": 40
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open",
          "args": [
            "volume.toStdString().c_str()",
            "O_RDONLY"
          ],
          "line": 39
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "volume.toStdString",
          "args": [],
          "line": 39
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "volume.toStdString",
          "args": [],
          "line": 39
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlcpy",
          "args": [
            "arg.name",
            "\"GEOM::descr\"",
            "sizeof(arg.name)"
          ],
          "line": 36
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sysBlock.close",
          "args": [],
          "line": 32
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sysBlock.readAll",
          "args": [],
          "line": 30
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sysBlock.readAll",
          "args": [],
          "line": 30
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString",
          "args": [],
          "line": 28
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sysBlock.open",
          "args": [
            "QIODevice::ReadOnly | QIODevice::Text"
          ],
          "line": 27
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString",
          "args": [
            "sysClass.baseName()"
          ],
          "line": 25
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sysClass.baseName",
          "args": [],
          "line": 25
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString",
          "args": [
            "\"/sys/block/%1/device/model\""
          ],
          "line": 25
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QFileInfo",
          "args": [],
          "line": 21
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QFileInfo",
          "args": [
            "QString(\"/sys/class/block/%1/..\")\n                                 .arg(getDeviceByVolume(volume))"
          ],
          "line": 21
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString",
          "args": [
            "getDeviceByVolume(volume)"
          ],
          "line": 21
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getDeviceByVolume",
          "args": [
            "volume"
          ],
          "line": 22
        },
        "resolved": true,
        "details": {
          "function_name": "getDeviceByVolume",
          "container": "DiskDriveInfo",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2022-40673/repo/src/diskdriveinfo.cpp",
          "lines": "12-16",
          "snippet": "QString DiskDriveInfo::getDeviceByVolume(const QString &volume)\n{\n    QString device = QFileInfo(volume).canonicalFilePath();\n    return device.mid(device.lastIndexOf(\"/\") + 1);\n}",
          "includes": [
            "#include <unistd.h>",
            "#include <sys/fcntl.h>",
            "#include <sys/disk.h>",
            "#include <QFileInfo>",
            "#include <QFile>",
            "#include <QString>",
            "#include \"diskdriveinfo.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <unistd.h>\n#include <sys/fcntl.h>\n#include <sys/disk.h>\n#include <QFileInfo>\n#include <QFile>\n#include <QString>\n#include \"diskdriveinfo.h\"\n\nDiskDriveInfo {\n  QString DiskDriveInfo::getDeviceByVolume(const QString &volume)\n  {\n      QString device = QFileInfo(volume).canonicalFilePath();\n      return device.mid(device.lastIndexOf(\"/\") + 1);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "QString",
          "args": [
            "\"/sys/class/block/%1/..\""
          ],
          "line": 21
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <unistd.h>\n#include <sys/fcntl.h>\n#include <sys/disk.h>\n#include <QFileInfo>\n#include <QFile>\n#include <QString>\n#include \"diskdriveinfo.h\"\n\nDiskDriveInfo {\n  QString DiskDriveInfo::getModelName(const QString &volume)\n  {\n  #if defined(__linux__)\n      QFileInfo sysClass(QFileInfo(QString(\"/sys/class/block/%1/..\")\n                                   .arg(getDeviceByVolume(volume)))\n                         .canonicalFilePath());\n  \n      QFile sysBlock(QString(\"/sys/block/%1/device/model\").arg(sysClass.baseName()));\n  \n      if (!sysBlock.open(QIODevice::ReadOnly | QIODevice::Text))\n          return QString();\n  \n      QString model(sysBlock.readAll().simplified());\n  \n      sysBlock.close();\n  #elif defined(__FreeBSD__)\n      struct diocgattr_arg arg;\n  \n      strlcpy(arg.name, \"GEOM::descr\", sizeof(arg.name));\n      arg.len = sizeof(arg.value.str);\n  \n      int fd = open(volume.toStdString().c_str(), O_RDONLY);\n      if (fd == -1 || ioctl(fd, DIOCGATTR, &arg) == -1)\n          return QString();\n  \n      QString model(arg.value.str);\n  \n      close(fd);\n  #endif\n  \n      return model;\n  }\n}"
  },
  {
    "function_name": "getDeviceByVolume",
    "container": "DiskDriveInfo",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2022-40673/repo/src/diskdriveinfo.cpp",
    "lines": "12-16",
    "snippet": "QString DiskDriveInfo::getDeviceByVolume(const QString &volume)\n{\n    QString device = QFileInfo(volume).canonicalFilePath();\n    return device.mid(device.lastIndexOf(\"/\") + 1);\n}",
    "includes": [
      "#include <unistd.h>",
      "#include <sys/fcntl.h>",
      "#include <sys/disk.h>",
      "#include <QFileInfo>",
      "#include <QFile>",
      "#include <QString>",
      "#include \"diskdriveinfo.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "device.mid",
          "args": [
            "device.lastIndexOf(\"/\") + 1"
          ],
          "line": 15
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "device.lastIndexOf",
          "args": [
            "\"/\""
          ],
          "line": 15
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QFileInfo",
          "args": [],
          "line": 14
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QFileInfo",
          "args": [
            "volume"
          ],
          "line": 14
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <unistd.h>\n#include <sys/fcntl.h>\n#include <sys/disk.h>\n#include <QFileInfo>\n#include <QFile>\n#include <QString>\n#include \"diskdriveinfo.h\"\n\nDiskDriveInfo {\n  QString DiskDriveInfo::getDeviceByVolume(const QString &volume)\n  {\n      QString device = QFileInfo(volume).canonicalFilePath();\n      return device.mid(device.lastIndexOf(\"/\") + 1);\n  }\n}"
  }
]