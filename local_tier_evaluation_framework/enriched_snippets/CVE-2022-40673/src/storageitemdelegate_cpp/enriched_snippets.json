[
  {
    "function_name": "paint",
    "container": "StorageItemDelegate",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2022-40673/repo/src/storageitemdelegate.cpp",
    "lines": "19-78",
    "snippet": "void StorageItemDelegate::paint(QPainter *painter, const QStyleOptionViewItem &option, const QModelIndex &index) const\n{\n    QVariant variant = index.data(Qt::UserRole);\n\n    if (variant.canConvert<Global::Storage>()) {\n        Global::Storage storage = variant.value<Global::Storage>();\n\n        QStyle *style = option.widget ? option.widget->style() : QApplication::style();\n\n        QPalette::ColorGroup cg = option.state & QStyle::State_Enabled\n                                  ? QPalette::Normal : QPalette::Disabled;\n        if (cg == QPalette::Normal && !(option.state & QStyle::State_Active))\n            cg = QPalette::Inactive;\n\n        if (option.state & QStyle::State_Selected) {\n            painter->fillRect(option.rect, option.palette.brush(cg, QPalette::Highlight));\n            painter->setPen(option.palette.color(cg, QPalette::HighlightedText));\n        } else {\n            painter->setPen(option.palette.color(cg, QPalette::Text));\n        }\n\n        const int textMargin = style->pixelMetric(QStyle::PM_FocusFrameHMargin, 0, option.widget) + 1;\n        // we will move the text up half of the total height\n        const int topMargin = QStyledItemDelegate::sizeHint(option, index).height() / 2;\n        QRect textRect = option.rect.adjusted(textMargin, -topMargin, -textMargin, -topMargin);\n\n        painter->drawText(textRect, option.displayAlignment, storage.path);\n        painter->drawText(textRect, option.displayAlignment | Qt::AlignRight, storage.formatedSize);\n\n        QStyleOptionProgressBar progressBarOption;\n\n        const int textHeight = QFontMetrics(painter->font()).height();\n        QRect progressBarRect = textRect.adjusted(0, textHeight, 0, textHeight);\n\n        const int percent = storage.bytesOccupied * 100 / storage.bytesTotal;\n\n#if QT_VERSION >= QT_VERSION_CHECK(5, 11, 0)\n        int percentTextWidth = QFontMetrics(painter->font()).horizontalAdvance(QLatin1Char('0')) * 4;\n#else\n        int percentTextWidth = QFontMetrics(painter->font()).width(QLatin1Char('0')) * 4;\n#endif\n        progressBarOption.rect = progressBarRect.adjusted(0, textHeight / 2 + textMargin, -percentTextWidth, -textHeight / 2 - textMargin);\n        progressBarOption.minimum = 0;\n        progressBarOption.maximum = 100;\n        progressBarOption.progress = percent;\n\n        if (percent >= 95) {\n            QPalette palette = progressBarOption.palette;\n            palette.setColor(QPalette::Highlight, QColor(218, 68, 83));\n            progressBarOption.palette = palette;\n        }\n\n        style->drawControl(QStyle::CE_ProgressBar, &progressBarOption, painter);\n\n        painter->drawText(progressBarRect, option.displayAlignment | Qt::AlignRight, QString::number(percent) + \"%\");\n    }\n    else {\n        QStyledItemDelegate::paint(painter, option, index);\n    }\n}",
    "includes": [
      "#include \"global.h\"",
      "#include <QApplication>",
      "#include <QPainter>",
      "#include \"storageitemdelegate.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "QStyledItemDelegate::paint",
          "args": [
            "painter",
            "option",
            "index"
          ],
          "line": 76
        },
        "resolved": true,
        "details": {
          "function_name": "paint",
          "container": "StorageItemDelegate",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2022-40673/repo/src/storageitemdelegate.cpp",
          "lines": "19-78",
          "snippet": "void StorageItemDelegate::paint(QPainter *painter, const QStyleOptionViewItem &option, const QModelIndex &index) const\n{\n    QVariant variant = index.data(Qt::UserRole);\n\n    if (variant.canConvert<Global::Storage>()) {\n        Global::Storage storage = variant.value<Global::Storage>();\n\n        QStyle *style = option.widget ? option.widget->style() : QApplication::style();\n\n        QPalette::ColorGroup cg = option.state & QStyle::State_Enabled\n                                  ? QPalette::Normal : QPalette::Disabled;\n        if (cg == QPalette::Normal && !(option.state & QStyle::State_Active))\n            cg = QPalette::Inactive;\n\n        if (option.state & QStyle::State_Selected) {\n            painter->fillRect(option.rect, option.palette.brush(cg, QPalette::Highlight));\n            painter->setPen(option.palette.color(cg, QPalette::HighlightedText));\n        } else {\n            painter->setPen(option.palette.color(cg, QPalette::Text));\n        }\n\n        const int textMargin = style->pixelMetric(QStyle::PM_FocusFrameHMargin, 0, option.widget) + 1;\n        // we will move the text up half of the total height\n        const int topMargin = QStyledItemDelegate::sizeHint(option, index).height() / 2;\n        QRect textRect = option.rect.adjusted(textMargin, -topMargin, -textMargin, -topMargin);\n\n        painter->drawText(textRect, option.displayAlignment, storage.path);\n        painter->drawText(textRect, option.displayAlignment | Qt::AlignRight, storage.formatedSize);\n\n        QStyleOptionProgressBar progressBarOption;\n\n        const int textHeight = QFontMetrics(painter->font()).height();\n        QRect progressBarRect = textRect.adjusted(0, textHeight, 0, textHeight);\n\n        const int percent = storage.bytesOccupied * 100 / storage.bytesTotal;\n\n#if QT_VERSION >= QT_VERSION_CHECK(5, 11, 0)\n        int percentTextWidth = QFontMetrics(painter->font()).horizontalAdvance(QLatin1Char('0')) * 4;\n#else\n        int percentTextWidth = QFontMetrics(painter->font()).width(QLatin1Char('0')) * 4;\n#endif\n        progressBarOption.rect = progressBarRect.adjusted(0, textHeight / 2 + textMargin, -percentTextWidth, -textHeight / 2 - textMargin);\n        progressBarOption.minimum = 0;\n        progressBarOption.maximum = 100;\n        progressBarOption.progress = percent;\n\n        if (percent >= 95) {\n            QPalette palette = progressBarOption.palette;\n            palette.setColor(QPalette::Highlight, QColor(218, 68, 83));\n            progressBarOption.palette = palette;\n        }\n\n        style->drawControl(QStyle::CE_ProgressBar, &progressBarOption, painter);\n\n        painter->drawText(progressBarRect, option.displayAlignment | Qt::AlignRight, QString::number(percent) + \"%\");\n    }\n    else {\n        QStyledItemDelegate::paint(painter, option, index);\n    }\n}",
          "note": "cyclic_reference_detected"
        }
      },
      {
        "call_info": {
          "callee": "painter->drawText",
          "args": [
            "progressBarRect",
            "option.displayAlignment | Qt::AlignRight",
            "QString::number(percent) + \"%\""
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QString::number",
          "args": [
            "percent"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "style->drawControl",
          "args": [
            "QStyle::CE_ProgressBar",
            "&progressBarOption",
            "painter"
          ],
          "line": 71
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "palette.setColor",
          "args": [
            "QPalette::Highlight",
            "QColor(218, 68, 83)"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QColor",
          "args": [
            "218",
            "68",
            "83"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "progressBarRect.adjusted",
          "args": [
            "0",
            "textHeight / 2 + textMargin",
            "-percentTextWidth",
            "-textHeight / 2 - textMargin"
          ],
          "line": 60
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QFontMetrics",
          "args": [
            "QLatin1Char('0')"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QLatin1Char",
          "args": [
            "'0'"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QFontMetrics",
          "args": [
            "painter->font()"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "painter->font",
          "args": [],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QFontMetrics",
          "args": [
            "QLatin1Char('0')"
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QLatin1Char",
          "args": [
            "'0'"
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QFontMetrics",
          "args": [
            "painter->font()"
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "painter->font",
          "args": [],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QT_VERSION_CHECK",
          "args": [
            "5",
            "11",
            "0"
          ],
          "line": 55
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "textRect.adjusted",
          "args": [
            "0",
            "textHeight",
            "0",
            "textHeight"
          ],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QFontMetrics",
          "args": [],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QFontMetrics",
          "args": [
            "painter->font()"
          ],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "painter->font",
          "args": [],
          "line": 50
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "painter->drawText",
          "args": [
            "textRect",
            "option.displayAlignment | Qt::AlignRight",
            "storage.formatedSize"
          ],
          "line": 46
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "painter->drawText",
          "args": [
            "textRect",
            "option.displayAlignment",
            "storage.path"
          ],
          "line": 45
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "option.rect.adjusted",
          "args": [
            "textMargin",
            "-topMargin",
            "-textMargin",
            "-topMargin"
          ],
          "line": 43
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QStyledItemDelegate::sizeHint",
          "args": [],
          "line": 42
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QStyledItemDelegate::sizeHint",
          "args": [
            "option",
            "index"
          ],
          "line": 42
        },
        "resolved": true,
        "details": {
          "function_name": "sizeHint",
          "container": "StorageItemDelegate",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2022-40673/repo/src/storageitemdelegate.cpp",
          "lines": "12-17",
          "snippet": "QSize StorageItemDelegate::sizeHint(const QStyleOptionViewItem &option, const QModelIndex &index) const\n{\n    QSize s = QStyledItemDelegate::sizeHint(option, index);\n    s.setHeight(s.height() * 2); // double item height\n    return s;\n}",
          "includes": [
            "#include \"global.h\"",
            "#include <QApplication>",
            "#include <QPainter>",
            "#include \"storageitemdelegate.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"global.h\"\n#include <QApplication>\n#include <QPainter>\n#include \"storageitemdelegate.h\"\n\nStorageItemDelegate {\n  QSize StorageItemDelegate::sizeHint(const QStyleOptionViewItem &option, const QModelIndex &index) const\n  {\n      QSize s = QStyledItemDelegate::sizeHint(option, index);\n      s.setHeight(s.height() * 2); // double item height\n      return s;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "style->pixelMetric",
          "args": [
            "QStyle::PM_FocusFrameHMargin",
            "0",
            "option.widget"
          ],
          "line": 40
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "painter->setPen",
          "args": [
            "option.palette.color(cg, QPalette::Text)"
          ],
          "line": 37
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "option.palette.color",
          "args": [
            "cg",
            "QPalette::Text"
          ],
          "line": 37
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "painter->setPen",
          "args": [
            "option.palette.color(cg, QPalette::HighlightedText)"
          ],
          "line": 35
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "option.palette.color",
          "args": [
            "cg",
            "QPalette::HighlightedText"
          ],
          "line": 35
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "painter->fillRect",
          "args": [
            "option.rect",
            "option.palette.brush(cg, QPalette::Highlight)"
          ],
          "line": 34
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "option.palette.brush",
          "args": [
            "cg",
            "QPalette::Highlight"
          ],
          "line": 34
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QApplication::style",
          "args": [],
          "line": 26
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "option.widget->style",
          "args": [],
          "line": 26
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "variant.value<Global::Storage>",
          "args": [],
          "line": 24
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "variant.canConvert<Global::Storage>",
          "args": [],
          "line": 23
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "index.data",
          "args": [
            "Qt::UserRole"
          ],
          "line": 21
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"global.h\"\n#include <QApplication>\n#include <QPainter>\n#include \"storageitemdelegate.h\"\n\nStorageItemDelegate {\n  void StorageItemDelegate::paint(QPainter *painter, const QStyleOptionViewItem &option, const QModelIndex &index) const\n  {\n      QVariant variant = index.data(Qt::UserRole);\n  \n      if (variant.canConvert<Global::Storage>()) {\n          Global::Storage storage = variant.value<Global::Storage>();\n  \n          QStyle *style = option.widget ? option.widget->style() : QApplication::style();\n  \n          QPalette::ColorGroup cg = option.state & QStyle::State_Enabled\n                                    ? QPalette::Normal : QPalette::Disabled;\n          if (cg == QPalette::Normal && !(option.state & QStyle::State_Active))\n              cg = QPalette::Inactive;\n  \n          if (option.state & QStyle::State_Selected) {\n              painter->fillRect(option.rect, option.palette.brush(cg, QPalette::Highlight));\n              painter->setPen(option.palette.color(cg, QPalette::HighlightedText));\n          } else {\n              painter->setPen(option.palette.color(cg, QPalette::Text));\n          }\n  \n          const int textMargin = style->pixelMetric(QStyle::PM_FocusFrameHMargin, 0, option.widget) + 1;\n          // we will move the text up half of the total height\n          const int topMargin = QStyledItemDelegate::sizeHint(option, index).height() / 2;\n          QRect textRect = option.rect.adjusted(textMargin, -topMargin, -textMargin, -topMargin);\n  \n          painter->drawText(textRect, option.displayAlignment, storage.path);\n          painter->drawText(textRect, option.displayAlignment | Qt::AlignRight, storage.formatedSize);\n  \n          QStyleOptionProgressBar progressBarOption;\n  \n          const int textHeight = QFontMetrics(painter->font()).height();\n          QRect progressBarRect = textRect.adjusted(0, textHeight, 0, textHeight);\n  \n          const int percent = storage.bytesOccupied * 100 / storage.bytesTotal;\n  \n  #if QT_VERSION >= QT_VERSION_CHECK(5, 11, 0)\n          int percentTextWidth = QFontMetrics(painter->font()).horizontalAdvance(QLatin1Char('0')) * 4;\n  #else\n          int percentTextWidth = QFontMetrics(painter->font()).width(QLatin1Char('0')) * 4;\n  #endif\n          progressBarOption.rect = progressBarRect.adjusted(0, textHeight / 2 + textMargin, -percentTextWidth, -textHeight / 2 - textMargin);\n          progressBarOption.minimum = 0;\n          progressBarOption.maximum = 100;\n          progressBarOption.progress = percent;\n  \n          if (percent >= 95) {\n              QPalette palette = progressBarOption.palette;\n              palette.setColor(QPalette::Highlight, QColor(218, 68, 83));\n              progressBarOption.palette = palette;\n          }\n  \n          style->drawControl(QStyle::CE_ProgressBar, &progressBarOption, painter);\n  \n          painter->drawText(progressBarRect, option.displayAlignment | Qt::AlignRight, QString::number(percent) + \"%\");\n      }\n      else {\n          QStyledItemDelegate::paint(painter, option, index);\n      }\n  }\n}"
  },
  {
    "function_name": "sizeHint",
    "container": "StorageItemDelegate",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2022-40673/repo/src/storageitemdelegate.cpp",
    "lines": "12-17",
    "snippet": "QSize StorageItemDelegate::sizeHint(const QStyleOptionViewItem &option, const QModelIndex &index) const\n{\n    QSize s = QStyledItemDelegate::sizeHint(option, index);\n    s.setHeight(s.height() * 2); // double item height\n    return s;\n}",
    "includes": [
      "#include \"global.h\"",
      "#include <QApplication>",
      "#include <QPainter>",
      "#include \"storageitemdelegate.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "s.setHeight",
          "args": [
            "s.height() * 2"
          ],
          "line": 15
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "s.height",
          "args": [],
          "line": 15
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "QStyledItemDelegate::sizeHint",
          "args": [
            "option",
            "index"
          ],
          "line": 14
        },
        "resolved": true,
        "details": {
          "function_name": "sizeHint",
          "container": "StorageItemDelegate",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2022-40673/repo/src/storageitemdelegate.cpp",
          "lines": "12-17",
          "snippet": "QSize StorageItemDelegate::sizeHint(const QStyleOptionViewItem &option, const QModelIndex &index) const\n{\n    QSize s = QStyledItemDelegate::sizeHint(option, index);\n    s.setHeight(s.height() * 2); // double item height\n    return s;\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"global.h\"\n#include <QApplication>\n#include <QPainter>\n#include \"storageitemdelegate.h\"\n\nStorageItemDelegate {\n  QSize StorageItemDelegate::sizeHint(const QStyleOptionViewItem &option, const QModelIndex &index) const\n  {\n      QSize s = QStyledItemDelegate::sizeHint(option, index);\n      s.setHeight(s.height() * 2); // double item height\n      return s;\n  }\n}"
  },
  {
    "function_name": "StorageItemDelegate",
    "container": "StorageItemDelegate",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2022-40673/repo/src/storageitemdelegate.cpp",
    "lines": "8-10",
    "snippet": "StorageItemDelegate::StorageItemDelegate(QObject *parent) : QStyledItemDelegate(parent)\n{\n}",
    "includes": [
      "#include \"global.h\"",
      "#include <QApplication>",
      "#include <QPainter>",
      "#include \"storageitemdelegate.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"global.h\"\n#include <QApplication>\n#include <QPainter>\n#include \"storageitemdelegate.h\"\n\nStorageItemDelegate {\n  StorageItemDelegate::StorageItemDelegate(QObject *parent) : QStyledItemDelegate(parent)\n  {\n  }\n}"
  }
]