[
  {
    "function_name": "memcached_get_memory_allocators",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/allocators.cc",
    "lines": "88-109",
    "snippet": "void memcached_get_memory_allocators(const memcached_st *shell, memcached_malloc_fn *mem_malloc,\n                                     memcached_free_fn *mem_free, memcached_realloc_fn *mem_realloc,\n                                     memcached_calloc_fn *mem_calloc) {\n  const Memcached *self = memcached2Memcached(shell);\n  if (self) {\n    if (mem_malloc) {\n      *mem_malloc = self->allocators.malloc;\n    }\n\n    if (mem_free) {\n      *mem_free = self->allocators.free;\n    }\n\n    if (mem_realloc) {\n      *mem_realloc = self->allocators.realloc;\n    }\n\n    if (mem_calloc) {\n      *mem_calloc = self->allocators.calloc;\n    }\n  }\n}",
    "includes": [
      "#include \"libmemcached/common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcached2Memcached",
          "args": [
            "shell"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"libmemcached/common.h\"\n\nvoid memcached_get_memory_allocators(const memcached_st *shell, memcached_malloc_fn *mem_malloc,\n                                     memcached_free_fn *mem_free, memcached_realloc_fn *mem_realloc,\n                                     memcached_calloc_fn *mem_calloc) {\n  const Memcached *self = memcached2Memcached(shell);\n  if (self) {\n    if (mem_malloc) {\n      *mem_malloc = self->allocators.malloc;\n    }\n\n    if (mem_free) {\n      *mem_free = self->allocators.free;\n    }\n\n    if (mem_realloc) {\n      *mem_realloc = self->allocators.realloc;\n    }\n\n    if (mem_calloc) {\n      *mem_calloc = self->allocators.calloc;\n    }\n  }\n}"
  },
  {
    "function_name": "memcached_set_memory_allocators",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/allocators.cc",
    "lines": "51-77",
    "snippet": "memcached_return_t memcached_set_memory_allocators(memcached_st *shell,\n                                                   memcached_malloc_fn mem_malloc,\n                                                   memcached_free_fn mem_free,\n                                                   memcached_realloc_fn mem_realloc,\n                                                   memcached_calloc_fn mem_calloc, void *context) {\n  Memcached *self = memcached2Memcached(shell);\n  if (self == NULL) {\n    return MEMCACHED_INVALID_ARGUMENTS;\n  }\n\n  /* All should be set, or none should be set */\n  if (mem_malloc == NULL and mem_free == NULL and mem_realloc == NULL and mem_calloc == NULL) {\n    self->allocators = memcached_allocators_return_default();\n  } else if (mem_malloc == NULL or mem_free == NULL or mem_realloc == NULL or mem_calloc == NULL) {\n    return memcached_set_error(\n        *self, MEMCACHED_INVALID_ARGUMENTS, MEMCACHED_AT,\n        memcached_literal_param(\"NULL parameter provided for one or more allocators\"));\n  } else {\n    self->allocators.malloc = mem_malloc;\n    self->allocators.free = mem_free;\n    self->allocators.realloc = mem_realloc;\n    self->allocators.calloc = mem_calloc;\n    self->allocators.context = context;\n  }\n\n  return MEMCACHED_SUCCESS;\n}",
    "includes": [
      "#include \"libmemcached/common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcached_set_error",
          "args": [
            "*self",
            "MEMCACHED_INVALID_ARGUMENTS",
            "MEMCACHED_AT",
            "memcached_literal_param(\"NULL parameter provided for one or more allocators\")"
          ],
          "line": 65
        },
        "resolved": true,
        "details": {
          "function_name": "memcached_set_error",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/error.cc",
          "lines": "234-269",
          "snippet": "memcached_return_t memcached_set_error(memcached_instance_st &self, memcached_return_t rc,\n                                       const char *at, memcached_string_t &str) {\n  assert_msg(rc != MEMCACHED_ERRNO,\n             \"Programmer error, MEMCACHED_ERRNO was set to be returned to client\");\n  assert_msg(\n      rc != MEMCACHED_SOME_ERRORS,\n      \"Programmer error, MEMCACHED_SOME_ERRORS was about to be set on a memcached_instance_st\");\n  if (memcached_fatal(rc) == false and rc != MEMCACHED_CLIENT_ERROR) {\n    return rc;\n  }\n\n  char hostname_port_message[MAX_ERROR_LENGTH];\n  char *hostname_port_message_ptr = hostname_port_message;\n  int size = 0;\n  if (str.size) {\n    size = snprintf(hostname_port_message_ptr, sizeof(hostname_port_message), \"%.*s, \",\n                    memcached_string_printf(str));\n    hostname_port_message_ptr += size;\n  }\n\n  size +=\n      append_host_to_string(self, hostname_port_message_ptr, sizeof(hostname_port_message) - size);\n\n  memcached_string_t error_host = {hostname_port_message, size_t(size)};\n\n  assert_msg(self.root, \"Programmer error, root was not set on instance\");\n  if (self.root) {\n    _set(*self.root, &error_host, rc, at);\n    _set(self, (*self.root));\n    assert(self.error_messages);\n    assert(self.root->error_messages);\n    assert(self.error_messages->rc == self.root->error_messages->rc);\n  }\n\n  return rc;\n}",
          "includes": [
            "#include <cstdio>",
            "#include <cstdarg>",
            "#include <cerrno>",
            "#include \"libmemcached/assert.hpp\"",
            "#include \"libmemcached/common.h\""
          ],
          "macros_used": [
            "#define MAX_ERROR_LENGTH 2048"
          ],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <cstdio>\n#include <cstdarg>\n#include <cerrno>\n#include \"libmemcached/assert.hpp\"\n#include \"libmemcached/common.h\"\n\n#define MAX_ERROR_LENGTH 2048\n\nmemcached_return_t memcached_set_error(memcached_instance_st &self, memcached_return_t rc,\n                                       const char *at, memcached_string_t &str) {\n  assert_msg(rc != MEMCACHED_ERRNO,\n             \"Programmer error, MEMCACHED_ERRNO was set to be returned to client\");\n  assert_msg(\n      rc != MEMCACHED_SOME_ERRORS,\n      \"Programmer error, MEMCACHED_SOME_ERRORS was about to be set on a memcached_instance_st\");\n  if (memcached_fatal(rc) == false and rc != MEMCACHED_CLIENT_ERROR) {\n    return rc;\n  }\n\n  char hostname_port_message[MAX_ERROR_LENGTH];\n  char *hostname_port_message_ptr = hostname_port_message;\n  int size = 0;\n  if (str.size) {\n    size = snprintf(hostname_port_message_ptr, sizeof(hostname_port_message), \"%.*s, \",\n                    memcached_string_printf(str));\n    hostname_port_message_ptr += size;\n  }\n\n  size +=\n      append_host_to_string(self, hostname_port_message_ptr, sizeof(hostname_port_message) - size);\n\n  memcached_string_t error_host = {hostname_port_message, size_t(size)};\n\n  assert_msg(self.root, \"Programmer error, root was not set on instance\");\n  if (self.root) {\n    _set(*self.root, &error_host, rc, at);\n    _set(self, (*self.root));\n    assert(self.error_messages);\n    assert(self.root->error_messages);\n    assert(self.error_messages->rc == self.root->error_messages->rc);\n  }\n\n  return rc;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcached_literal_param",
          "args": [
            "\"NULL parameter provided for one or more allocators\""
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcached_allocators_return_default",
          "args": [],
          "line": 63
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcached2Memcached",
          "args": [
            "shell"
          ],
          "line": 56
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"libmemcached/common.h\"\n\nmemcached_return_t memcached_set_memory_allocators(memcached_st *shell,\n                                                   memcached_malloc_fn mem_malloc,\n                                                   memcached_free_fn mem_free,\n                                                   memcached_realloc_fn mem_realloc,\n                                                   memcached_calloc_fn mem_calloc, void *context) {\n  Memcached *self = memcached2Memcached(shell);\n  if (self == NULL) {\n    return MEMCACHED_INVALID_ARGUMENTS;\n  }\n\n  /* All should be set, or none should be set */\n  if (mem_malloc == NULL and mem_free == NULL and mem_realloc == NULL and mem_calloc == NULL) {\n    self->allocators = memcached_allocators_return_default();\n  } else if (mem_malloc == NULL or mem_free == NULL or mem_realloc == NULL or mem_calloc == NULL) {\n    return memcached_set_error(\n        *self, MEMCACHED_INVALID_ARGUMENTS, MEMCACHED_AT,\n        memcached_literal_param(\"NULL parameter provided for one or more allocators\"));\n  } else {\n    self->allocators.malloc = mem_malloc;\n    self->allocators.free = mem_free;\n    self->allocators.realloc = mem_realloc;\n    self->allocators.calloc = mem_calloc;\n    self->allocators.context = context;\n  }\n\n  return MEMCACHED_SUCCESS;\n}"
  },
  {
    "function_name": "memcached_allocators_return_default",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/allocators.cc",
    "lines": "45-49",
    "snippet": "struct memcached_allocator_t memcached_allocators_return_default(void) {\n  static struct memcached_allocator_t global_default_allocator = {\n      _libmemcached_calloc, _libmemcached_free, _libmemcached_malloc, _libmemcached_realloc, 0};\n  return global_default_allocator;\n}",
    "includes": [
      "#include \"libmemcached/common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"libmemcached/common.h\"\n\nstruct memcached_allocator_t memcached_allocators_return_default(void) {\n  static struct memcached_allocator_t global_default_allocator = {\n      _libmemcached_calloc, _libmemcached_free, _libmemcached_malloc, _libmemcached_realloc, 0};\n  return global_default_allocator;\n}"
  },
  {
    "function_name": "_libmemcached_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/allocators.cc",
    "lines": "18-22",
    "snippet": "void _libmemcached_free(const memcached_st *, void *mem, void *) {\n  if (mem) {\n    std::free(mem);\n  }\n}",
    "includes": [
      "#include \"libmemcached/common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "std::free",
          "args": [
            "mem"
          ],
          "line": 20
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"libmemcached/common.h\"\n\nvoid _libmemcached_free(const memcached_st *, void *mem, void *) {\n  if (mem) {\n    std::free(mem);\n  }\n}"
  }
]