[
  {
    "function_name": "apply",
    "container": "client_options",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/bin/common/options.cpp",
    "lines": "149-177",
    "snippet": "bool client_options::apply(memcached_st *memc) {\n#ifdef _WIN32\n  WSADATA wsaData;\n  if (WSAStartup(MAKEWORD(2, 2), &wsaData)) {\n    std::cerr << \"Socket Initialization Error.\\n\";\n    return false;\n  }\n#endif // _WIN32\n\n  extended_option *servers = nullptr;\n  for (auto &opt : options) {\n    if (opt.apply) {\n      // servers should be applied last, so they take up any behaviors previously set\n      if (opt.opt.val == 's' && opt.opt.name == std::string(\"servers\")) {\n        servers = &opt;\n        continue;\n      }\n      if (!opt.apply(*this, opt, memc)) {\n        return false;\n      }\n    }\n  }\n  if (servers) {\n    if (!servers->apply(*this, *servers, memc)) {\n      return false;\n    }\n  }\n  return true;\n}",
    "includes": [
      "#include \"options.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "servers->apply",
          "args": [
            "*this",
            "*servers",
            "memc"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "opt.apply",
          "args": [
            "*this",
            "opt",
            "memc"
          ],
          "line": 166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::string",
          "args": [
            "\"servers\""
          ],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "WSAStartup",
          "args": [
            "MAKEWORD(2, 2)",
            "&wsaData"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "MAKEWORD",
          "args": [
            "2",
            "2"
          ],
          "line": 152
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"options.hpp\"\n\nclient_options {\n  bool client_options::apply(memcached_st *memc) {\n  #ifdef _WIN32\n    WSADATA wsaData;\n    if (WSAStartup(MAKEWORD(2, 2), &wsaData)) {\n      std::cerr << \"Socket Initialization Error.\\n\";\n      return false;\n    }\n  #endif // _WIN32\n  \n    extended_option *servers = nullptr;\n    for (auto &opt : options) {\n      if (opt.apply) {\n        // servers should be applied last, so they take up any behaviors previously set\n        if (opt.opt.val == 's' && opt.opt.name == std::string(\"servers\")) {\n          servers = &opt;\n          continue;\n        }\n        if (!opt.apply(*this, opt, memc)) {\n          return false;\n        }\n      }\n    }\n    if (servers) {\n      if (!servers->apply(*this, *servers, memc)) {\n        return false;\n      }\n    }\n    return true;\n  }\n}"
  },
  {
    "function_name": "parse",
    "container": "client_options",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/bin/common/options.cpp",
    "lines": "88-147",
    "snippet": "bool client_options::parse(int argc, char **argv, char ***argp) {\n  /* extern */ optind = 1;\n  auto debug = has(\"debug\") ? &get(\"debug\") : nullptr;\n  std::string short_opts{};\n  std::vector<option> long_opts{};\n\n  short_opts.reserve(options.size() * 3);\n  long_opts.reserve(options.size() + 1);\n\n  for (const auto &ext : options) {\n    if (ext.opt.val) {\n      short_opts.push_back(ext.opt.val);\n      for (int i = 0; i < ext.opt.has_arg; ++i) {\n        short_opts.push_back(':');\n      }\n    }\n    if (ext.opt.name) {\n      long_opts.push_back(ext.opt);\n    }\n  }\n  long_opts.push_back({});\n\n  while (true) {\n    auto opt = getopt_long(argc, argv, short_opts.c_str(), long_opts.data(), nullptr);\n\n    if (debug->set && opt > 0) {\n      std::cerr << \"Processing option '\" << (char) opt << \"' (\" << opt << \")\\n\";\n    }\n    if (opt == '?') {\n      return false;\n    }\n    if (opt == -1) {\n      if (argp) {\n        *argp = &argv[optind];\n      }\n      return true;\n    }\n\n    auto &ext_opt = get(opt);\n\n    // grab optional argument\n    if (ext_opt.opt.has_arg == optional_argument && !optarg) {\n      auto next_arg = argv[optind];\n\n      if (next_arg && *next_arg && *next_arg != '-') {\n        optarg = next_arg;\n        ++optind;\n      }\n    }\n\n    ext_opt.set = true;\n    ext_opt.arg = optarg;\n\n    if (ext_opt.parse) {\n      if (!ext_opt.parse(*this, ext_opt)) {\n        return false;\n      }\n    }\n  }\n}",
    "includes": [
      "#include \"options.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "ext_opt.parse",
          "args": [
            "*this",
            "ext_opt"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get",
          "args": [
            "opt"
          ],
          "line": 126
        },
        "resolved": true,
        "details": {
          "function_name": "hashkit_get_distribution_function",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libhashkit/function.cc",
          "lines": "175-181",
          "snippet": "hashkit_hash_algorithm_t hashkit_get_distribution_function(const hashkit_st *self) {\n  if (self == NULL) {\n    return HASHKIT_HASH_DEFAULT;\n  }\n\n  return get_function_type(self->distribution_hash.function);\n}",
          "includes": [
            "#include \"libhashkit/common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"libhashkit/common.h\"\n\nhashkit_hash_algorithm_t hashkit_get_distribution_function(const hashkit_st *self) {\n  if (self == NULL) {\n    return HASHKIT_HASH_DEFAULT;\n  }\n\n  return get_function_type(self->distribution_hash.function);\n}"
        }
      },
      {
        "call_info": {
          "callee": "getopt_long",
          "args": [
            "argc",
            "argv",
            "short_opts.c_str()",
            "long_opts.data()",
            "nullptr"
          ],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "long_opts.data",
          "args": [],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "short_opts.c_str",
          "args": [],
          "line": 111
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "long_opts.push_back",
          "args": [
            "{}"
          ],
          "line": 108
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "long_opts.push_back",
          "args": [
            "ext.opt"
          ],
          "line": 105
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "short_opts.push_back",
          "args": [
            "':'"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "short_opts.push_back",
          "args": [
            "ext.opt.val"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "long_opts.reserve",
          "args": [
            "options.size() + 1"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "options.size",
          "args": [],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "short_opts.reserve",
          "args": [
            "options.size() * 3"
          ],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "options.size",
          "args": [],
          "line": 94
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "has",
          "args": [
            "\"debug\""
          ],
          "line": 90
        },
        "resolved": true,
        "details": {
          "function_name": "has",
          "container": "client_options",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/bin/common/options.hpp",
          "lines": "281-284",
          "snippet": "bool has(int c) const {\n    auto found = find(c);\n    return found != options.cend();\n  }",
          "includes": [
            "#include \"p9y/getopt.hpp\"",
            "#include \"libmemcached/common.h\"",
            "#include <vector>",
            "#include <string>",
            "#include <iostream>",
            "#include <functional>",
            "#include <climits>",
            "#include <cstdint>",
            "#include <algorithm>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"p9y/getopt.hpp\"\n#include \"libmemcached/common.h\"\n#include <vector>\n#include <string>\n#include <iostream>\n#include <functional>\n#include <climits>\n#include <cstdint>\n#include <algorithm>\n\nclient_options {\n  bool has(int c) const {\n      auto found = find(c);\n      return found != options.cend();\n    }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"options.hpp\"\n\nclient_options {\n  bool client_options::parse(int argc, char **argv, char ***argp) {\n    /* extern */ optind = 1;\n    auto debug = has(\"debug\") ? &get(\"debug\") : nullptr;\n    std::string short_opts{};\n    std::vector<option> long_opts{};\n  \n    short_opts.reserve(options.size() * 3);\n    long_opts.reserve(options.size() + 1);\n  \n    for (const auto &ext : options) {\n      if (ext.opt.val) {\n        short_opts.push_back(ext.opt.val);\n        for (int i = 0; i < ext.opt.has_arg; ++i) {\n          short_opts.push_back(':');\n        }\n      }\n      if (ext.opt.name) {\n        long_opts.push_back(ext.opt);\n      }\n    }\n    long_opts.push_back({});\n  \n    while (true) {\n      auto opt = getopt_long(argc, argv, short_opts.c_str(), long_opts.data(), nullptr);\n  \n      if (debug->set && opt > 0) {\n        std::cerr << \"Processing option '\" << (char) opt << \"' (\" << opt << \")\\n\";\n      }\n      if (opt == '?') {\n        return false;\n      }\n      if (opt == -1) {\n        if (argp) {\n          *argp = &argv[optind];\n        }\n        return true;\n      }\n  \n      auto &ext_opt = get(opt);\n  \n      // grab optional argument\n      if (ext_opt.opt.has_arg == optional_argument && !optarg) {\n        auto next_arg = argv[optind];\n  \n        if (next_arg && *next_arg && *next_arg != '-') {\n          optarg = next_arg;\n          ++optind;\n        }\n      }\n  \n      ext_opt.set = true;\n      ext_opt.arg = optarg;\n  \n      if (ext_opt.parse) {\n        if (!ext_opt.parse(*this, ext_opt)) {\n          return false;\n        }\n      }\n    }\n  }\n}"
  },
  {
    "function_name": "print_help",
    "container": "client_options",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/bin/common/options.cpp",
    "lines": "23-86",
    "snippet": "void client_options::print_help() const {\n  print_version();\n  std::cout << \"\\n\\t\" << prog_desc << \"\\n\\n\";\n  std::cout << \"Usage:\\n\\t\" << prog_name << \" -[\";\n  for (const auto &opt : options) {\n    if (!opt.opt.has_arg && opt.opt.val != '-') {\n      std::cout << (char) opt.opt.val;\n    }\n  }\n  std::cout << \"] [-\";\n  for (const auto &ext : options) {\n    if (ext.opt.has_arg) {\n      std::cout << (char) ext.opt.val;\n      if ((&ext) != &*options.rbegin())\n        std::cout << '|';\n    }\n  }\n  std::cout << \" <arg>] \";\n\n  if (prog_argp) {\n    std::cout << prog_argp;\n  }\n  std::cout << \"\\n\\nOptions:\\n\";\n  for (const auto &ext : options) {\n    if (ext.opt.val == '-' || !(ext.opt.val || ext.opt.name)) {\n      continue;\n    }\n    std::cout << \"\\t\";\n    if (ext.opt.val) {\n      std::cout << \"-\" << (char) ext.opt.val;\n      if (ext.opt.name) {\n        std::cout << \"|\";\n      }\n    } else {\n      std::cout << \"   \";\n    }\n    if (ext.opt.name) {\n      std::cout << \"--\" << ext.opt.name << \" \";\n    } else {\n      std::cout << \" \";\n    }\n    if (ext.opt.has_arg) {\n      if (ext.opt.has_arg == optional_argument) {\n        std::cout << \"[\";\n      } else {\n        std::cout << \"<\";\n      }\n      std::cout << \"arg\";\n      if (ext.opt.has_arg == optional_argument) {\n        std::cout << \"]\";\n      } else {\n        std::cout << \">\";\n      }\n    }\n    std::cout << \"\\n\\t\\t\" << ext.help << \"\\n\";\n  }\n\n  if (has(\"servers\")) {\n    std::cout << \"\\nEnvironment:\\n\";\n    std::cout << \"\\tMEMCACHED_SERVERS=\\n\";\n    std::cout << \"\\t\\tList of servers to use if `-s|--servers` was not provided.\\n\";\n  }\n  std::cout << std::endl;\n}",
    "includes": [
      "#include \"options.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "has",
          "args": [
            "\"servers\""
          ],
          "line": 80
        },
        "resolved": true,
        "details": {
          "function_name": "has",
          "container": "client_options",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/bin/common/options.hpp",
          "lines": "281-284",
          "snippet": "bool has(int c) const {\n    auto found = find(c);\n    return found != options.cend();\n  }",
          "includes": [
            "#include \"p9y/getopt.hpp\"",
            "#include \"libmemcached/common.h\"",
            "#include <vector>",
            "#include <string>",
            "#include <iostream>",
            "#include <functional>",
            "#include <climits>",
            "#include <cstdint>",
            "#include <algorithm>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"p9y/getopt.hpp\"\n#include \"libmemcached/common.h\"\n#include <vector>\n#include <string>\n#include <iostream>\n#include <functional>\n#include <climits>\n#include <cstdint>\n#include <algorithm>\n\nclient_options {\n  bool has(int c) const {\n      auto found = find(c);\n      return found != options.cend();\n    }\n}"
        }
      },
      {
        "call_info": {
          "callee": "options.rbegin",
          "args": [],
          "line": 36
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "print_version",
          "args": [],
          "line": 24
        },
        "resolved": true,
        "details": {
          "function_name": "print_version",
          "container": "client_options",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/bin/common/options.cpp",
          "lines": "18-21",
          "snippet": "void client_options::print_version() const {\n  std::cout << prog_name << \" v\" << prog_vers << \" (libmemcached v\" << LIBMEMCACHED_VERSION_STRING << \")\"\n            << std::endl;\n}",
          "includes": [
            "#include \"options.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"options.hpp\"\n\nclient_options {\n  void client_options::print_version() const {\n    std::cout << prog_name << \" v\" << prog_vers << \" (libmemcached v\" << LIBMEMCACHED_VERSION_STRING << \")\"\n              << std::endl;\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"options.hpp\"\n\nclient_options {\n  void client_options::print_help() const {\n    print_version();\n    std::cout << \"\\n\\t\" << prog_desc << \"\\n\\n\";\n    std::cout << \"Usage:\\n\\t\" << prog_name << \" -[\";\n    for (const auto &opt : options) {\n      if (!opt.opt.has_arg && opt.opt.val != '-') {\n        std::cout << (char) opt.opt.val;\n      }\n    }\n    std::cout << \"] [-\";\n    for (const auto &ext : options) {\n      if (ext.opt.has_arg) {\n        std::cout << (char) ext.opt.val;\n        if ((&ext) != &*options.rbegin())\n          std::cout << '|';\n      }\n    }\n    std::cout << \" <arg>] \";\n  \n    if (prog_argp) {\n      std::cout << prog_argp;\n    }\n    std::cout << \"\\n\\nOptions:\\n\";\n    for (const auto &ext : options) {\n      if (ext.opt.val == '-' || !(ext.opt.val || ext.opt.name)) {\n        continue;\n      }\n      std::cout << \"\\t\";\n      if (ext.opt.val) {\n        std::cout << \"-\" << (char) ext.opt.val;\n        if (ext.opt.name) {\n          std::cout << \"|\";\n        }\n      } else {\n        std::cout << \"   \";\n      }\n      if (ext.opt.name) {\n        std::cout << \"--\" << ext.opt.name << \" \";\n      } else {\n        std::cout << \" \";\n      }\n      if (ext.opt.has_arg) {\n        if (ext.opt.has_arg == optional_argument) {\n          std::cout << \"[\";\n        } else {\n          std::cout << \"<\";\n        }\n        std::cout << \"arg\";\n        if (ext.opt.has_arg == optional_argument) {\n          std::cout << \"]\";\n        } else {\n          std::cout << \">\";\n        }\n      }\n      std::cout << \"\\n\\t\\t\" << ext.help << \"\\n\";\n    }\n  \n    if (has(\"servers\")) {\n      std::cout << \"\\nEnvironment:\\n\";\n      std::cout << \"\\tMEMCACHED_SERVERS=\\n\";\n      std::cout << \"\\t\\tList of servers to use if `-s|--servers` was not provided.\\n\";\n    }\n    std::cout << std::endl;\n  }\n}"
  },
  {
    "function_name": "print_version",
    "container": "client_options",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/bin/common/options.cpp",
    "lines": "18-21",
    "snippet": "void client_options::print_version() const {\n  std::cout << prog_name << \" v\" << prog_vers << \" (libmemcached v\" << LIBMEMCACHED_VERSION_STRING << \")\"\n            << std::endl;\n}",
    "includes": [
      "#include \"options.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"options.hpp\"\n\nclient_options {\n  void client_options::print_version() const {\n    std::cout << prog_name << \" v\" << prog_vers << \" (libmemcached v\" << LIBMEMCACHED_VERSION_STRING << \")\"\n              << std::endl;\n  }\n}"
  }
]