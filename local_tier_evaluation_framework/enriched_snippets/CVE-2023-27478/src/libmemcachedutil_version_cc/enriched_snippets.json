[
  {
    "function_name": "libmemcached_util_version_check",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcachedutil/version.cc",
    "lines": "49-62",
    "snippet": "bool libmemcached_util_version_check(memcached_st *memc, uint8_t major_version,\n                                     uint8_t minor_version, uint8_t micro_version) {\n  if (memcached_failed(memcached_version(memc))) {\n    return false;\n  }\n\n  struct local_context check = {major_version, minor_version, micro_version, true};\n\n  memcached_server_fn callbacks[1];\n  callbacks[0] = check_server_version;\n  memcached_server_cursor(memc, callbacks, (void *) &check, 1);\n\n  return check.truth;\n}",
    "includes": [
      "#include <cassert>",
      "#include \"libmemcachedutil/common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcached_server_cursor",
          "args": [
            "memc",
            "callbacks",
            "(void *) &check",
            "1"
          ],
          "line": 59
        },
        "resolved": true,
        "details": {
          "function_name": "memcached_server_cursor",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/instance.cc",
          "lines": "147-171",
          "snippet": "memcached_return_t memcached_server_cursor(const memcached_st *shell,\n                                           const memcached_server_fn *callback, void *context,\n                                           uint32_t number_of_callbacks) {\n  const Memcached *memc = memcached2Memcached(shell);\n  memcached_return_t rc;\n  if (memcached_failed(rc = initialize_const_query(memc))) {\n    return rc;\n  }\n\n  size_t errors = 0;\n  for (uint32_t x = 0; x < memcached_instance_list_count(memc); x++) {\n    memcached_instance_st *instance = memcached_instance_by_position(memc, x);\n\n    for (uint32_t y = 0; y < number_of_callbacks; y++) {\n      memcached_return_t ret = (*callback[y])(memc, instance, context);\n\n      if (memcached_failed(ret)) {\n        errors++;\n        continue;\n      }\n    }\n  }\n\n  return errors ? MEMCACHED_SOME_ERRORS : MEMCACHED_SUCCESS;\n}",
          "includes": [
            "#include \"libmemcached/common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"libmemcached/common.h\"\n\nmemcached_return_t memcached_server_cursor(const memcached_st *shell,\n                                           const memcached_server_fn *callback, void *context,\n                                           uint32_t number_of_callbacks) {\n  const Memcached *memc = memcached2Memcached(shell);\n  memcached_return_t rc;\n  if (memcached_failed(rc = initialize_const_query(memc))) {\n    return rc;\n  }\n\n  size_t errors = 0;\n  for (uint32_t x = 0; x < memcached_instance_list_count(memc); x++) {\n    memcached_instance_st *instance = memcached_instance_by_position(memc, x);\n\n    for (uint32_t y = 0; y < number_of_callbacks; y++) {\n      memcached_return_t ret = (*callback[y])(memc, instance, context);\n\n      if (memcached_failed(ret)) {\n        errors++;\n        continue;\n      }\n    }\n  }\n\n  return errors ? MEMCACHED_SOME_ERRORS : MEMCACHED_SUCCESS;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcached_failed",
          "args": [
            "memcached_version(memc)"
          ],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcached_version",
          "args": [
            "memc"
          ],
          "line": 51
        },
        "resolved": true,
        "details": {
          "function_name": "memcached_version",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/version.cc",
          "lines": "164-184",
          "snippet": "memcached_return_t memcached_version(memcached_st *shell) {\n  Memcached *memc = memcached2Memcached(shell);\n  if (memc) {\n    memcached_return_t rc;\n    if (memcached_failed(rc = initialize_query(memc, true))) {\n      return rc;\n    }\n\n    if (memcached_is_udp(memc)) {\n      return MEMCACHED_NOT_SUPPORTED;\n    }\n\n    if (memcached_is_binary(memc)) {\n      return memcached_version_binary(memc);\n    }\n\n    return memcached_version_textual(memc);\n  }\n\n  return MEMCACHED_INVALID_ARGUMENTS;\n}",
          "includes": [
            "#include \"libmemcached/common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"libmemcached/common.h\"\n\nmemcached_return_t memcached_version(memcached_st *shell) {\n  Memcached *memc = memcached2Memcached(shell);\n  if (memc) {\n    memcached_return_t rc;\n    if (memcached_failed(rc = initialize_query(memc, true))) {\n      return rc;\n    }\n\n    if (memcached_is_udp(memc)) {\n      return MEMCACHED_NOT_SUPPORTED;\n    }\n\n    if (memcached_is_binary(memc)) {\n      return memcached_version_binary(memc);\n    }\n\n    return memcached_version_textual(memc);\n  }\n\n  return MEMCACHED_INVALID_ARGUMENTS;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <cassert>\n#include \"libmemcachedutil/common.h\"\n\nbool libmemcached_util_version_check(memcached_st *memc, uint8_t major_version,\n                                     uint8_t minor_version, uint8_t micro_version) {\n  if (memcached_failed(memcached_version(memc))) {\n    return false;\n  }\n\n  struct local_context check = {major_version, minor_version, micro_version, true};\n\n  memcached_server_fn callbacks[1];\n  callbacks[0] = check_server_version;\n  memcached_server_cursor(memc, callbacks, (void *) &check, 1);\n\n  return check.truth;\n}"
  },
  {
    "function_name": "check_server_version",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcachedutil/version.cc",
    "lines": "27-47",
    "snippet": "static memcached_return_t\ncheck_server_version(const memcached_st *, const memcached_instance_st *instance, void *context) {\n  /* Do Nothing */\n  struct local_context *check = (struct local_context *) context;\n\n  if (memcached_server_major_version(instance) != UINT8_MAX) {\n    uint32_t sv, cv;\n\n    sv = memcached_server_micro_version(instance) | memcached_server_minor_version(instance) << 8\n        | memcached_server_major_version(instance) << 16;\n    cv = check->micro_version | check->minor_version << 8 | check->major_version << 16;\n\n    if (sv >= cv) {\n      return MEMCACHED_SUCCESS;\n    }\n  }\n\n  check->truth = false;\n\n  return MEMCACHED_FAILURE;\n}",
    "includes": [
      "#include <cassert>",
      "#include \"libmemcachedutil/common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "memcached_server_major_version",
          "args": [
            "instance"
          ],
          "line": 36
        },
        "resolved": true,
        "details": {
          "function_name": "memcached_server_major_version",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/server.cc",
          "lines": "205-211",
          "snippet": "uint8_t memcached_server_major_version(const memcached_instance_st *instance) {\n  if (instance) {\n    return instance->major_version;\n  }\n\n  return UINT8_MAX;\n}",
          "includes": [
            "#include \"libmemcached/common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"libmemcached/common.h\"\n\nuint8_t memcached_server_major_version(const memcached_instance_st *instance) {\n  if (instance) {\n    return instance->major_version;\n  }\n\n  return UINT8_MAX;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcached_server_minor_version",
          "args": [
            "instance"
          ],
          "line": 35
        },
        "resolved": true,
        "details": {
          "function_name": "memcached_server_minor_version",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/server.cc",
          "lines": "213-219",
          "snippet": "uint8_t memcached_server_minor_version(const memcached_instance_st *instance) {\n  if (instance) {\n    return instance->minor_version;\n  }\n\n  return UINT8_MAX;\n}",
          "includes": [
            "#include \"libmemcached/common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"libmemcached/common.h\"\n\nuint8_t memcached_server_minor_version(const memcached_instance_st *instance) {\n  if (instance) {\n    return instance->minor_version;\n  }\n\n  return UINT8_MAX;\n}"
        }
      },
      {
        "call_info": {
          "callee": "memcached_server_micro_version",
          "args": [
            "instance"
          ],
          "line": 35
        },
        "resolved": true,
        "details": {
          "function_name": "memcached_server_micro_version",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/server.cc",
          "lines": "221-227",
          "snippet": "uint8_t memcached_server_micro_version(const memcached_instance_st *instance) {\n  if (instance) {\n    return instance->micro_version;\n  }\n\n  return UINT8_MAX;\n}",
          "includes": [
            "#include \"libmemcached/common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"libmemcached/common.h\"\n\nuint8_t memcached_server_micro_version(const memcached_instance_st *instance) {\n  if (instance) {\n    return instance->micro_version;\n  }\n\n  return UINT8_MAX;\n}"
        }
      }
    ],
    "contextual_snippet": "#include <cassert>\n#include \"libmemcachedutil/common.h\"\n\nstatic memcached_return_t\ncheck_server_version(const memcached_st *, const memcached_instance_st *instance, void *context) {\n  /* Do Nothing */\n  struct local_context *check = (struct local_context *) context;\n\n  if (memcached_server_major_version(instance) != UINT8_MAX) {\n    uint32_t sv, cv;\n\n    sv = memcached_server_micro_version(instance) | memcached_server_minor_version(instance) << 8\n        | memcached_server_major_version(instance) << 16;\n    cv = check->micro_version | check->minor_version << 8 | check->major_version << 16;\n\n    if (sv >= cv) {\n      return MEMCACHED_SUCCESS;\n    }\n  }\n\n  check->truth = false;\n\n  return MEMCACHED_FAILURE;\n}"
  }
]