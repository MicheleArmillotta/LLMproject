[
  {
    "function_name": "custom_backtrace",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/backtrace.cc",
    "lines": "86-88",
    "snippet": "void custom_backtrace(void) {\n  fprintf(stderr, \"Backtrace null function called\\n\");\n}",
    "includes": [
      "#    include <dlfcn.h>",
      "#    include <cxxabi.h>",
      "#  include BACKTRACE_HEADER",
      "#include <cstring>",
      "#include <cstdlib>",
      "#include <cstdio>",
      "#include \"libmemcached/backtrace.hpp\"",
      "#include \"mem_config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Backtrace null function called\\n\""
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#    include <dlfcn.h>\n#    include <cxxabi.h>\n#  include BACKTRACE_HEADER\n#include <cstring>\n#include <cstdlib>\n#include <cstdio>\n#include \"libmemcached/backtrace.hpp\"\n#include \"mem_config.h\"\n\nvoid custom_backtrace(void) {\n  fprintf(stderr, \"Backtrace null function called\\n\");\n}"
  },
  {
    "function_name": "custom_backtrace",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/backtrace.cc",
    "lines": "38-82",
    "snippet": "void custom_backtrace(void) {\n  void *backtrace_buffer[MAX_DEPTH + 1];\n\n  int stack_frames = backtrace(backtrace_buffer, MAX_DEPTH);\n  if (stack_frames) {\n    char **symbollist = backtrace_symbols(backtrace_buffer, stack_frames);\n    if (symbollist) {\n      for (int x = 0; x < stack_frames; x++) {\n        bool was_demangled = false;\n\n#  ifdef HAVE_ABI____CXA_DEMANGLE\n#    ifdef HAVE_DLFCN_H\n          Dl_info dlinfo;\n          if (dladdr(backtrace_buffer[x], &dlinfo)) {\n            char demangled_buffer[1024];\n            const char *called_in = \"<unresolved>\";\n            if (dlinfo.dli_sname) {\n              size_t demangled_size = sizeof(demangled_buffer);\n              int status;\n              char *demangled;\n              if ((demangled = abi::__cxa_demangle(dlinfo.dli_sname, demangled_buffer,\n                                                   &demangled_size, &status))) {\n                called_in = demangled;\n                fprintf(stderr, \"---> demangled: %s -> %s\\n\", demangled_buffer, demangled);\n              } else {\n                called_in = dlinfo.dli_sname;\n              }\n\n              was_demangled = true;\n              fprintf(stderr, \"#%d  %p in %s at %s\\n\", x, backtrace_buffer[x], called_in,\n                      dlinfo.dli_fname);\n            }\n          }\n#    endif\n#  endif\n\n        if (was_demangled == false) {\n          fprintf(stderr, \"?%d  %p in %s\\n\", x, backtrace_buffer[x], symbollist[x]);\n        }\n      }\n\n      ::free(symbollist);\n    }\n  }\n}",
    "includes": [
      "#    include <dlfcn.h>",
      "#    include <cxxabi.h>",
      "#  include BACKTRACE_HEADER",
      "#include <cstring>",
      "#include <cstdlib>",
      "#include <cstdio>",
      "#include \"libmemcached/backtrace.hpp\"",
      "#include \"mem_config.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "::free",
          "args": [
            "symbollist"
          ],
          "line": 79
        },
        "resolved": true,
        "details": {
          "function_name": "memcached_result_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/result.cc",
          "lines": "66-82",
          "snippet": "void memcached_result_free(memcached_result_st *ptr) {\n  if (ptr == NULL) {\n    return;\n  }\n\n  memcached_string_free(&ptr->value);\n  ptr->numeric_value = UINT64_MAX;\n\n  if (memcached_is_allocated(ptr)) {\n    WATCHPOINT_ASSERT(\n        ptr->root); // Without a root, that means that result was not properly initialized.\n    libmemcached_free(ptr->root, ptr);\n  } else {\n    ptr->count = 0;\n    ptr->options.is_initialized = false;\n  }\n}",
          "includes": [
            "#include \"libmemcached/common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"libmemcached/common.h\"\n\nvoid memcached_result_free(memcached_result_st *ptr) {\n  if (ptr == NULL) {\n    return;\n  }\n\n  memcached_string_free(&ptr->value);\n  ptr->numeric_value = UINT64_MAX;\n\n  if (memcached_is_allocated(ptr)) {\n    WATCHPOINT_ASSERT(\n        ptr->root); // Without a root, that means that result was not properly initialized.\n    libmemcached_free(ptr->root, ptr);\n  } else {\n    ptr->count = 0;\n    ptr->options.is_initialized = false;\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"?%d  %p in %s\\n\"",
            "x",
            "backtrace_buffer[x]",
            "symbollist[x]"
          ],
          "line": 75
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"#%d  %p in %s at %s\\n\"",
            "x",
            "backtrace_buffer[x]",
            "called_in",
            "dlinfo.dli_fname"
          ],
          "line": 67
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"---> demangled: %s -> %s\\n\"",
            "demangled_buffer",
            "demangled"
          ],
          "line": 61
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "abi::__cxa_demangle",
          "args": [
            "dlinfo.dli_sname",
            "demangled_buffer",
            "&demangled_size",
            "&status"
          ],
          "line": 58
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dladdr",
          "args": [
            "backtrace_buffer[x]",
            "&dlinfo"
          ],
          "line": 51
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "backtrace_symbols",
          "args": [
            "backtrace_buffer",
            "stack_frames"
          ],
          "line": 43
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "backtrace",
          "args": [
            "backtrace_buffer",
            "MAX_DEPTH"
          ],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#    include <dlfcn.h>\n#    include <cxxabi.h>\n#  include BACKTRACE_HEADER\n#include <cstring>\n#include <cstdlib>\n#include <cstdio>\n#include \"libmemcached/backtrace.hpp\"\n#include \"mem_config.h\"\n\nvoid custom_backtrace(void) {\n  void *backtrace_buffer[MAX_DEPTH + 1];\n\n  int stack_frames = backtrace(backtrace_buffer, MAX_DEPTH);\n  if (stack_frames) {\n    char **symbollist = backtrace_symbols(backtrace_buffer, stack_frames);\n    if (symbollist) {\n      for (int x = 0; x < stack_frames; x++) {\n        bool was_demangled = false;\n\n#  ifdef HAVE_ABI____CXA_DEMANGLE\n#    ifdef HAVE_DLFCN_H\n          Dl_info dlinfo;\n          if (dladdr(backtrace_buffer[x], &dlinfo)) {\n            char demangled_buffer[1024];\n            const char *called_in = \"<unresolved>\";\n            if (dlinfo.dli_sname) {\n              size_t demangled_size = sizeof(demangled_buffer);\n              int status;\n              char *demangled;\n              if ((demangled = abi::__cxa_demangle(dlinfo.dli_sname, demangled_buffer,\n                                                   &demangled_size, &status))) {\n                called_in = demangled;\n                fprintf(stderr, \"---> demangled: %s -> %s\\n\", demangled_buffer, demangled);\n              } else {\n                called_in = dlinfo.dli_sname;\n              }\n\n              was_demangled = true;\n              fprintf(stderr, \"#%d  %p in %s at %s\\n\", x, backtrace_buffer[x], called_in,\n                      dlinfo.dli_fname);\n            }\n          }\n#    endif\n#  endif\n\n        if (was_demangled == false) {\n          fprintf(stderr, \"?%d  %p in %s\\n\", x, backtrace_buffer[x], symbollist[x]);\n        }\n      }\n\n      ::free(symbollist);\n    }\n  }\n}"
  }
]