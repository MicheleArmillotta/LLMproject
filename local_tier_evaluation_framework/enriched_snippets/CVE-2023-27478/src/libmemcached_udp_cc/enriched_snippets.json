[
  {
    "function_name": "memcached_io_init_udp_header",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/udp.cc",
    "lines": "41-52",
    "snippet": "bool memcached_io_init_udp_header(memcached_instance_st *ptr, const uint16_t thread_id) {\n  if (thread_id > UDP_REQUEST_ID_MAX_THREAD_ID) {\n    return MEMCACHED_FAILURE;\n  }\n\n  struct udp_datagram_header_st *header = (struct udp_datagram_header_st *) ptr->write_buffer;\n  header->request_id = htons(uint16_t((generate_udp_request_thread_id(thread_id))));\n  header->num_datagrams = htons(1);\n  header->sequence_number = htons(0);\n\n  return MEMCACHED_SUCCESS;\n}",
    "includes": [
      "#include \"libmemcached/common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "htons",
          "args": [
            "0"
          ],
          "line": 49
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "htons",
          "args": [
            "1"
          ],
          "line": 48
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "htons",
          "args": [
            "uint16_t((generate_udp_request_thread_id(thread_id)))"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "uint16_t",
          "args": [
            "(generate_udp_request_thread_id(thread_id))"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "generate_udp_request_thread_id",
          "args": [
            "thread_id"
          ],
          "line": 47
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"libmemcached/common.h\"\n\nbool memcached_io_init_udp_header(memcached_instance_st *ptr, const uint16_t thread_id) {\n  if (thread_id > UDP_REQUEST_ID_MAX_THREAD_ID) {\n    return MEMCACHED_FAILURE;\n  }\n\n  struct udp_datagram_header_st *header = (struct udp_datagram_header_st *) ptr->write_buffer;\n  header->request_id = htons(uint16_t((generate_udp_request_thread_id(thread_id))));\n  header->num_datagrams = htons(1);\n  header->sequence_number = htons(0);\n\n  return MEMCACHED_SUCCESS;\n}"
  },
  {
    "function_name": "increment_udp_message_id",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/udp.cc",
    "lines": "29-39",
    "snippet": "void increment_udp_message_id(memcached_instance_st *ptr) {\n  struct udp_datagram_header_st *header = (struct udp_datagram_header_st *) ptr->write_buffer;\n  uint16_t cur_req = get_udp_datagram_request_id(header);\n  int msg_num = get_msg_num_from_request_id(cur_req);\n  int thread_id = get_thread_id_from_request_id(cur_req);\n\n  if (((++msg_num) & UDP_REQUEST_ID_THREAD_MASK))\n    msg_num = 0;\n\n  header->request_id = htons((uint16_t)(thread_id | msg_num));\n}",
    "includes": [
      "#include \"libmemcached/common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "htons",
          "args": [
            "(uint16_t)(thread_id | msg_num)"
          ],
          "line": 38
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_thread_id_from_request_id",
          "args": [
            "cur_req"
          ],
          "line": 33
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_msg_num_from_request_id",
          "args": [
            "cur_req"
          ],
          "line": 32
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "get_udp_datagram_request_id",
          "args": [
            "header"
          ],
          "line": 31
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"libmemcached/common.h\"\n\nvoid increment_udp_message_id(memcached_instance_st *ptr) {\n  struct udp_datagram_header_st *header = (struct udp_datagram_header_st *) ptr->write_buffer;\n  uint16_t cur_req = get_udp_datagram_request_id(header);\n  int msg_num = get_msg_num_from_request_id(cur_req);\n  int thread_id = get_thread_id_from_request_id(cur_req);\n\n  if (((++msg_num) & UDP_REQUEST_ID_THREAD_MASK))\n    msg_num = 0;\n\n  header->request_id = htons((uint16_t)(thread_id | msg_num));\n}"
  }
]