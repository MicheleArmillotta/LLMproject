[
  {
    "function_name": "clock_gettime",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/p9y/p9y.cpp",
    "lines": "159-171",
    "snippet": "int clock_gettime(int, struct timespec *spec)\n{\n  __int64 wintime, unixtime;\n\n  GetSystemTimeAsFileTime((FILETIME*) &wintime);\n  unixtime = wintime2unixtime(wintime);\n\n\n  spec->tv_sec = unixtime / 10000000i64;\n  spec->tv_nsec = unixtime % 10000000i64 * 100;\n\n  return 0;\n}",
    "includes": [
      "#include \"clock_gettime.hpp\"",
      "#include \"poll.hpp\"",
      "#include \"socket.hpp\"",
      "# include <chrono>",
      "#include \"gettimeofday.hpp\"",
      "#include \"realpath.hpp\"",
      "# include <cstring>",
      "#include \"libgen.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "wintime2unixtime",
          "args": [
            "wintime"
          ],
          "line": 164
        },
        "resolved": true,
        "details": {
          "function_name": "wintime2unixtime",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/p9y/p9y.cpp",
          "lines": "155-157",
          "snippet": "static inline __int64 wintime2unixtime(__int64 wintime) {\n  return wintime - 116444736000000000i64;\n}",
          "includes": [
            "#include \"clock_gettime.hpp\"",
            "#include \"poll.hpp\"",
            "#include \"socket.hpp\"",
            "# include <chrono>",
            "#include \"gettimeofday.hpp\"",
            "#include \"realpath.hpp\"",
            "# include <cstring>",
            "#include \"libgen.hpp\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"clock_gettime.hpp\"\n#include \"poll.hpp\"\n#include \"socket.hpp\"\n# include <chrono>\n#include \"gettimeofday.hpp\"\n#include \"realpath.hpp\"\n# include <cstring>\n#include \"libgen.hpp\"\n\nstatic inline __int64 wintime2unixtime(__int64 wintime) {\n  return wintime - 116444736000000000i64;\n}"
        }
      },
      {
        "call_info": {
          "callee": "GetSystemTimeAsFileTime",
          "args": [
            "(FILETIME*) &wintime"
          ],
          "line": 163
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"clock_gettime.hpp\"\n#include \"poll.hpp\"\n#include \"socket.hpp\"\n# include <chrono>\n#include \"gettimeofday.hpp\"\n#include \"realpath.hpp\"\n# include <cstring>\n#include \"libgen.hpp\"\n\nint clock_gettime(int, struct timespec *spec)\n{\n  __int64 wintime, unixtime;\n\n  GetSystemTimeAsFileTime((FILETIME*) &wintime);\n  unixtime = wintime2unixtime(wintime);\n\n\n  spec->tv_sec = unixtime / 10000000i64;\n  spec->tv_nsec = unixtime % 10000000i64 * 100;\n\n  return 0;\n}"
  },
  {
    "function_name": "wintime2unixtime",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/p9y/p9y.cpp",
    "lines": "155-157",
    "snippet": "static inline __int64 wintime2unixtime(__int64 wintime) {\n  return wintime - 116444736000000000i64;\n}",
    "includes": [
      "#include \"clock_gettime.hpp\"",
      "#include \"poll.hpp\"",
      "#include \"socket.hpp\"",
      "# include <chrono>",
      "#include \"gettimeofday.hpp\"",
      "#include \"realpath.hpp\"",
      "# include <cstring>",
      "#include \"libgen.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"clock_gettime.hpp\"\n#include \"poll.hpp\"\n#include \"socket.hpp\"\n# include <chrono>\n#include \"gettimeofday.hpp\"\n#include \"realpath.hpp\"\n# include <cstring>\n#include \"libgen.hpp\"\n\nstatic inline __int64 wintime2unixtime(__int64 wintime) {\n  return wintime - 116444736000000000i64;\n}"
  },
  {
    "function_name": "poll",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/p9y/p9y.cpp",
    "lines": "99-148",
    "snippet": "int poll(struct pollfd fds[], nfds_t nfds, int tmo) {\n  fd_set readfds, writefds, errorfds;\n  FD_ZERO(&readfds);\n  FD_ZERO(&writefds);\n  FD_ZERO(&errorfds);\n\n  int maxfd = 0;\n\n  for (nfds_t x = 0; x < nfds; ++x) {\n    if (fds[x].events & (POLLIN | POLLOUT)) {\n#  ifndef _WIN32\n      if (fds[x].fd > maxfd) {\n        maxfd = fds[x].fd;\n      }\n#  endif\n      if (fds[x].events & POLLIN) {\n        FD_SET(fds[x].fd, &readfds);\n      }\n      if (fds[x].events & POLLOUT) {\n        FD_SET(fds[x].fd, &writefds);\n      }\n    }\n  }\n\n  struct timeval timeout = {tmo / 1000, (tmo % 1000) * 1000};\n  struct timeval *tp = &timeout;\n  if (tmo == -1) {\n    tp = NULL;\n  }\n  int ret = select(maxfd + 1, &readfds, &writefds, &errorfds, tp);\n  if (ret <= 0) {\n    return ret;\n  }\n\n  /* Iterate through all of them because I need to clear the revent map */\n  for (nfds_t x = 0; x < nfds; ++x) {\n    fds[x].revents = 0;\n    if (FD_ISSET(fds[x].fd, &readfds)) {\n      fds[x].revents |= POLLIN;\n    }\n    if (FD_ISSET(fds[x].fd, &writefds)) {\n      fds[x].revents |= POLLOUT;\n    }\n    if (FD_ISSET(fds[x].fd, &errorfds)) {\n      fds[x].revents |= POLLERR;\n    }\n  }\n\n  return ret;\n}",
    "includes": [
      "#include \"clock_gettime.hpp\"",
      "#include \"poll.hpp\"",
      "#include \"socket.hpp\"",
      "# include <chrono>",
      "#include \"gettimeofday.hpp\"",
      "#include \"realpath.hpp\"",
      "# include <cstring>",
      "#include \"libgen.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "FD_ISSET",
          "args": [
            "fds[x].fd",
            "&errorfds"
          ],
          "line": 142
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FD_ISSET",
          "args": [
            "fds[x].fd",
            "&writefds"
          ],
          "line": 139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FD_ISSET",
          "args": [
            "fds[x].fd",
            "&readfds"
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "select",
          "args": [
            "maxfd + 1",
            "&readfds",
            "&writefds",
            "&errorfds",
            "tp"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FD_SET",
          "args": [
            "fds[x].fd",
            "&writefds"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FD_SET",
          "args": [
            "fds[x].fd",
            "&readfds"
          ],
          "line": 115
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FD_ZERO",
          "args": [
            "&errorfds"
          ],
          "line": 103
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FD_ZERO",
          "args": [
            "&writefds"
          ],
          "line": 102
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FD_ZERO",
          "args": [
            "&readfds"
          ],
          "line": 101
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"clock_gettime.hpp\"\n#include \"poll.hpp\"\n#include \"socket.hpp\"\n# include <chrono>\n#include \"gettimeofday.hpp\"\n#include \"realpath.hpp\"\n# include <cstring>\n#include \"libgen.hpp\"\n\nint poll(struct pollfd fds[], nfds_t nfds, int tmo) {\n  fd_set readfds, writefds, errorfds;\n  FD_ZERO(&readfds);\n  FD_ZERO(&writefds);\n  FD_ZERO(&errorfds);\n\n  int maxfd = 0;\n\n  for (nfds_t x = 0; x < nfds; ++x) {\n    if (fds[x].events & (POLLIN | POLLOUT)) {\n#  ifndef _WIN32\n      if (fds[x].fd > maxfd) {\n        maxfd = fds[x].fd;\n      }\n#  endif\n      if (fds[x].events & POLLIN) {\n        FD_SET(fds[x].fd, &readfds);\n      }\n      if (fds[x].events & POLLOUT) {\n        FD_SET(fds[x].fd, &writefds);\n      }\n    }\n  }\n\n  struct timeval timeout = {tmo / 1000, (tmo % 1000) * 1000};\n  struct timeval *tp = &timeout;\n  if (tmo == -1) {\n    tp = NULL;\n  }\n  int ret = select(maxfd + 1, &readfds, &writefds, &errorfds, tp);\n  if (ret <= 0) {\n    return ret;\n  }\n\n  /* Iterate through all of them because I need to clear the revent map */\n  for (nfds_t x = 0; x < nfds; ++x) {\n    fds[x].revents = 0;\n    if (FD_ISSET(fds[x].fd, &readfds)) {\n      fds[x].revents |= POLLIN;\n    }\n    if (FD_ISSET(fds[x].fd, &writefds)) {\n      fds[x].revents |= POLLOUT;\n    }\n    if (FD_ISSET(fds[x].fd, &errorfds)) {\n      fds[x].revents |= POLLERR;\n    }\n  }\n\n  return ret;\n}"
  },
  {
    "function_name": "get_socket_errno",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/p9y/p9y.cpp",
    "lines": "48-93",
    "snippet": "int get_socket_errno() {\n    int local_errno = WSAGetLastError();\n\n  switch (local_errno) {\n  case WSAEINVAL:\n    local_errno = EINPROGRESS;\n    break;\n  case WSAEALREADY:\n  case WSAEWOULDBLOCK:\n    local_errno = EAGAIN;\n    break;\n\n  case WSAECONNREFUSED:\n    local_errno = ECONNREFUSED;\n    break;\n\n  case WSAENETUNREACH:\n    local_errno = ENETUNREACH;\n    break;\n\n  case WSAETIMEDOUT:\n    local_errno = ETIMEDOUT;\n    break;\n\n  case WSAECONNRESET:\n    local_errno = ECONNRESET;\n    break;\n\n  case WSAEADDRINUSE:\n    local_errno = EADDRINUSE;\n    break;\n\n  case WSAEOPNOTSUPP:\n    local_errno = EOPNOTSUPP;\n    break;\n\n  case WSAENOPROTOOPT:\n    local_errno = ENOPROTOOPT;\n    break;\n\n  default:\n    break;\n  }\n\n  return local_errno;\n}",
    "includes": [
      "#include \"clock_gettime.hpp\"",
      "#include \"poll.hpp\"",
      "#include \"socket.hpp\"",
      "# include <chrono>",
      "#include \"gettimeofday.hpp\"",
      "#include \"realpath.hpp\"",
      "# include <cstring>",
      "#include \"libgen.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "WSAGetLastError",
          "args": [],
          "line": 49
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"clock_gettime.hpp\"\n#include \"poll.hpp\"\n#include \"socket.hpp\"\n# include <chrono>\n#include \"gettimeofday.hpp\"\n#include \"realpath.hpp\"\n# include <cstring>\n#include \"libgen.hpp\"\n\nint get_socket_errno() {\n    int local_errno = WSAGetLastError();\n\n  switch (local_errno) {\n  case WSAEINVAL:\n    local_errno = EINPROGRESS;\n    break;\n  case WSAEALREADY:\n  case WSAEWOULDBLOCK:\n    local_errno = EAGAIN;\n    break;\n\n  case WSAECONNREFUSED:\n    local_errno = ECONNREFUSED;\n    break;\n\n  case WSAENETUNREACH:\n    local_errno = ENETUNREACH;\n    break;\n\n  case WSAETIMEDOUT:\n    local_errno = ETIMEDOUT;\n    break;\n\n  case WSAECONNRESET:\n    local_errno = ECONNRESET;\n    break;\n\n  case WSAEADDRINUSE:\n    local_errno = EADDRINUSE;\n    break;\n\n  case WSAEOPNOTSUPP:\n    local_errno = EOPNOTSUPP;\n    break;\n\n  case WSAENOPROTOOPT:\n    local_errno = ENOPROTOOPT;\n    break;\n\n  default:\n    break;\n  }\n\n  return local_errno;\n}"
  },
  {
    "function_name": "gettimeofday",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/p9y/p9y.cpp",
    "lines": "26-42",
    "snippet": "int gettimeofday(struct timeval* tp, struct timezone*) {\n  using clock = std::chrono::system_clock;\n  auto as_sec = [] (auto d) {\n      return std::chrono::duration_cast<std::chrono::seconds>(d);\n  };\n  auto as_usec = [] (auto d) {\n      return std::chrono::duration_cast<std::chrono::microseconds>(d);\n  };\n\n  auto now = clock::now().time_since_epoch();\n  auto sec = as_sec(now);\n  auto usec = as_usec(now - sec);\n\n  tp->tv_sec = sec.count();\n  tp->tv_usec = usec.count();\n  return 0;\n}",
    "includes": [
      "#include \"clock_gettime.hpp\"",
      "#include \"poll.hpp\"",
      "#include \"socket.hpp\"",
      "# include <chrono>",
      "#include \"gettimeofday.hpp\"",
      "#include \"realpath.hpp\"",
      "# include <cstring>",
      "#include \"libgen.hpp\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "usec.count",
          "args": [],
          "line": 40
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "sec.count",
          "args": [],
          "line": 39
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "as_usec",
          "args": [
            "now - sec"
          ],
          "line": 37
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "as_sec",
          "args": [
            "now"
          ],
          "line": 36
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "clock::now",
          "args": [],
          "line": 35
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "clock::now",
          "args": [],
          "line": 35
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::chrono::duration_cast<std::chrono::microseconds>",
          "args": [
            "d"
          ],
          "line": 32
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::chrono::duration_cast<std::chrono::seconds>",
          "args": [
            "d"
          ],
          "line": 29
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"clock_gettime.hpp\"\n#include \"poll.hpp\"\n#include \"socket.hpp\"\n# include <chrono>\n#include \"gettimeofday.hpp\"\n#include \"realpath.hpp\"\n# include <cstring>\n#include \"libgen.hpp\"\n\nint gettimeofday(struct timeval* tp, struct timezone*) {\n  using clock = std::chrono::system_clock;\n  auto as_sec = [] (auto d) {\n      return std::chrono::duration_cast<std::chrono::seconds>(d);\n  };\n  auto as_usec = [] (auto d) {\n      return std::chrono::duration_cast<std::chrono::microseconds>(d);\n  };\n\n  auto now = clock::now().time_since_epoch();\n  auto sec = as_sec(now);\n  auto usec = as_usec(now - sec);\n\n  tp->tv_sec = sec.count();\n  tp->tv_usec = usec.count();\n  return 0;\n}"
  }
]