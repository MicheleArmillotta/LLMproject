[
  {
    "function_name": "memcached_virtual_bucket_get",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/virtual_bucket.cc",
    "lines": "74-85",
    "snippet": "uint32_t memcached_virtual_bucket_get(const memcached_st *self, uint32_t digest) {\n  if (self) {\n    if (self->virtual_bucket) {\n      uint32_t result = (uint32_t)(digest & (self->virtual_bucket->size - 1));\n      return self->virtual_bucket->buckets[result].master;\n    }\n\n    return (uint32_t)(digest & (self->number_of_hosts - 1));\n  }\n\n  return 0;\n}",
    "includes": [
      "#include \"libmemcached/virtual_bucket.h\"",
      "#include \"libmemcached/common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [],
    "contextual_snippet": "#include \"libmemcached/virtual_bucket.h\"\n#include \"libmemcached/common.h\"\n\nuint32_t memcached_virtual_bucket_get(const memcached_st *self, uint32_t digest) {\n  if (self) {\n    if (self->virtual_bucket) {\n      uint32_t result = (uint32_t)(digest & (self->virtual_bucket->size - 1));\n      return self->virtual_bucket->buckets[result].master;\n    }\n\n    return (uint32_t)(digest & (self->number_of_hosts - 1));\n  }\n\n  return 0;\n}"
  },
  {
    "function_name": "memcached_virtual_bucket_free",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/virtual_bucket.cc",
    "lines": "65-72",
    "snippet": "void memcached_virtual_bucket_free(memcached_st *self) {\n  if (self) {\n    if (self->virtual_bucket) {\n      free(self->virtual_bucket);\n      self->virtual_bucket = NULL;\n    }\n  }\n}",
    "includes": [
      "#include \"libmemcached/virtual_bucket.h\"",
      "#include \"libmemcached/common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "self->virtual_bucket"
          ],
          "line": 68
        },
        "resolved": true,
        "details": {
          "function_name": "memcached_virtual_bucket_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/virtual_bucket.cc",
          "lines": "65-72",
          "snippet": "void memcached_virtual_bucket_free(memcached_st *self) {\n  if (self) {\n    if (self->virtual_bucket) {\n      free(self->virtual_bucket);\n      self->virtual_bucket = NULL;\n    }\n  }\n}",
          "note": "cyclic_reference_detected"
        }
      }
    ],
    "contextual_snippet": "#include \"libmemcached/virtual_bucket.h\"\n#include \"libmemcached/common.h\"\n\nvoid memcached_virtual_bucket_free(memcached_st *self) {\n  if (self) {\n    if (self->virtual_bucket) {\n      free(self->virtual_bucket);\n      self->virtual_bucket = NULL;\n    }\n  }\n}"
  },
  {
    "function_name": "memcached_virtual_bucket_create",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/virtual_bucket.cc",
    "lines": "31-63",
    "snippet": "memcached_return_t memcached_virtual_bucket_create(memcached_st *self, const uint32_t *host_map,\n                                                   const uint32_t *forward_map,\n                                                   const uint32_t buckets,\n                                                   const uint32_t replicas) {\n  if (self == NULL || host_map == NULL || buckets == 0U) {\n    return MEMCACHED_INVALID_ARGUMENTS;\n  }\n\n  memcached_virtual_bucket_free(self);\n\n  struct memcached_virtual_bucket_t *virtual_bucket = (struct memcached_virtual_bucket_t *) malloc(\n      sizeof(struct memcached_virtual_bucket_t) + sizeof(struct bucket_t) * buckets);\n\n  if (virtual_bucket == NULL) {\n    return MEMCACHED_MEMORY_ALLOCATION_FAILURE;\n  }\n\n  virtual_bucket->size = buckets;\n  virtual_bucket->replicas = replicas;\n  self->virtual_bucket = virtual_bucket;\n\n  uint32_t x = 0;\n  for (; x < buckets; x++) {\n    virtual_bucket->buckets[x].master = host_map[x];\n    if (forward_map) {\n      virtual_bucket->buckets[x].forward = forward_map[x];\n    } else {\n      virtual_bucket->buckets[x].forward = 0;\n    }\n  }\n\n  return MEMCACHED_SUCCESS;\n}",
    "includes": [
      "#include \"libmemcached/virtual_bucket.h\"",
      "#include \"libmemcached/common.h\""
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "sizeof(struct memcached_virtual_bucket_t) + sizeof(struct bucket_t) * buckets"
          ],
          "line": 41
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "memcached_virtual_bucket_free",
          "args": [
            "self"
          ],
          "line": 39
        },
        "resolved": true,
        "details": {
          "function_name": "memcached_virtual_bucket_free",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2023-27478/repo/src/libmemcached/virtual_bucket.cc",
          "lines": "65-72",
          "snippet": "void memcached_virtual_bucket_free(memcached_st *self) {\n  if (self) {\n    if (self->virtual_bucket) {\n      free(self->virtual_bucket);\n      self->virtual_bucket = NULL;\n    }\n  }\n}",
          "includes": [
            "#include \"libmemcached/virtual_bucket.h\"",
            "#include \"libmemcached/common.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"libmemcached/virtual_bucket.h\"\n#include \"libmemcached/common.h\"\n\nvoid memcached_virtual_bucket_free(memcached_st *self) {\n  if (self) {\n    if (self->virtual_bucket) {\n      free(self->virtual_bucket);\n      self->virtual_bucket = NULL;\n    }\n  }\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"libmemcached/virtual_bucket.h\"\n#include \"libmemcached/common.h\"\n\nmemcached_return_t memcached_virtual_bucket_create(memcached_st *self, const uint32_t *host_map,\n                                                   const uint32_t *forward_map,\n                                                   const uint32_t buckets,\n                                                   const uint32_t replicas) {\n  if (self == NULL || host_map == NULL || buckets == 0U) {\n    return MEMCACHED_INVALID_ARGUMENTS;\n  }\n\n  memcached_virtual_bucket_free(self);\n\n  struct memcached_virtual_bucket_t *virtual_bucket = (struct memcached_virtual_bucket_t *) malloc(\n      sizeof(struct memcached_virtual_bucket_t) + sizeof(struct bucket_t) * buckets);\n\n  if (virtual_bucket == NULL) {\n    return MEMCACHED_MEMORY_ALLOCATION_FAILURE;\n  }\n\n  virtual_bucket->size = buckets;\n  virtual_bucket->replicas = replicas;\n  self->virtual_bucket = virtual_bucket;\n\n  uint32_t x = 0;\n  for (; x < buckets; x++) {\n    virtual_bucket->buckets[x].master = host_map[x];\n    if (forward_map) {\n      virtual_bucket->buckets[x].forward = forward_map[x];\n    } else {\n      virtual_bucket->buckets[x].forward = 0;\n    }\n  }\n\n  return MEMCACHED_SUCCESS;\n}"
  }
]