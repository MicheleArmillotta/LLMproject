[
  {
    "function_name": "shift_log_files",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2util-r/src/y2changes.cc",
    "lines": "276-303",
    "snippet": "static void shift_log_files(string filename)\n{\n    struct stat buf;\n\n    if( stat(filename.c_str(), &buf) )\n\treturn;\n\n    if( buf.st_size <= maxlogsize )\n\treturn;\n\n    static const char * gz = \".gz\";\n    // Delete the last logfile\n    remove (old (filename, maxlognum - 1, \"\"   ).c_str());\n    remove (old (filename, maxlognum - 1, gz).c_str());\n\n    // rename existing ones\n    for( int f = maxlognum-2; f > 0; f-- )\n    {\n\trename (old (filename, f, \"\").c_str(), old (filename, f+1, \"\").c_str());\n\trename (old (filename, f, gz).c_str(), old (filename, f+1, gz).c_str());\n    }\n\n    // rename and compress first one\n    rename( filename.c_str(), old (filename, 1, \"\").c_str() );\n    // fate#300637: compress!\n    // may fail, but so what\n    system( (\"nice -n 20 gzip \" + old (filename, 1, \"\") + \" &\").c_str());\n}",
    "includes": [
      "#include <syslog.h>",
      "#include \"y2util/PathInfo.h\"",
      "#include \"y2util/stringutil.h\"",
      "#include \"y2util/y2changes.h\"",
      "#include <list>",
      "#include <limits>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/time.h>",
      "#include <sys/stat.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <signal.h>",
      "#include <pwd.h>",
      "#include <malloc.h>",
      "#include <fcntl.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static off_t maxlogsize;",
      "static int   maxlognum;",
      "static void shift_log_files(string filename);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "system",
          "args": [
            "(\"nice -n 20 gzip \" + old (filename, 1, \"\") + \" &\").c_str()"
          ],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "",
          "args": [],
          "line": 302
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "old",
          "args": [
            "filename",
            "1",
            "\"\""
          ],
          "line": 302
        },
        "resolved": true,
        "details": {
          "function_name": "old",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2util-r/src/y2changes.cc",
          "lines": "265-269",
          "snippet": "static string old (const string & filename, int i, const char * suffix) {\n    char numbuf[8];\n    sprintf (numbuf, \"%d\", i);\n    return filename + \"-\" + numbuf + suffix;\n}",
          "includes": [
            "#include <syslog.h>",
            "#include \"y2util/PathInfo.h\"",
            "#include \"y2util/stringutil.h\"",
            "#include \"y2util/y2changes.h\"",
            "#include <list>",
            "#include <limits>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <pwd.h>",
            "#include <malloc.h>",
            "#include <fcntl.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static void shift_log_files(string filename);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <syslog.h>\n#include \"y2util/PathInfo.h\"\n#include \"y2util/stringutil.h\"\n#include \"y2util/y2changes.h\"\n#include <list>\n#include <limits>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <pwd.h>\n#include <malloc.h>\n#include <fcntl.h>\n#include <errno.h>\n\nstatic void shift_log_files(string filename);\n\nstatic string old (const string & filename, int i, const char * suffix) {\n    char numbuf[8];\n    sprintf (numbuf, \"%d\", i);\n    return filename + \"-\" + numbuf + suffix;\n}"
        }
      },
      {
        "call_info": {
          "callee": "rename",
          "args": [
            "filename.c_str()",
            "old (filename, 1, \"\").c_str()"
          ],
          "line": 299
        },
        "resolved": true,
        "details": {
          "function_name": "rename",
          "container": "PathInfo",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2util-r/src/PathInfo.cc",
          "lines": "558-565",
          "snippet": "int PathInfo::rename( const Pathname & oldpath, const Pathname & newpath )\n{\n  DBG << \"rename \" << oldpath << \" -> \" << newpath;\n  if ( ::rename( oldpath.asString().c_str(), newpath.asString().c_str() ) == -1 ) {\n    return _Log_Result( errno );\n  }\n  return _Log_Result( 0 );\n}",
          "includes": [
            "#include <y2util/PathInfo.h>",
            "#include <y2util/ExternalProgram.h>",
            "#include <y2util/stringutil.h>",
            "#include <y2util/Y2SLog.h>",
            "#include <iomanip>",
            "#include <fstream>",
            "#include <iostream>",
            "#include <string.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <y2util/PathInfo.h>\n#include <y2util/ExternalProgram.h>\n#include <y2util/stringutil.h>\n#include <y2util/Y2SLog.h>\n#include <iomanip>\n#include <fstream>\n#include <iostream>\n#include <string.h>\n\nPathInfo {\n  int PathInfo::rename( const Pathname & oldpath, const Pathname & newpath )\n  {\n    DBG << \"rename \" << oldpath << \" -> \" << newpath;\n    if ( ::rename( oldpath.asString().c_str(), newpath.asString().c_str() ) == -1 ) {\n      return _Log_Result( errno );\n    }\n    return _Log_Result( 0 );\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "old",
          "args": [],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.c_str",
          "args": [],
          "line": 299
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "old",
          "args": [],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "old",
          "args": [],
          "line": 295
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "old",
          "args": [],
          "line": 294
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "old",
          "args": [],
          "line": 294
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "remove",
          "args": [
            "old (filename, maxlognum - 1, gz).c_str()"
          ],
          "line": 289
        },
        "resolved": true,
        "details": {
          "function_name": "remove",
          "container": "YCPMapRep",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/libycp/src/YCPMap.cc",
          "lines": "104-113",
          "snippet": "void YCPMapRep::remove(const YCPValue& key)\n{\n    if (!key->isString() && !key->isInteger() && !key->isSymbol())\n    {\n        ycp2error (\"Only integer, string, or symbol constant allowed as key in map\");\n        return;\n    }\n\n    stl_map.erase (key);\n}",
          "includes": [
            "#include \"ycp/ExecutionEnvironment.h\"",
            "#include \"ycp/Xmlcode.h\"",
            "#include \"ycp/Bytecode.h\"",
            "#include \"ycp/YCPMap.h\"",
            "#include \"ycp/y2log.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ycp/ExecutionEnvironment.h\"\n#include \"ycp/Xmlcode.h\"\n#include \"ycp/Bytecode.h\"\n#include \"ycp/YCPMap.h\"\n#include \"ycp/y2log.h\"\n\nYCPMapRep {\n  void YCPMapRep::remove(const YCPValue& key)\n  {\n      if (!key->isString() && !key->isInteger() && !key->isSymbol())\n      {\n          ycp2error (\"Only integer, string, or symbol constant allowed as key in map\");\n          return;\n      }\n  \n      stl_map.erase (key);\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "old",
          "args": [],
          "line": 289
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "old",
          "args": [],
          "line": 288
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stat",
          "args": [
            "filename.c_str()",
            "&buf"
          ],
          "line": 280
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "filename.c_str",
          "args": [],
          "line": 280
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <syslog.h>\n#include \"y2util/PathInfo.h\"\n#include \"y2util/stringutil.h\"\n#include \"y2util/y2changes.h\"\n#include <list>\n#include <limits>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <pwd.h>\n#include <malloc.h>\n#include <fcntl.h>\n#include <errno.h>\n\nstatic off_t maxlogsize;\nstatic int   maxlognum;\nstatic void shift_log_files(string filename);\n\nstatic void shift_log_files(string filename)\n{\n    struct stat buf;\n\n    if( stat(filename.c_str(), &buf) )\n\treturn;\n\n    if( buf.st_size <= maxlogsize )\n\treturn;\n\n    static const char * gz = \".gz\";\n    // Delete the last logfile\n    remove (old (filename, maxlognum - 1, \"\"   ).c_str());\n    remove (old (filename, maxlognum - 1, gz).c_str());\n\n    // rename existing ones\n    for( int f = maxlognum-2; f > 0; f-- )\n    {\n\trename (old (filename, f, \"\").c_str(), old (filename, f+1, \"\").c_str());\n\trename (old (filename, f, gz).c_str(), old (filename, f+1, gz).c_str());\n    }\n\n    // rename and compress first one\n    rename( filename.c_str(), old (filename, 1, \"\").c_str() );\n    // fate#300637: compress!\n    // may fail, but so what\n    system( (\"nice -n 20 gzip \" + old (filename, 1, \"\") + \" &\").c_str());\n}"
  },
  {
    "function_name": "old",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2util-r/src/y2changes.cc",
    "lines": "265-269",
    "snippet": "static string old (const string & filename, int i, const char * suffix) {\n    char numbuf[8];\n    sprintf (numbuf, \"%d\", i);\n    return filename + \"-\" + numbuf + suffix;\n}",
    "includes": [
      "#include <syslog.h>",
      "#include \"y2util/PathInfo.h\"",
      "#include \"y2util/stringutil.h\"",
      "#include \"y2util/y2changes.h\"",
      "#include <list>",
      "#include <limits>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/time.h>",
      "#include <sys/stat.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <signal.h>",
      "#include <pwd.h>",
      "#include <malloc.h>",
      "#include <fcntl.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void shift_log_files(string filename);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "sprintf",
          "args": [
            "numbuf",
            "\"%d\"",
            "i"
          ],
          "line": 267
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <syslog.h>\n#include \"y2util/PathInfo.h\"\n#include \"y2util/stringutil.h\"\n#include \"y2util/y2changes.h\"\n#include <list>\n#include <limits>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <pwd.h>\n#include <malloc.h>\n#include <fcntl.h>\n#include <errno.h>\n\nstatic void shift_log_files(string filename);\n\nstatic string old (const string & filename, int i, const char * suffix) {\n    char numbuf[8];\n    sprintf (numbuf, \"%d\", i);\n    return filename + \"-\" + numbuf + suffix;\n}"
  },
  {
    "function_name": "do_log_yast",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2util-r/src/y2changes.cc",
    "lines": "243-263",
    "snippet": "static\nvoid do_log_yast( const char* logmessage )\n{\n    /* Prepare the logfile name */\n    if(!did_set_logname) set_log_filename(\"\");\n\n    /* Prepare the logfile */\n    shift_log_files (string (logname));\n\n    FILE *logfile = open_logfile ();\n    if (!logfile)\n\treturn;\n\n    fprintf (logfile, \"%s\", logmessage);\n\n    /* Clean everything */\n    if (logfile && logfile != Y2CHANGES_STDERR)\n\tfclose (logfile);\n    else\n\tfflush (logfile);\n}",
    "includes": [
      "#include <syslog.h>",
      "#include \"y2util/PathInfo.h\"",
      "#include \"y2util/stringutil.h\"",
      "#include \"y2util/y2changes.h\"",
      "#include <list>",
      "#include <limits>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/time.h>",
      "#include <sys/stat.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <signal.h>",
      "#include <pwd.h>",
      "#include <malloc.h>",
      "#include <fcntl.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static bool did_set_logname = false;",
      "static const char *logname;",
      "static FILE *Y2CHANGES_STDERR = stderr;",
      "static void do_log_syslog( const char* logmessage );",
      "static void do_log_yast( const char* logmessage );"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fflush",
          "args": [
            "logfile"
          ],
          "line": 262
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fclose",
          "args": [
            "logfile"
          ],
          "line": 260
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "logfile",
            "\"%s\"",
            "logmessage"
          ],
          "line": 256
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "open_logfile",
          "args": [],
          "line": 252
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "shift_log_files",
          "args": [
            "string (logname)"
          ],
          "line": 250
        },
        "resolved": true,
        "details": {
          "function_name": "shift_log_files",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2util-r/src/y2changes.cc",
          "lines": "276-303",
          "snippet": "static void shift_log_files(string filename)\n{\n    struct stat buf;\n\n    if( stat(filename.c_str(), &buf) )\n\treturn;\n\n    if( buf.st_size <= maxlogsize )\n\treturn;\n\n    static const char * gz = \".gz\";\n    // Delete the last logfile\n    remove (old (filename, maxlognum - 1, \"\"   ).c_str());\n    remove (old (filename, maxlognum - 1, gz).c_str());\n\n    // rename existing ones\n    for( int f = maxlognum-2; f > 0; f-- )\n    {\n\trename (old (filename, f, \"\").c_str(), old (filename, f+1, \"\").c_str());\n\trename (old (filename, f, gz).c_str(), old (filename, f+1, gz).c_str());\n    }\n\n    // rename and compress first one\n    rename( filename.c_str(), old (filename, 1, \"\").c_str() );\n    // fate#300637: compress!\n    // may fail, but so what\n    system( (\"nice -n 20 gzip \" + old (filename, 1, \"\") + \" &\").c_str());\n}",
          "includes": [
            "#include <syslog.h>",
            "#include \"y2util/PathInfo.h\"",
            "#include \"y2util/stringutil.h\"",
            "#include \"y2util/y2changes.h\"",
            "#include <list>",
            "#include <limits>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <pwd.h>",
            "#include <malloc.h>",
            "#include <fcntl.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static off_t maxlogsize;",
            "static int   maxlognum;",
            "static void shift_log_files(string filename);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <syslog.h>\n#include \"y2util/PathInfo.h\"\n#include \"y2util/stringutil.h\"\n#include \"y2util/y2changes.h\"\n#include <list>\n#include <limits>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <pwd.h>\n#include <malloc.h>\n#include <fcntl.h>\n#include <errno.h>\n\nstatic off_t maxlogsize;\nstatic int   maxlognum;\nstatic void shift_log_files(string filename);\n\nstatic void shift_log_files(string filename)\n{\n    struct stat buf;\n\n    if( stat(filename.c_str(), &buf) )\n\treturn;\n\n    if( buf.st_size <= maxlogsize )\n\treturn;\n\n    static const char * gz = \".gz\";\n    // Delete the last logfile\n    remove (old (filename, maxlognum - 1, \"\"   ).c_str());\n    remove (old (filename, maxlognum - 1, gz).c_str());\n\n    // rename existing ones\n    for( int f = maxlognum-2; f > 0; f-- )\n    {\n\trename (old (filename, f, \"\").c_str(), old (filename, f+1, \"\").c_str());\n\trename (old (filename, f, gz).c_str(), old (filename, f+1, gz).c_str());\n    }\n\n    // rename and compress first one\n    rename( filename.c_str(), old (filename, 1, \"\").c_str() );\n    // fate#300637: compress!\n    // may fail, but so what\n    system( (\"nice -n 20 gzip \" + old (filename, 1, \"\") + \" &\").c_str());\n}"
        }
      },
      {
        "call_info": {
          "callee": "string",
          "args": [
            "logname"
          ],
          "line": 250
        },
        "resolved": true,
        "details": {
          "function_name": "to_string",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/agent-ini/src/IniFile.cc",
          "lines": "29-37",
          "snippet": "string to_string (const YCPValue&v)\n{\n    string s;\n    if (v->isString ())\n\ts = v->asString ()->value ();\n    else\n\ts = v->toString ();\n    return s;\n}",
          "includes": [
            "#include \"IniParser.h\"",
            "#include \"IniFile.h\"",
            "#include <cassert>",
            "#include <set>",
            "#include <ctype.h>",
            "#include <stdio.h>",
            "#include <ycp/y2log.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"IniParser.h\"\n#include \"IniFile.h\"\n#include <cassert>\n#include <set>\n#include <ctype.h>\n#include <stdio.h>\n#include <ycp/y2log.h>\n\nstring to_string (const YCPValue&v)\n{\n    string s;\n    if (v->isString ())\n\ts = v->asString ()->value ();\n    else\n\ts = v->toString ();\n    return s;\n}"
        }
      },
      {
        "call_info": {
          "callee": "set_log_filename",
          "args": [
            "\"\""
          ],
          "line": 247
        },
        "resolved": true,
        "details": {
          "function_name": "set_log_filename",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2util-r/src/y2changes.cc",
          "lines": "188-240",
          "snippet": "static void set_log_filename (string fname)\n{\n    did_set_logname = true;\n\n    if(log_to_syslog) openlog(\"yast2\", LOG_PID, LOG_DAEMON);\n    if(!log_to_file) return;\n\n    struct passwd *pw = getpwuid( geteuid() );\n    const char *filename = fname.c_str();\n\n    char *env_maxlogsize = getenv(Y2CHANGES_VAR_SIZE);\n    if ( env_maxlogsize ) {\n      stringutil::strtonum( env_maxlogsize, maxlogsize );\n      // prevent overflow (#156149)\n      const off_t limit = std::numeric_limits<off_t>::max();\n      const off_t limit_k = limit / 1024;\n      if (maxlogsize <= limit_k)\n\t  maxlogsize *= 1024;\n      else\n\t  maxlogsize = limit;\n    } else \n      maxlogsize = Y2CHANGES_MAXSIZE;\n\n    char *env_maxlognum = getenv(Y2CHANGES_VAR_NUM);\n    maxlognum = env_maxlognum ? atoi(env_maxlognum) : Y2CHANGES_MAXNUM;\n\n    /* Assign logfile name */\n\n    if ((filename == 0) || (*filename == 0))\n    {\t\t/* No filename --> use defaults */\n\tif (geteuid()) {\t\t\t/* Non root */\n\t    if (!pw)\n\t    {\n\t\tfprintf( Y2CHANGES_STDERR,\n\t\t\t \"Cannot read pwd entry of user id %d. Logfile will be '%s'.\\n\",\n\t\t\t geteuid(), Y2CHANGES_FALLBACK );\n\n\t\tlogname = Y2CHANGES_FALLBACK;\n\t    }\n\t    else\n\t    {\n\t\t// never freed\n\t\tchar * my_logname = (char *)malloc (strlen (pw->pw_dir) + strlen (Y2CHANGES_USER) + 1);\n\t\tstrcpy (my_logname, pw->pw_dir);\n\t\tlogname = strcat (my_logname, Y2CHANGES_USER);\n\t    }\n\t}\n\telse\t\t    /* Root */\n\t    logname = Y2CHANGES_ROOT;\n    }\n    else\n\tlogname = strdup (filename);  /* Explicit assignment */\n}",
          "includes": [
            "#include <syslog.h>",
            "#include \"y2util/PathInfo.h\"",
            "#include \"y2util/stringutil.h\"",
            "#include \"y2util/y2changes.h\"",
            "#include <list>",
            "#include <limits>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <pwd.h>",
            "#include <malloc.h>",
            "#include <fcntl.h>",
            "#include <errno.h>"
          ],
          "macros_used": [
            "#define Y2CHANGES_VAR_NUM\t\"Y2MAXLOGNUM\"",
            "#define Y2CHANGES_VAR_SIZE\t\"Y2MAXLOGSIZE\"",
            "#define Y2CHANGES_FALLBACK\t\"/y2changes\"",
            "#define Y2CHANGES_USER\t\"/.y2changes\"\t\t/* Relative to $HOME */",
            "#define Y2CHANGES_ROOT\tLOGDIR \"/y2changes\"",
            "#define Y2CHANGES_MAXNUM\t10\t\t\t/* Maximum logfiles number */",
            "#define Y2CHANGES_MAXSIZE\t10* 1024 * 1024\t\t/* Maximal logfile size */"
          ],
          "globals_used": [
            "static bool did_set_logname = false;",
            "static const char *logname;",
            "static off_t maxlogsize;",
            "static int   maxlognum;",
            "static bool log_to_file = true;",
            "static bool log_to_syslog = false;",
            "static FILE *Y2CHANGES_STDERR = stderr;",
            "static void shift_log_files(string filename);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <syslog.h>\n#include \"y2util/PathInfo.h\"\n#include \"y2util/stringutil.h\"\n#include \"y2util/y2changes.h\"\n#include <list>\n#include <limits>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <pwd.h>\n#include <malloc.h>\n#include <fcntl.h>\n#include <errno.h>\n\n#define Y2CHANGES_VAR_NUM\t\"Y2MAXLOGNUM\"\n#define Y2CHANGES_VAR_SIZE\t\"Y2MAXLOGSIZE\"\n#define Y2CHANGES_FALLBACK\t\"/y2changes\"\n#define Y2CHANGES_USER\t\"/.y2changes\"\t\t/* Relative to $HOME */\n#define Y2CHANGES_ROOT\tLOGDIR \"/y2changes\"\n#define Y2CHANGES_MAXNUM\t10\t\t\t/* Maximum logfiles number */\n#define Y2CHANGES_MAXSIZE\t10* 1024 * 1024\t\t/* Maximal logfile size */\n\nstatic bool did_set_logname = false;\nstatic const char *logname;\nstatic off_t maxlogsize;\nstatic int   maxlognum;\nstatic bool log_to_file = true;\nstatic bool log_to_syslog = false;\nstatic FILE *Y2CHANGES_STDERR = stderr;\nstatic void shift_log_files(string filename);\n\nstatic void set_log_filename (string fname)\n{\n    did_set_logname = true;\n\n    if(log_to_syslog) openlog(\"yast2\", LOG_PID, LOG_DAEMON);\n    if(!log_to_file) return;\n\n    struct passwd *pw = getpwuid( geteuid() );\n    const char *filename = fname.c_str();\n\n    char *env_maxlogsize = getenv(Y2CHANGES_VAR_SIZE);\n    if ( env_maxlogsize ) {\n      stringutil::strtonum( env_maxlogsize, maxlogsize );\n      // prevent overflow (#156149)\n      const off_t limit = std::numeric_limits<off_t>::max();\n      const off_t limit_k = limit / 1024;\n      if (maxlogsize <= limit_k)\n\t  maxlogsize *= 1024;\n      else\n\t  maxlogsize = limit;\n    } else \n      maxlogsize = Y2CHANGES_MAXSIZE;\n\n    char *env_maxlognum = getenv(Y2CHANGES_VAR_NUM);\n    maxlognum = env_maxlognum ? atoi(env_maxlognum) : Y2CHANGES_MAXNUM;\n\n    /* Assign logfile name */\n\n    if ((filename == 0) || (*filename == 0))\n    {\t\t/* No filename --> use defaults */\n\tif (geteuid()) {\t\t\t/* Non root */\n\t    if (!pw)\n\t    {\n\t\tfprintf( Y2CHANGES_STDERR,\n\t\t\t \"Cannot read pwd entry of user id %d. Logfile will be '%s'.\\n\",\n\t\t\t geteuid(), Y2CHANGES_FALLBACK );\n\n\t\tlogname = Y2CHANGES_FALLBACK;\n\t    }\n\t    else\n\t    {\n\t\t// never freed\n\t\tchar * my_logname = (char *)malloc (strlen (pw->pw_dir) + strlen (Y2CHANGES_USER) + 1);\n\t\tstrcpy (my_logname, pw->pw_dir);\n\t\tlogname = strcat (my_logname, Y2CHANGES_USER);\n\t    }\n\t}\n\telse\t\t    /* Root */\n\t    logname = Y2CHANGES_ROOT;\n    }\n    else\n\tlogname = strdup (filename);  /* Explicit assignment */\n}"
        }
      }
    ],
    "contextual_snippet": "#include <syslog.h>\n#include \"y2util/PathInfo.h\"\n#include \"y2util/stringutil.h\"\n#include \"y2util/y2changes.h\"\n#include <list>\n#include <limits>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <pwd.h>\n#include <malloc.h>\n#include <fcntl.h>\n#include <errno.h>\n\nstatic bool did_set_logname = false;\nstatic const char *logname;\nstatic FILE *Y2CHANGES_STDERR = stderr;\nstatic void do_log_syslog( const char* logmessage );\nstatic void do_log_yast( const char* logmessage );\n\nstatic\nvoid do_log_yast( const char* logmessage )\n{\n    /* Prepare the logfile name */\n    if(!did_set_logname) set_log_filename(\"\");\n\n    /* Prepare the logfile */\n    shift_log_files (string (logname));\n\n    FILE *logfile = open_logfile ();\n    if (!logfile)\n\treturn;\n\n    fprintf (logfile, \"%s\", logmessage);\n\n    /* Clean everything */\n    if (logfile && logfile != Y2CHANGES_STDERR)\n\tfclose (logfile);\n    else\n\tfflush (logfile);\n}"
  },
  {
    "function_name": "set_log_filename",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2util-r/src/y2changes.cc",
    "lines": "188-240",
    "snippet": "static void set_log_filename (string fname)\n{\n    did_set_logname = true;\n\n    if(log_to_syslog) openlog(\"yast2\", LOG_PID, LOG_DAEMON);\n    if(!log_to_file) return;\n\n    struct passwd *pw = getpwuid( geteuid() );\n    const char *filename = fname.c_str();\n\n    char *env_maxlogsize = getenv(Y2CHANGES_VAR_SIZE);\n    if ( env_maxlogsize ) {\n      stringutil::strtonum( env_maxlogsize, maxlogsize );\n      // prevent overflow (#156149)\n      const off_t limit = std::numeric_limits<off_t>::max();\n      const off_t limit_k = limit / 1024;\n      if (maxlogsize <= limit_k)\n\t  maxlogsize *= 1024;\n      else\n\t  maxlogsize = limit;\n    } else \n      maxlogsize = Y2CHANGES_MAXSIZE;\n\n    char *env_maxlognum = getenv(Y2CHANGES_VAR_NUM);\n    maxlognum = env_maxlognum ? atoi(env_maxlognum) : Y2CHANGES_MAXNUM;\n\n    /* Assign logfile name */\n\n    if ((filename == 0) || (*filename == 0))\n    {\t\t/* No filename --> use defaults */\n\tif (geteuid()) {\t\t\t/* Non root */\n\t    if (!pw)\n\t    {\n\t\tfprintf( Y2CHANGES_STDERR,\n\t\t\t \"Cannot read pwd entry of user id %d. Logfile will be '%s'.\\n\",\n\t\t\t geteuid(), Y2CHANGES_FALLBACK );\n\n\t\tlogname = Y2CHANGES_FALLBACK;\n\t    }\n\t    else\n\t    {\n\t\t// never freed\n\t\tchar * my_logname = (char *)malloc (strlen (pw->pw_dir) + strlen (Y2CHANGES_USER) + 1);\n\t\tstrcpy (my_logname, pw->pw_dir);\n\t\tlogname = strcat (my_logname, Y2CHANGES_USER);\n\t    }\n\t}\n\telse\t\t    /* Root */\n\t    logname = Y2CHANGES_ROOT;\n    }\n    else\n\tlogname = strdup (filename);  /* Explicit assignment */\n}",
    "includes": [
      "#include <syslog.h>",
      "#include \"y2util/PathInfo.h\"",
      "#include \"y2util/stringutil.h\"",
      "#include \"y2util/y2changes.h\"",
      "#include <list>",
      "#include <limits>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/time.h>",
      "#include <sys/stat.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <signal.h>",
      "#include <pwd.h>",
      "#include <malloc.h>",
      "#include <fcntl.h>",
      "#include <errno.h>"
    ],
    "macros_used": [
      "#define Y2CHANGES_VAR_NUM\t\"Y2MAXLOGNUM\"",
      "#define Y2CHANGES_VAR_SIZE\t\"Y2MAXLOGSIZE\"",
      "#define Y2CHANGES_FALLBACK\t\"/y2changes\"",
      "#define Y2CHANGES_USER\t\"/.y2changes\"\t\t/* Relative to $HOME */",
      "#define Y2CHANGES_ROOT\tLOGDIR \"/y2changes\"",
      "#define Y2CHANGES_MAXNUM\t10\t\t\t/* Maximum logfiles number */",
      "#define Y2CHANGES_MAXSIZE\t10* 1024 * 1024\t\t/* Maximal logfile size */"
    ],
    "globals_used": [
      "static bool did_set_logname = false;",
      "static const char *logname;",
      "static off_t maxlogsize;",
      "static int   maxlognum;",
      "static bool log_to_file = true;",
      "static bool log_to_syslog = false;",
      "static FILE *Y2CHANGES_STDERR = stderr;",
      "static void shift_log_files(string filename);"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "strdup",
          "args": [
            "filename"
          ],
          "line": 239
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcat",
          "args": [
            "my_logname",
            "Y2CHANGES_USER"
          ],
          "line": 232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strcpy",
          "args": [
            "my_logname",
            "pw->pw_dir"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "malloc",
          "args": [
            "strlen (pw->pw_dir) + strlen (Y2CHANGES_USER) + 1"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "Y2CHANGES_USER"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strlen",
          "args": [
            "pw->pw_dir"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "Y2CHANGES_STDERR",
            "\"Cannot read pwd entry of user id %d. Logfile will be '%s'.\\n\"",
            "geteuid()",
            "Y2CHANGES_FALLBACK"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "geteuid",
          "args": [],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "geteuid",
          "args": [],
          "line": 218
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "atoi",
          "args": [
            "env_maxlognum"
          ],
          "line": 212
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "Y2CHANGES_VAR_NUM"
          ],
          "line": 211
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "std::numeric_limits<off_t>::max",
          "args": [],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "stringutil::strtonum",
          "args": [
            "env_maxlogsize",
            "maxlogsize"
          ],
          "line": 200
        },
        "resolved": true,
        "details": {
          "function_name": "strtonum",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2util-r/src/include/y2util/stringutil.h",
          "lines": "182-182",
          "snippet": "inline _It strtonum( const std::string & str, _It & i ) { return i = strtonum<_It>( str ); }",
          "includes": [
            "#include <list>",
            "#include <string>",
            "#include <vector>",
            "#include <iosfwd>",
            "#include <cstdlib>",
            "#include <cstdarg>",
            "#include <cstdio>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <list>\n#include <string>\n#include <vector>\n#include <iosfwd>\n#include <cstdlib>\n#include <cstdarg>\n#include <cstdio>\n\ninline _It strtonum( const std::string & str, _It & i ) { return i = strtonum<_It>( str ); }"
        }
      },
      {
        "call_info": {
          "callee": "getenv",
          "args": [
            "Y2CHANGES_VAR_SIZE"
          ],
          "line": 198
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fname.c_str",
          "args": [],
          "line": 196
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getpwuid",
          "args": [
            "geteuid()"
          ],
          "line": 195
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "geteuid",
          "args": [],
          "line": 195
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "openlog",
          "args": [
            "\"yast2\"",
            "LOG_PID",
            "LOG_DAEMON"
          ],
          "line": 192
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <syslog.h>\n#include \"y2util/PathInfo.h\"\n#include \"y2util/stringutil.h\"\n#include \"y2util/y2changes.h\"\n#include <list>\n#include <limits>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <pwd.h>\n#include <malloc.h>\n#include <fcntl.h>\n#include <errno.h>\n\n#define Y2CHANGES_VAR_NUM\t\"Y2MAXLOGNUM\"\n#define Y2CHANGES_VAR_SIZE\t\"Y2MAXLOGSIZE\"\n#define Y2CHANGES_FALLBACK\t\"/y2changes\"\n#define Y2CHANGES_USER\t\"/.y2changes\"\t\t/* Relative to $HOME */\n#define Y2CHANGES_ROOT\tLOGDIR \"/y2changes\"\n#define Y2CHANGES_MAXNUM\t10\t\t\t/* Maximum logfiles number */\n#define Y2CHANGES_MAXSIZE\t10* 1024 * 1024\t\t/* Maximal logfile size */\n\nstatic bool did_set_logname = false;\nstatic const char *logname;\nstatic off_t maxlogsize;\nstatic int   maxlognum;\nstatic bool log_to_file = true;\nstatic bool log_to_syslog = false;\nstatic FILE *Y2CHANGES_STDERR = stderr;\nstatic void shift_log_files(string filename);\n\nstatic void set_log_filename (string fname)\n{\n    did_set_logname = true;\n\n    if(log_to_syslog) openlog(\"yast2\", LOG_PID, LOG_DAEMON);\n    if(!log_to_file) return;\n\n    struct passwd *pw = getpwuid( geteuid() );\n    const char *filename = fname.c_str();\n\n    char *env_maxlogsize = getenv(Y2CHANGES_VAR_SIZE);\n    if ( env_maxlogsize ) {\n      stringutil::strtonum( env_maxlogsize, maxlogsize );\n      // prevent overflow (#156149)\n      const off_t limit = std::numeric_limits<off_t>::max();\n      const off_t limit_k = limit / 1024;\n      if (maxlogsize <= limit_k)\n\t  maxlogsize *= 1024;\n      else\n\t  maxlogsize = limit;\n    } else \n      maxlogsize = Y2CHANGES_MAXSIZE;\n\n    char *env_maxlognum = getenv(Y2CHANGES_VAR_NUM);\n    maxlognum = env_maxlognum ? atoi(env_maxlognum) : Y2CHANGES_MAXNUM;\n\n    /* Assign logfile name */\n\n    if ((filename == 0) || (*filename == 0))\n    {\t\t/* No filename --> use defaults */\n\tif (geteuid()) {\t\t\t/* Non root */\n\t    if (!pw)\n\t    {\n\t\tfprintf( Y2CHANGES_STDERR,\n\t\t\t \"Cannot read pwd entry of user id %d. Logfile will be '%s'.\\n\",\n\t\t\t geteuid(), Y2CHANGES_FALLBACK );\n\n\t\tlogname = Y2CHANGES_FALLBACK;\n\t    }\n\t    else\n\t    {\n\t\t// never freed\n\t\tchar * my_logname = (char *)malloc (strlen (pw->pw_dir) + strlen (Y2CHANGES_USER) + 1);\n\t\tstrcpy (my_logname, pw->pw_dir);\n\t\tlogname = strcat (my_logname, Y2CHANGES_USER);\n\t    }\n\t}\n\telse\t\t    /* Root */\n\t    logname = Y2CHANGES_ROOT;\n    }\n    else\n\tlogname = strdup (filename);  /* Explicit assignment */\n}"
  },
  {
    "function_name": "do_log_syslog",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2util-r/src/y2changes.cc",
    "lines": "179-183",
    "snippet": "static\nvoid do_log_syslog( const char* logmessage )\n{\n    syslog (LOG_NOTICE, \"%s\", logmessage);\n}",
    "includes": [
      "#include <syslog.h>",
      "#include \"y2util/PathInfo.h\"",
      "#include \"y2util/stringutil.h\"",
      "#include \"y2util/y2changes.h\"",
      "#include <list>",
      "#include <limits>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/time.h>",
      "#include <sys/stat.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <signal.h>",
      "#include <pwd.h>",
      "#include <malloc.h>",
      "#include <fcntl.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static void do_log_syslog( const char* logmessage );",
      "static void do_log_yast( const char* logmessage );"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "syslog",
          "args": [
            "LOG_NOTICE",
            "\"%s\"",
            "logmessage"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <syslog.h>\n#include \"y2util/PathInfo.h\"\n#include \"y2util/stringutil.h\"\n#include \"y2util/y2changes.h\"\n#include <list>\n#include <limits>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <pwd.h>\n#include <malloc.h>\n#include <fcntl.h>\n#include <errno.h>\n\nstatic void do_log_syslog( const char* logmessage );\nstatic void do_log_yast( const char* logmessage );\n\nstatic\nvoid do_log_syslog( const char* logmessage )\n{\n    syslog (LOG_NOTICE, \"%s\", logmessage);\n}"
  },
  {
    "function_name": "y2changes_function",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2util-r/src/y2changes.cc",
    "lines": "154-176",
    "snippet": "void y2changes_function (logcategory_t category, const char *format, ...)\n{\n    va_list ap;\n    va_start(ap, format);\n\n    /* Prepare the log text */\n    char *logtext = NULL;\n    vasprintf(&logtext, format, ap); /* GNU extension needs the define above */\n    string common = logtext;\n    common += '\\n';\n    free (logtext);\n\n    if(log_to_syslog) {\n\tsyslog (LOG_NOTICE, Y2CHANGES_SYSLOG, category, common.c_str ());\n    }\n\n    if(log_to_file) {\n\tstring tolog = y2_changesfmt_prefix (category) + common;\n\tdo_log_yast (tolog.c_str ());\n    }\n\n    va_end(ap);\n}",
    "includes": [
      "#include <syslog.h>",
      "#include \"y2util/PathInfo.h\"",
      "#include \"y2util/stringutil.h\"",
      "#include \"y2util/y2changes.h\"",
      "#include <list>",
      "#include <limits>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/time.h>",
      "#include <sys/stat.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <signal.h>",
      "#include <pwd.h>",
      "#include <malloc.h>",
      "#include <fcntl.h>",
      "#include <errno.h>"
    ],
    "macros_used": [
      "#define Y2CHANGES_SYSLOG\t\"<%d>%s \""
    ],
    "globals_used": [
      "static bool log_to_file = true;",
      "static bool log_to_syslog = false;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "va_end",
          "args": [
            "ap"
          ],
          "line": 175
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "do_log_yast",
          "args": [
            "tolog.c_str ()"
          ],
          "line": 172
        },
        "resolved": true,
        "details": {
          "function_name": "do_log_yast",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2util-r/src/y2changes.cc",
          "lines": "243-263",
          "snippet": "static\nvoid do_log_yast( const char* logmessage )\n{\n    /* Prepare the logfile name */\n    if(!did_set_logname) set_log_filename(\"\");\n\n    /* Prepare the logfile */\n    shift_log_files (string (logname));\n\n    FILE *logfile = open_logfile ();\n    if (!logfile)\n\treturn;\n\n    fprintf (logfile, \"%s\", logmessage);\n\n    /* Clean everything */\n    if (logfile && logfile != Y2CHANGES_STDERR)\n\tfclose (logfile);\n    else\n\tfflush (logfile);\n}",
          "includes": [
            "#include <syslog.h>",
            "#include \"y2util/PathInfo.h\"",
            "#include \"y2util/stringutil.h\"",
            "#include \"y2util/y2changes.h\"",
            "#include <list>",
            "#include <limits>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <pwd.h>",
            "#include <malloc.h>",
            "#include <fcntl.h>",
            "#include <errno.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "static bool did_set_logname = false;",
            "static const char *logname;",
            "static FILE *Y2CHANGES_STDERR = stderr;",
            "static void do_log_syslog( const char* logmessage );",
            "static void do_log_yast( const char* logmessage );"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <syslog.h>\n#include \"y2util/PathInfo.h\"\n#include \"y2util/stringutil.h\"\n#include \"y2util/y2changes.h\"\n#include <list>\n#include <limits>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <pwd.h>\n#include <malloc.h>\n#include <fcntl.h>\n#include <errno.h>\n\nstatic bool did_set_logname = false;\nstatic const char *logname;\nstatic FILE *Y2CHANGES_STDERR = stderr;\nstatic void do_log_syslog( const char* logmessage );\nstatic void do_log_yast( const char* logmessage );\n\nstatic\nvoid do_log_yast( const char* logmessage )\n{\n    /* Prepare the logfile name */\n    if(!did_set_logname) set_log_filename(\"\");\n\n    /* Prepare the logfile */\n    shift_log_files (string (logname));\n\n    FILE *logfile = open_logfile ();\n    if (!logfile)\n\treturn;\n\n    fprintf (logfile, \"%s\", logmessage);\n\n    /* Clean everything */\n    if (logfile && logfile != Y2CHANGES_STDERR)\n\tfclose (logfile);\n    else\n\tfflush (logfile);\n}"
        }
      },
      {
        "call_info": {
          "callee": "tolog.c_str",
          "args": [],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "y2_changesfmt_prefix",
          "args": [
            "category"
          ],
          "line": 171
        },
        "resolved": true,
        "details": {
          "function_name": "y2_changesfmt_prefix",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2util-r/src/y2changes.cc",
          "lines": "130-149",
          "snippet": "string y2_changesfmt_prefix (logcategory_t category)\n{\n    /* Prepare the host name */\n    char hostname[1024];\n    if (gethostname(hostname, 1024))\n\tstrncpy(hostname, \"unknown\", 1024);\n\n    // just 1 second precision\n    time_t timestamp = time (NULL);\n    struct tm *brokentime = localtime (&timestamp);\n    char date[50];\t\t// that's big enough\n    strftime (date, sizeof (date), Y2CHANGES_DATE, brokentime);\n\n    char * result_c = NULL;\n    asprintf (&result_c, Y2CHANGES_FORMAT, date, log_messages[category], hostname );\n    string result = result_c;\n    free (result_c);\n\n    return result;\n}",
          "includes": [
            "#include <syslog.h>",
            "#include \"y2util/PathInfo.h\"",
            "#include \"y2util/stringutil.h\"",
            "#include \"y2util/y2changes.h\"",
            "#include <list>",
            "#include <limits>",
            "#include <unistd.h>",
            "#include <sys/types.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>",
            "#include <string.h>",
            "#include <stdio.h>",
            "#include <stdarg.h>",
            "#include <signal.h>",
            "#include <pwd.h>",
            "#include <malloc.h>",
            "#include <fcntl.h>",
            "#include <errno.h>"
          ],
          "macros_used": [
            "#define Y2CHANGES_FORMAT\t\"%s <%s> %s \"",
            "#define Y2CHANGES_DATE\t\"%Y-%m-%d %H:%M:%S\"\t/* The date format */"
          ],
          "globals_used": [
            "static const char *log_messages[] = {\n    \"item\",\n    \"note\",\n};"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <syslog.h>\n#include \"y2util/PathInfo.h\"\n#include \"y2util/stringutil.h\"\n#include \"y2util/y2changes.h\"\n#include <list>\n#include <limits>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <pwd.h>\n#include <malloc.h>\n#include <fcntl.h>\n#include <errno.h>\n\n#define Y2CHANGES_FORMAT\t\"%s <%s> %s \"\n#define Y2CHANGES_DATE\t\"%Y-%m-%d %H:%M:%S\"\t/* The date format */\n\nstatic const char *log_messages[] = {\n    \"item\",\n    \"note\",\n};\n\nstring y2_changesfmt_prefix (logcategory_t category)\n{\n    /* Prepare the host name */\n    char hostname[1024];\n    if (gethostname(hostname, 1024))\n\tstrncpy(hostname, \"unknown\", 1024);\n\n    // just 1 second precision\n    time_t timestamp = time (NULL);\n    struct tm *brokentime = localtime (&timestamp);\n    char date[50];\t\t// that's big enough\n    strftime (date, sizeof (date), Y2CHANGES_DATE, brokentime);\n\n    char * result_c = NULL;\n    asprintf (&result_c, Y2CHANGES_FORMAT, date, log_messages[category], hostname );\n    string result = result_c;\n    free (result_c);\n\n    return result;\n}"
        }
      },
      {
        "call_info": {
          "callee": "syslog",
          "args": [
            "LOG_NOTICE",
            "Y2CHANGES_SYSLOG",
            "category",
            "common.c_str ()"
          ],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "common.c_str",
          "args": [],
          "line": 167
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "free",
          "args": [
            "logtext"
          ],
          "line": 164
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "vasprintf",
          "args": [
            "&logtext",
            "format",
            "ap"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "va_start",
          "args": [
            "ap",
            "format"
          ],
          "line": 157
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <syslog.h>\n#include \"y2util/PathInfo.h\"\n#include \"y2util/stringutil.h\"\n#include \"y2util/y2changes.h\"\n#include <list>\n#include <limits>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <pwd.h>\n#include <malloc.h>\n#include <fcntl.h>\n#include <errno.h>\n\n#define Y2CHANGES_SYSLOG\t\"<%d>%s \"\n\nstatic bool log_to_file = true;\nstatic bool log_to_syslog = false;\n\nvoid y2changes_function (logcategory_t category, const char *format, ...)\n{\n    va_list ap;\n    va_start(ap, format);\n\n    /* Prepare the log text */\n    char *logtext = NULL;\n    vasprintf(&logtext, format, ap); /* GNU extension needs the define above */\n    string common = logtext;\n    common += '\\n';\n    free (logtext);\n\n    if(log_to_syslog) {\n\tsyslog (LOG_NOTICE, Y2CHANGES_SYSLOG, category, common.c_str ());\n    }\n\n    if(log_to_file) {\n\tstring tolog = y2_changesfmt_prefix (category) + common;\n\tdo_log_yast (tolog.c_str ());\n    }\n\n    va_end(ap);\n}"
  },
  {
    "function_name": "y2_changesfmt_prefix",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2util-r/src/y2changes.cc",
    "lines": "130-149",
    "snippet": "string y2_changesfmt_prefix (logcategory_t category)\n{\n    /* Prepare the host name */\n    char hostname[1024];\n    if (gethostname(hostname, 1024))\n\tstrncpy(hostname, \"unknown\", 1024);\n\n    // just 1 second precision\n    time_t timestamp = time (NULL);\n    struct tm *brokentime = localtime (&timestamp);\n    char date[50];\t\t// that's big enough\n    strftime (date, sizeof (date), Y2CHANGES_DATE, brokentime);\n\n    char * result_c = NULL;\n    asprintf (&result_c, Y2CHANGES_FORMAT, date, log_messages[category], hostname );\n    string result = result_c;\n    free (result_c);\n\n    return result;\n}",
    "includes": [
      "#include <syslog.h>",
      "#include \"y2util/PathInfo.h\"",
      "#include \"y2util/stringutil.h\"",
      "#include \"y2util/y2changes.h\"",
      "#include <list>",
      "#include <limits>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/time.h>",
      "#include <sys/stat.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <signal.h>",
      "#include <pwd.h>",
      "#include <malloc.h>",
      "#include <fcntl.h>",
      "#include <errno.h>"
    ],
    "macros_used": [
      "#define Y2CHANGES_FORMAT\t\"%s <%s> %s \"",
      "#define Y2CHANGES_DATE\t\"%Y-%m-%d %H:%M:%S\"\t/* The date format */"
    ],
    "globals_used": [
      "static const char *log_messages[] = {\n    \"item\",\n    \"note\",\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "free",
          "args": [
            "result_c"
          ],
          "line": 146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "asprintf",
          "args": [
            "&result_c",
            "Y2CHANGES_FORMAT",
            "date",
            "log_messages[category]",
            "hostname"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strftime",
          "args": [
            "date",
            "sizeof (date)",
            "Y2CHANGES_DATE",
            "brokentime"
          ],
          "line": 141
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "localtime",
          "args": [
            "&timestamp"
          ],
          "line": 139
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "time",
          "args": [
            "NULL"
          ],
          "line": 138
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strncpy",
          "args": [
            "hostname",
            "\"unknown\"",
            "1024"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "gethostname",
          "args": [
            "hostname",
            "1024"
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <syslog.h>\n#include \"y2util/PathInfo.h\"\n#include \"y2util/stringutil.h\"\n#include \"y2util/y2changes.h\"\n#include <list>\n#include <limits>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <pwd.h>\n#include <malloc.h>\n#include <fcntl.h>\n#include <errno.h>\n\n#define Y2CHANGES_FORMAT\t\"%s <%s> %s \"\n#define Y2CHANGES_DATE\t\"%Y-%m-%d %H:%M:%S\"\t/* The date format */\n\nstatic const char *log_messages[] = {\n    \"item\",\n    \"note\",\n};\n\nstring y2_changesfmt_prefix (logcategory_t category)\n{\n    /* Prepare the host name */\n    char hostname[1024];\n    if (gethostname(hostname, 1024))\n\tstrncpy(hostname, \"unknown\", 1024);\n\n    // just 1 second precision\n    time_t timestamp = time (NULL);\n    struct tm *brokentime = localtime (&timestamp);\n    char date[50];\t\t// that's big enough\n    strftime (date, sizeof (date), Y2CHANGES_DATE, brokentime);\n\n    char * result_c = NULL;\n    asprintf (&result_c, Y2CHANGES_FORMAT, date, log_messages[category], hostname );\n    string result = result_c;\n    free (result_c);\n\n    return result;\n}"
  },
  {
    "function_name": "dup_stderr",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2util-r/src/y2changes.cc",
    "lines": "89-107",
    "snippet": "static int dup_stderr()\n{\n    int dupstderr = dup( 2 );\n    if ( dupstderr != -1 ) {\n\tFILE * newstderr = fdopen( dupstderr, \"a\" );\n\n\tif ( newstderr == NULL ) {\n\t    fprintf( Y2CHANGES_STDERR, \"y2log: Can't fdopen new stderr: %s.\\n\", strerror (errno) );\n\t}\n\telse {\n\t    fcntl (fileno (newstderr), F_SETFD, fcntl (fileno (newstderr), F_GETFD) | FD_CLOEXEC);\n\t    Y2CHANGES_STDERR = newstderr;\n\t}\n    }\n    else {\n\tfprintf( Y2CHANGES_STDERR, \"y2log: Can't dup stderr: %s.\\n\", strerror (errno) );\n    }\n    return 1;\n}",
    "includes": [
      "#include <syslog.h>",
      "#include \"y2util/PathInfo.h\"",
      "#include \"y2util/stringutil.h\"",
      "#include \"y2util/y2changes.h\"",
      "#include <list>",
      "#include <limits>",
      "#include <unistd.h>",
      "#include <sys/types.h>",
      "#include <sys/time.h>",
      "#include <sys/stat.h>",
      "#include <string.h>",
      "#include <stdio.h>",
      "#include <stdarg.h>",
      "#include <signal.h>",
      "#include <pwd.h>",
      "#include <malloc.h>",
      "#include <fcntl.h>",
      "#include <errno.h>"
    ],
    "macros_used": [],
    "globals_used": [
      "static FILE *Y2CHANGES_STDERR = stderr;"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "Y2CHANGES_STDERR",
            "\"y2log: Can't dup stderr: %s.\\n\"",
            "strerror (errno)"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 104
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fcntl",
          "args": [
            "fileno (newstderr)",
            "F_SETFD",
            "fcntl (fileno (newstderr), F_GETFD) | FD_CLOEXEC"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fcntl",
          "args": [
            "fileno (newstderr)",
            "F_GETFD"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fileno",
          "args": [
            "newstderr"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fileno",
          "args": [
            "newstderr"
          ],
          "line": 99
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "Y2CHANGES_STDERR",
            "\"y2log: Can't fdopen new stderr: %s.\\n\"",
            "strerror (errno)"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "strerror",
          "args": [
            "errno"
          ],
          "line": 96
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fdopen",
          "args": [
            "dupstderr",
            "\"a\""
          ],
          "line": 93
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dup",
          "args": [
            "2"
          ],
          "line": 91
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <syslog.h>\n#include \"y2util/PathInfo.h\"\n#include \"y2util/stringutil.h\"\n#include \"y2util/y2changes.h\"\n#include <list>\n#include <limits>\n#include <unistd.h>\n#include <sys/types.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n#include <string.h>\n#include <stdio.h>\n#include <stdarg.h>\n#include <signal.h>\n#include <pwd.h>\n#include <malloc.h>\n#include <fcntl.h>\n#include <errno.h>\n\nstatic FILE *Y2CHANGES_STDERR = stderr;\n\nstatic int dup_stderr()\n{\n    int dupstderr = dup( 2 );\n    if ( dupstderr != -1 ) {\n\tFILE * newstderr = fdopen( dupstderr, \"a\" );\n\n\tif ( newstderr == NULL ) {\n\t    fprintf( Y2CHANGES_STDERR, \"y2log: Can't fdopen new stderr: %s.\\n\", strerror (errno) );\n\t}\n\telse {\n\t    fcntl (fileno (newstderr), F_SETFD, fcntl (fileno (newstderr), F_GETFD) | FD_CLOEXEC);\n\t    Y2CHANGES_STDERR = newstderr;\n\t}\n    }\n    else {\n\tfprintf( Y2CHANGES_STDERR, \"y2log: Can't dup stderr: %s.\\n\", strerror (errno) );\n    }\n    return 1;\n}"
  }
]