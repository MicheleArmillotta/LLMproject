[
  {
    "function_name": "main",
    "container": null,
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/agent-ini/testsuite/runag_ini.cc",
    "lines": "18-41",
    "snippet": "int\nmain (int argc, char *argv[])\n{\n    // find the \".ycp\" argument\n    string scrconf = process_options (argc, argv);\n    // substitute\n    string::size_type p = scrconf.rfind (\".ycp\");\n    if (p != string::npos)\n    {\n\tscrconf.replace (p, 4, \".scr\");\n    }\n\n    SCRAgent *agent = new ScriptingAgent (scrconf);\n    if (!agent)\n    {\n\tfprintf (stderr, \"Failed to create Agent\\n\");\n\texit (EXIT_FAILURE);\n    }\n\n    run_agent_instance (argc, argv, false, agent);\n\n    delete agent;\n    exit (EXIT_SUCCESS);\n}",
    "includes": [
      "#include \"../src/IniAgent.h\"",
      "#include \"../../scr/src/ScriptingAgent.h\"",
      "#include <scr/run_agent.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_SUCCESS"
          ],
          "line": 40
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "run_agent_instance",
          "args": [
            "argc",
            "argv",
            "false",
            "agent"
          ],
          "line": 37
        },
        "resolved": true,
        "details": {
          "function_name": "run_agent_instance",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/libscr/src/include/scr/run_agent.h",
          "lines": "78-169",
          "snippet": "void\nrun_agent_instance (int argc, char* argv[], bool load_scr, SCRAgent* agent)\n{\n    const char* fname = process_options (argc, argv);\n    \n    // fill in SCR builtins\n    SCR scr;\n\n    // create parser\n    Parser* parser = new Parser ();\n    if (!parser)\n    {\n\tfprintf (stderr, \"Failed to create Parser\\n\");\n\texit (EXIT_FAILURE);\n    }\n    \n    // create stdio as UI component, disable textdomain calls\n    Y2Component* user_interface = new Y2StdioComponent (false, true);\n    if (!user_interface)\n    {\n\tfprintf (stderr, \"Failed to create Y2StdioComponent\\n\");\n\texit (EXIT_FAILURE);\n    }\n\n    // load config file (if existing)\n    if (fname && load_scr)\n    {\n\tint len = strlen (fname);\n\tif (len > 5\n\t    && strcmp (&fname[len-4], \".ycp\") == 0)\n\t{\n\t    char* cname = strdup (fname);\n\t    strcpy (&cname[len-4], \".scr\");\n\t    if (access (cname, R_OK) == 0)\n\t    {\n\t\tYCPValue confval = SCRAgent::readconf (cname);\n\t\tif (confval.isNull ()\n\t\t    || !confval->isTerm ())\n\t\t{\n\t\t    fprintf (stderr, \"Failed to read '%s'\\n\", cname);\n\t\t    fprintf (stderr, \"Read result: %s\\n\", confval->toString().c_str());\n\t\t    exit (EXIT_FAILURE);\n\t\t}\n\t\tYCPTerm term = confval->asTerm();\n\t\tfor (int i = 0; i < term->size (); i++)\n\t\t{\n\t\t    agent->otherCommand (term->value (i)->asTerm ());\n\t\t}\n\t    }\n\t}\n    }\n\n    // open ycp script\n    FILE* infile = stdin;\n    if (fname != 0)\n    {\n\tinfile = fopen (fname, \"r\");\n\tif (infile == 0)\n\t{\n\t    fprintf (stderr, \"Failed to open '%s'\\n\", fname);\n\t    exit (EXIT_FAILURE);\n\t}\n    }\n    else\n    {\n\tfname = \"stdin\";\n    }\n\n    // evaluate ycp script\n    parser->setInput (infile, fname);\n    parser->setBuffered ();\n    YCodePtr value = 0;\n    while (true)\n    {\n\tvalue = parser->parse ();\t\t\t// error reports show our filename\n\tif (value == 0)\n\t{\n\t    break;\n\t}\n\tYCPValue result = value->evaluate ();\n\tprintf (\"(%s)\\n\", result->toString ().c_str ());\t// send result to caller\n\tfflush (0);\n    }\n\n    if (infile != stdin)\n    {\n\tfclose (infile);\n    }\n    delete user_interface;\n    delete parser;\t\t\t\t\t// restores callers filename\n\n}",
          "includes": [
            "#include <scr/SCR.h>",
            "#include <scr/SCRAgent.h>",
            "#include <y2/Y2StdioComponent.h>",
            "#include <ycp/Parser.h>",
            "#include <ycp/y2log.h>",
            "#include <unistd.h>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "void run_agent_instance (int, char*[], bool, SCRAgent*);"
          ],
          "called_functions": [],
          "contextual_snippet": "#include <scr/SCR.h>\n#include <scr/SCRAgent.h>\n#include <y2/Y2StdioComponent.h>\n#include <ycp/Parser.h>\n#include <ycp/y2log.h>\n#include <unistd.h>\n#include <stdio.h>\n\nvoid run_agent_instance (int, char*[], bool, SCRAgent*);\n\nvoid\nrun_agent_instance (int argc, char* argv[], bool load_scr, SCRAgent* agent)\n{\n    const char* fname = process_options (argc, argv);\n    \n    // fill in SCR builtins\n    SCR scr;\n\n    // create parser\n    Parser* parser = new Parser ();\n    if (!parser)\n    {\n\tfprintf (stderr, \"Failed to create Parser\\n\");\n\texit (EXIT_FAILURE);\n    }\n    \n    // create stdio as UI component, disable textdomain calls\n    Y2Component* user_interface = new Y2StdioComponent (false, true);\n    if (!user_interface)\n    {\n\tfprintf (stderr, \"Failed to create Y2StdioComponent\\n\");\n\texit (EXIT_FAILURE);\n    }\n\n    // load config file (if existing)\n    if (fname && load_scr)\n    {\n\tint len = strlen (fname);\n\tif (len > 5\n\t    && strcmp (&fname[len-4], \".ycp\") == 0)\n\t{\n\t    char* cname = strdup (fname);\n\t    strcpy (&cname[len-4], \".scr\");\n\t    if (access (cname, R_OK) == 0)\n\t    {\n\t\tYCPValue confval = SCRAgent::readconf (cname);\n\t\tif (confval.isNull ()\n\t\t    || !confval->isTerm ())\n\t\t{\n\t\t    fprintf (stderr, \"Failed to read '%s'\\n\", cname);\n\t\t    fprintf (stderr, \"Read result: %s\\n\", confval->toString().c_str());\n\t\t    exit (EXIT_FAILURE);\n\t\t}\n\t\tYCPTerm term = confval->asTerm();\n\t\tfor (int i = 0; i < term->size (); i++)\n\t\t{\n\t\t    agent->otherCommand (term->value (i)->asTerm ());\n\t\t}\n\t    }\n\t}\n    }\n\n    // open ycp script\n    FILE* infile = stdin;\n    if (fname != 0)\n    {\n\tinfile = fopen (fname, \"r\");\n\tif (infile == 0)\n\t{\n\t    fprintf (stderr, \"Failed to open '%s'\\n\", fname);\n\t    exit (EXIT_FAILURE);\n\t}\n    }\n    else\n    {\n\tfname = \"stdin\";\n    }\n\n    // evaluate ycp script\n    parser->setInput (infile, fname);\n    parser->setBuffered ();\n    YCodePtr value = 0;\n    while (true)\n    {\n\tvalue = parser->parse ();\t\t\t// error reports show our filename\n\tif (value == 0)\n\t{\n\t    break;\n\t}\n\tYCPValue result = value->evaluate ();\n\tprintf (\"(%s)\\n\", result->toString ().c_str ());\t// send result to caller\n\tfflush (0);\n    }\n\n    if (infile != stdin)\n    {\n\tfclose (infile);\n    }\n    delete user_interface;\n    delete parser;\t\t\t\t\t// restores callers filename\n\n}"
        }
      },
      {
        "call_info": {
          "callee": "exit",
          "args": [
            "EXIT_FAILURE"
          ],
          "line": 34
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Failed to create Agent\\n\""
          ],
          "line": 33
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "scrconf.replace",
          "args": [
            "p",
            "4",
            "\".scr\""
          ],
          "line": 27
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "scrconf.rfind",
          "args": [
            "\".ycp\""
          ],
          "line": 24
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "process_options",
          "args": [
            "argc",
            "argv"
          ],
          "line": 22
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include \"../src/IniAgent.h\"\n#include \"../../scr/src/ScriptingAgent.h\"\n#include <scr/run_agent.h>\n\nint\nmain (int argc, char *argv[])\n{\n    // find the \".ycp\" argument\n    string scrconf = process_options (argc, argv);\n    // substitute\n    string::size_type p = scrconf.rfind (\".ycp\");\n    if (p != string::npos)\n    {\n\tscrconf.replace (p, 4, \".scr\");\n    }\n\n    SCRAgent *agent = new ScriptingAgent (scrconf);\n    if (!agent)\n    {\n\tfprintf (stderr, \"Failed to create Agent\\n\");\n\texit (EXIT_FAILURE);\n    }\n\n    run_agent_instance (argc, argv, false, agent);\n\n    delete agent;\n    exit (EXIT_SUCCESS);\n}"
  }
]