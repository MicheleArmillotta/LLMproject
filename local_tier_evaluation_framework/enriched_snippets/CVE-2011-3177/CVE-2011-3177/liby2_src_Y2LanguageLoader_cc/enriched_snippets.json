[
  {
    "function_name": "Y2LanguageLoader",
    "container": "Y2LanguageLoader",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2/src/Y2LanguageLoader.cc",
    "lines": "58-101",
    "snippet": "Y2LanguageLoader::Y2LanguageLoader ()\n{\n    glob_t glob_buf;\n    int glob_flags = 0;\n    if (YCPPathSearch::numberOfComponentLevels() == 0)\n    {\n\ty2milestone (\"No language components\");\n\tmemset (&glob_buf, 0, sizeof (glob_t));\n    }\n    for (int i = 0; i < YCPPathSearch::numberOfComponentLevels (); ++i)\n    {\n\tstring pattern = YCPPathSearch::searchPath (YCPPathSearch::PLUGIN, i)\n\t    + \"/libpy2lang_*.so\";\n\n\tint res = glob (pattern.c_str (), glob_flags, NULL, &glob_buf);\n\tif (res != 0 && res != GLOB_NOMATCH)\n\t{\n// Cannot use logging, may not be initialized yet (esp. with logconf)\n\t    fprintf (stderr, \"Glob error %d for pattern %s\\n\",\n\t\t     res, pattern.c_str ());\n\t}\n\tglob_flags |= GLOB_APPEND;\n    }\n\n    // load them\n    for (size_t i = 0; i < glob_buf.gl_pathc; ++i)\n    {\n\tchar *p = glob_buf.gl_pathv[i];\n\ty2debug (\"Loading language plugin %s\", p);\n\tvoid *handle = dlopen (p, RTLD_LAZY | RTLD_GLOBAL);\n\tif (handle)\n\t{\n\t    plugins.push (handle);\n\t}\n\telse\n\t{\n//\t    y2error (\"Error loading language plugin %s: %s\", p, dlerror ());\n\t    fprintf (stderr, \"Error loading language plugin %s: %s\\n\", p, dlerror ());\n\t}\n    }\n\n    if (glob_flags != 0)\n\tglobfree (&glob_buf);\n}",
    "includes": [
      "#include <stack>",
      "#include <glob.h>",
      "#include <dlfcn.h>",
      "#include <ycp/y2log.h>",
      "#include <ycp/pathsearch.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "globfree",
          "args": [
            "&glob_buf"
          ],
          "line": 100
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Error loading language plugin %s: %s\\n\"",
            "p",
            "dlerror ()"
          ],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dlerror",
          "args": [],
          "line": 95
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "plugins.push",
          "args": [
            "handle"
          ],
          "line": 90
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "dlopen",
          "args": [
            "p",
            "RTLD_LAZY | RTLD_GLOBAL"
          ],
          "line": 87
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "y2debug",
          "args": [
            "\"Loading language plugin %s\"",
            "p"
          ],
          "line": 86
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "fprintf",
          "args": [
            "stderr",
            "\"Glob error %d for pattern %s\\n\"",
            "res",
            "pattern.c_str ()"
          ],
          "line": 76
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pattern.c_str",
          "args": [],
          "line": 77
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "glob",
          "args": [
            "pattern.c_str ()",
            "glob_flags",
            "NULL",
            "&glob_buf"
          ],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "pattern.c_str",
          "args": [],
          "line": 72
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "YCPPathSearch::searchPath",
          "args": [
            "YCPPathSearch::PLUGIN",
            "i"
          ],
          "line": 69
        },
        "resolved": true,
        "details": {
          "function_name": "searchPath",
          "container": "Y2PathSearch",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/libycp/src/pathsearch.cc",
          "lines": "93-128",
          "snippet": "string\nY2PathSearch::searchPath (WHAT what, int level)\n{\n    initializePaths();\n\n    int levels = paths.size();\n\n    switch (what)\n    {\n\tcase EXECCOMP:\n\t    if (level == levels - 1) // FIXME\n\t    {\n\t\treturn EXECCOMPDIR;\n\t    }\n\t    else\n\t    {\n\t\treturn paths[level];\n\t    }\n\tbreak;\n\n\tcase PLUGIN:\n\t    if (level == levels - 1) // FIXME\n\t    {\n\t\treturn PLUGINDIR;\n\t    }\n\t    else\n\t    {\n\t\treturn paths[level] + \"/plugin\";\n\t    }\n\tbreak;\n\n\tdefault:\n\tbreak;\n    }\n    return paths[level];\n}",
          "includes": [
            "#include \"pathsearch.h\"",
            "#include <ycp/y2log.h>",
            "#include <boost/algorithm/string.hpp>",
            "#include <unistd.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "vector<string> Y2PathSearch::paths;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"pathsearch.h\"\n#include <ycp/y2log.h>\n#include <boost/algorithm/string.hpp>\n#include <unistd.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n\nvector<string> Y2PathSearch::paths;\n\nY2PathSearch {\n  string\n  Y2PathSearch::searchPath (WHAT what, int level)\n  {\n      initializePaths();\n  \n      int levels = paths.size();\n  \n      switch (what)\n      {\n  \tcase EXECCOMP:\n  \t    if (level == levels - 1) // FIXME\n  \t    {\n  \t\treturn EXECCOMPDIR;\n  \t    }\n  \t    else\n  \t    {\n  \t\treturn paths[level];\n  \t    }\n  \tbreak;\n  \n  \tcase PLUGIN:\n  \t    if (level == levels - 1) // FIXME\n  \t    {\n  \t\treturn PLUGINDIR;\n  \t    }\n  \t    else\n  \t    {\n  \t\treturn paths[level] + \"/plugin\";\n  \t    }\n  \tbreak;\n  \n  \tdefault:\n  \tbreak;\n      }\n      return paths[level];\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "YCPPathSearch::numberOfComponentLevels",
          "args": [],
          "line": 67
        },
        "resolved": true,
        "details": {
          "function_name": "numberOfComponentLevels",
          "container": "Y2PathSearch",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/libycp/src/pathsearch.cc",
          "lines": "85-90",
          "snippet": "int\nY2PathSearch::numberOfComponentLevels()\n{\n    initializePaths();\n    return paths.size();\n}",
          "includes": [
            "#include \"pathsearch.h\"",
            "#include <ycp/y2log.h>",
            "#include <boost/algorithm/string.hpp>",
            "#include <unistd.h>",
            "#include <sys/time.h>",
            "#include <sys/stat.h>"
          ],
          "macros_used": [],
          "globals_used": [
            "vector<string> Y2PathSearch::paths;"
          ],
          "called_functions": [],
          "contextual_snippet": "#include \"pathsearch.h\"\n#include <ycp/y2log.h>\n#include <boost/algorithm/string.hpp>\n#include <unistd.h>\n#include <sys/time.h>\n#include <sys/stat.h>\n\nvector<string> Y2PathSearch::paths;\n\nY2PathSearch {\n  int\n  Y2PathSearch::numberOfComponentLevels()\n  {\n      initializePaths();\n      return paths.size();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "memset",
          "args": [
            "&glob_buf",
            "0",
            "sizeof (glob_t)"
          ],
          "line": 65
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "y2milestone",
          "args": [
            "\"No language components\""
          ],
          "line": 64
        },
        "resolved": false,
        "reason": "library_or_external"
      }
    ],
    "contextual_snippet": "#include <stack>\n#include <glob.h>\n#include <dlfcn.h>\n#include <ycp/y2log.h>\n#include <ycp/pathsearch.h>\n\nY2LanguageLoader {\n  Y2LanguageLoader::Y2LanguageLoader ()\n  {\n      glob_t glob_buf;\n      int glob_flags = 0;\n      if (YCPPathSearch::numberOfComponentLevels() == 0)\n      {\n  \ty2milestone (\"No language components\");\n  \tmemset (&glob_buf, 0, sizeof (glob_t));\n      }\n      for (int i = 0; i < YCPPathSearch::numberOfComponentLevels (); ++i)\n      {\n  \tstring pattern = YCPPathSearch::searchPath (YCPPathSearch::PLUGIN, i)\n  \t    + \"/libpy2lang_*.so\";\n  \n  \tint res = glob (pattern.c_str (), glob_flags, NULL, &glob_buf);\n  \tif (res != 0 && res != GLOB_NOMATCH)\n  \t{\n  // Cannot use logging, may not be initialized yet (esp. with logconf)\n  \t    fprintf (stderr, \"Glob error %d for pattern %s\\n\",\n  \t\t     res, pattern.c_str ());\n  \t}\n  \tglob_flags |= GLOB_APPEND;\n      }\n  \n      // load them\n      for (size_t i = 0; i < glob_buf.gl_pathc; ++i)\n      {\n  \tchar *p = glob_buf.gl_pathv[i];\n  \ty2debug (\"Loading language plugin %s\", p);\n  \tvoid *handle = dlopen (p, RTLD_LAZY | RTLD_GLOBAL);\n  \tif (handle)\n  \t{\n  \t    plugins.push (handle);\n  \t}\n  \telse\n  \t{\n  //\t    y2error (\"Error loading language plugin %s: %s\", p, dlerror ());\n  \t    fprintf (stderr, \"Error loading language plugin %s: %s\\n\", p, dlerror ());\n  \t}\n      }\n  \n      if (glob_flags != 0)\n  \tglobfree (&glob_buf);\n  }\n}"
  },
  {
    "function_name": "~Y2LanguageLoader",
    "container": "Y2LanguageLoader",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2/src/Y2LanguageLoader.cc",
    "lines": "38-56",
    "snippet": "Y2LanguageLoader::~Y2LanguageLoader ()\n{\n/*\nTHis does not work because the environment may be already destroyed\n    if (getenv (\"Y2LANGUAGELOADER\"))\n    {\n\t// don't unload the libraries when we need their symbols for\n\t// valgrind tracking\n\treturn;\n    }\n*/\n    while (!plugins.empty ())\n    {\n\t// only unloaded when not needed, says man\n// The process is ending anyway\n//\tdlclose (plugins.top ());\n\tplugins.pop ();\n    }\n}",
    "includes": [
      "#include <stack>",
      "#include <glob.h>",
      "#include <dlfcn.h>",
      "#include <ycp/y2log.h>",
      "#include <ycp/pathsearch.h>"
    ],
    "macros_used": [],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "plugins.pop",
          "args": [],
          "line": 54
        },
        "resolved": true,
        "details": {
          "function_name": "pop",
          "container": "SymbolEntry",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2/src/SymbolEntry.cc",
          "lines": "159-167",
          "snippet": "void\nSymbolEntry::pop ()\n{\n    if (! m_recurse_stack)\n\treturn;\n\n    m_value = m_recurse_stack->top ();\n    m_recurse_stack->pop ();\n}",
          "includes": [
            "#include \"ycp/YCPCode.h\"",
            "#include \"ycp/YCPVoid.h\"",
            "#include \"ycp/SymbolTable.h\"",
            "#include \"y2/SymbolEntry.h\"",
            "#include \"ycp/y2log.h\"",
            "#include <string>",
            "#include <stdio.h>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"ycp/YCPCode.h\"\n#include \"ycp/YCPVoid.h\"\n#include \"ycp/SymbolTable.h\"\n#include \"y2/SymbolEntry.h\"\n#include \"ycp/y2log.h\"\n#include <string>\n#include <stdio.h>\n\nSymbolEntry {\n  void\n  SymbolEntry::pop ()\n  {\n      if (! m_recurse_stack)\n  \treturn;\n  \n      m_value = m_recurse_stack->top ();\n      m_recurse_stack->pop ();\n  }\n}"
        }
      },
      {
        "call_info": {
          "callee": "plugins.empty",
          "args": [],
          "line": 49
        },
        "resolved": true,
        "details": {
          "function_name": "empty",
          "container": "Pathname",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2011-3177/repo/liby2util-r/src/include/y2util/Pathname.h",
          "lines": "66-66",
          "snippet": "bool empty()    const { return !name_t.size(); }",
          "includes": [
            "#include <string>",
            "#include <iosfwd>"
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <string>\n#include <iosfwd>\n\nPathname {\n  bool empty()    const { return !name_t.size(); }\n}"
        }
      }
    ],
    "contextual_snippet": "#include <stack>\n#include <glob.h>\n#include <dlfcn.h>\n#include <ycp/y2log.h>\n#include <ycp/pathsearch.h>\n\nY2LanguageLoader {\n  Y2LanguageLoader::~Y2LanguageLoader ()\n  {\n  /*\n  THis does not work because the environment may be already destroyed\n      if (getenv (\"Y2LANGUAGELOADER\"))\n      {\n  \t// don't unload the libraries when we need their symbols for\n  \t// valgrind tracking\n  \treturn;\n      }\n  */\n      while (!plugins.empty ())\n      {\n  \t// only unloaded when not needed, says man\n  // The process is ending anyway\n  //\tdlclose (plugins.top ());\n  \tplugins.pop ();\n      }\n  }\n}"
  }
]