[
  {
    "function_name": "ProcessAndXorBlock",
    "container": "Camellia::Base",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2141/repo/camellia.cpp",
    "lines": "188-234",
    "snippet": "void Camellia::Base::ProcessAndXorBlock(const byte *inBlock, const byte *xorBlock, byte *outBlock) const\n{\n#define KS(i, j) ks[i*4 + EFI(j/2)*2 + EFI(j%2)]\n\n#define FL(klh, kll, krh, krl)\t\t\\\n\tll ^= rotlFixed(lh & klh, 1);\t\\\n\tlh ^= (ll | kll);\t\t\t\t\\\n\trh ^= (rl | krl);\t\t\t\t\\\n\trl ^= rotlFixed(rh & krh, 1);\n\n\tword32 lh, ll, rh, rl;\n\ttypedef BlockGetAndPut<word32, BigEndian> Block;\n\tBlock::Get(inBlock)(lh)(ll)(rh)(rl);\n\tconst word32 *ks = m_key.data();\n\tlh ^= KS(0,0);\n\tll ^= KS(0,1);\n\trh ^= KS(0,2);\n\trl ^= KS(0,3);\n\n\t// timing attack countermeasure. see comments at top for more details\n\tconst int cacheLineSize = GetCacheLineSize();\n\tunsigned int i;\n\tword32 u = 0;\n\tfor (i=0; i<256; i+=cacheLineSize)\n\t\tu &= *(const word32 *)(s1+i);\n\tu &= *(const word32 *)(s1+252);\n\tlh |= u; ll |= u;\n\n\tSLOW_ROUND(lh, ll, rh, rl, KS(1,0), KS(1,1))\n\tSLOW_ROUND(rh, rl, lh, ll, KS(1,2), KS(1,3))\n\tfor (i = m_rounds-1; i > 0; --i)\n\t{\n\t\tDOUBLE_ROUND(lh, ll, rh, rl, KS(2,0), KS(2,1), KS(2,2), KS(2,3))\n\t\tDOUBLE_ROUND(lh, ll, rh, rl, KS(3,0), KS(3,1), KS(3,2), KS(3,3))\n\t\tFL(KS(4,0), KS(4,1), KS(4,2), KS(4,3));\n\t\tDOUBLE_ROUND(lh, ll, rh, rl, KS(5,0), KS(5,1), KS(5,2), KS(5,3))\n\t\tks += 16;\n\t}\n\tDOUBLE_ROUND(lh, ll, rh, rl, KS(2,0), KS(2,1), KS(2,2), KS(2,3))\n\tROUND(lh, ll, rh, rl, KS(3,0), KS(3,1))\n\tSLOW_ROUND(rh, rl, lh, ll, KS(3,2), KS(3,3))\n\tlh ^= KS(4,0);\n\tll ^= KS(4,1);\n\trh ^= KS(4,2);\n\trl ^= KS(4,3);\n\tBlock::Put(xorBlock, outBlock)(rh)(rl)(lh)(ll);\n}",
    "includes": [
      "#include \"cpu.h\"",
      "#include \"misc.h\"",
      "#include \"camellia.h\"",
      "#include \"pch.h\""
    ],
    "macros_used": [],
    "globals_used": [
      "const byte Camellia::Base::s1[256] =\n{\n\t112,130,44,236,179,39,192,229,228,133,87,53,234,12,174,65,\n\t35,239,107,147,69,25,165,33,237,14,79,78,29,101,146,189,\n\t134,184,175,143,124,235,31,206,62,48,220,95,94,197,11,26,\n\t166,225,57,202,213,71,93,61,217,1,90,214,81,86,108,77,\n\t139,13,154,102,251,204,176,45,116,18,43,32,240,177,132,153,\n\t223,76,203,194,52,126,118,5,109,183,169,49,209,23,4,215,\n\t20,88,58,97,222,27,17,28,50,15,156,22,83,24,242,34,\n\t254,68,207,178,195,181,122,145,36,8,232,168,96,252,105,80,\n\t170,208,160,125,161,137,98,151,84,91,30,149,224,255,100,210,\n\t16,196,0,72,163,247,117,219,138,3,230,218,9,63,221,148,\n\t135,92,131,2,205,74,144,51,115,103,246,243,157,127,191,226,\n\t82,155,216,38,200,55,198,59,129,150,111,75,19,190,99,46,\n\t233,121,167,140,159,110,188,142,41,245,249,182,47,253,180,89,\n\t120,152,6,106,231,70,113,186,212,37,171,66,136,162,141,250,\n\t114,7,185,85,248,238,172,10,54,73,42,104,60,56,241,164,\n\t64,40,211,123,187,201,67,193,21,227,173,244,119,199,128,158\n};"
    ],
    "called_functions": [
      {
        "call_info": {
          "callee": "Block::Put",
          "args": [
            "ll"
          ],
          "line": 233
        },
        "resolved": true,
        "details": {
          "function_name": "Put",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2141/repo/cryptlib.h",
          "lines": "785-786",
          "snippet": "size_t Put(byte inByte, bool blocking=true)\n\t\t\t{return Put(&inByte, 1, blocking);}",
          "includes": [
            "#include \"stdcpp.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"stdcpp.h\"\n#include \"config.h\"\n\nsize_t Put(byte inByte, bool blocking=true)\n\t\t\t{return Put(&inByte, 1, blocking);}"
        }
      },
      {
        "call_info": {
          "callee": "Block::Put",
          "args": [
            "xorBlock",
            "outBlock"
          ],
          "line": 233
        },
        "resolved": true,
        "details": {
          "function_name": "PutBlock",
          "container": "PutBlock",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2141/repo/misc.h",
          "lines": "1179-1180",
          "snippet": "PutBlock(const void *xorBlock, void *block)\n\t\t: m_xorBlock((const byte *)xorBlock), m_block((byte *)block) {}",
          "includes": [
            "#include <byteswap.h>",
            "#include <mem.h>",
            "#include <intrin.h>",
            "#include <string.h>\t\t// for memcpy and memmove",
            "#include \"smartptr.h\"",
            "#include \"cryptlib.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <byteswap.h>\n#include <mem.h>\n#include <intrin.h>\n#include <string.h>\t\t// for memcpy and memmove\n#include \"smartptr.h\"\n#include \"cryptlib.h\"\n\nPutBlock {\n  PutBlock(const void *xorBlock, void *block)\n  \t\t: m_xorBlock((const byte *)xorBlock), m_block((byte *)block) {}\n}"
        }
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "4",
            "3"
          ],
          "line": 232
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "4",
            "2"
          ],
          "line": 231
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "4",
            "1"
          ],
          "line": 230
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "4",
            "0"
          ],
          "line": 229
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SLOW_ROUND",
          "args": [
            "rh",
            "rl",
            "lh",
            "ll",
            "KS(3,2)",
            "KS(3,3)"
          ],
          "line": 228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "3",
            "3"
          ],
          "line": 228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "3",
            "2"
          ],
          "line": 228
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "ROUND",
          "args": [
            "lh",
            "ll",
            "rh",
            "rl",
            "KS(3,0)",
            "KS(3,1)"
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "3",
            "1"
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "3",
            "0"
          ],
          "line": 227
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DOUBLE_ROUND",
          "args": [
            "lh",
            "ll",
            "rh",
            "rl",
            "KS(2,0)",
            "KS(2,1)",
            "KS(2,2)",
            "KS(2,3)"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "2",
            "3"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "2",
            "2"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "2",
            "1"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "2",
            "0"
          ],
          "line": 226
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DOUBLE_ROUND",
          "args": [
            "lh",
            "ll",
            "rh",
            "rl",
            "KS(5,0)",
            "KS(5,1)",
            "KS(5,2)",
            "KS(5,3)"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "5",
            "3"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "5",
            "2"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "5",
            "1"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "5",
            "0"
          ],
          "line": 223
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "FL",
          "args": [
            "KS(4,0)",
            "KS(4,1)",
            "KS(4,2)",
            "KS(4,3)"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "4",
            "3"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "4",
            "2"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "4",
            "1"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "4",
            "0"
          ],
          "line": 222
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DOUBLE_ROUND",
          "args": [
            "lh",
            "ll",
            "rh",
            "rl",
            "KS(3,0)",
            "KS(3,1)",
            "KS(3,2)",
            "KS(3,3)"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "3",
            "3"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "3",
            "2"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "3",
            "1"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "3",
            "0"
          ],
          "line": 221
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DOUBLE_ROUND",
          "args": [
            "lh",
            "ll",
            "rh",
            "rl",
            "KS(2,0)",
            "KS(2,1)",
            "KS(2,2)",
            "KS(2,3)"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "2",
            "3"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "2",
            "2"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "2",
            "1"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "2",
            "0"
          ],
          "line": 220
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SLOW_ROUND",
          "args": [
            "rh",
            "rl",
            "lh",
            "ll",
            "KS(1,2)",
            "KS(1,3)"
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "1",
            "3"
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "1",
            "2"
          ],
          "line": 217
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "SLOW_ROUND",
          "args": [
            "lh",
            "ll",
            "rh",
            "rl",
            "KS(1,0)",
            "KS(1,1)"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "1",
            "1"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "1",
            "0"
          ],
          "line": 216
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetCacheLineSize",
          "args": [],
          "line": 208
        },
        "resolved": true,
        "details": {
          "function_name": "GetCacheLineSize",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2141/repo/cpu.h",
          "lines": "183-186",
          "snippet": "inline int GetCacheLineSize()\n{\n\treturn CRYPTOPP_L1_CACHE_LINE_SIZE;\n}",
          "includes": [
            "#include <wmmintrin.h>",
            "#include <smmintrin.h>",
            "#include <tmmintrin.h>",
            "#include <emmintrin.h>",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <wmmintrin.h>\n#include <smmintrin.h>\n#include <tmmintrin.h>\n#include <emmintrin.h>\n#include \"config.h\"\n\ninline int GetCacheLineSize()\n{\n\treturn CRYPTOPP_L1_CACHE_LINE_SIZE;\n}"
        }
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "0",
            "3"
          ],
          "line": 205
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "0",
            "2"
          ],
          "line": 204
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "0",
            "1"
          ],
          "line": 203
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS",
          "args": [
            "0",
            "0"
          ],
          "line": 202
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "m_key.data",
          "args": [],
          "line": 201
        },
        "resolved": true,
        "details": {
          "function_name": "data",
          "container": "SecBlock",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2141/repo/secblock.h",
          "lines": "300-300",
          "snippet": "typename A::const_pointer data() const {return m_ptr;}",
          "includes": [
            "#include <assert.h>",
            "#include \"misc.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <assert.h>\n#include \"misc.h\"\n#include \"config.h\"\n\nSecBlock {\n  typename A::const_pointer data() const {return m_ptr;}\n}"
        }
      },
      {
        "call_info": {
          "callee": "Block::Get",
          "args": [
            "rl"
          ],
          "line": 200
        },
        "resolved": true,
        "details": {
          "function_name": "Get",
          "container": "BlockGetAndPut",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2141/repo/misc.h",
          "lines": "1201-1201",
          "snippet": "static inline GetBlock<T, B, GA> Get(const void *block) {return GetBlock<T, B, GA>(block);}",
          "includes": [
            "#include <byteswap.h>",
            "#include <mem.h>",
            "#include <intrin.h>",
            "#include <string.h>\t\t// for memcpy and memmove",
            "#include \"smartptr.h\"",
            "#include \"cryptlib.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <byteswap.h>\n#include <mem.h>\n#include <intrin.h>\n#include <string.h>\t\t// for memcpy and memmove\n#include \"smartptr.h\"\n#include \"cryptlib.h\"\n\nBlockGetAndPut {\n  static inline GetBlock<T, B, GA> Get(const void *block) {return GetBlock<T, B, GA>(block);}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"cpu.h\"\n#include \"misc.h\"\n#include \"camellia.h\"\n#include \"pch.h\"\n\nconst byte Camellia::Base::s1[256] =\n{\n\t112,130,44,236,179,39,192,229,228,133,87,53,234,12,174,65,\n\t35,239,107,147,69,25,165,33,237,14,79,78,29,101,146,189,\n\t134,184,175,143,124,235,31,206,62,48,220,95,94,197,11,26,\n\t166,225,57,202,213,71,93,61,217,1,90,214,81,86,108,77,\n\t139,13,154,102,251,204,176,45,116,18,43,32,240,177,132,153,\n\t223,76,203,194,52,126,118,5,109,183,169,49,209,23,4,215,\n\t20,88,58,97,222,27,17,28,50,15,156,22,83,24,242,34,\n\t254,68,207,178,195,181,122,145,36,8,232,168,96,252,105,80,\n\t170,208,160,125,161,137,98,151,84,91,30,149,224,255,100,210,\n\t16,196,0,72,163,247,117,219,138,3,230,218,9,63,221,148,\n\t135,92,131,2,205,74,144,51,115,103,246,243,157,127,191,226,\n\t82,155,216,38,200,55,198,59,129,150,111,75,19,190,99,46,\n\t233,121,167,140,159,110,188,142,41,245,249,182,47,253,180,89,\n\t120,152,6,106,231,70,113,186,212,37,171,66,136,162,141,250,\n\t114,7,185,85,248,238,172,10,54,73,42,104,60,56,241,164,\n\t64,40,211,123,187,201,67,193,21,227,173,244,119,199,128,158\n};\n\nCamellia {\n  Base {\n    void Camellia::Base::ProcessAndXorBlock(const byte *inBlock, const byte *xorBlock, byte *outBlock) const\n    {\n    #define KS(i, j) ks[i*4 + EFI(j/2)*2 + EFI(j%2)]\n    \n    #define FL(klh, kll, krh, krl)\t\t\\\n    \tll ^= rotlFixed(lh & klh, 1);\t\\\n    \tlh ^= (ll | kll);\t\t\t\t\\\n    \trh ^= (rl | krl);\t\t\t\t\\\n    \trl ^= rotlFixed(rh & krh, 1);\n    \n    \tword32 lh, ll, rh, rl;\n    \ttypedef BlockGetAndPut<word32, BigEndian> Block;\n    \tBlock::Get(inBlock)(lh)(ll)(rh)(rl);\n    \tconst word32 *ks = m_key.data();\n    \tlh ^= KS(0,0);\n    \tll ^= KS(0,1);\n    \trh ^= KS(0,2);\n    \trl ^= KS(0,3);\n    \n    \t// timing attack countermeasure. see comments at top for more details\n    \tconst int cacheLineSize = GetCacheLineSize();\n    \tunsigned int i;\n    \tword32 u = 0;\n    \tfor (i=0; i<256; i+=cacheLineSize)\n    \t\tu &= *(const word32 *)(s1+i);\n    \tu &= *(const word32 *)(s1+252);\n    \tlh |= u; ll |= u;\n    \n    \tSLOW_ROUND(lh, ll, rh, rl, KS(1,0), KS(1,1))\n    \tSLOW_ROUND(rh, rl, lh, ll, KS(1,2), KS(1,3))\n    \tfor (i = m_rounds-1; i > 0; --i)\n    \t{\n    \t\tDOUBLE_ROUND(lh, ll, rh, rl, KS(2,0), KS(2,1), KS(2,2), KS(2,3))\n    \t\tDOUBLE_ROUND(lh, ll, rh, rl, KS(3,0), KS(3,1), KS(3,2), KS(3,3))\n    \t\tFL(KS(4,0), KS(4,1), KS(4,2), KS(4,3));\n    \t\tDOUBLE_ROUND(lh, ll, rh, rl, KS(5,0), KS(5,1), KS(5,2), KS(5,3))\n    \t\tks += 16;\n    \t}\n    \tDOUBLE_ROUND(lh, ll, rh, rl, KS(2,0), KS(2,1), KS(2,2), KS(2,3))\n    \tROUND(lh, ll, rh, rl, KS(3,0), KS(3,1))\n    \tSLOW_ROUND(rh, rl, lh, ll, KS(3,2), KS(3,3))\n    \tlh ^= KS(4,0);\n    \tll ^= KS(4,1);\n    \trh ^= KS(4,2);\n    \trl ^= KS(4,3);\n    \tBlock::Put(xorBlock, outBlock)(rh)(rl)(lh)(ll);\n    }\n  }\n}"
  },
  {
    "function_name": "UncheckedSetKey",
    "container": "Camellia::Base",
    "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2141/repo/camellia.cpp",
    "lines": "61-186",
    "snippet": "void Camellia::Base::UncheckedSetKey(const byte *key, unsigned int keylen, const NameValuePairs &)\n{\n\tm_rounds = (keylen >= 24) ? 4 : 3;\n\tunsigned int kslen = (8 * m_rounds + 2);\n\tm_key.New(kslen*2);\n\tword32 *ks32 = m_key.data();\n\tint m=0, a=0;\n\tif (!IsForwardTransformation())\n\t\tm = -1, a = kslen-1;\n\n\tword32 kl0, kl1, kl2, kl3;\n\tGetBlock<word32, BigEndian> getBlock(key);\n\tgetBlock(kl0)(kl1)(kl2)(kl3);\n\tword32 k0=kl0, k1=kl1, k2=kl2, k3=kl3;\n\n#define CALC_ADDR2(base, i, j)\t((byte *)(base)+8*(i)+4*(j)+((-16*(i))&m))\n#define CALC_ADDR(base, i)\tCALC_ADDR2(base, i, 0)\n\n#if 1\n\tword64 kwl, kwr;\n\tks32 += 2*a;\n#define PREPARE_KS_ROUNDS\t\t\t\\\n\tkwl = (word64(k0) << 32) | k1;\t\\\n\tkwr = (word64(k2) << 32) | k3\n#define KS_ROUND_0(i)\t\t\t\t\t\t\t\\\n\t*(word64*)CALC_ADDR(ks32, i+EFI(0)) = kwl;\t\\\n\t*(word64*)CALC_ADDR(ks32, i+EFI(1)) = kwr\n#define KS_ROUND(i, r, which)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\\\n\tif (which & (1<<int(r<64))) *(word64*)CALC_ADDR(ks32, i+EFI(r<64)) = (kwr << (r%64)) | (kwl >> (64 - (r%64)));\t\\\n\tif (which & (1<<int(r>64))) *(word64*)CALC_ADDR(ks32, i+EFI(r>64)) = (kwl << (r%64)) | (kwr >> (64 - (r%64)))\n#else\n\t// SSE2 version is 30% faster on Intel Core 2. Doesn't seem worth the hassle of maintenance, but left here\n\t// #if'd out in case someone needs it.\n\t__m128i kw, kw2;\n\t__m128i *ks128 = (__m128i *)ks32+a/2;\n\tks32 += 2*a;\n#define PREPARE_KS_ROUNDS\t\t\t\t\t\t\t\t\t\t\t\t\t\\\n\tkw = _mm_set_epi32(k0, k1, k2, k3);\t\t\t\t\t\t\t\t\t\t\\\n\tif (m) kw2 = kw, kw = _mm_shuffle_epi32(kw, _MM_SHUFFLE(1, 0, 3, 2));\t\\\n\telse kw2 = _mm_shuffle_epi32(kw, _MM_SHUFFLE(1, 0, 3, 2))\n#define KS_ROUND_0(i)\t\t\t\t\t\t\t\t\t\t\\\n\t_mm_store_si128((__m128i *)CALC_ADDR(ks128, i), kw)\n#define KS_ROUND(i, r, which)\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\\\n\t__m128i temp;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\\\n\tif (r<64 && (which!=1 || m)) temp = _mm_or_si128(_mm_slli_epi64(kw, r%64), _mm_srli_epi64(kw2, 64-r%64));\t\\\n\telse temp = _mm_or_si128(_mm_slli_epi64(kw2, r%64), _mm_srli_epi64(kw, 64-r%64));\t\t\t\t\t\t\t\\\n\tif (which & 2) _mm_store_si128((__m128i *)CALC_ADDR(ks128, i), temp);\t\t\t\t\t\t\t\t\t\t\\\n\telse _mm_storel_epi64((__m128i*)CALC_ADDR(ks32, i+EFI(0)), temp);\t\t\t\t\t\t\t\t\t\t\t\\\n\t}\n#endif\n\n\tif (keylen == 16)\n\t{\n\t\t// KL\n\t\tPREPARE_KS_ROUNDS;\n\t\tKS_ROUND_0(0);\n\t\tKS_ROUND(4, 15, 3);\n\t\tKS_ROUND(10, 45, 3);\n\t\tKS_ROUND(12, 60, 2);\n\t\tKS_ROUND(16, 77, 3);\n\t\tKS_ROUND(18, 94, 3);\n\t\tKS_ROUND(22, 111, 3);\n\n\t\t// KA\n\t\tk0=kl0, k1=kl1, k2=kl2, k3=kl3;\n\t\tDOUBLE_ROUND(k0, k1, k2, k3, 0xA09E667Ful, 0x3BCC908Bul, 0xB67AE858ul, 0x4CAA73B2ul);\n\t\tk0^=kl0, k1^=kl1, k2^=kl2, k3^=kl3;\n\t\tDOUBLE_ROUND(k0, k1, k2, k3, 0xC6EF372Ful, 0xE94F82BEul, 0x54FF53A5ul, 0xF1D36F1Cul);\n\n\t\tPREPARE_KS_ROUNDS;\n\t\tKS_ROUND_0(2);\n\t\tKS_ROUND(6, 15, 3);\n\t\tKS_ROUND(8, 30, 3);\n\t\tKS_ROUND(12, 45, 1);\n\t\tKS_ROUND(14, 60, 3);\n\t\tKS_ROUND(20, 94, 3);\n\t\tKS_ROUND(24, 47, 3);\n\t}\n\telse\n\t{\n\t\t// KL\n\t\tPREPARE_KS_ROUNDS;\n\t\tKS_ROUND_0(0);\n\t\tKS_ROUND(12, 45, 3);\n\t\tKS_ROUND(16, 60, 3);\n\t\tKS_ROUND(22, 77, 3);\n\t\tKS_ROUND(30, 111, 3);\n\n\t\t// KR\n\t\tword32 kr0, kr1, kr2, kr3;\n\t\tGetBlock<word32, BigEndian>(key+16)(kr0)(kr1);\n\t\tif (keylen == 24)\n\t\t\tkr2 = ~kr0, kr3 = ~kr1;\n\t\telse\n\t\t\tGetBlock<word32, BigEndian>(key+24)(kr2)(kr3);\n\t\tk0=kr0, k1=kr1, k2=kr2, k3=kr3;\n\n\t\tPREPARE_KS_ROUNDS;\n\t\tKS_ROUND(4, 15, 3);\n\t\tKS_ROUND(8, 30, 3);\n\t\tKS_ROUND(18, 60, 3);\n\t\tKS_ROUND(26, 94, 3);\n\n\t\t// KA\n\t\tk0^=kl0, k1^=kl1, k2^=kl2, k3^=kl3;\n\t\tDOUBLE_ROUND(k0, k1, k2, k3, 0xA09E667Ful, 0x3BCC908Bul, 0xB67AE858ul, 0x4CAA73B2ul);\n\t\tk0^=kl0, k1^=kl1, k2^=kl2, k3^=kl3;\n\t\tDOUBLE_ROUND(k0, k1, k2, k3, 0xC6EF372Ful, 0xE94F82BEul, 0x54FF53A5ul, 0xF1D36F1Cul);\n\n\t\tPREPARE_KS_ROUNDS;\n\t\tKS_ROUND(6, 15, 3);\n\t\tKS_ROUND(14, 45, 3);\n\t\tKS_ROUND(24, 77, 3);\n\t\tKS_ROUND(28, 94, 3);\n\n\t\t// KB\n\t\tk0^=kr0, k1^=kr1, k2^=kr2, k3^=kr3;\n\t\tDOUBLE_ROUND(k0, k1, k2, k3, 0x10E527FAul, 0xDE682D1Dul, 0xB05688C2ul, 0xB3E6C1FDul);\n\n\t\tPREPARE_KS_ROUNDS;\n\t\tKS_ROUND_0(2);\n\t\tKS_ROUND(10, 30, 3);\n\t\tKS_ROUND(20, 60, 3);\n\t\tKS_ROUND(32, 47, 3);\n\t}\n}",
    "includes": [
      "#include \"cpu.h\"",
      "#include \"misc.h\"",
      "#include \"camellia.h\"",
      "#include \"pch.h\""
    ],
    "macros_used": [
      "#define PREPARE_KS_ROUNDS\t\t\t\t\t\t\t\t\t\t\t\t\t\\\n\tkw = _mm_set_epi32(k0, k1, k2, k3);\t\t\t\t\t\t\t\t\t\t\\\n\tif (m) kw2 = kw, kw = _mm_shuffle_epi32(kw, _MM_SHUFFLE(1, 0, 3, 2));\t\\\n\telse kw2 = _mm_shuffle_epi32(kw, _MM_SHUFFLE(1, 0, 3, 2))",
      "#define PREPARE_KS_ROUNDS\t\t\t\\\n\tkwl = (word64(k0) << 32) | k1;\t\\\n\tkwr = (word64(k2) << 32) | k3"
    ],
    "globals_used": [],
    "called_functions": [
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "32",
            "47",
            "3"
          ],
          "line": 184
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "20",
            "60",
            "3"
          ],
          "line": 183
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "10",
            "30",
            "3"
          ],
          "line": 182
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND_0",
          "args": [
            "2"
          ],
          "line": 181
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DOUBLE_ROUND",
          "args": [
            "k0",
            "k1",
            "k2",
            "k3",
            "0x10E527FAul",
            "0xDE682D1Dul",
            "0xB05688C2ul",
            "0xB3E6C1FDul"
          ],
          "line": 178
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "28",
            "94",
            "3"
          ],
          "line": 174
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "24",
            "77",
            "3"
          ],
          "line": 173
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "14",
            "45",
            "3"
          ],
          "line": 172
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "6",
            "15",
            "3"
          ],
          "line": 171
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DOUBLE_ROUND",
          "args": [
            "k0",
            "k1",
            "k2",
            "k3",
            "0xC6EF372Ful",
            "0xE94F82BEul",
            "0x54FF53A5ul",
            "0xF1D36F1Cul"
          ],
          "line": 168
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DOUBLE_ROUND",
          "args": [
            "k0",
            "k1",
            "k2",
            "k3",
            "0xA09E667Ful",
            "0x3BCC908Bul",
            "0xB67AE858ul",
            "0x4CAA73B2ul"
          ],
          "line": 166
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "26",
            "94",
            "3"
          ],
          "line": 162
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "18",
            "60",
            "3"
          ],
          "line": 161
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "8",
            "30",
            "3"
          ],
          "line": 160
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "4",
            "15",
            "3"
          ],
          "line": 159
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "GetBlock<word32, BigEndian>",
          "args": [
            "kr3"
          ],
          "line": 155
        },
        "resolved": true,
        "details": {
          "function_name": "GetBlock",
          "container": "GetBlock",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2141/repo/misc.h",
          "lines": "1159-1160",
          "snippet": "GetBlock(const void *block)\n\t\t: m_block((const byte *)block) {}",
          "includes": [
            "#include <byteswap.h>",
            "#include <mem.h>",
            "#include <intrin.h>",
            "#include <string.h>\t\t// for memcpy and memmove",
            "#include \"smartptr.h\"",
            "#include \"cryptlib.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <byteswap.h>\n#include <mem.h>\n#include <intrin.h>\n#include <string.h>\t\t// for memcpy and memmove\n#include \"smartptr.h\"\n#include \"cryptlib.h\"\n\nGetBlock {\n  GetBlock(const void *block)\n  \t\t: m_block((const byte *)block) {}\n}"
        }
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "30",
            "111",
            "3"
          ],
          "line": 147
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "22",
            "77",
            "3"
          ],
          "line": 146
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "16",
            "60",
            "3"
          ],
          "line": 145
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "12",
            "45",
            "3"
          ],
          "line": 144
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND_0",
          "args": [
            "0"
          ],
          "line": 143
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "24",
            "47",
            "3"
          ],
          "line": 137
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "20",
            "94",
            "3"
          ],
          "line": 136
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "14",
            "60",
            "3"
          ],
          "line": 135
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "12",
            "45",
            "1"
          ],
          "line": 134
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "8",
            "30",
            "3"
          ],
          "line": 133
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "6",
            "15",
            "3"
          ],
          "line": 132
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND_0",
          "args": [
            "2"
          ],
          "line": 131
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DOUBLE_ROUND",
          "args": [
            "k0",
            "k1",
            "k2",
            "k3",
            "0xC6EF372Ful",
            "0xE94F82BEul",
            "0x54FF53A5ul",
            "0xF1D36F1Cul"
          ],
          "line": 128
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "DOUBLE_ROUND",
          "args": [
            "k0",
            "k1",
            "k2",
            "k3",
            "0xA09E667Ful",
            "0x3BCC908Bul",
            "0xB67AE858ul",
            "0x4CAA73B2ul"
          ],
          "line": 126
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "22",
            "111",
            "3"
          ],
          "line": 122
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "18",
            "94",
            "3"
          ],
          "line": 121
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "16",
            "77",
            "3"
          ],
          "line": 120
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "12",
            "60",
            "2"
          ],
          "line": 119
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "10",
            "45",
            "3"
          ],
          "line": 118
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND",
          "args": [
            "4",
            "15",
            "3"
          ],
          "line": 117
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "KS_ROUND_0",
          "args": [
            "0"
          ],
          "line": 116
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getBlock",
          "args": [
            "kl3"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getBlock",
          "args": [
            "kl2"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getBlock",
          "args": [
            "kl1"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "getBlock",
          "args": [
            "kl0"
          ],
          "line": 73
        },
        "resolved": false,
        "reason": "library_or_external"
      },
      {
        "call_info": {
          "callee": "IsForwardTransformation",
          "args": [],
          "line": 68
        },
        "resolved": true,
        "details": {
          "function_name": "IsForwardTransformation",
          "container": null,
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2141/repo/arc4.h",
          "lines": "25-25",
          "snippet": "bool IsForwardTransformation() const {return true;}",
          "includes": [
            "#include \"strciphr.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include \"strciphr.h\"\n\nbool IsForwardTransformation() const {return true;}"
        }
      },
      {
        "call_info": {
          "callee": "m_key.data",
          "args": [],
          "line": 66
        },
        "resolved": true,
        "details": {
          "function_name": "data",
          "container": "SecBlock",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2141/repo/secblock.h",
          "lines": "300-300",
          "snippet": "typename A::const_pointer data() const {return m_ptr;}",
          "includes": [
            "#include <assert.h>",
            "#include \"misc.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <assert.h>\n#include \"misc.h\"\n#include \"config.h\"\n\nSecBlock {\n  typename A::const_pointer data() const {return m_ptr;}\n}"
        }
      },
      {
        "call_info": {
          "callee": "m_key.New",
          "args": [
            "kslen*2"
          ],
          "line": 65
        },
        "resolved": true,
        "details": {
          "function_name": "New",
          "container": "SecBlock",
          "file": "/home/michele/Desktop/ricerca/output_repos_cpp/CVE-2015-2141/repo/secblock.h",
          "lines": "361-365",
          "snippet": "void New(size_type newSize)\n\t{\n\t\tm_ptr = m_alloc.reallocate(m_ptr, m_size, newSize, false);\n\t\tm_size = newSize;\n\t}",
          "includes": [
            "#include <assert.h>",
            "#include \"misc.h\"",
            "#include \"config.h\""
          ],
          "macros_used": [],
          "globals_used": [],
          "called_functions": [],
          "contextual_snippet": "#include <assert.h>\n#include \"misc.h\"\n#include \"config.h\"\n\nSecBlock {\n  void New(size_type newSize)\n  \t{\n  \t\tm_ptr = m_alloc.reallocate(m_ptr, m_size, newSize, false);\n  \t\tm_size = newSize;\n  \t}\n}"
        }
      }
    ],
    "contextual_snippet": "#include \"cpu.h\"\n#include \"misc.h\"\n#include \"camellia.h\"\n#include \"pch.h\"\n\n#define PREPARE_KS_ROUNDS\t\t\t\t\t\t\t\t\t\t\t\t\t\\\n\tkw = _mm_set_epi32(k0, k1, k2, k3);\t\t\t\t\t\t\t\t\t\t\\\n\tif (m) kw2 = kw, kw = _mm_shuffle_epi32(kw, _MM_SHUFFLE(1, 0, 3, 2));\t\\\n\telse kw2 = _mm_shuffle_epi32(kw, _MM_SHUFFLE(1, 0, 3, 2))\n#define PREPARE_KS_ROUNDS\t\t\t\\\n\tkwl = (word64(k0) << 32) | k1;\t\\\n\tkwr = (word64(k2) << 32) | k3\n\nCamellia {\n  Base {\n    void Camellia::Base::UncheckedSetKey(const byte *key, unsigned int keylen, const NameValuePairs &)\n    {\n    \tm_rounds = (keylen >= 24) ? 4 : 3;\n    \tunsigned int kslen = (8 * m_rounds + 2);\n    \tm_key.New(kslen*2);\n    \tword32 *ks32 = m_key.data();\n    \tint m=0, a=0;\n    \tif (!IsForwardTransformation())\n    \t\tm = -1, a = kslen-1;\n    \n    \tword32 kl0, kl1, kl2, kl3;\n    \tGetBlock<word32, BigEndian> getBlock(key);\n    \tgetBlock(kl0)(kl1)(kl2)(kl3);\n    \tword32 k0=kl0, k1=kl1, k2=kl2, k3=kl3;\n    \n    #define CALC_ADDR2(base, i, j)\t((byte *)(base)+8*(i)+4*(j)+((-16*(i))&m))\n    #define CALC_ADDR(base, i)\tCALC_ADDR2(base, i, 0)\n    \n    #if 1\n    \tword64 kwl, kwr;\n    \tks32 += 2*a;\n    #define PREPARE_KS_ROUNDS\t\t\t\\\n    \tkwl = (word64(k0) << 32) | k1;\t\\\n    \tkwr = (word64(k2) << 32) | k3\n    #define KS_ROUND_0(i)\t\t\t\t\t\t\t\\\n    \t*(word64*)CALC_ADDR(ks32, i+EFI(0)) = kwl;\t\\\n    \t*(word64*)CALC_ADDR(ks32, i+EFI(1)) = kwr\n    #define KS_ROUND(i, r, which)\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\\\n    \tif (which & (1<<int(r<64))) *(word64*)CALC_ADDR(ks32, i+EFI(r<64)) = (kwr << (r%64)) | (kwl >> (64 - (r%64)));\t\\\n    \tif (which & (1<<int(r>64))) *(word64*)CALC_ADDR(ks32, i+EFI(r>64)) = (kwl << (r%64)) | (kwr >> (64 - (r%64)))\n    #else\n    \t// SSE2 version is 30% faster on Intel Core 2. Doesn't seem worth the hassle of maintenance, but left here\n    \t// #if'd out in case someone needs it.\n    \t__m128i kw, kw2;\n    \t__m128i *ks128 = (__m128i *)ks32+a/2;\n    \tks32 += 2*a;\n    #define PREPARE_KS_ROUNDS\t\t\t\t\t\t\t\t\t\t\t\t\t\\\n    \tkw = _mm_set_epi32(k0, k1, k2, k3);\t\t\t\t\t\t\t\t\t\t\\\n    \tif (m) kw2 = kw, kw = _mm_shuffle_epi32(kw, _MM_SHUFFLE(1, 0, 3, 2));\t\\\n    \telse kw2 = _mm_shuffle_epi32(kw, _MM_SHUFFLE(1, 0, 3, 2))\n    #define KS_ROUND_0(i)\t\t\t\t\t\t\t\t\t\t\\\n    \t_mm_store_si128((__m128i *)CALC_ADDR(ks128, i), kw)\n    #define KS_ROUND(i, r, which)\t{\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\\\n    \t__m128i temp;\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\t\\\n    \tif (r<64 && (which!=1 || m)) temp = _mm_or_si128(_mm_slli_epi64(kw, r%64), _mm_srli_epi64(kw2, 64-r%64));\t\\\n    \telse temp = _mm_or_si128(_mm_slli_epi64(kw2, r%64), _mm_srli_epi64(kw, 64-r%64));\t\t\t\t\t\t\t\\\n    \tif (which & 2) _mm_store_si128((__m128i *)CALC_ADDR(ks128, i), temp);\t\t\t\t\t\t\t\t\t\t\\\n    \telse _mm_storel_epi64((__m128i*)CALC_ADDR(ks32, i+EFI(0)), temp);\t\t\t\t\t\t\t\t\t\t\t\\\n    \t}\n    #endif\n    \n    \tif (keylen == 16)\n    \t{\n    \t\t// KL\n    \t\tPREPARE_KS_ROUNDS;\n    \t\tKS_ROUND_0(0);\n    \t\tKS_ROUND(4, 15, 3);\n    \t\tKS_ROUND(10, 45, 3);\n    \t\tKS_ROUND(12, 60, 2);\n    \t\tKS_ROUND(16, 77, 3);\n    \t\tKS_ROUND(18, 94, 3);\n    \t\tKS_ROUND(22, 111, 3);\n    \n    \t\t// KA\n    \t\tk0=kl0, k1=kl1, k2=kl2, k3=kl3;\n    \t\tDOUBLE_ROUND(k0, k1, k2, k3, 0xA09E667Ful, 0x3BCC908Bul, 0xB67AE858ul, 0x4CAA73B2ul);\n    \t\tk0^=kl0, k1^=kl1, k2^=kl2, k3^=kl3;\n    \t\tDOUBLE_ROUND(k0, k1, k2, k3, 0xC6EF372Ful, 0xE94F82BEul, 0x54FF53A5ul, 0xF1D36F1Cul);\n    \n    \t\tPREPARE_KS_ROUNDS;\n    \t\tKS_ROUND_0(2);\n    \t\tKS_ROUND(6, 15, 3);\n    \t\tKS_ROUND(8, 30, 3);\n    \t\tKS_ROUND(12, 45, 1);\n    \t\tKS_ROUND(14, 60, 3);\n    \t\tKS_ROUND(20, 94, 3);\n    \t\tKS_ROUND(24, 47, 3);\n    \t}\n    \telse\n    \t{\n    \t\t// KL\n    \t\tPREPARE_KS_ROUNDS;\n    \t\tKS_ROUND_0(0);\n    \t\tKS_ROUND(12, 45, 3);\n    \t\tKS_ROUND(16, 60, 3);\n    \t\tKS_ROUND(22, 77, 3);\n    \t\tKS_ROUND(30, 111, 3);\n    \n    \t\t// KR\n    \t\tword32 kr0, kr1, kr2, kr3;\n    \t\tGetBlock<word32, BigEndian>(key+16)(kr0)(kr1);\n    \t\tif (keylen == 24)\n    \t\t\tkr2 = ~kr0, kr3 = ~kr1;\n    \t\telse\n    \t\t\tGetBlock<word32, BigEndian>(key+24)(kr2)(kr3);\n    \t\tk0=kr0, k1=kr1, k2=kr2, k3=kr3;\n    \n    \t\tPREPARE_KS_ROUNDS;\n    \t\tKS_ROUND(4, 15, 3);\n    \t\tKS_ROUND(8, 30, 3);\n    \t\tKS_ROUND(18, 60, 3);\n    \t\tKS_ROUND(26, 94, 3);\n    \n    \t\t// KA\n    \t\tk0^=kl0, k1^=kl1, k2^=kl2, k3^=kl3;\n    \t\tDOUBLE_ROUND(k0, k1, k2, k3, 0xA09E667Ful, 0x3BCC908Bul, 0xB67AE858ul, 0x4CAA73B2ul);\n    \t\tk0^=kl0, k1^=kl1, k2^=kl2, k3^=kl3;\n    \t\tDOUBLE_ROUND(k0, k1, k2, k3, 0xC6EF372Ful, 0xE94F82BEul, 0x54FF53A5ul, 0xF1D36F1Cul);\n    \n    \t\tPREPARE_KS_ROUNDS;\n    \t\tKS_ROUND(6, 15, 3);\n    \t\tKS_ROUND(14, 45, 3);\n    \t\tKS_ROUND(24, 77, 3);\n    \t\tKS_ROUND(28, 94, 3);\n    \n    \t\t// KB\n    \t\tk0^=kr0, k1^=kr1, k2^=kr2, k3^=kr3;\n    \t\tDOUBLE_ROUND(k0, k1, k2, k3, 0x10E527FAul, 0xDE682D1Dul, 0xB05688C2ul, 0xB3E6C1FDul);\n    \n    \t\tPREPARE_KS_ROUNDS;\n    \t\tKS_ROUND_0(2);\n    \t\tKS_ROUND(10, 30, 3);\n    \t\tKS_ROUND(20, 60, 3);\n    \t\tKS_ROUND(32, 47, 3);\n    \t}\n    }\n  }\n}"
  }
]